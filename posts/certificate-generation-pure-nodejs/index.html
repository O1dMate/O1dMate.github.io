<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Certificate Generate Pure NodeJS" /><meta property="og:locale" content="en" /><meta name="description" content="This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node-forge npm module. This post will assume you are familiar with Certificates Authorities and Host Certificates already. There is not much explanation given as the code is well documented." /><meta property="og:description" content="This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node-forge npm module. This post will assume you are familiar with Certificates Authorities and Host Certificates already. There is not much explanation given as the code is well documented." /><link rel="canonical" href="/posts/certificate-generation-pure-nodejs/" /><meta property="og:url" content="/posts/certificate-generation-pure-nodejs/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-09-21T00:07:50+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Certificate Generate Pure NodeJS" /><meta name="twitter:site" content="@todo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-06T00:46:45+10:00","datePublished":"2021-09-21T00:07:50+10:00","description":"This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node-forge npm module. This post will assume you are familiar with Certificates Authorities and Host Certificates already. There is not much explanation given as the code is well documented.","headline":"Certificate Generate Pure NodeJS","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/certificate-generation-pure-nodejs/"},"url":"/posts/certificate-generation-pure-nodejs/"}</script><title>Certificate Generate Pure NodeJS | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/icon.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Node Security</a></h1><p class="site-subtitle fst-italic mb-0">Security & Programming Guides</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/todo" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Certificate Generate Pure NodeJS</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Certificate Generate Pure NodeJS</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1632146870" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Sep 21, 2021 </time> </span> <span> Updated <time data-ts="1638715605" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 6, 2021 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/todo">Alexander Wells</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1727 words" > <em>9 min</em> read</span></div></div></div></header><div class="content"><p>This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the <a href="https://www.npmjs.com/package/node-forge">node-forge</a> npm module. This post will assume you are familiar with Certificates Authorities and Host Certificates already. There is not much explanation given as the code is well documented.</p><ol><li><a href="#install-package">Install Package</a><li><a href="#setup">Setup</a><li><a href="#generating-a-certificate-authority">Generating a Certificate Authority</a><li><a href="#generating-a-host-certificate">Generating a Host Certificate</a><li><a href="#full-code">Full Code</a></ol><h1 id="install-package">Install Package</h1><p>First step is to install the required npm package:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>npm i node-forge
</pre></table></code></div></div><h1 id="setup">Setup</h1><p>To start with weâ€™ll need some helper functions for creating valid serial numbers, and also for generating the <code class="language-plaintext highlighter-rouge">notBefore</code> and <code class="language-plaintext highlighter-rouge">notAfter</code> dates. We will also define some constants that will be included in all the certificates (Country, State, Locality), as well as a boilerplate class with two methods we will fill in later.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">forge</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-forge</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">makeNumberPositive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hexString</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">hexString</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">);</span>

	<span class="k">if </span><span class="p">(</span><span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="k">return</span> <span class="nx">hexString</span><span class="p">;</span>

	<span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">-=</span> <span class="mi">8</span>
	<span class="k">return</span> <span class="nx">mostSignificativeHexDigitAsInt</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">hexString</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Generate a random serial number for the Certificate</span>
<span class="kd">const</span> <span class="nx">randomSerialNumber</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">makeNumberPositive</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nf">bytesToHex</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nf">getBytesSync</span><span class="p">(</span><span class="mi">20</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// Get the Not Before Date for a Certificate (will be valid from 2 days ago)</span>
<span class="kd">const</span> <span class="nx">getCertNotBefore</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">twoDaysAgo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">();</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 00:00:00Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get Certificate Expiration Date (Valid for 90 Days)</span>
<span class="kd">const</span> <span class="nx">getCertNotAfter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">ninetyDaysLater</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">notBefore</span><span class="p">.</span><span class="nf">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">90</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">();</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 23:59:59Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get CA Expiration Date (Valid for 100 Years)</span>
<span class="kd">const</span> <span class="nx">getCANotAfter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">notBefore</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">notBefore</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 23:59:59Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">DEFAULT_C</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Australia</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">DEFAULT_ST</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Victoria</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">DEFAULT_L</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Melbourne</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CertificateGeneration</span> <span class="p">{</span>
	<span class="kd">static</span> <span class="nc">CreateRootCA</span><span class="p">()</span> <span class="p">{}</span>
	<span class="kd">static</span> <span class="nc">CreateHostCert</span><span class="p">(</span><span class="nx">hostCertCN</span><span class="p">,</span> <span class="nx">validDomains</span><span class="p">,</span> <span class="nx">rootCAObject</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="generating-a-certificate-authority">Generating a Certificate Authority</h1><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="kd">static</span> <span class="nc">CreateRootCA</span><span class="p">()</span> <span class="p">{</span>
	<span class="c1">// Create a new Keypair for the Root CA</span>
	<span class="kd">const</span> <span class="p">{</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="nx">publicKey</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nf">generateKeyPair</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span>

	<span class="c1">// Define the attributes for the new Root CA</span>
	<span class="kd">const</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">C</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_C</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ST</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_ST</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">L</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_L</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CN</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">My Custom Testing RootCA</span><span class="dl">'</span>
	<span class="p">}];</span>

	<span class="kd">const</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">basicConstraints</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">cA</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">keyUsage</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">keyCertSign</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">cRLSign</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">}];</span>

	<span class="c1">// Create an empty Certificate</span>
	<span class="kd">const</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">createCertificate</span><span class="p">();</span>

	<span class="c1">// Set the Certificate attributes for the new Root CA</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">;</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">;</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="nf">randomSerialNumber</span><span class="p">();</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span> <span class="o">=</span> <span class="nf">getCertNotBefore</span><span class="p">();</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="o">=</span> <span class="nf">getCANotAfter</span><span class="p">(</span><span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">);</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nf">setSubject</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nf">setIssuer</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nf">setExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">);</span>

	<span class="c1">// Self-sign the Certificate</span>
	<span class="nx">cert</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nf">create</span><span class="p">());</span>

	<span class="c1">// Convert to PEM format</span>
	<span class="kd">const</span> <span class="nx">pemCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateToPem</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>
	<span class="kd">const</span> <span class="nx">pemKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyToPem</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>

	<span class="c1">// Return the PEM encoded cert and private key</span>
	<span class="k">return</span> <span class="p">{</span> <span class="na">certificate</span><span class="p">:</span> <span class="nx">pemCert</span><span class="p">,</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">pemKey</span><span class="p">,</span> <span class="na">notBefore</span><span class="p">:</span> <span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="generating-a-host-certificate">Generating a Host Certificate</h1><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre><td class="rouge-code"><pre><span class="kd">static</span> <span class="nc">CreateHostCert</span><span class="p">(</span><span class="nx">hostCertCN</span><span class="p">,</span> <span class="nx">validDomains</span><span class="p">,</span> <span class="nx">rootCAObject</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">hostCertCN</span><span class="p">.</span><span class="nf">toString</span><span class="p">().</span><span class="nf">trim</span><span class="p">())</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"hostCertCN" must be a String</span><span class="dl">'</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">validDomains</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"validDomains" must be an Array of Strings</span><span class="dl">'</span><span class="p">);</span>
	<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">rootCAObject</span> <span class="o">||</span> <span class="o">!</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nf">hasOwnProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">certificate</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nf">hasOwnProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">privateKey</span><span class="dl">'</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"rootCAObject" must be an Object with the properties "certificate" &amp; "privateKey"</span><span class="dl">'</span><span class="p">);</span>

	<span class="c1">// Convert the Root CA PEM details, to a forge Object</span>
	<span class="kd">let</span> <span class="nx">caCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateFromPem</span><span class="p">(</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nx">certificate</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">caKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyFromPem</span><span class="p">(</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

	<span class="c1">// Create a new Keypair for the Host Certificate</span>
	<span class="kd">const</span> <span class="nx">hostKeys</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nf">generateKeyPair</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span>

	<span class="c1">// Define the attributes/properties for the Host Certificate</span>
	<span class="kd">const</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">C</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_C</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ST</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_ST</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">L</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_L</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CN</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">value</span><span class="p">:</span> <span class="nx">hostCertCN</span>
	<span class="p">}];</span>

	<span class="kd">const</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">basicConstraints</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">cA</span><span class="p">:</span> <span class="kc">false</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">nsCertType</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">server</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subjectKeyIdentifier</span><span class="dl">'</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">authorityKeyIdentifier</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">authorityCertIssuer</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">serialNumber</span><span class="p">:</span> <span class="nx">caCert</span><span class="p">.</span><span class="nx">serialNumber</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">keyUsage</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">digitalSignature</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">nonRepudiation</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">keyEncipherment</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">extKeyUsage</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">serverAuth</span><span class="p">:</span> <span class="kc">true</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subjectAltName</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">altNames</span><span class="p">:</span> <span class="nx">validDomains</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">domain</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">domain</span> <span class="p">}</span> <span class="p">})</span>
	<span class="p">}];</span>

	<span class="c1">// Create an empty Certificate</span>
	<span class="kd">let</span> <span class="nx">newHostCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">createCertificate</span><span class="p">();</span>

	<span class="c1">// Set the attributes for the new Host Certificate</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">hostKeys</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">;</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="nf">randomSerialNumber</span><span class="p">();</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span> <span class="o">=</span> <span class="nf">getCertNotBefore</span><span class="p">();</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="o">=</span> <span class="nf">getCertNotAfter</span><span class="p">(</span><span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">);</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setSubject</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setIssuer</span><span class="p">(</span><span class="nx">caCert</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">);</span>

	<span class="c1">// Sign the new Host Certificate using the CA</span>
	<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">caKey</span><span class="p">,</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nf">create</span><span class="p">());</span>

	<span class="c1">// Convert to PEM format</span>
	<span class="kd">let</span> <span class="nx">pemHostCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateToPem</span><span class="p">(</span><span class="nx">newHostCert</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">pemHostKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyToPem</span><span class="p">(</span><span class="nx">hostKeys</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">{</span> <span class="na">certificate</span><span class="p">:</span> <span class="nx">pemHostCert</span><span class="p">,</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">pemHostKey</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><h1 id="full-code">Full Code</h1><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">forge</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-forge</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">makeNumberPositive</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hexString</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">hexString</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">);</span>

	<span class="k">if </span><span class="p">(</span><span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="k">return</span> <span class="nx">hexString</span><span class="p">;</span>

	<span class="nx">mostSignificativeHexDigitAsInt</span> <span class="o">-=</span> <span class="mi">8</span>
	<span class="k">return</span> <span class="nx">mostSignificativeHexDigitAsInt</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span> <span class="o">+</span> <span class="nx">hexString</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Generate a random serial number for the Certificate</span>
<span class="kd">const</span> <span class="nx">randomSerialNumber</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nf">makeNumberPositive</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nf">bytesToHex</span><span class="p">(</span><span class="nx">forge</span><span class="p">.</span><span class="nx">random</span><span class="p">.</span><span class="nf">getBytesSync</span><span class="p">(</span><span class="mi">20</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// Get the Not Before Date for a Certificate (will be valid from 2 days ago)</span>
<span class="kd">const</span> <span class="nx">getCertNotBefore</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">twoDaysAgo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">();</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">twoDaysAgo</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 00:00:00Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get Certificate Expiration Date (Valid for 90 Days)</span>
<span class="kd">const</span> <span class="nx">getCertNotAfter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">ninetyDaysLater</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">notBefore</span><span class="p">.</span><span class="nf">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="o">*</span><span class="mi">90</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">();</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">ninetyDaysLater</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 23:59:59Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get CA Expiration Date (Valid for 100 Years)</span>
<span class="kd">const</span> <span class="nx">getCANotAfter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">year</span> <span class="o">=</span> <span class="nx">notBefore</span><span class="p">.</span><span class="nf">getFullYear</span><span class="p">()</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">month</span> <span class="o">=</span> <span class="p">(</span><span class="nx">notBefore</span><span class="p">.</span><span class="nf">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">toString</span><span class="p">().</span><span class="nf">padStart</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">day</span> <span class="o">=</span> <span class="nx">notBefore</span><span class="p">.</span><span class="nf">getDate</span><span class="p">();</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">year</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">month</span><span class="p">}</span><span class="s2">-</span><span class="p">${</span><span class="nx">day</span><span class="p">}</span><span class="s2"> 23:59:59Z`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">DEFAULT_C</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Australia</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">DEFAULT_ST</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Victoria</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">DEFAULT_L</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Melbourne</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">CertificateGeneration</span> <span class="p">{</span>
	<span class="kd">static</span> <span class="nc">CreateRootCA</span><span class="p">()</span> <span class="p">{</span>
		<span class="c1">// Create a new Keypair for the Root CA</span>
		<span class="kd">const</span> <span class="p">{</span> <span class="nx">privateKey</span><span class="p">,</span> <span class="nx">publicKey</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nf">generateKeyPair</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span>

		<span class="c1">// Define the attributes for the new Root CA</span>
		<span class="kd">const</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">C</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_C</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ST</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_ST</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">L</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_L</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CN</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="dl">'</span><span class="s1">My Custom Testing RootCA</span><span class="dl">'</span>
		<span class="p">}];</span>

		<span class="kd">const</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">basicConstraints</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">cA</span><span class="p">:</span> <span class="kc">true</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">keyUsage</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">keyCertSign</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="na">cRLSign</span><span class="p">:</span> <span class="kc">true</span>
		<span class="p">}];</span>

		<span class="c1">// Create an empty Certificate</span>
		<span class="kd">const</span> <span class="nx">cert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">createCertificate</span><span class="p">();</span>

		<span class="c1">// Set the Certificate attributes for the new Root CA</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">publicKey</span><span class="p">;</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">privateKey</span><span class="p">;</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="nf">randomSerialNumber</span><span class="p">();</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span> <span class="o">=</span> <span class="nf">getCertNotBefore</span><span class="p">();</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="o">=</span> <span class="nf">getCANotAfter</span><span class="p">(</span><span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">);</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nf">setSubject</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nf">setIssuer</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nf">setExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">);</span>

		<span class="c1">// Self-sign the Certificate</span>
		<span class="nx">cert</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">,</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nf">create</span><span class="p">());</span>

		<span class="c1">// Convert to PEM format</span>
		<span class="kd">const</span> <span class="nx">pemCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateToPem</span><span class="p">(</span><span class="nx">cert</span><span class="p">);</span>
		<span class="kd">const</span> <span class="nx">pemKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyToPem</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">);</span>

		<span class="c1">// Return the PEM encoded cert and private key</span>
		<span class="k">return</span> <span class="p">{</span> <span class="na">certificate</span><span class="p">:</span> <span class="nx">pemCert</span><span class="p">,</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">pemKey</span><span class="p">,</span> <span class="na">notBefore</span><span class="p">:</span> <span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">cert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="p">};</span>
	<span class="p">}</span>

	<span class="kd">static</span> <span class="nc">CreateHostCert</span><span class="p">(</span><span class="nx">hostCertCN</span><span class="p">,</span> <span class="nx">validDomains</span><span class="p">,</span> <span class="nx">rootCAObject</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">hostCertCN</span><span class="p">.</span><span class="nf">toString</span><span class="p">().</span><span class="nf">trim</span><span class="p">())</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"hostCertCN" must be a String</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="nf">isArray</span><span class="p">(</span><span class="nx">validDomains</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"validDomains" must be an Array of Strings</span><span class="dl">'</span><span class="p">);</span>
		<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">rootCAObject</span> <span class="o">||</span> <span class="o">!</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nf">hasOwnProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">certificate</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nf">hasOwnProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">privateKey</span><span class="dl">'</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">"rootCAObject" must be an Object with the properties "certificate" &amp; "privateKey"</span><span class="dl">'</span><span class="p">);</span>

		<span class="c1">// Convert the Root CA PEM details, to a forge Object</span>
		<span class="kd">let</span> <span class="nx">caCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateFromPem</span><span class="p">(</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nx">certificate</span><span class="p">);</span>
		<span class="kd">let</span> <span class="nx">caKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyFromPem</span><span class="p">(</span><span class="nx">rootCAObject</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

		<span class="c1">// Create a new Keypair for the Host Certificate</span>
		<span class="kd">const</span> <span class="nx">hostKeys</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nx">rsa</span><span class="p">.</span><span class="nf">generateKeyPair</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span>

		<span class="c1">// Define the attributes/properties for the Host Certificate</span>
		<span class="kd">const</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">[{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">C</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_C</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ST</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_ST</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">L</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">DEFAULT_L</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">shortName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">CN</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">value</span><span class="p">:</span> <span class="nx">hostCertCN</span>
		<span class="p">}];</span>

		<span class="kd">const</span> <span class="nx">extensions</span> <span class="o">=</span> <span class="p">[{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">basicConstraints</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">cA</span><span class="p">:</span> <span class="kc">false</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">nsCertType</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">server</span><span class="p">:</span> <span class="kc">true</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subjectKeyIdentifier</span><span class="dl">'</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">authorityKeyIdentifier</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">authorityCertIssuer</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="na">serialNumber</span><span class="p">:</span> <span class="nx">caCert</span><span class="p">.</span><span class="nx">serialNumber</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">keyUsage</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">digitalSignature</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="na">nonRepudiation</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="na">keyEncipherment</span><span class="p">:</span> <span class="kc">true</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">extKeyUsage</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">serverAuth</span><span class="p">:</span> <span class="kc">true</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">subjectAltName</span><span class="dl">'</span><span class="p">,</span>
			<span class="na">altNames</span><span class="p">:</span> <span class="nx">validDomains</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="nx">domain</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">domain</span> <span class="p">}</span> <span class="p">})</span>
		<span class="p">}];</span>

		<span class="c1">// Create an empty Certificate</span>
		<span class="kd">let</span> <span class="nx">newHostCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">createCertificate</span><span class="p">();</span>

		<span class="c1">// Set the attributes for the new Host Certificate</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">publicKey</span> <span class="o">=</span> <span class="nx">hostKeys</span><span class="p">.</span><span class="nx">publicKey</span><span class="p">;</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">serialNumber</span> <span class="o">=</span> <span class="nf">randomSerialNumber</span><span class="p">();</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span> <span class="o">=</span> <span class="nf">getCertNotBefore</span><span class="p">();</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="o">=</span> <span class="nf">getCertNotAfter</span><span class="p">(</span><span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">);</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setSubject</span><span class="p">(</span><span class="nx">attributes</span><span class="p">);</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setIssuer</span><span class="p">(</span><span class="nx">caCert</span><span class="p">.</span><span class="nx">subject</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">setExtensions</span><span class="p">(</span><span class="nx">extensions</span><span class="p">);</span>

		<span class="c1">// Sign the new Host Certificate using the CA</span>
		<span class="nx">newHostCert</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="nx">caKey</span><span class="p">,</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">md</span><span class="p">.</span><span class="nx">sha512</span><span class="p">.</span><span class="nf">create</span><span class="p">());</span>

		<span class="c1">// Convert to PEM format</span>
		<span class="kd">let</span> <span class="nx">pemHostCert</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">certificateToPem</span><span class="p">(</span><span class="nx">newHostCert</span><span class="p">);</span>
		<span class="kd">let</span> <span class="nx">pemHostKey</span> <span class="o">=</span> <span class="nx">forge</span><span class="p">.</span><span class="nx">pki</span><span class="p">.</span><span class="nf">privateKeyToPem</span><span class="p">(</span><span class="nx">hostKeys</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">);</span>

		<span class="k">return</span> <span class="p">{</span> <span class="na">certificate</span><span class="p">:</span> <span class="nx">pemHostCert</span><span class="p">,</span> <span class="na">privateKey</span><span class="p">:</span> <span class="nx">pemHostKey</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notBefore</span><span class="p">,</span> <span class="na">notAfter</span><span class="p">:</span> <span class="nx">newHostCert</span><span class="p">.</span><span class="nx">validity</span><span class="p">.</span><span class="nx">notAfter</span> <span class="p">};</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">CA</span> <span class="o">=</span> <span class="nx">CertificateGeneration</span><span class="p">.</span><span class="nc">CreateRootCA</span><span class="p">();</span>

<span class="cm">/* The following certificate:
	- Will be called 'testing.com'.
	- Will be valid for 'testing.com' and 'test.com'.
	- Will be signed by the CA we just created above.
*/</span>
<span class="kd">let</span> <span class="nx">hostCert</span> <span class="o">=</span> <span class="nx">CertificateGeneration</span><span class="p">.</span><span class="nc">CreateHostCert</span><span class="p">(</span><span class="dl">'</span><span class="s1">testing.com</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span><span class="dl">'</span><span class="s1">testing.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">test.com</span><span class="dl">'</span><span class="p">],</span> <span class="nx">CA</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">CA</span><span class="p">.</span><span class="nx">certificate</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">hostCert</span><span class="p">.</span><span class="nx">certificate</span><span class="p">);</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/security/">security</a>, <a href="/categories/web/">web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a> <a href="/tags/https/" class="post-tag no-text-decoration" >https</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/certificates/" class="post-tag no-text-decoration" >certificates</a> <a href="/tags/ca/" class="post-tag no-text-decoration" >ca</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Certificate%20Generate%20Pure%20NodeJS%20-%20Node%20Security&url=%2Fposts%2Fcertificate-generation-pure-nodejs%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Certificate%20Generate%20Pure%20NodeJS%20-%20Node%20Security&u=%2Fposts%2Fcertificate-generation-pure-nodejs%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fcertificate-generation-pure-nodejs%2F&text=Certificate%20Generate%20Pure%20NodeJS%20-%20Node%20Security" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/json-parse-and-filter/">JSON Parse & Filter</a><li class="text-truncate lh-lg"> <a href="/posts/password-word-list-generator/">Password Word List Generator</a><li class="text-truncate lh-lg"> <a href="/posts/rust-cheatsheet/">Rust Cheatsheet</a><li class="text-truncate lh-lg"> <a href="/posts/breaking-out-of-windows-environments/">Breaking out of Windows Environments</a><li class="text-truncate lh-lg"> <a href="/posts/custom-right-click-menu-option/">Windows Custom Right Click Menu Option</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/jwt-fuzzing/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1621929818" data-df="ll" > May 25, 2021 </time><h4 class="pt-0 my-2">JWT Fuzzing</h4><div class="text-muted"><p>The goal of this tool is to create a list of fuzzing payloads for testing JWTs on web services and applications. The payloads are designed to test common JWT issues and bypasses, as well as attempt...</p></div></div></a></article><article class="col"> <a href="/posts/cookies-ports-and-subdomains/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1643371690" data-df="ll" > Jan 28, 2022 </time><h4 class="pt-0 my-2">Cookies, Ports and Subdomains</h4><div class="text-muted"><p>This post will look at how browser cookies work when used on different subdomains and on different ports. Short Answer &amp;amp; Summary Cookie without Domain Attribute Same Domain Dif...</p></div></div></a></article><article class="col"> <a href="/posts/jsp-war-shell/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1635152988" data-df="ll" > Oct 25, 2021 </time><h4 class="pt-0 my-2">JSP War Shell</h4><div class="text-muted"><p>How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s). JSP War Shell MSFVeno...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/objection-quick-start/" class="btn btn-outline-primary" aria-label="Older" ><p>Objection Quick Start</p></a> <a href="/posts/web-app-security/" class="btn btn-outline-primary" aria-label="Newer" ><p>Web App Security</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>Â© <time>2025</time> <a href="https://twitter.com/todo">Alexander Wells</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
