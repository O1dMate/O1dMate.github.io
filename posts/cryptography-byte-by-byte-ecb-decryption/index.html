<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="Cryptography - Byte by Byte ECB Decryption" /><meta property="og:locale" content="en" /><meta name="description" content="In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key." /><meta property="og:description" content="In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key." /><link rel="canonical" href="/posts/cryptography-byte-by-byte-ecb-decryption/" /><meta property="og:url" content="/posts/cryptography-byte-by-byte-ecb-decryption/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-12T18:50:23+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cryptography - Byte by Byte ECB Decryption" /><meta name="twitter:site" content="@todo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-30T18:17:01+10:00","datePublished":"2021-12-12T18:50:23+10:00","description":"In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.","headline":"Cryptography - Byte by Byte ECB Decryption","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/cryptography-byte-by-byte-ecb-decryption/"},"url":"/posts/cryptography-byte-by-byte-ecb-decryption/"}</script><title>Cryptography - Byte by Byte ECB Decryption | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/icon.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Node Security</a></h1><p class="site-subtitle fst-italic mb-0">Security & Programming Guides</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/todo" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Cryptography - Byte by Byte ECB Decryption</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>Cryptography - Byte by Byte ECB Decryption</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1639299023" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 12, 2021 </time> </span> <span> Updated <time data-ts="1672388221" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 30, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/todo">Alexander Wells</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1863 words" > <em>10 min</em> read</span></div></div></div></header><div class="content"><p>In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.</p><p>This post will assume you know what PKCS#7 padding is. If you’re unsure what this is, you can read my short post about it <a href="/posts/cryptography-pkcs-7-padding/">here</a>.</p><p>This post is also a solution to <a href="https://cryptopals.com/sets/2/challenges/12">challenge 12</a> on the <a href="https://cryptopals.com/">cryptopals</a> website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and visual examples.</p><style> .customTable { border: 2px solid darkgrey; border-collapse: collapse; table-layout: fixed; margin-bottom: 10px; width: 100%; } .customCell { border: 1px solid darkgrey; text-align: center; } .rowHighlightTopAndSides { border: 2px solid yellow; } .rowHighlightTop { border-top: 2px solid yellow; } .indigo { background-color: indigo; } .darkmagenta { background-color: darkmagenta; } .darkgreen { background-color: darkgreen; } .darkred { background-color: darkred; } .black { background-color: black; }</style><ol><li><a href="#what-are-we-breaking">What are we Breaking</a><li><a href="#attack-summary">Attack Summary</a><ul><li><a href="#step-1---determining-the-block-size">Step 1 - Determining the Block Size</a><li><a href="#step-2---unknown-string-size">Step 2 - Unknown String Size</a><li><a href="#step-3---determining-the-unknown-string">Step 3 - Determining the Unknown String</a><li><a href="#step-4---determining-the-unknown-string-continued">Step 4 - Determining the Unknown String Continued</a></ul></ol><h1 id="what-are-we-breaking">What are we Breaking</h1><p>For a more concrete example of what we are breaking, imagine the oracle function is a web server API such as:</p><ul><li><code class="language-plaintext highlighter-rouge">POST /encrypt</code> This API would take a single parameter which is the message we want to encrypt, and would return the cipher-text. Because the key used by the server remains constant, sending the same message results in the same response.</ul><p><strong>Example Request</strong></p><blockquote><p>This is my message I want encrypted</p></blockquote><p><strong>Example Response (HEX)</strong></p><blockquote><p>3b600a3994308f1d53879432125635deb10485748eefc86905180ff82f9a73c235b09a4c89e30328094effe8d2282edb9e2d3ccf364ba758e1395f1fcebbedc1</p></blockquote><p><br /></p><p>Behind the scenes the server is doing the following:</p><ol><li>Concatenating the user supplied string with an unknown constant string (like a salt), and encrypting it with a unknown constant key.<ul><li><code class="language-plaintext highlighter-rouge">AES-ECB(user-string || unknown-constant-string, unknown-constant-key)</code></ul><li>The resulting encrypted data is sent back to the user.</ol><p>My claim is that we can determine exactly what <code class="language-plaintext highlighter-rouge">unknown-constant-string</code> is by repeated calls to this oracle function without ever knowing the encryption key!</p><p><br /></p><h1 id="attack-summary">Attack Summary</h1><h2 id="step-1---determining-the-block-size"><span class="me-2">Step 1 - Determining the Block Size</span><a href="#step-1---determining-the-block-size" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The first piece of information we require is the block size, since encryption modes like ECB and CBC encrypt blocks of a fixed length. The cryptopals challenge uses AES, so we already know the block size is 16 bytes, but we’ll assume we don’t know that. The below visual examples will use a block size of 8 bytes, since it fits on the screen better. The technique is exactly the same for all block sizes.</p><p>Working out the block size is very simple, we just need to do the following:</p><ol><li>Create a message 1 byte in length.<li>Send the message to the oracle function, and store the cipher-text length.<li>Increase the message size by 1 byte, and send the message to the oracle function.<li>Repeat the previous step until the length of the cipher-text changes.<li>The block size will be the final size minus the original size.</ol><p>Example Setup:</p><ul><li>The server is using a unknown string that is 13 bytes long (marked as <code class="language-plaintext highlighter-rouge">XX</code> since we don’t know what it is).<li>We’ll use the byte <code class="language-plaintext highlighter-rouge">0x41</code> as our message, which is actually the letter <code class="language-plaintext highlighter-rouge">A</code>. This is arbitrary, and you can use any byte you like.<li>After the user string is concatenated with the unknown string, the message is padded using PKCS#7 to make sure the length is a multiple of block size.</ul><p><strong>Message 1 (1 Byte Message)</strong></p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">02<td class="customCell indigo">02</table></div><p>After being encrypted and returned, the length would be 16 bytes, which we store as the starting size. We add another message byte and repeat.</p><p><strong>Message 2 (2 Byte Message)</strong></p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">01</table></div><p>The response is still 16 bytes long, so we add another message byte and repeat.</p><p><strong>Message 3 (3 Byte Message)</strong></p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08</table></div><p>The response size has increased to 24 bytes. We now stop, and subtract the current size from the starting size to find the block size.</p><p>Block Size = 24 - 16</p><p>Block Size = 8 bytes</p><p><br /></p><h2 id="step-2---unknown-string-size"><span class="me-2">Step 2 - Unknown String Size</span><a href="#step-2---unknown-string-size" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This part is trivial now that we have determined the block size in the last step. We don’t even have to send any more messages to work this out.</p><p>The first message we sent was 1 byte long, and the response was 16 bytes long. This means the unknown string is guaranteed to be less than 16 bytes long.</p><p>We kept adding bytes to our message until the next block is added. Recall that in PKCS#7 padding, an entire block of padding is added when the plain-text length is a multiple of the block size.</p><ul><li>Look at Message 3 above, the plain-text <code class="language-plaintext highlighter-rouge">(user-string || unknown-string)</code> exactly filled 2 blocks</ul><p>Because of this, we now know:</p><ul><li>length(user-string) + length(unknown-string) = 16 bytes<li>length(unknown-string) = 16 bytes - length(user-string)<li>length(unknown-string) = 16 bytes - 3 bytes<li>length(unknown-string) = 13 bytes</ul><p>The <code class="language-plaintext highlighter-rouge">16 bytes</code> comes from the response length in Message 1. The <code class="language-plaintext highlighter-rouge">3 bytes</code> comes from the length of our message when the response size increased.</p><p>Perfect, with just a little Math we know the length of the unknown string is <code class="language-plaintext highlighter-rouge">13 bytes</code>!</p><p>Now let’s get to decrypting what unknown string is.</p><p><br /></p><h2 id="step-3---determining-the-unknown-string"><span class="me-2">Step 3 - Determining the Unknown String</span><a href="#step-3---determining-the-unknown-string" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Our first step to finding the unknown string is to create a piece of plain-text that is <strong>bigger</strong> than the unknown string.</p><p>Since the unknown string is 13 bytes long, we’ll add enough extra bytes until it’s a multiple of the block size. Our plain-text will be 16 bytes long, since 16 is a multiple of 8 (block size), and is bigger than 13 (unknown string size).</p><p>The message we’ll send is 16 repeated bytes (we’ll use <code class="language-plaintext highlighter-rouge">0x41</code> again). If we send said message to the server, we know that it would look like this after the unknown string and padding is added:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><p>The only block of plain-text and cipher-text we’ll really be looking at is what block number the final block of plain-text is. Since we sent 2 blocks of plain-text, we’ll only be interested in the 2nd block of cipher-text. If we had sent 30 blocks of plain-text, we’d only focus on the 30th block of cipher-text.</p><p>Okay, now the fun stuff. Observe what we happen if we were to remove a single byte of our message. The first byte of the unknown string is now the last byte in block 2 (the highlighted row):</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">04<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04</table></div><p>How do we determine what that unknown byte is? By brute force!</p><p>A byte can only be 256 possible values. So we’ll send 256 messages, each with a different value in the final position of block 2.</p><p>Message 1 would look like this:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">00<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><p>Message 2 would look like this:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">01<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><p>…</p><p>Message 256 would look like this:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">FF<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><p>For each of the 256 messages, we store the cipher-text value of block 2 (the highlighted row) along with the byte that was added in a lookup table.</p><p>Now let’s send the earlier message with 1 byte less than a full block:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04</table></div><p>We can now get the cipher-text value of block 2, perform a lookup in our table, and see what byte is required to produce said cipher-text. It turns out it was <code class="language-plaintext highlighter-rouge">0x53</code>.</p><p>We’ve just discovered the first byte of the unknown string, let’s find more!</p><p><br /></p><h2 id="step-4---determining-the-unknown-string-continued"><span class="me-2">Step 4 - Determining the Unknown String Continued</span><a href="#step-4---determining-the-unknown-string-continued" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We’ve found the first byte, 1 down, 12 to go. We just need to rinse and repeat.</p><p>For the second byte, we first remove another byte of our message so that the first two bytes of the unknown string are in block 2:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">53<td class="customCell darkred">XX<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05</table></div><p>Since we know the first byte of the unknown string, there are again only 256 possible values for the final byte. So let’s brute force again and create another lookup table. From now on we’ll be appending the recovered unknown string bytes to the end of our plain-text when doing the brute forcing.</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">53<td class="customCell darkgreen">00<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">53<td class="customCell darkgreen">01<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table></div><p>With the new lookup table built, we can send our plain-text message (with no unknown string bytes added), extract block 2 of the cipher-text, and perform a lookup to see what byte produced that cipher-text:</p><div class="table-wrapper"><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlightTopAndSides"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">53<td class="customCell darkred">XX<tr class="rowHighlightTop"><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05</table></div><p>It turns out the second byte was <code class="language-plaintext highlighter-rouge">0x65</code>.</p><p>Awesome, 2 bytes down 11 to go. This step is just rinse and repeat until all the unknown string bytes are found.</p><h1 id="finishing-up">Finishing Up</h1><p>After repeating Step 4 eleven more times, we’ve found our unknown string for our example. It turns out it was <code class="language-plaintext highlighter-rouge">SecretStuff@1</code>.</p><p>Using this exact technique on the challenge cipher-text yielded the following unknown string.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Rollin' in my 5.0
With my rag-top down so my hair can blow
The girlies on standby waving just to say hi
Did you stop? No, I just drove by
</pre></table></code></div></div><p>Some final notes:</p><ul><li>We recovered this string without knowledge of the encryption key.<li>This attack was not on the underlying cipher, it was against the cipher mode. AES is just as vulnerable to this attack as DES.<li>This attack scales linearly O(N) and takes (256 * N) oracle function calls to complete, where N is the length of the unknown string. This could be lowered if you assumed/guessed the unknown string is only printable ASCII chars.<li>Checkout the <a href="https://cryptopals.com/">cryptopals</a> website if you want to solve more problems like this and learn more about cryptography.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/security/">security</a>, <a href="/categories/cryptography/">cryptography</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/cipher/" class="post-tag no-text-decoration" >cipher</a> <a href="/tags/encryption/" class="post-tag no-text-decoration" >encryption</a> <a href="/tags/decryption/" class="post-tag no-text-decoration" >decryption</a> <a href="/tags/algorithm/" class="post-tag no-text-decoration" >algorithm</a> <a href="/tags/tools/" class="post-tag no-text-decoration" >tools</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cryptography%20-%20Byte%20by%20Byte%20ECB%20Decryption%20-%20Node%20Security&url=%2Fposts%2Fcryptography-byte-by-byte-ecb-decryption%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cryptography%20-%20Byte%20by%20Byte%20ECB%20Decryption%20-%20Node%20Security&u=%2Fposts%2Fcryptography-byte-by-byte-ecb-decryption%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fcryptography-byte-by-byte-ecb-decryption%2F&text=Cryptography%20-%20Byte%20by%20Byte%20ECB%20Decryption%20-%20Node%20Security" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/pdf-combine/">PDF Combiner</a><li class="text-truncate lh-lg"> <a href="/posts/json-parse-and-filter/">JSON Parse & Filter</a><li class="text-truncate lh-lg"> <a href="/posts/password-word-list-generator/">Password Word List Generator</a><li class="text-truncate lh-lg"> <a href="/posts/rust-cheatsheet/">Rust Cheatsheet</a><li class="text-truncate lh-lg"> <a href="/posts/breaking-out-of-windows-environments/">Breaking out of Windows Environments</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1639171442" data-df="ll" > Dec 11, 2021 </time><h4 class="pt-0 my-2">Cryptography - Breaking Repeating Key XOR Encryption</h4><div class="text-muted"><p>In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter fr...</p></div></div></a></article><article class="col"> <a href="/posts/cryptography-breaking-single-byte-xor-encryption/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1638739442" data-df="ll" > Dec 6, 2021 </time><h4 class="pt-0 my-2">Cryptography - Breaking Single Byte XOR Encryption</h4><div class="text-muted"><p>In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encrypti...</p></div></div></a></article><article class="col"> <a href="/posts/cryptographic-recommendation-summary/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1653711478" data-df="ll" > May 28, 2022 </time><h4 class="pt-0 my-2">Cryptographic Recommendation Summary</h4><div class="text-muted"><p>This post contains recommendation summaries for password security and cryptographic topics including password complexity &amp;amp; storage, hash functions, symmetric &amp;amp; asymmetric encryption, MACs, ...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="btn btn-outline-primary" aria-label="Older" ><p>Cryptography - Breaking Repeating Key XOR Encryption</p></a> <a href="/posts/frida-for-ios/" class="btn btn-outline-primary" aria-label="Newer" ><p>Frida for iOS</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/todo">Alexander Wells</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
