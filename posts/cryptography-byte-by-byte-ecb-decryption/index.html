<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Cryptography - Byte by Byte ECB Decryption" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key." /><meta property="og:description" content="In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key." /><link rel="canonical" href="https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/" /><meta property="og:url" content="https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-12T18:50:23+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cryptography - Byte by Byte ECB Decryption" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="zCs6F-1y95azrfcOnbFvS60JAILGGXaeG4vY1-JFacs" /> <script type="application/ld+json"> {"url":"https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/","@type":"BlogPosting","headline":"Cryptography - Byte by Byte ECB Decryption","dateModified":"2021-12-12T19:20:22+10:00","datePublished":"2021-12-12T18:50:23+10:00","description":"In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.","mainEntityOfPage":{"@type":"WebPage","@id":"https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/"},"@context":"https://schema.org"}</script><title>Cryptography - Byte by Byte ECB Decryption | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"></noscript> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/icon.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Node Security</a></div><div class="site-subtitle font-italic">Security & Programming Guides</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cryptography - Byte by Byte ECB Decryption</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cryptography - Byte by Byte ECB Decryption</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexander Wells </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 12, 2021, 6:50 PM +1000" >Dec 12, 2021<i class="unloaded">2021-12-12T18:50:23+10:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Dec 12, 2021, 8:20 PM +1100" >Dec 12, 2021<i class="unloaded">2021-12-12T19:20:22+10:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1837 words">10 min read</span></div></div><div class="post-content"><p>In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key.</p><p>This post will assume you know what PKCS#7 padding is. If you’re unsure what this is, you can read my short post about it <a href="/posts/cryptography-pkcs-7-padding/">here</a>.</p><p>This post is also a solution to <a href="https://cryptopals.com/sets/2/challenges/12">challenge 12</a> on the <a href="https://cryptopals.com/">cryptopals</a> website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and visual examples.</p><style> .customTable { border: 1px solid darkgrey; border-collapse: collapse; table-layout: fixed; margin-bottom: 10px; width: 100%; } .customCell { border: 1px solid darkgrey; text-align: center; } .rowHighlight { border: 2px solid yellow; } .indigo { background-color: indigo; } .darkmagenta { background-color: darkmagenta; } .darkgreen { background-color: darkgreen; } .darkred { background-color: darkred; } .black { background-color: black; } .clearCell { border: 1px solid transparent; }</style><ol><li><a href="#what-are-we-breaking">What are we Breaking</a><li><a href="#attack-summary">Attack Summary</a></ol><h1 id="what-are-we-breaking">What are we Breaking</h1><p>For a more concrete example of what we are breaking, imagine the oracle function is a web server API such as:</p><ul><li><code class="language-plaintext highlighter-rouge">POST /encrypt</code> This API would take a single parameter which is the message we want to encrypt, and would return the cipher-text. Because the key used by the server remains constant, sending the same message results in the same response.</ul><p><strong>Example Request</strong></p><blockquote><p>This is my message I want encrypted</p></blockquote><p><strong>Example Response (HEX)</strong></p><blockquote><p>3b600a3994308f1d53879432125635deb10485748eefc86905180ff82f9a73c235b09a4c89e30328094effe8d2282edb9e2d3ccf364ba758e1395f1fcebbedc1</p></blockquote><p><br /></p><p>Behind the scenes the server is doing the following:</p><ol><li>Concatenating the user supplied string with an unknown string (like a salt), and encrypting it with a random but constant key.<ul><li><code class="language-plaintext highlighter-rouge">AES-ECB(user-string || unknown-string, random-key)</code></ul><li>The resulting encrypted data is sent back to the user.</ol><p>My claim is that we can determine exactly what <code class="language-plaintext highlighter-rouge">unknown-string</code> is by repeated calls to this oracle function without ever knowing the encryption key!</p><p><br /></p><h1 id="attack-summary">Attack Summary</h1><h2 id="step-1---block-size">Step 1 - Block Size</h2><p>The first piece of information we require is the block size, since encryption modes like ECB and CBC encrypt blocks of a fixed length. The cryptopals challenge uses AES, so we already know the block size is 16 bytes, but we’ll assume we don’t know that. The below visual examples will use a block size of 8 bytes, since it fits on the screen better. The technique is exactly the same for all block sizes.</p><p>Working out the block size is very simple, we just need to do the following:</p><ol><li>Create a message 1 byte in length.<li>Send the message to the oracle function, and store the cipher-text length.<li>Increase the message size by 1 byte, and send the message to the oracle function.<li>Repeat the previous step until the length of the cipher-text changes.<li>The block size will be the final size minus the original size.</ol><h2 id="step-1---visual-example">Step 1 - Visual Example</h2><p>Example Configuration:</p><ul><li>The server is using a unknown string that is 13 bytes long (marked as <code class="language-plaintext highlighter-rouge">XX</code> since we don’t know what it is).<li>We’ll use the byte <code class="language-plaintext highlighter-rouge">0x41</code> as our message, which is actually the letter <code class="language-plaintext highlighter-rouge">A</code>. This is arbitrary, and you can use any byte you like.<li>After the user string is concatenated with the unknown string, the message is padded using PKCS#7 to make sure the length is a multiple of block size.</ul><p><strong>Message 1 (1 Byte Message)</strong></p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">02<td class="customCell indigo">02</table><p>After being encrypted and returned, the length would be 16 bytes, which we store as the starting size. We add another message byte and repeat.</p><p><strong>Message 2 (2 Byte Message)</strong></p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">01</table><p>The response is still 16 bytes long, so we add another message byte and repeat.</p><p><strong>Message 3 (3 Byte Message)</strong></p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08<td class="customCell indigo">08</table><p>The response size has increased to 24 bytes. We now stop, and subtract the current size from the starting size to find the block size.</p><p>Block Size = 24 - 16</p><p>Block Size = 8 bytes</p><p><br /></p><h2 id="step-2---unknown-string-size">Step 2 - Unknown String Size</h2><p>This part is trivial now that we have determined the block size in the last step. We don’t even have to send anymore messages to work this out.</p><p>The first message we sent was 1 byte long, and the response was 16 bytes long. This means the unknown string is guaranteed to be less than 16 bytes long.</p><p>We kept adding bytes to our message until the next block is added. Recall that in PKCS#7 padding, an entire block of padding is added when the plain-text length is a multiple of the block size.</p><ul><li>Look at Message 3 above, the plain-text <code class="language-plaintext highlighter-rouge">(user-string || unknown-string)</code> exactly filled 2 blocks</ul><p>Because of this, we now know:</p><ul><li>length(user-string) + length(unknown-string) = 16 bytes<li>length(unknown-string) = 16 bytes - length(user-string)<li>length(unknown-string) = 16 bytes - 3 bytes<li>length(unknown-string) = 13 bytes</ul><p>The <code class="language-plaintext highlighter-rouge">16 bytes</code> comes from the response length in Message 1. The <code class="language-plaintext highlighter-rouge">3 bytes</code> comes from the length of our message when the response size increased.</p><p>Perfect, with just a little Math we know the length of the unknown string is <code class="language-plaintext highlighter-rouge">13 bytes</code>!</p><p>Now let’s get to decrypting what unknown string is.</p><p><br /></p><h2 id="step-3---determining-the-unknown-string">Step 3 - Determining the Unknown String</h2><p>Our first step to finding the unknown string is to create a piece of plain-text that is <strong>bigger</strong> than the unknown string.</p><p>Since the unknown string is 13 bytes long, we’ll add enough extra bytes until it’s a multiple of the block size. Our plain-text will be 16 bytes long, since 16 is a multiple of 8 (block size), and is bigger than 13 (unknown string size).</p><p>The message we’ll send is 16 repeated bytes (we’ll use <code class="language-plaintext highlighter-rouge">0x41</code> again). If we send said message to the server, we know that it would look like this after the unknown string and padding is added:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><p>The only block of plain-text and cipher-text we’ll really be looking at is what block number the final block of plain-text is. Since we sent 2 blocks of plain-text, we’ll only be interested in the 2nd block of cipher-text. If we had sent 30 blocks of plain-text, we’d only focus on the 30th block of cipher-text.</p><p>Okay, now the fun stuff. Observe what we happen if we were to remove a single byte of our message. The first byte of the unknown string is now the last byte in block 2 (the highlighted row):</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">04<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04</table><p>How do we determine what that unknown byte is? By brute force!</p><p>A byte can only be 256 possible values. So we’ll send 256 messages, each with a different value in the final position of block 2.</p><p>Message 1 would look like this:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">00<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><p>Message 2 would look like this:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">01<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><p>…</p><p>Message 256 would look like this:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">FF<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><p>For each of the 256 messages, we store the cipher-text value of block 2 (the highlighted row) along with the byte that was added in a lookup table.</p><p>Now let’s send the earlier message with 1 byte less than a full block:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04<td class="customCell indigo">04</table><p>We can now get the cipher-text value of block 2, perform a lookup in our table, and see what byte is required to produce said cipher-text. It turns out it was <code class="language-plaintext highlighter-rouge">0x53</code>.</p><p>We’ve just discovered the first byte of the unknown string, let’s find more!</p><p><br /></p><h2 id="step-4---determining-the-unknown-string-continued">Step 4 - Determining the Unknown String Continued</h2><p>We’ve found the first byte, 1 down, 12 to go. We just need to rinse and repeat.</p><p>For the second byte, we first remove another byte of our message so that the first two bytes of the unknown string are in block 2:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">53<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05</table><p>Since we know the first byte of the unknown string, there are again only 256 possible values for the final byte. So let’s brute force again and create another lookup table. From now on we’ll be appending the recovered unknown string bytes to the end of our plain-text when doing the brute forcing.</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">53<td class="customCell darkgreen">00<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">53<td class="customCell darkgreen">01<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">03<td class="customCell indigo">03<td class="customCell indigo">03</table><p>With the new lookup table built, we can send our plain-text message (with no unknown string bytes added), extract block 2 of the cipher-text, and perform a lookup to see what byte produced that cipher-text:</p><table class="customTable"><tr><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<tr class="rowHighlight"><td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkgreen">41<td class="customCell darkred">53<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<tr><td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell darkred">XX<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05<td class="customCell indigo">05</table><p>It turns out the second byte was <code class="language-plaintext highlighter-rouge">0x65</code>.</p><p>Awesome, 2 bytes down 11 to go. This step is just rinse and repeat until all the unknown string bytes are found.</p><h1 id="finishing-up">Finishing Up</h1><p>After repeating Step 4 eleven more times, we’ve found our unknown string for our example. It turns out it was <code class="language-plaintext highlighter-rouge">SecretStuff@1</code>.</p><p>Using this exact technique on the challenge cipher-text yielded the following unknown string.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Rollin' in my 5.0
With my rag-top down so my hair can blow
The girlies on standby waving just to say hi
Did you stop? No, I just drove by
</pre></table></code></div></div><p>Some final notes:</p><ul><li>We recovered this string without knowledge of the encryption key.<li>This attack was not on the underlying cipher, it was against the cipher mode. AES is just as vulnerable to this attack as DES.<li>This attack scales linearly O(N) and takes (256 * N) oracle function calls to complete, where N is the length of the unknown string. This could be lowered if you assumed/guessed the unknown string is only printable ASCII chars.<li>Checkout the <a href="https://cryptopals.com/">cryptopals</a> website if you want to solve more problems like this and learn more about cryptography.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/security/'>security</a>, <a href='/categories/cryptography/'>cryptography</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/cipher/" class="post-tag no-text-decoration" >cipher</a> <a href="/tags/encryption/" class="post-tag no-text-decoration" >encryption</a> <a href="/tags/decryption/" class="post-tag no-text-decoration" >decryption</a> <a href="/tags/algorithm/" class="post-tag no-text-decoration" >algorithm</a> <a href="/tags/tools/" class="post-tag no-text-decoration" >tools</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cryptography - Byte by Byte ECB Decryption - Node Security&url=https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cryptography - Byte by Byte ECB Decryption - Node Security&u=https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cryptography - Byte by Byte ECB Decryption - Node Security&url=https://node-security.com/posts/cryptography-byte-by-byte-ecb-decryption/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/web-app-security/">Web App Security</a><li><a href="/posts/web-app-checklist/">Web App Checklist</a><li><a href="/posts/xor-encryption-cracker/">XOR Encryption Cracker</a><li><a href="/posts/nodejs-crypto/">NodeJS Crypto Module</a><li><a href="/posts/mobile-useful/">Mobile Useful</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/"><div class="card-body"> <span class="timeago small" >Dec 11, 2021<i class="unloaded">2021-12-11T07:24:02+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - Breaking Repeating Key XOR Encryption</h3><div class="text-muted small"><p> In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter fr...</p></div></div></a></div><div class="card"> <a href="/posts/cryptography-breaking-single-byte-xor-encryption/"><div class="card-body"> <span class="timeago small" >Dec 6, 2021<i class="unloaded">2021-12-06T07:24:02+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - Breaking Single Byte XOR Encryption</h3><div class="text-muted small"><p> In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encrypti...</p></div></div></a></div><div class="card"> <a href="/posts/cryptography-pkcs-7-padding/"><div class="card-body"> <span class="timeago small" >Dec 3, 2021<i class="unloaded">2021-12-03T00:06:44+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - PKCS#7 Padding</h3><div class="text-muted small"><p> This post will show how PKCS#7 Padding works for block ciphers like DES and AES. This post includes visual examples and the edge case to be aware of. PKCS#7, which includes message padding, is defi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="btn btn-outline-primary" prompt="Older"><p>Cryptography - Breaking Repeating Key XOR Encryption</p></a> <a href="/posts/frida-for-ios/" class="btn btn-outline-primary" prompt="Newer"><p>Frida for iOS</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/twitter_username">Alexander Wells</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RCTP6RS6T4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RCTP6RS6T4'); }); </script> <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "49945a71f40e4c15819bec60237a4d82"}'></script>
