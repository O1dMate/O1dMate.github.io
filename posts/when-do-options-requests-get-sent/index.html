<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="When are OPTIONS Requests Sent?" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this post we’ll look at OPTIONS requests, when they get sent, and their security implications." /><meta property="og:description" content="In this post we’ll look at OPTIONS requests, when they get sent, and their security implications." /><link rel="canonical" href="https://node-security.com/posts/when-do-options-requests-get-sent/" /><meta property="og:url" content="https://node-security.com/posts/when-do-options-requests-get-sent/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-15T10:41:50+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="When are OPTIONS Requests Sent?" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="zCs6F-1y95azrfcOnbFvS60JAILGGXaeG4vY1-JFacs" /> <script type="application/ld+json"> {"url":"https://node-security.com/posts/when-do-options-requests-get-sent/","@type":"BlogPosting","headline":"When are OPTIONS Requests Sent?","dateModified":"2021-05-25T12:19:10+10:00","datePublished":"2021-05-15T10:41:50+10:00","description":"In this post we’ll look at OPTIONS requests, when they get sent, and their security implications.","mainEntityOfPage":{"@type":"WebPage","@id":"https://node-security.com/posts/when-do-options-requests-get-sent/"},"@context":"https://schema.org"}</script><title>When are OPTIONS Requests Sent? | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"></noscript> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/icon.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Node Security</a></div><div class="site-subtitle font-italic">Security & Programming Guides</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>When are OPTIONS Requests Sent?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>When are OPTIONS Requests Sent?</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexander Wells </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, May 15, 2021, 10:41 AM +1000" >May 15, 2021<i class="unloaded">2021-05-15T10:41:50+10:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, May 25, 2021, 12:19 PM +1000" >May 25, 2021<i class="unloaded">2021-05-25T12:19:10+10:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="584 words">3 min read</span></div></div><div class="post-content"><p>In this post we’ll look at OPTIONS requests, when they get sent, and their security implications.</p><p>A basic understanding of CORS and CSRF attacks would be beneficial before reading this post.</p><ol><li><a href="#same-origin-requests">Same Origin Requests</a><li><a href="#cross-origin-requests">Cross Origin Requests</a><ul><li><a href="#html-form-submission">HTML Form Submission</a><li><a href="#additional-headers">Additional Headers</a></ul><li><a href="#security-implications">Security Implications</a></ol><h1 id="same-origin-requests">Same Origin Requests</h1><p>We’ll start off by looking at requests from the same origin.</p><p>Below we have loaded our testing website <code class="language-plaintext highlighter-rouge">my-testing.com</code>, which is a local web server I’m hosting.</p><p><img data-proofer-ignore data-src="/assets/security/options/options-1.png" alt="" /></p><p>If we call one of the server APIs, we will have no issues as the request is <strong>not</strong> cross-origin. The response body <code class="language-plaintext highlighter-rouge">{result: true}</code> is also visible in the browser:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-2.png" alt="" /></p><p>The result is the same if add additional headers and a body to the request:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-3.png" alt="" /></p><p><br /></p><h1 id="cross-origin-requests">Cross Origin Requests</h1><p>Let’s see the difference when we start performing requests to <code class="language-plaintext highlighter-rouge">my-testing.com</code> from another origin.</p><h2 id="html-form-submission">HTML Form Submission</h2><p>On a different site we’ll create and submit a HTML form using JavaScript:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-4.png" alt="" /></p><p>Using an interception proxy (i.e. burp), we can see the request details:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-5.png" alt="" /></p><ul><li>Notice the <code class="language-plaintext highlighter-rouge">Origin</code> header indicating where the request came from.<li>Also notice the session token (cookie) was included.</ul><p>From the response we can see that the request was successful:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-6.png" alt="" /></p><ul><li>If this was a state changing request like <code class="language-plaintext highlighter-rouge">create-user</code>, <code class="language-plaintext highlighter-rouge">update-details</code>, etc, then congrats because we just performed a CSRF (cross-site request forgery) attack.</ul><p>However, no OPTIONS requests have been sent so far, so why not?</p><h2 id="additional-headers">Additional Headers</h2><p>Let’s now assume that the <code class="language-plaintext highlighter-rouge">/endpoint</code> API on <code class="language-plaintext highlighter-rouge">my-testing.com</code> accepts a JSON body instead of a HTML form. We can use the <code class="language-plaintext highlighter-rouge">fetch</code> command in JavaScript to update the <code class="language-plaintext highlighter-rouge">content-type</code> header, add a JSON body, and perform the request:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-7.png" alt="" /></p><ul><li>We’re unable to see the response in the browser due to missing CORS headers, but this might not matter if it’s a state changing request, as the action may have still been performed by the server.</ul><p>Let’s see what request(s) were sent using our proxy:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-8.png" alt="" /></p><p><img data-proofer-ignore data-src="/assets/security/options/options-9.png" alt="" /></p><p>Now an OPTIONS request was sent, but no POST request.</p><p>Because we added extra headers, the browser sends a preflight request (OPTIONS) to ensure this origin (<code class="language-plaintext highlighter-rouge">node-security.com</code>) has permission to send requests to the target origin (<code class="language-plaintext highlighter-rouge">my-testing.com</code>).</p><p>If we want the OPTIONS request to succeed, then we need to add the following CORS headers:</p><ul><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin</code><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Headers</code><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Methods</code><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Credentials</code></ul><p>Let’s call the API again now with the correct headers added to the OPTIONS response:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-10.png" alt="" /></p><p>The request still “failed” because of CORS issues, but again, this may not matter if the POST request was sent.</p><p>Looking at our proxy history we see the following:</p><p><img data-proofer-ignore data-src="/assets/security/options/options-11.png" alt="" /></p><p><img data-proofer-ignore data-src="/assets/security/options/options-12.png" alt="" /></p><p><img data-proofer-ignore data-src="/assets/security/options/options-13.png" alt="" /></p><p>We can see that the correct headers were added to the OPTIONS response which means the browser will perform the POST request. The POST request still “failed” because there are still missing CORS headers on the response.</p><p>If we wanted no errors, the following response headers need to be added:</p><ul><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Origin: https://node-security.com</code><li><code class="language-plaintext highlighter-rouge">Access-Control-Allow-Credentials: true</code></ul><p><img data-proofer-ignore data-src="/assets/security/options/options-14.png" alt="" /></p><h2 id="summary">Summary</h2><p>OPTIONS requests are sent when additional headers have been added to cross-origin requests. The request is a preflight check to see if the origin is allowed to perform the request.</p><p><br /></p><h1 id="security-implications">Security Implications</h1><p>The question we want to ask is do OPTIONS requests provide protection against CSRF attacks? This is similar to asking if CORS provides protection against CSRF attacks?</p><p>The answer to both of these, annoyingly, is yes and no. There are situations when it does, but also situations when it doesn’t.</p><p>A better answer is that it’s <strong>not a reliable protection mechanism</strong> against CSRF. Better mechanisms include Anti-CSRF tokens (sometimes), utilizing the SameSite flag on cookies, and checking the Origin header server-side.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/security/'>security</a>, <a href='/categories/web/'>web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/csrf/" class="post-tag no-text-decoration" >csrf</a> <a href="/tags/cors/" class="post-tag no-text-decoration" >cors</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=When are OPTIONS Requests Sent? - Node Security&url=https://node-security.com/posts/when-do-options-requests-get-sent/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=When are OPTIONS Requests Sent? - Node Security&u=https://node-security.com/posts/when-do-options-requests-get-sent/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=When are OPTIONS Requests Sent? - Node Security&url=https://node-security.com/posts/when-do-options-requests-get-sent/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jwt-fuzzing/">JWT Fuzzing</a><li><a href="/posts/javascript-tips-and-tricks-2/">JavaScript Tips & Tricks 2</a><li><a href="/posts/android-hooking-in-frida/">Android Hooking in Frida</a><li><a href="/posts/configuring-ssh-server/">Configuring SSH Server</a><li><a href="/posts/ssh-server-hardening/">SSH Server Hardening</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/web-app-security/"><div class="card-body"> <span class="timeago small" >Sep 29, 2021<i class="unloaded">2021-09-29T17:01:50+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Web App Security</h3><div class="text-muted small"><p> General purpose guide for testing Web Applications. This list is not supposed to be exhaustive, nor is the information absolute. Each web application is different and the business case needs to be ...</p></div></div></a></div><div class="card"> <a href="/posts/cookies-ports-and-subdomains/"><div class="card-body"> <span class="timeago small" >Jan 28<i class="unloaded">2022-01-28T22:08:10+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cookies, Ports and Subdomains</h3><div class="text-muted small"><p> This post will look at how browser cookies work when used on different subdomains and on different ports. Short Answer &amp; Summary Cookie without Domain Attribute Same Domain Dif...</p></div></div></a></div><div class="card"> <a href="/posts/certificate-generation-pure-nodejs/"><div class="card-body"> <span class="timeago small" >Sep 21, 2021<i class="unloaded">2021-09-21T00:07:50+10:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Certificate Generate Pure NodeJS</h3><div class="text-muted small"><p> This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/admin-to-system-with-psexec/" class="btn btn-outline-primary" prompt="Older"><p>Admin to SYSTEM with PsExec</p></a> <a href="/posts/user-dumping-with-msol/" class="btn btn-outline-primary" prompt="Newer"><p>User Dumping with MSOL</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/twitter_username">Alexander Wells</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RCTP6RS6T4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RCTP6RS6T4'); }); </script> <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "49945a71f40e4c15819bec60237a4d82"}'></script>
