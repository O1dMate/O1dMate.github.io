<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Cryptography - Breaking Single Byte XOR Encryption" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c." /><meta property="og:description" content="In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c." /><link rel="canonical" href="https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/" /><meta property="og:url" content="https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-06T08:24:02+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cryptography - Breaking Single Byte XOR Encryption" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="zCs6F-1y95azrfcOnbFvS60JAILGGXaeG4vY1-JFacs" /> <script type="application/ld+json"> {"url":"https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/","@type":"BlogPosting","headline":"Cryptography - Breaking Single Byte XOR Encryption","dateModified":"2021-12-06T08:24:02+11:00","datePublished":"2021-12-06T08:24:02+11:00","description":"In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c.","mainEntityOfPage":{"@type":"WebPage","@id":"https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/"},"@context":"https://schema.org"}</script><title>Cryptography - Breaking Single Byte XOR Encryption | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"></noscript> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/icon.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Node Security</a></div><div class="site-subtitle font-italic">Security & Programming Guides</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cryptography - Breaking Single Byte XOR Encryption</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Cryptography - Breaking Single Byte XOR Encryption</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexander Wells </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 6, 2021, 8:24 AM +1100" >Dec 6, 2021<i class="unloaded">2021-12-06T08:24:02+11:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1085 words">6 min read</span></div></div><div class="post-content"><p>In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as <code class="language-plaintext highlighter-rouge">b7</code>. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as <code class="language-plaintext highlighter-rouge">84 d2 7a 09 4c</code>.</p><p>This post is also a solution to <a href="https://cryptopals.com/sets/1/challenges/3">challenge 3</a> on the <a href="https://cryptopals.com/">cryptopals</a> website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and examples.</p><ol><li><a href="#how-to-break-it">How to Break it</a><li><a href="#english-scoring">English Scoring</a><li><a href="#brute-forcing-the-key">Brute Forcing the Key</a><li><a href="#what-next">What Next?</a></ol><h1 id="how-to-break-it">How to Break it</h1><p>Since the key is only a single byte, the keyspace is very small, only 256 possible keys. As such, brute force is practical and reasonable solution.</p><p>We still need to determine which key is actually correct though. We’re assuming that the plain-text we are recovering is English text. After attempting decryption with a key, we’ll need a method to “score” the decrypted data based on how English it is.</p><h1 id="english-scoring">English Scoring</h1><p>Let’s start off by writing a function that can score a String based on how English it is.</p><p>We’ll give a String points for the following:</p><ul><li>+2 Points for each occurrence of the 6 most common English characters (and space)<li>+1 Point for each occurrence of the next 6 most common English characters<li>+1 Point for each occurrence of the 20 most common English Bigrams<li>+1 Point for each occurrence of the 20 most common English Trigrams<li>+1 Point for each occurrence of the 298 most common English Words</ul><p>The String’s score will be the sum of these points.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c1">// Source: https://preply.com/en/blog/300-most-common-english-words/</span>
<span class="kd">let</span> <span class="nx">commonEnglishWords</span> <span class="o">=</span> <span class="s2">`is,be,do,go,am,he,an,up,so,no,of,to,in,on,at,by,it,he,we,my,me,us,as,or,if,was,are,had,can,use,has,see,did,get,may,say,set,put,ask,try,add,saw,got,run,eat,let,cut,way,day,man,boy,end,men,air,eye,car,sea,one,all,two,new,old,any,big,own,few,not,how,out,now,too,why,off,far,for,you,his,she,her,him,who,its,our,and,but,have,were,said,will,make,like,look,been,call,find,come,made,take,know,live,give,help,tell,came,want,show,does,must,went,read,need,move,play,keep,turn,seem,open,walk,grow,took,hear,stop,miss,talk,word,time,part,work,year,back,name,line,farm,land,home,hand,page,food,tree,city,head,life,side,feet,mile,book,idea,face,girl,list,song,each,many,some,more,long,most,good,mean,same,even,such,kind,high,left,next,hard,both,four,when,then,only,very,just,much,also,well,here,away,near,last,once,soon,with,from,into,down,over,that,they,this,what,your,them,than,it’s,would,write,could,think,spell,found,study,learn,start,might,close,begin,began,carry,watch,being,leave,water,sound,place,thing,house,point,world,plant,earth,story,paper,group,night,river,state,other,great,right,three,small,large,still,every,light,white,above,young,there,first,where,again,below,never,often,later,about,after,under,along,until,which,their,these,those,while,don’t,follow,change,should,number,people,animal,letter,mother,answer,school,father,Indian,family,little,second,enough,before,around,always,really,almost,thought,picture,America,country,example,another,through,between,without,because,sentence,children,mountain,together,different,important,sometimes,something`</span><span class="p">;</span>
<span class="nx">commonEnglishWords</span> <span class="o">=</span> <span class="nx">commonEnglishWords</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>

<span class="c1">// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.html</span>
<span class="kd">let</span> <span class="nx">mostCommonEnglishLettersPrimary</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">mostCommonEnglishLettersSecondary</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="p">();</span>
<span class="dl">'</span><span class="s1">etaoin </span><span class="dl">'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">''</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">char</span> <span class="o">=&gt;</span> <span class="nx">mostCommonEnglishLettersPrimary</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">char</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>
<span class="dl">'</span><span class="s1">shrdlu</span><span class="dl">'</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">''</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">char</span> <span class="o">=&gt;</span> <span class="nx">mostCommonEnglishLettersSecondary</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="nx">char</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>

<span class="c1">// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.html</span>
<span class="kd">let</span> <span class="nx">commonEnglishBigrams</span> <span class="o">=</span> <span class="s2">`th,he,in,er,an,re,nd,on,en,at,ou,ed,ha,to,or,it,is,hi,es,ng`</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">commonEnglishTrigrams</span> <span class="o">=</span> <span class="s2">`the,and,ing,her,hat,his,tha,ere,for,ent,ion,ter,was,you,ith,ver,all,wit,thi,tio`</span><span class="p">;</span>
<span class="nx">commonEnglishBigrams</span> <span class="o">=</span> <span class="nx">commonEnglishBigrams</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">commonEnglishTrigrams</span> <span class="o">=</span> <span class="nx">commonEnglishTrigrams</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>

<span class="c1">// Returns an positive Integer score based on how English the input Buffer is</span>
<span class="kd">const</span> <span class="nx">scoreDecryptedBuffer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">commonWordMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonBigramMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonTrigramMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonLetterMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="c1">// Detect how many occurrences of the most common English Words there are.</span>
	<span class="nx">commonEnglishWords</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">commonWord</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonWordMatches</span> <span class="o">+=</span> <span class="nx">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonWord</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English Bigrams there are.</span>
	<span class="nx">commonEnglishBigrams</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">commonBigram</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonBigramMatches</span> <span class="o">+=</span> <span class="nx">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonBigram</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English Trigrams there are.</span>
	<span class="nx">commonEnglishTrigrams</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">commonTrigram</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonTrigramMatches</span> <span class="o">+=</span> <span class="nx">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonTrigram</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English letters there are.</span>
	<span class="c1">// The 6 most common letters (and space) get +2 score, the next 6 most common get +1 score.</span>
	<span class="nx">decipheredBuffer</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">byte</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">mostCommonEnglishLettersPrimary</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">byte</span><span class="p">))</span> <span class="nx">commonLetterMatches</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mostCommonEnglishLettersSecondary</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">byte</span><span class="p">))</span> <span class="nx">commonLetterMatches</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">});</span>

	<span class="k">return</span> <span class="nx">commonWordMatches</span> <span class="o">+</span> <span class="nx">commonBigramMatches</span> <span class="o">+</span> <span class="nx">commonTrigramMatches</span> <span class="o">+</span> <span class="nx">commonLetterMatches</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Count how many occurrences of a Buffer occur within a target Buffer</span>
<span class="kd">const</span> <span class="nx">countOccurrences</span> <span class="o">=</span> <span class="p">(</span><span class="nx">targetBuffer</span><span class="p">,</span> <span class="nx">toSearchForBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">occurrences</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">currentOccurrenceIndex</span> <span class="o">=</span> <span class="nx">targetBuffer</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">toSearchForBuffer</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="nx">currentOccurrenceIndex</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">occurrences</span><span class="o">++</span><span class="p">;</span>
		<span class="nx">currentOccurrenceIndex</span> <span class="o">=</span> <span class="nx">targetBuffer</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">toSearchForBuffer</span><span class="p">,</span> <span class="nx">currentOccurrenceIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">occurrences</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Scoring Example</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">englishText</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is a test string that will be scored on how english it is</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">randomBytes</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">randomBytes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">256</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Score for English Text:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">englishText</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Score for Random Bytes:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">randomBytes</span><span class="p">)));</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Score for English Text: 129
Score for Random Bytes: 4
</pre></table></code></div></div><p><br /></p><h1 id="brute-forcing-the-key">Brute Forcing the Key</h1><p>Now that we can score a given String on how English it is, we can brute force the key.</p><p>As the key is only one byte, there is 256 possible keys to check. For each key we will decrypt the cipher-text with it, and score the decrypted string. The key that produces the best score is most likely to be the correct key.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">// Perform single byte XOR decryption on a given Cipher-Text Buffer</span>
<span class="kd">const</span> <span class="nx">singleXorKeyDecryption</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cipherTextBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">bestScore</span> <span class="o">=</span> <span class="p">{</span> <span class="na">score</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">};</span>
	<span class="kd">let</span> <span class="nx">decryptionBuffer</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">alloc</span><span class="p">(</span><span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">tempScore</span><span class="p">;</span>

	<span class="c1">// Brute force all 256 possible keys</span>
	<span class="k">for</span> <span class="p">(</span><span class="nx">decryptionKey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">decryptionKey</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="o">++</span><span class="nx">decryptionKey</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// Decrypt the Cipher-Text using the current decryption key and store results in the decryption Buffer</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">decryptionBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cipherTextBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="nx">decryptionKey</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Score the decrypted Cipher-Text</span>
		<span class="nx">tempScore</span> <span class="o">=</span> <span class="nx">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">decryptionBuffer</span><span class="p">);</span>

		<span class="c1">// If this key scored best, store it</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">tempScore</span> <span class="o">&gt;</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span> <span class="o">=</span> <span class="nx">tempScore</span><span class="p">;</span>
			<span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">decryptionKey</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// Decrypt the Cipher-Text using the best scoring decryption key and store results in the decryption Buffer</span>
	<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">decryptionBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cipherTextBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Return the best key, and the Cipher-Text decrypted with that key</span>
	<span class="k">return</span> <span class="p">{</span>
		<span class="na">data</span><span class="p">:</span> <span class="nx">decryptionBuffer</span><span class="p">,</span>
		<span class="na">key</span><span class="p">:</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
		<span class="na">score</span><span class="p">:</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span>
	<span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With this latest function we can call it with our cipher-text as input. The cipher-text used is from <a href="https://cryptopals.com/sets/1/challenges/3">here</a>.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span text-data=" JavaScript "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">cipherText</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">decryptionResults</span> <span class="o">=</span> <span class="nx">singleXorKeyDecryption</span><span class="p">(</span><span class="nx">cipherText</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="s1">Most Likely Decryption Key:</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">key</span><span class="p">]));</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="s1">Decrypted Data:</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>
</pre></table></code></div></div><p>Putting everything together, we can now decrypt our cipher-text:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Most Likely Decryption Key:
&lt;Buffer 58&gt;

Decrypted Data:
&lt;Buffer 43 6f 6f 6b 69 6e 67 20 4d 43 27 73 20 6c 69 6b 65 20 61 20 70 6f 75 6e 64 20 6f 66 20 62 61 63 6f 6e&gt;
Cooking MC's like a pound of bacon
</pre></table></code></div></div><p><br /></p><h1 id="what-next">What Next?</h1><p>While this function might not seem that useful at first, it will be vital when we want to break repeating key XOR encryption.</p><p>If you want to learn how to do that, you can read how to <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/security/'>security</a>, <a href='/categories/cryptography/'>cryptography</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/cipher/" class="post-tag no-text-decoration" >cipher</a> <a href="/tags/encryption/" class="post-tag no-text-decoration" >encryption</a> <a href="/tags/decryption/" class="post-tag no-text-decoration" >decryption</a> <a href="/tags/algorithm/" class="post-tag no-text-decoration" >algorithm</a> <a href="/tags/tools/" class="post-tag no-text-decoration" >tools</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cryptography - Breaking Single Byte XOR Encryption - Node Security&url=https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cryptography - Breaking Single Byte XOR Encryption - Node Security&u=https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Cryptography - Breaking Single Byte XOR Encryption - Node Security&url=https://node-security.com/posts/cryptography-breaking-single-byte-xor-encryption/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/intertesting-algorithms/">Interesting Algorithms</a><li><a href="/posts/docx-templating-in-javascript/">Docx Templating in JavaScript</a><li><a href="/posts/web-app-security/">Web App Security</a><li><a href="/posts/web-app-checklist/">Web App Checklist</a><li><a href="/posts/cryptography-byte-by-byte-ecb-decryption/">Cryptography - Byte by Byte ECB Decryption</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/"><div class="card-body"> <span class="timeago small" >Dec 11, 2021<i class="unloaded">2021-12-11T08:24:02+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - Breaking Repeating Key XOR Encryption</h3><div class="text-muted small"><p> In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter fr...</p></div></div></a></div><div class="card"> <a href="/posts/cryptography-byte-by-byte-ecb-decryption/"><div class="card-body"> <span class="timeago small" >Dec 12, 2021<i class="unloaded">2021-12-12T19:50:23+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - Byte by Byte ECB Decryption</h3><div class="text-muted small"><p> In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key. This post will...</p></div></div></a></div><div class="card"> <a href="/posts/cryptography-pkcs-7-padding/"><div class="card-body"> <span class="timeago small" >Dec 3, 2021<i class="unloaded">2021-12-03T01:06:44+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cryptography - PKCS#7 Padding</h3><div class="text-muted small"><p> This post will show how PKCS#7 Padding works for block ciphers like DES and AES. This post includes visual examples and the edge case to be aware of. PKCS#7, which includes message padding, is defi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cryptography-pkcs-7-padding/" class="btn btn-outline-primary" prompt="Older"><p>Cryptography - PKCS#7 Padding</p></a> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="btn btn-outline-primary" prompt="Newer"><p>Cryptography - Breaking Repeating Key XOR Encryption</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/twitter_username">Alexander Wells</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/windows/">windows</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RCTP6RS6T4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RCTP6RS6T4'); }); </script>
