<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Cryptography - Breaking Single Byte XOR Encryption" /><meta property="og:locale" content="en" /><meta name="description" content="In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c." /><meta property="og:description" content="In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c." /><link rel="canonical" href="/posts/cryptography-breaking-single-byte-xor-encryption/" /><meta property="og:url" content="/posts/cryptography-breaking-single-byte-xor-encryption/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-06T07:24:02+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Cryptography - Breaking Single Byte XOR Encryption" /><meta name="twitter:site" content="@todo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-12-06T07:24:02+10:00","datePublished":"2021-12-06T07:24:02+10:00","description":"In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as b7. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as 84 d2 7a 09 4c.","headline":"Cryptography - Breaking Single Byte XOR Encryption","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/cryptography-breaking-single-byte-xor-encryption/"},"url":"/posts/cryptography-breaking-single-byte-xor-encryption/"}</script><title>Cryptography - Breaking Single Byte XOR Encryption | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/icon.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">Node Security</a></div><div class="site-subtitle fst-italic">Security & Programming Guides</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/todo" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cryptography - Breaking Single Byte XOR Encryption</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>Cryptography - Breaking Single Byte XOR Encryption</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1638739442" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Dec 6, 2021 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/todo">Alexander Wells</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1085 words" > <em>6 min</em> read</span></div></div></div><div class="post-content"><p>In this post we’ll cover how to decrypt messages that have been XOR encrypted using a single byte key, such as <code class="language-plaintext highlighter-rouge">b7</code>. While this might not sound that useful, it’s a pre-cursor to breaking XOR encryption that uses a repeating key, such as <code class="language-plaintext highlighter-rouge">84 d2 7a 09 4c</code>.</p><p>This post is also a solution to <a href="https://cryptopals.com/sets/1/challenges/3">challenge 3</a> on the <a href="https://cryptopals.com/">cryptopals</a> website. This site is a great resource for hands on learning about cryptography. The technique used to complete this challenge is outlined on that page. This post will explain the same technique with a bit more detail and examples.</p><ol><li><a href="#how-to-break-it">How to Break it</a><li><a href="#english-scoring">English Scoring</a><li><a href="#brute-forcing-the-key">Brute Forcing the Key</a><li><a href="#what-next">What Next?</a></ol><h1 id="how-to-break-it">How to Break it</h1><p>Since the key is only a single byte, the keyspace is very small, only 256 possible keys. As such, brute force is practical and reasonable solution.</p><p>We still need to determine which key is actually correct though. We’re assuming that the plain-text we are recovering is English text. After attempting decryption with a key, we’ll need a method to “score” the decrypted data based on how English it is.</p><h1 id="english-scoring">English Scoring</h1><p>Let’s start off by writing a function that can score a String based on how English it is.</p><p>We’ll give a String points for the following:</p><ul><li>+2 Points for each occurrence of the 6 most common English characters (and space)<li>+1 Point for each occurrence of the next 6 most common English characters<li>+1 Point for each occurrence of the 20 most common English Bigrams<li>+1 Point for each occurrence of the 20 most common English Trigrams<li>+1 Point for each occurrence of the 298 most common English Words</ul><p>The String’s score will be the sum of these points.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre><span class="c1">// Source: https://preply.com/en/blog/300-most-common-english-words/</span>
<span class="kd">let</span> <span class="nx">commonEnglishWords</span> <span class="o">=</span> <span class="s2">`is,be,do,go,am,he,an,up,so,no,of,to,in,on,at,by,it,he,we,my,me,us,as,or,if,was,are,had,can,use,has,see,did,get,may,say,set,put,ask,try,add,saw,got,run,eat,let,cut,way,day,man,boy,end,men,air,eye,car,sea,one,all,two,new,old,any,big,own,few,not,how,out,now,too,why,off,far,for,you,his,she,her,him,who,its,our,and,but,have,were,said,will,make,like,look,been,call,find,come,made,take,know,live,give,help,tell,came,want,show,does,must,went,read,need,move,play,keep,turn,seem,open,walk,grow,took,hear,stop,miss,talk,word,time,part,work,year,back,name,line,farm,land,home,hand,page,food,tree,city,head,life,side,feet,mile,book,idea,face,girl,list,song,each,many,some,more,long,most,good,mean,same,even,such,kind,high,left,next,hard,both,four,when,then,only,very,just,much,also,well,here,away,near,last,once,soon,with,from,into,down,over,that,they,this,what,your,them,than,it’s,would,write,could,think,spell,found,study,learn,start,might,close,begin,began,carry,watch,being,leave,water,sound,place,thing,house,point,world,plant,earth,story,paper,group,night,river,state,other,great,right,three,small,large,still,every,light,white,above,young,there,first,where,again,below,never,often,later,about,after,under,along,until,which,their,these,those,while,don’t,follow,change,should,number,people,animal,letter,mother,answer,school,father,Indian,family,little,second,enough,before,around,always,really,almost,thought,picture,America,country,example,another,through,between,without,because,sentence,children,mountain,together,different,important,sometimes,something`</span><span class="p">;</span>
<span class="nx">commonEnglishWords</span> <span class="o">=</span> <span class="nx">commonEnglishWords</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>

<span class="c1">// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.html</span>
<span class="kd">let</span> <span class="nx">mostCommonEnglishLettersPrimary</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>
<span class="kd">let</span> <span class="nx">mostCommonEnglishLettersSecondary</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Map</span><span class="p">();</span>
<span class="dl">'</span><span class="s1">etaoin </span><span class="dl">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">''</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">char</span> <span class="o">=&gt;</span> <span class="nx">mostCommonEnglishLettersPrimary</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">char</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>
<span class="dl">'</span><span class="s1">shrdlu</span><span class="dl">'</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">''</span><span class="p">).</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">char</span> <span class="o">=&gt;</span> <span class="nx">mostCommonEnglishLettersSecondary</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="nx">char</span><span class="p">.</span><span class="nf">charCodeAt</span><span class="p">(),</span> <span class="kc">true</span><span class="p">));</span>

<span class="c1">// Source: https://www3.nd.edu/~busiforc/handouts/cryptography/Letter%20Frequencies.html</span>
<span class="kd">let</span> <span class="nx">commonEnglishBigrams</span> <span class="o">=</span> <span class="s2">`th,he,in,er,an,re,nd,on,en,at,ou,ed,ha,to,or,it,is,hi,es,ng`</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">commonEnglishTrigrams</span> <span class="o">=</span> <span class="s2">`the,and,ing,her,hat,his,tha,ere,for,ent,ion,ter,was,you,ith,ver,all,wit,thi,tio`</span><span class="p">;</span>
<span class="nx">commonEnglishBigrams</span> <span class="o">=</span> <span class="nx">commonEnglishBigrams</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">commonEnglishTrigrams</span> <span class="o">=</span> <span class="nx">commonEnglishTrigrams</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>

<span class="c1">// Returns an positive Integer score based on how English the input Buffer is</span>
<span class="kd">const</span> <span class="nx">scoreDecryptedBuffer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">commonWordMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonBigramMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonTrigramMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">commonLetterMatches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="c1">// Detect how many occurrences of the most common English Words there are.</span>
	<span class="nx">commonEnglishWords</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">commonWord</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonWordMatches</span> <span class="o">+=</span> <span class="nf">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonWord</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English Bigrams there are.</span>
	<span class="nx">commonEnglishBigrams</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">commonBigram</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonBigramMatches</span> <span class="o">+=</span> <span class="nf">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonBigram</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English Trigrams there are.</span>
	<span class="nx">commonEnglishTrigrams</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">commonTrigram</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="nx">commonTrigramMatches</span> <span class="o">+=</span> <span class="nf">countOccurrences</span><span class="p">(</span><span class="nx">decipheredBuffer</span><span class="p">,</span> <span class="nx">commonTrigram</span><span class="p">);</span>
	<span class="p">});</span>

	<span class="c1">// Detect how many occurrences of the most common English letters there are.</span>
	<span class="c1">// The 6 most common letters (and space) get +2 score, the next 6 most common get +1 score.</span>
	<span class="nx">decipheredBuffer</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="nx">byte</span> <span class="o">=&gt;</span> <span class="p">{</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">mostCommonEnglishLettersPrimary</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="nx">byte</span><span class="p">))</span> <span class="nx">commonLetterMatches</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nx">mostCommonEnglishLettersSecondary</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="nx">byte</span><span class="p">))</span> <span class="nx">commonLetterMatches</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">});</span>

	<span class="k">return</span> <span class="nx">commonWordMatches</span> <span class="o">+</span> <span class="nx">commonBigramMatches</span> <span class="o">+</span> <span class="nx">commonTrigramMatches</span> <span class="o">+</span> <span class="nx">commonLetterMatches</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Count how many occurrences of a Buffer occur within a target Buffer</span>
<span class="kd">const</span> <span class="nx">countOccurrences</span> <span class="o">=</span> <span class="p">(</span><span class="nx">targetBuffer</span><span class="p">,</span> <span class="nx">toSearchForBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">occurrences</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kd">let</span> <span class="nx">currentOccurrenceIndex</span> <span class="o">=</span> <span class="nx">targetBuffer</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="nx">toSearchForBuffer</span><span class="p">);</span>

	<span class="k">while </span><span class="p">(</span><span class="nx">currentOccurrenceIndex</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">occurrences</span><span class="o">++</span><span class="p">;</span>
		<span class="nx">currentOccurrenceIndex</span> <span class="o">=</span> <span class="nx">targetBuffer</span><span class="p">.</span><span class="nf">indexOf</span><span class="p">(</span><span class="nx">toSearchForBuffer</span><span class="p">,</span> <span class="nx">currentOccurrenceIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">occurrences</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p><strong>Scoring Example</strong></p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">englishText</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is a test string that will be scored on how english it is</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">randomBytes</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">64</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">randomBytes</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nf">random</span><span class="p">()</span><span class="o">*</span><span class="mi">256</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Score for English Text:</span><span class="dl">'</span><span class="p">,</span> <span class="nf">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">englishText</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Score for Random Bytes:</span><span class="dl">'</span><span class="p">,</span> <span class="nf">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">randomBytes</span><span class="p">)));</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Score for English Text: 129
Score for Random Bytes: 4
</pre></table></code></div></div><p><br /></p><h1 id="brute-forcing-the-key">Brute Forcing the Key</h1><p>Now that we can score a given String on how English it is, we can brute force the key.</p><p>As the key is only one byte, there is 256 possible keys to check. For each key we will decrypt the cipher-text with it, and score the decrypted string. The key that produces the best score is most likely to be the correct key.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="c1">// Perform single byte XOR decryption on a given Cipher-Text Buffer</span>
<span class="kd">const</span> <span class="nx">singleXorKeyDecryption</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cipherTextBuffer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="kd">let</span> <span class="nx">bestScore</span> <span class="o">=</span> <span class="p">{</span> <span class="na">score</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">key</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">};</span>
	<span class="kd">let</span> <span class="nx">decryptionBuffer</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">alloc</span><span class="p">(</span><span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
	<span class="kd">let</span> <span class="nx">tempScore</span><span class="p">;</span>

	<span class="c1">// Brute force all 256 possible keys</span>
	<span class="k">for </span><span class="p">(</span><span class="nx">decryptionKey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">decryptionKey</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="o">++</span><span class="nx">decryptionKey</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// Decrypt the Cipher-Text using the current decryption key and store results in the decryption Buffer</span>
		<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">decryptionBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cipherTextBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="nx">decryptionKey</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="c1">// Score the decrypted Cipher-Text</span>
		<span class="nx">tempScore</span> <span class="o">=</span> <span class="nf">scoreDecryptedBuffer</span><span class="p">(</span><span class="nx">decryptionBuffer</span><span class="p">);</span>

		<span class="c1">// If this key scored best, store it</span>
		<span class="k">if </span><span class="p">(</span><span class="nx">tempScore</span> <span class="o">&gt;</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span> <span class="o">=</span> <span class="nx">tempScore</span><span class="p">;</span>
			<span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">decryptionKey</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">// Decrypt the Cipher-Text using the best scoring decryption key and store results in the decryption Buffer</span>
	<span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">cipherTextBuffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">decryptionBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">cipherTextBuffer</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">^</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">// Return the best key, and the Cipher-Text decrypted with that key</span>
	<span class="k">return</span> <span class="p">{</span>
		<span class="na">data</span><span class="p">:</span> <span class="nx">decryptionBuffer</span><span class="p">,</span>
		<span class="na">key</span><span class="p">:</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span>
		<span class="na">score</span><span class="p">:</span> <span class="nx">bestScore</span><span class="p">.</span><span class="nx">score</span>
	<span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><p>With this latest function we can call it with our cipher-text as input. The cipher-text used is from <a href="https://cryptopals.com/sets/1/challenges/3">here</a>.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">cipherText</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">decryptionResults</span> <span class="o">=</span> <span class="nf">singleXorKeyDecryption</span><span class="p">(</span><span class="nx">cipherText</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="s1">Most Likely Decryption Key:</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">([</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">key</span><span class="p">]));</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="s1">Decrypted Data:</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">decryptionResults</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">));</span>
</pre></table></code></div></div><p>Putting everything together, we can now decrypt our cipher-text:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>Most Likely Decryption Key:
&lt;Buffer 58&gt;

Decrypted Data:
&lt;Buffer 43 6f 6f 6b 69 6e 67 20 4d 43 27 73 20 6c 69 6b 65 20 61 20 70 6f 75 6e 64 20 6f 66 20 62 61 63 6f 6e&gt;
Cooking MC's like a pound of bacon
</pre></table></code></div></div><p><br /></p><h1 id="what-next">What Next?</h1><p>While this function might not seem that useful at first, it will be vital when we want to break repeating key XOR encryption.</p><p>If you want to learn how to do that, you can read how to <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/">here</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/security/'>security</a>, <a href='/categories/cryptography/'>cryptography</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a> <a href="/tags/cipher/" class="post-tag no-text-decoration" >cipher</a> <a href="/tags/encryption/" class="post-tag no-text-decoration" >encryption</a> <a href="/tags/decryption/" class="post-tag no-text-decoration" >decryption</a> <a href="/tags/algorithm/" class="post-tag no-text-decoration" >algorithm</a> <a href="/tags/tools/" class="post-tag no-text-decoration" >tools</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cryptography%20-%20Breaking%20Single%20Byte%20XOR%20Encryption%20-%20Node%20Security&url=%2Fposts%2Fcryptography-breaking-single-byte-xor-encryption%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cryptography%20-%20Breaking%20Single%20Byte%20XOR%20Encryption%20-%20Node%20Security&u=%2Fposts%2Fcryptography-breaking-single-byte-xor-encryption%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fcryptography-breaking-single-byte-xor-encryption%2F&text=Cryptography%20-%20Breaking%20Single%20Byte%20XOR%20Encryption%20-%20Node%20Security" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/rust-cheatsheet/">Rust Cheatsheet</a><li class="text-truncate lh-lg"> <a href="/posts/extract-ntlm-hashes-via-linux-live-boot/">Extract NTLM Hashes via Linux Live Boot</a><li class="text-truncate lh-lg"> <a href="/posts/admin-to-system-with-psexec/">Admin to SYSTEM with PsExec</a><li class="text-truncate lh-lg"> <a href="/posts/user-dumping-with-msol/">User Dumping with MSOL</a><li class="text-truncate lh-lg"> <a href="/posts/windows-uac-privilege-escalation/">Windows UAC Privilege Escalation</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1639171442" data-df="ll" > Dec 11, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Cryptography - Breaking Repeating Key XOR Encryption</h4><div class="text-muted small"><p> In this post we’ll cover how to decrypt messages that have been XOR encrypted using a repeated key, such as 84 d2 7a 09. The method we’ll be using to break the encryption uses statistics (letter fr...</p></div></div></a></div><div class="col"> <a href="/posts/cryptography-byte-by-byte-ecb-decryption/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1639299023" data-df="ll" > Dec 12, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Cryptography - Byte by Byte ECB Decryption</h4><div class="text-muted small"><p> In this post we’ll cover how to attack an oracle function that encrypts user supplied data concatenated with an unknown string under ECB mode while using a constant but unknown key. This post will...</p></div></div></a></div><div class="col"> <a href="/posts/cryptographic-recommendation-summary/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1653711478" data-df="ll" > May 28, 2022 </em><h4 class="pt-0 my-2" data-toc-skip>Cryptographic Recommendation Summary</h4><div class="text-muted small"><p> This post contains recommendation summaries for password security and cryptographic topics including password complexity &amp;amp; storage, hash functions, symmetric &amp;amp; asymmetric encryption, MACs, ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/cryptography-pkcs-7-padding/" class="btn btn-outline-primary" prompt="Older" ><p>Cryptography - PKCS#7 Padding</p></a> <a href="/posts/cryptography-breaking-repeating-xor-key-encryption/" class="btn btn-outline-primary" prompt="Newer" ><p>Cryptography - Breaking Repeating Key XOR Encryption</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>© 2024 <a href="https://twitter.com/todo">Alexander Wells</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
