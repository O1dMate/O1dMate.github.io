<!doctype html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="NodeJS Crypto Module" /><meta property="og:locale" content="en" /><meta name="description" content="In this post we’ll look at how to use some features of the crypto library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Elliptic-Curve Diffie-Hellman)." /><meta property="og:description" content="In this post we’ll look at how to use some features of the crypto library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Elliptic-Curve Diffie-Hellman)." /><link rel="canonical" href="/posts/nodejs-crypto/" /><meta property="og:url" content="/posts/nodejs-crypto/" /><meta property="og:site_name" content="Node Security" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-06T18:37:40+10:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="NodeJS Crypto Module" /><meta name="twitter:site" content="@todo" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-28T22:18:33+10:00","datePublished":"2021-04-06T18:37:40+10:00","description":"In this post we’ll look at how to use some features of the crypto library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Elliptic-Curve Diffie-Hellman).","headline":"NodeJS Crypto Module","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/nodejs-crypto/"},"url":"/posts/nodejs-crypto/"}</script><title>NodeJS Crypto Module | Node Security</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Node Security"><meta name="application-name" content="Node Security"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"><body><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"> <img src="/assets/icon.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'"> </a><div class="site-title"> <a href="/">Node Security</a></div><div class="site-subtitle fst-italic">Security & Programming Guides</div></div><ul class="nav flex-column flex-grow-1 w-100 ps-0"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tools/" class="nav-link"> <i class="fa-fw fas fa-tools"></i> <span>TOOLS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/O1dMate" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/todo" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['o1dmate','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container px-xxl-5"><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100" > <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>NodeJS Crypto Module</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </span> <span id="search-cancel">Cancel</span></div></div><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4"><div class="post px-1 px-md-2"><h1 data-toc-skip>NodeJS Crypto Module</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1617698260" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Apr 6, 2021 </em> </span> <span> Updated <em class="" data-ts="1653740313" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > May 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/todo">Alexander Wells</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="966 words" > <em>5 min</em> read</span></div></div></div><div class="post-content"><p>In this post we’ll look at how to use some features of the <code class="language-plaintext highlighter-rouge">crypto</code> library built into NodeJS. We’ll look at how to do symmetric encryption (AES), hashing strings and files, and finally ECDH (Elliptic-Curve Diffie-Hellman).</p><ol><li><a href="#symmetric-encryption">Symmetric Encryption</a><ul><li><a href="#supported-ciphers">List Supported Ciphers</a><li><a href="#encrypt-string-with-aes-128-ecb">Encrypt String with AES-128-ECB</a><li><a href="#encrypt-string-with-aes-256-cbc">Encrypt String with AES-256-CBC</a><li><a href="#encrypt-string-with-aes-256-gcm">Encrypt String with AES-256-GCM</a></ul><li><a href="#hash-functions">Hash Functions</a><ul><li><a href="#hash-functions">List Supported Hash Functions</a><li><a href="#hashing-a-string-example">Hashing a String Example</a><li><a href="#hashing-a-file-example">Hashing a File Example</a></ul><li><a href="#hmac-generation">HMAC Generation</a><li><a href="#elliptic-curve-diffie-hellman">Elliptic-Curve Diffie-Hellman</a><ul><li><a href="#supported-curves">List Supported Curves</a><li><a href="#ecdh-example">ECDH Example</a></ul></ol><h1 id="symmetric-encryption">Symmetric Encryption</h1><p>For a quick refresher, Symmetric Encryption is when only a single key is used. The same key is used for both encryption and decryption of the data.</p><h2 id="supported-ciphers"><span class="me-2">Supported Ciphers</span><a href="#supported-ciphers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can see which ciphers are supported in NodeJS by using the following code:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>  
  
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">crypto</span><span class="p">.</span><span class="nf">getCiphers</span><span class="p">());</span>  
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">crypto.getCiphers()</code> returns a list of strings of all the ciphers that are supported. From the list we’ll choose <code class="language-plaintext highlighter-rouge">aes-256-ctr</code>. Let’s now see how to encrypt &amp; decrypt some data using our chosen mode.</p><h2 id="encrypt-string-with-aes-128-ecb"><span class="me-2">Encrypt String with AES-128-ECB</span><a href="#encrypt-string-with-aes-128-ecb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">ABCDEFGHIJKLMNOP</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// The Secret Message</span>
<span class="kd">let</span> <span class="nx">secret_msg</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">To be Encrypted!</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Encrypt</span>
<span class="kd">let</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createCipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-128-ecb</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">encryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">cipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">secret_msg</span><span class="p">),</span> <span class="nx">cipher</span><span class="p">.</span><span class="nf">final</span><span class="p">()]);</span>

<span class="c1">// Decrypt</span>
<span class="kd">let</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createDecipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-128-ecb</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">decryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">decipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">),</span> <span class="nx">decipher</span><span class="p">.</span><span class="nf">final</span><span class="p">()]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`\nEncryption Key: </span><span class="p">${</span><span class="nx">key</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t"</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t"</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)}</span><span class="s2">"`</span><span class="p">);</span>
</pre></table></code></div></div><ul><li>This is just an example, please don’t ever use ECB in practice.</ul><h2 id="encrypt-string-with-aes-256-cbc"><span class="me-2">Encrypt String with AES-256-CBC</span><a href="#encrypt-string-with-aes-256-cbc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">ABCDEFGHIJKLMNOPabcdefghijklmnop</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">000102030405060708090a0b0c0d0e0f</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// The Secret Message</span>
<span class="kd">let</span> <span class="nx">secret_msg</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">To be Encrypted!</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Encrypt</span>
<span class="kd">let</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createCipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-256-cbc</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">encryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">cipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">secret_msg</span><span class="p">),</span> <span class="nx">cipher</span><span class="p">.</span><span class="nf">final</span><span class="p">()]);</span>

<span class="c1">// Decrypt</span>
<span class="kd">let</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createDecipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-256-cbc</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">decryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">decipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">),</span> <span class="nx">decipher</span><span class="p">.</span><span class="nf">final</span><span class="p">()]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`\nEncryption Key: </span><span class="p">${</span><span class="nx">key</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`IV: \t\t</span><span class="p">${</span><span class="nx">iv</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">\n`</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t"</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t"</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)}</span><span class="s2">"`</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="encrypt-string-with-aes-256-gcm"><span class="me-2">Encrypt String with AES-256-GCM</span><a href="#encrypt-string-with-aes-256-gcm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">ABCDEFGHIJKLMNOPabcdefghijklmnop</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">iv</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">000102030405060708090a0b0c0d0e0f</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">authTagLength</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="c1">// The Secret Message</span>
<span class="kd">let</span> <span class="nx">secret_msg</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="dl">'</span><span class="s1">To be Encrypted!</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Encrypt</span>
<span class="kd">let</span> <span class="nx">cipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createCipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-256-gcm</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="p">{</span> <span class="nx">authTagLength</span> <span class="p">});</span>
<span class="kd">let</span> <span class="nx">encryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">cipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">secret_msg</span><span class="p">),</span> <span class="nx">cipher</span><span class="p">.</span><span class="nf">final</span><span class="p">(),</span> <span class="nx">cipher</span><span class="p">.</span><span class="nf">getAuthTag</span><span class="p">()]);</span>

<span class="c1">// Separate the encrypted data from the Auth Tag</span>
<span class="kd">let</span> <span class="nx">dataToDecrypt</span> <span class="o">=</span> <span class="nx">encryptedData</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">encryptedData</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">authTagLength</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">authTag</span> <span class="o">=</span> <span class="nx">encryptedData</span><span class="p">.</span><span class="nf">slice</span><span class="p">(</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">authTagLength</span><span class="p">,</span> <span class="nx">encryptedData</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

<span class="c1">// Decrypt</span>
<span class="kd">let</span> <span class="nx">decipher</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createDecipheriv</span><span class="p">(</span><span class="dl">'</span><span class="s1">aes-256-gcm</span><span class="dl">'</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">iv</span><span class="p">,</span> <span class="p">{</span> <span class="nx">authTagLength</span> <span class="p">});</span>
<span class="nx">decipher</span><span class="p">.</span><span class="nf">setAuthTag</span><span class="p">(</span><span class="nx">authTag</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">decryptedData</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="nx">decipher</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">dataToDecrypt</span><span class="p">),</span> <span class="nx">decipher</span><span class="p">.</span><span class="nf">final</span><span class="p">()]);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`\nEncryption Key: </span><span class="p">${</span><span class="nx">key</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`IV: \t\t</span><span class="p">${</span><span class="nx">iv</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">\n`</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t"</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">}</span><span class="s2">"`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Plain-text: \t</span><span class="p">${</span><span class="nx">secret_msg</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Encrypted: \t</span><span class="p">${</span><span class="nx">encryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`Decrypted: \t"</span><span class="p">${</span><span class="nx">decryptedData</span><span class="p">.</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">utf-8</span><span class="dl">'</span><span class="p">)}</span><span class="s2">"`</span><span class="p">);</span>
</pre></table></code></div></div><p>Note, the cipher and decipher objects created will automatically use PKCS padding. This can be disabled with the <code class="language-plaintext highlighter-rouge">setAutoPadding</code> function if needed.</p><p><br /></p><h1 id="hash-functions">Hash Functions</h1><h2 id="list-supported-hash-functions"><span class="me-2">List Supported Hash Functions</span><a href="#list-supported-hash-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can see which hash functions are supported in NodeJS by using the following code:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">crypto</span><span class="p">.</span><span class="nf">getHashes</span><span class="p">());</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">crypto.getHashes()</code> returns a list of strings of all the hash functions that are supported.</p><h2 id="hashing-a-string-example"><span class="me-2">Hashing a String Example</span><a href="#hashing-a-string-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// String to be hashed</span>
<span class="kd">let</span> <span class="nx">msgToHash</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Password1</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Create Hash Functions</span>
<span class="kd">let</span> <span class="nx">MD4_HashFunction</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">md4</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">NTLM_HashFunction</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">md4</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">SHA256_HashFunction</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">SHA3_256_HashFunction</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha3-256</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Add data to the hash function</span>
<span class="nx">MD4_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">msgToHash</span><span class="p">);</span>
<span class="nx">NTLM_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">msgToHash</span><span class="p">,</span> <span class="dl">'</span><span class="s1">utf16le</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">msgToHash</span><span class="p">);</span>
<span class="nx">SHA3_256_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">msgToHash</span><span class="p">);</span>

<span class="c1">// Get the result</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">MD4:</span><span class="se">\t\t</span><span class="dl">'</span><span class="p">,</span> <span class="nx">MD4_HashFunction</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">NTLM:</span><span class="se">\t\t</span><span class="dl">'</span><span class="p">,</span> <span class="nx">NTLM_HashFunction</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">SHA256:</span><span class="se">\t\t</span><span class="dl">'</span><span class="p">,</span> <span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">SHA3-256:</span><span class="se">\t</span><span class="dl">'</span><span class="p">,</span> <span class="nx">SHA3_256_HashFunction</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">));</span>
</pre></table></code></div></div><p>The <code class="language-plaintext highlighter-rouge">update</code> function can be called multiple times before getting the output hash. For example:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="dl">"</span><span class="s2">Pass</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="dl">"</span><span class="s2">word1</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><p>is the same as:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="dl">"</span><span class="s2">Password1</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="hashing-a-file-example"><span class="me-2">Hashing a File Example</span><a href="#hashing-a-file-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Target file that we what to calculate the hash of</span>
<span class="kd">const</span> <span class="nx">targetFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">input-file.txt</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Create Hash Function</span>
<span class="kd">const</span> <span class="nx">SHA256_HashFunction</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha256</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">setEncoding</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Create a read stream with the target file</span>
<span class="kd">const</span> <span class="nx">inputFileStream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">createReadStream</span><span class="p">(</span><span class="nx">targetFile</span><span class="p">);</span>

<span class="c1">// Callback for when Hashing is complete</span>
<span class="nx">inputFileStream</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">end</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">end</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">SHA256_HashFunction</span><span class="p">.</span><span class="nf">read</span><span class="p">());</span>
<span class="p">});</span>

<span class="c1">// Read the file contents and pipe it into the hash object</span>
<span class="nx">inputFileStream</span><span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">SHA256_HashFunction</span><span class="p">);</span>
</pre></table></code></div></div><p><br /></p><h1 id="hmac-generation">HMAC Generation</h1><p>Ideally a NIST approved hash function should be used:</p><ul><li>SHA-224, SHA-256, SHA-384, SHA-512, SHA-512/224, &amp; SHA-512/256<li>SHA3-224, SHA3-256, SHA3-384, &amp; SHA3-512</ul><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Create the HMAC Function with the desired hash function and key.</span>
<span class="kd">const</span> <span class="nx">hmac</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHmac</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha3-256</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">MySecretKey</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Add data to the HMAC</span>
<span class="nx">hmac</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="dl">'</span><span class="s1">My data</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Get the result</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">HMAC:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">hmac</span><span class="p">.</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">));</span>
</pre></table></code></div></div><p><br /></p><h1 id="elliptic-curve-diffie-hellman">Elliptic-Curve Diffie-Hellman</h1><h2 id="supported-curves"><span class="me-2">Supported Curves</span><a href="#supported-curves" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can see which curves are supported in NodeJS by using the following code:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">crypto</span><span class="p">.</span><span class="nf">getCurves</span><span class="p">());</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">crypto.getCurves()</code> returns a list of strings of all the elliptic curves that are supported. We’ll use the <code class="language-plaintext highlighter-rouge">sect571k1</code> curve in the below example.</p><h2 id="ecdh-example"><span class="me-2">ECDH Example</span><a href="#ecdh-example" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">alice</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createECDH</span><span class="p">(</span><span class="dl">'</span><span class="s1">sect571k1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">alice</span><span class="p">.</span><span class="nf">generateKeys</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">bob</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createECDH</span><span class="p">(</span><span class="dl">'</span><span class="s1">sect571k1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">bob</span><span class="p">.</span><span class="nf">generateKeys</span><span class="p">();</span>

<span class="c1">// Alice's Data</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="se">\n</span><span class="s2">Alice Public:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">alice</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">().</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Alice Private:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">alice</span><span class="p">.</span><span class="nf">getPrivateKey</span><span class="p">().</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">),</span> <span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Bob's Data</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Bob Public:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bob</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">().</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Bob Private:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">bob</span><span class="p">.</span><span class="nf">getPrivateKey</span><span class="p">().</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">),</span> <span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// The Shared Secret will be the same</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Shared Secret: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">alice</span><span class="p">.</span><span class="nf">computeSecret</span><span class="p">(</span><span class="nx">bob</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Shared Secret: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">bob</span><span class="p">.</span><span class="nf">computeSecret</span><span class="p">(</span><span class="nx">alice</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">(),</span> <span class="kc">null</span><span class="p">,</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">),</span> <span class="dl">"</span><span class="se">\n</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href='/categories/javascript/'>javascript</a>, <a href='/categories/nodejs/'>nodejs</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >javascript</a> <a href="/tags/nodejs/" class="post-tag no-text-decoration" >nodejs</a> <a href="/tags/security/" class="post-tag no-text-decoration" >security</a> <a href="/tags/cryptography/" class="post-tag no-text-decoration" >cryptography</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted me-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=NodeJS%20Crypto%20Module%20-%20Node%20Security&url=%2Fposts%2Fnodejs-crypto%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter" > <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=NodeJS%20Crypto%20Module%20-%20Node%20Security&u=%2Fposts%2Fnodejs-crypto%2F" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook" > <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fnodejs-crypto%2F&text=NodeJS%20Crypto%20Module%20-%20Node%20Security" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram" > <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/rust-cheatsheet/">Rust Cheatsheet</a><li class="text-truncate lh-lg"> <a href="/posts/extract-ntlm-hashes-via-linux-live-boot/">Extract NTLM Hashes via Linux Live Boot</a><li class="text-truncate lh-lg"> <a href="/posts/admin-to-system-with-psexec/">Admin to SYSTEM with PsExec</a><li class="text-truncate lh-lg"> <a href="/posts/user-dumping-with-msol/">User Dumping with MSOL</a><li class="text-truncate lh-lg"> <a href="/posts/windows-uac-privilege-escalation/">Windows UAC Privilege Escalation</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></div></div><div id="toc-wrapper" class="ps-0 pe-4 mb-5"><div class="panel-heading ps-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ms-1" data-toc-skip> Further Reading</h3><div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><div class="col"> <a href="/posts/secure-electron-ipc/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1630049217" data-df="ll" > Aug 27, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>Secure Electron IPC</h4><div class="text-muted small"><p> In this post we’ll look at how to do secure IPC (Inter-Process-Communication) in Electron. PLEASE NOTE this is NOT a tutorial on Electron or Electron IPC, it will assume you already know how to us...</p></div></div></a></div><div class="col"> <a href="/posts/express-cert-based-mutual-auth/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1630963538" data-df="ll" > Sep 7, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>NodeJS Express Cert Based Mutual Auth</h4><div class="text-muted small"><p> In this post we’ll look at how to add Certificate Based Mutual Authentication to an express HTTPS server. This will allow us to require a User Certificate before being able to communicate with out ...</p></div></div></a></div><div class="col"> <a href="/posts/express-http-server/" class="card post-preview h-100"><div class="card-body"> <em class="small" data-ts="1617953560" data-df="ll" > Apr 9, 2021 </em><h4 class="pt-0 my-2" data-toc-skip>NodeJS Express HTTP Server</h4><div class="text-muted small"><p> In this post we’ll look at how to build a simple HTTP server in NodeJS using the express framework. Server Setup Required Packages Basic Setup Express Basics ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older" ><p>-</p></div><a href="/posts/openssl-testing-cipher-suite/" class="btn btn-outline-primary" prompt="Newer" ><p>OpenSSL Testing a Cipher Suite</p></a></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/security/">security</a> <a class="post-tag btn btn-outline-primary" href="/tags/javascript/">javascript</a> <a class="post-tag btn btn-outline-primary" href="/tags/cryptography/">cryptography</a> <a class="post-tag btn btn-outline-primary" href="/tags/web/">web</a> <a class="post-tag btn btn-outline-primary" href="/tags/http/">http</a> <a class="post-tag btn btn-outline-primary" href="/tags/https/">https</a> <a class="post-tag btn btn-outline-primary" href="/tags/algorithm/">algorithm</a> <a class="post-tag btn btn-outline-primary" href="/tags/programming/">programming</a> <a class="post-tag btn btn-outline-primary" href="/tags/windows/">windows</a> <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">nodejs</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div></div><footer><div class="container px-lg-4"><div class="d-flex justify-content-center align-items-center text-muted mx-md-3"><p>Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a></p><p>© 2024 <a href="https://twitter.com/todo">Alexander Wells</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p></div></div></footer><div id="mask"></div><button id="back-to-top" aria-label="back-to-top" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.0/dist/jquery.min.js,npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.7/dayjs.min.js,npm/dayjs@1.11.7/locale/en.min.js,npm/dayjs@1.11.7/plugin/relativeTime.min.js,npm/dayjs@1.11.7/plugin/localizedFormat.min.js,npm/tocbot@4.21.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5"></p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
